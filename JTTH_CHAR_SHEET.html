<div class="sheet-core">
    <div class="sheet-section-roll">
        <input type="hidden" name="attr_wtype" class="sheet-roll-toggle">
        <div class="sheet-section-roll-whisper">
            <label class="sheet-radio">
                <input type="radio" name="attr_whispertoggle" value="" checked="checked">
                <span title="@{whispertoggle}">Public</span>
            </label>
            <label class="sheet-radio">
                <input type="radio" name="attr_whispertoggle" value="/w gm ">
                <span title="@{whispertoggle}">To GM</span>
            </label>
        </div>
    </div>
    <div class="sheet-section-main">
        <div class="sheet-main-header">
            <div class="sheet-header-avatar">
                <img name="attr_character_avatar">
            </div>
            <div class="sheet-header-details">
                <div class="sheet-detail sheet-detail-name">
                    <div class="sheet-detail-label">Name:</div>
                    <div class="sheet-detail-value">
                        <input type="text" name="attr_character_name" title="@{character_name}">
                    </div>
                </div>
                <div class="sheet-detail sheet-detail-ancestry_species">
                    <div class="sheet-detail-label">Ancestry & Species:</div>
                    <div class="sheet-detail-value">
                        <input type="text" name="attr_ancestry_species" title="@{ancestry_species}">
                    </div>
                </div>
                <div class="sheet-detail sheet-detail-mortal-path">
                    <div class="sheet-detail-label">Mortal Path:</div>
                    <div class="sheet-detail-value">
                        <input type="text" name="attr_mortal-path" title="@{mortal-path}">
                    </div>
                </div>
                <div class="sheet-detail sheet-detail-mortal-level">
                    <div class="sheet-detail-label">Level:</div>
                    <div class="sheet-detail-value">
                        <input type="number" name="attr_mortal-level" title="@{mortal-level}">
                    </div>
                </div>
                <div class="sheet-detail sheet-detail-cultivator-path">
                    <div class="sheet-detail-label">Cultivator Path:</div>
                    <div class="sheet-detail-value">
                        <input type="text" name="attr_cultivator-path" title="@{cultivator-path}">
                    </div>
                </div>
                <div class="sheet-detail sheet-detail-cultivator-realm">
                    <div class="sheet-detail-label">Realm:</div>
                    <div class="sheet-detail-value">
                        <input type="text" name="attr_cultivator-realm" title="@{cultivator-realm}">
                    </div>
                </div>
            </div>
        </div>
        <div class="sheet-main-body">
            <div class="sheet-pages">
                <div class="sheet-page sheet-page-mortal">
                    <input type="radio" name="attr_page" value="mortal" checked="checked">
                    <span class="sheet-page-label">MORTAL</span>
                    <div class="sheet-page-content">
                        <div class="sheet-container-well sheet-well-attributes">
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_power" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Power}} {{r1=[[@{power}d6[power]+@{power_check_bonus}[BONUS]+@{global_attribute_check_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">POWER</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_power_base" title="@{power_base}" value="0">
                                    <input type="hidden" name="attr_power" value="0">
                                    <input type="hidden" name="attr_power_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_power" title="@{power}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_power_dc" title="@{power_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_agility" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Agility}} {{r1=[[@{agility}d6[agility]+@{agility_check_bonus}[BONUS]+@{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">AGILITY</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_agility_base" title="@{agility_base}" value="0">
                                    <input type="hidden" name="attr_agility" value="0">
                                    <input type="hidden" name="attr_agility_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_agility" title="@{agility}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_agility_dc" title="@{agility_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_vitality" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Vitality}} {{r1=[[@{vitality}d6[vitality]+@{vitality_check_bonus}[BONUS]+@{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">VITALITY</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_vitality_base" title="@{vitality_base}" value="0">
                                    <input type="hidden" name="attr_vitality" value="0">
                                    <input type="hidden" name="attr_vitality_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_vitality" title="@{vitality}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_vitality_dc" title="@{vitality_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_cultivation" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Cultivation}} {{r1=[[@{cultivation}d6[cultivation]+@{cultivation_check_bonus}[BONUS]+@{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">CULTIVATION</span>
                                </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_cultivation_base" title="@{cultivation_base}" value="0">
                                    <input type="hidden" name="attr_cultivation" value="0">
                                    <input type="hidden" name="attr_cultivation_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_cultivation" title="@{cultivation}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_cultivation_dc" title="@{cultivation_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_qicontrol" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Qicontrol}} {{r1=[[@{qicontrol}d6[qicontrol]+@{qicontrol_check_bonus}[BONUS]+@{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">QI CONTROL</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_qicontrol_base" title="@{qicontrol_base}" value="0">
                                    <input type="hidden" name="attr_qicontrol" value="0">
                                    <input type="hidden" name="attr_qicontrol_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_qicontrol" title="@{qicontrol}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_qicontrol_dc" title="@{qicontrol_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_mental" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Mental}} {{r1=[[@{mental}d6[mental]+@{mental_check_bonus}[BONUS]+@{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">MENTAL</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_mental_base" title="@{mental_base}" value="0">
                                    <input type="hidden" name="attr_mental" value="0">
                                    <input type="hidden" name="attr_mental_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_mental" title="@{mental}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_mental_dc" title="@{mental_dc}">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-columns">
                            <div class="col col1">
                                <div class="sheet-container-panel sheet-container-skills">
                                    <div class="sheet-container-header">SKILLS</div>
                                    <div class="sheet-container-body">
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_acrobatics" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Acrobatics}} {{r1=[[@{acrobatics_roll}d6+@{acrobatics_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Acrobatics</span>
                                                <span name="attr_acrobatics">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_athletics" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Athletics}} {{r1=[[@{athletics_roll}d6+@{athletics_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Athletics</span>
                                                <span name="attr_athletics">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_deceit" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Deceit}} {{r1=[[@{deceit_roll}d6+@{deceit_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Deceit</span>
                                                <span name="attr_deceit">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_discretion" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Discretion}} {{r1=[[@{discretion_roll}d6+@{discretion_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Discretion</span>
                                                <span name="attr_discretion">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_disguise" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Disguise}} {{r1=[[@{disguise_roll}d6+@{disguise_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Disguise</span>
                                                <span name="attr_disguise">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_fine_arts" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Fine_arts}} {{r1=[[@{fine_arts_roll}d6+@{fine_arts_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Fine Arts</span>
                                                <span name="attr_fine_arts">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_forgery" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Forgery}} {{r1=[[@{forgery_roll}d6+@{forgery_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Forgery</span>
                                                <span name="attr_forgery">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_grapple" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Grapple}} {{r1=[[@{grapple_roll}d6+@{grapple_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Grapple</span>
                                                <span name="attr_grapple">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_history" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=History}} {{r1=[[@{history_roll}d6+@{history_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>History</span>
                                                <span name="attr_history">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_intuition" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Intuition}} {{r1=[[@{intuition_roll}d6+@{intuition_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Intuition</span>
                                                <span name="attr_intuition">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_intimidation" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Intimidation}} {{r1=[[@{intimidation_roll}d6+@{intimidation_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Intimidation</span>
                                                <span name="attr_intimidation">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_investigation" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Investigation}} {{r1=[[@{investigation_roll}d6+@{investigation_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Investigation</span>
                                                <span name="attr_investigation">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_medicine" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Medicine}} {{r1=[[@{medicine_roll}d6+@{medicine_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Medicine</span>
                                                <span name="attr_medicine">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_navigation" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Navigation}} {{r1=[[@{navigation_roll}d6+@{navigation_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Navigation</span>
                                                <span name="attr_navigation">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_perception" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Perception}} {{r1=[[@{perception_roll}d6+@{perception_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Perception</span>
                                                <span name="attr_perception">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_performance" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Performance}} {{r1=[[@{performance_roll}d6+@{performance_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Performance</span>
                                                <span name="attr_performance">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_persuade" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Persuade}} {{r1=[[@{persuade_roll}d6+@{persuade_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Persuade</span>
                                                <span name="attr_persuade">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_seduce" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Seduce}} {{r1=[[@{seduce_roll}d6+@{seduce_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Seduce</span>
                                                <span name="attr_seduce">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_stealth" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Stealth}} {{r1=[[@{stealth_roll}d6+@{stealth_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Stealth</span>
                                                <span name="attr_stealth">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_survival" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Survival}} {{r1=[[@{survival_roll}d6+@{survival_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Survival</span>
                                                <span name="attr_survival">0d6</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-container-tools">
                                    <div class="sheet-container-header">TOOLS</div>
									<div class="sheet-container-body">
                                        <fieldset class="repeating_mortaltool">
                                            <div class="sheet-fieldset-item sheet-fieldset-item-tool">
                                                <div class="sheet-checkbox-cog">
                                                    <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                    <span class="sheet-toggle-icon"></span>
                                                </div>
                                                <input type="checkbox" name="attr_options-flag" checked="checked" hidden class="sheet-toggle">
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-form">
                                                        <div class="sheet-form-header">Edit Tool</div>
                                                        <div class="sheet-form-body">
                                                            <div class="sheet-form-group">
                                                                <label>Name:</label>
                                                                <input type="text" name="attr_toolname">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Roll:</label>
                                                                <input type="text" name="attr_tool_roll" title="@{tool_roll}" value="0">
                                                                <label>Mods:</label>
                                                                <input type="text" name="attr_tool_mod" title="@{tool_mod}" value="0">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-toggle-unchecked">
                                                    <div class="sheet-pc-tool">
                                                        <button type="roll" name="roll_roll" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=@{toolname}}} {{r1=[[@{tool_roll}+@{tool_mod}[BONUS]]]}} {{type=Custom}}">
                                                            <span name="attr_toolname"></span>
                                                            <span name="attr_tool_roll"></span>
                                                            <span>+</span>
                                                            <span name="attr_tool_mod"></span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </div>
                            <div class="col col2">
                                <div class="sheet-container-panel sheet-panel-hp">
                                    <div class="sheet-container-header">HEALTH</div>
                                    <div class="sheet-container-body">
                                        <div class="sheet-container-box sheet-pc-health">
                                            <div class="sheet-box-body sheet-health">
                                                <input type="number" name="attr_hp_max" title="@{hp_max}" placeholder="MAXIMUM">
                                                <input type="number" name="attr_hp" title="@{hp}" placeholder="CURRENT">
                                            </div>
                                        </div>
                                        <div class="sheet-container-box sheet-pc-health">
                                            <div class="sheet-box-body sheet-health-extra">
                                                <div class="sheet-box">
                                                    <span>Temp</span>
                                                    <input type="number" name="attr_hp_temp" title="@{hp_temp}" placeholder="0">
                                                </div>
                                                <div class="sheet-box">
                                                    <span>Dice</span>
                                                <input type="text" name="attr_hp_die" title="@{hp_die}" placeholder="1d8">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-container-combat">
                                    <div class="sheet-container-header">COMBAT</div>
                                    <div class="sheet-container-body">
                                        <div class="sheet-container-box sheet-pc-initiative">
                                            <div class="sheet-container-bar">
                                                <button type="roll" name="roll_init" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Initiative}} {{r1=[[@{agility}d6[INIT]+@{initiative_bonus} &{tracker}]]}} {{type=Initiative}}">INITIATIVE<span name="attr_initiative" title="@{initiative}"></span></button>
                                            </div>
                                        </div>
                                        <div class="sheet-container-box sheet-pc-defences">
                                            <div class="sheet-defence-label">HYPER RESISTANCE</div>
                                            <input class="sheet-defence" type="text" name="attr_hyper_resistances" title="@{hyper_resistances}">
                                            <div class="sheet-defence-label">RESISTANCE</div>
                                            <input class="sheet-defence" type="text" name="attr_resistances" title="@{resistances}">
                                            <div class="sheet-defence-label">WEAKNESS</div>
                                            <input class="sheet-defence" type="text" name="attr_weakness" title="@{weakness}">
                                            <div class="sheet-defence-label">HYPER WEAKNESS</div>
                                            <input class="sheet-defence" type="text" name="attr_hyper_weakness" title="@{hyper_weakness}">
                                        </div>
                                        <div class="sheet-container-box sheet-pc-evasion-durability">
                                            <div class="sheet-pc-evasion-group">
                                                <div class="sheet-pc-evasion-full">
                                                    <span class="sheet-evasion-full" name="attr_evasion-full" title="@{evasion-full}">0</span>
                                                    <div class="sheet-pc-defence-label">EVA</div>
                                                </div>
                                                <div class="sheet-pc-evasion-base">
                                                    <input class="sheet-evasion-base" type="number" name="attr_evasion-base" title="@{evasion-base}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BASE</div>
                                                </div>
                                                <div class="sheet-pc-evasion-bonus">
                                                    <input class="sheet-evasion-bonus" type="number" name="attr_evasion-bonus" title="@{evasion-bonus}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BONUS</div>
                                                </div>
                                            </div>
                                            <div class="sheet-pc-reduction-group">
                                                <div class="sheet-pc-reduction-full">
                                                    <span class="sheet-reduction-full" name="attr_reduction-full" title="@{reduction-full}">0</span>
                                                    <div class="sheet-pc-defence-label">DR</div>
                                                </div>
                                                <div class="sheet-pc-reduction-base">
                                                    <input class="sheet-reduction-base" type="number" name="attr_reduction-base" title="@{reduction-base}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BASE</div>
                                                </div>
                                                <div class="sheet-pc-reduction-armour">
                                                    <input class="sheet-reduction-armour" type="number" name="attr_reduction-armour" title="@{reduction-armour}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">ARMOUR</div>
                                                </div>
                                                <div class="sheet-pc-reduction-bonus">
                                                    <input class="sheet-reduction-bonus" type="number" name="attr_reduction-bonus" title="@{reduction-bonus}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BONUS</div>
                                                </div>
                                            </div>
                                            <div class="sheet-pc-speed-group">
                                                <div class="sheet-pc-speed-movement">
                                                    <input class="sheet-movement-movement" type="number" name="attr_movement" title="@{movement}"placeholder="0">
                                                    <div class="sheet-pc-defence-label">SPEED</div>
                                                </div>
                                                <div class="sheet-pc-speed-swim">
                                                    <input class="sheet-movement-swim" type="number" name="attr_swim" title="@{swim}"placeholder="0">
                                                    <div class="sheet-pc-defence-label">SWIM</div>
                                                </div>
                                                <div class="sheet-pc-speed-climb">
                                                    <input class="sheet-movement-climb" type="number" name="attr_climb" title="@{climb}"placeholder="0">
                                                    <div class="sheet-pc-defence-label">CLIMB</div>
                                                </div>
                                                <div class="sheet-pc-speed-fly">
                                                    <input class="sheet-movement-fly" type="number" name="attr_fly" title="@{fly}"placeholder="0">
                                                    <div class="sheet-pc-defence-label">FLY</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="sheet-container-attacks">
                                    <div class="sheet-container-panel sheet-panel-bonuses">
                                        <div class="sheet-container-header">ATTACK MODIFIERS</div>
                                        <input class="sheet-hidden" type="checkbox" name="attr_global_attack_mod_flag" title="@{global_attack_mod_flag}" value="1">
                                        <div class="sheet-container-body">
                                            <fieldset class="repeating_mortaltohitmod">
                                                <div class="sheet-fieldset-item">
                                                    <div class="sheet-checkbox-cog">
                                                        <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                        <span class="sheet-toggle-icon"></span>
                                                    </div>
                                                    <input type="checkbox" name="attr_options-flag" checked="checked" hidden class="sheet-toggle">
                                                    <div class="sheet-toggle-checked">
                                                        <div class="sheet-form">
                                                            <div class="sheet-form-header">Edit Modifier</div>
                                                            <div class="sheet-form-body">
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_global_attack_active_flag" value="1">
                                                                    </label>
                                                                    <input type="text" name="attr_global_attack_name">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Roll:</label>
                                                                    <input type="text" name="attr_global_attack_roll">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Applied To:</label>
                                                                    <select name="attr_global_attack_appliesto">
                                                                        <option value="Both" selected>Both</option>
                                                                        <option value="Accuracy">Accuracy</option>
                                                                        <option value="Effectiveness">Effectiveness</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="sheet-toggle-unchecked">
                                                        <div class="sheet-pc-attack-modifier">
                                                            <div class="sheet-checkbox-image">
                                                                <input type="checkbox" name="attr_global_attack_active_flag" value="1">
                                                                <span></span>
                                                            </div>
                                                            <span name="attr_global_attack_name"></span>
                                                            <span name="attr_global_attack_roll"></span>
                                                            <span name="attr_global_attack_appliesto"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </div>
                                    </div>
                                    <div class="sheet-container-panel sheet-panel-bonuses">
                                        <div class="sheet-container-header">DAMAGE MODIFIERS</div>
                                        <input class="sheet-hidden" type="checkbox" name="attr_global_damage_mod_flag" title="@{global_damage_mod_flag}" value="1">
                                        <div class="sheet-container-body">
                                            <fieldset class="repeating_mortaldamagemod">
                                                <div class="sheet-fieldset-item">
                                                    <div class="sheet-checkbox-cog">
                                                        <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                        <span class="sheet-toggle-icon"></span>
                                                    </div>
                                                    <input type="checkbox" name="attr_options-flag" checked="checked" hidden class="sheet-toggle">
                                                    <div class="sheet-toggle-checked">
                                                        <div class="sheet-form">
                                                            <div class="sheet-form-header">Edit Modifier</div>
                                                            <div class="sheet-form-body">
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_global_damage_active_flag" value="1">
                                                                    </label>
                                                                    <input type="text" name="attr_global_damage_name">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Damage:</label>
                                                                    <input type="text" name="attr_global_damage_damage" value="">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Type:</label>
                                                                    <input type="text" name="attr_global_damage_type" value="">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="sheet-toggle-unchecked">
                                                        <div class="sheet-pc-attack-damage-modifier">
                                                            <div class="sheet-checkbox-image">
                                                                <input type="checkbox" name="attr_global_damage_active_flag" value="1">
                                                                <span></span>
                                                            </div>
                                                            <span name="attr_global_damage_name"></span>
                                                            <span name="attr_global_damage_damage"></span>
                                                            <span name="attr_global_damage_type"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </div>
                                    </div>
                                    <div class="sheet-container-panel sheet-panel-attacks">
                                        <div class="sheet-container-header">ATTACKS</div>
                                        <div class="sheet-container-body">
                                            <fieldset class="repeating_mortalattack">
                                                <div class="sheet-fieldset-item">
                                                    <div class="sheet-checkbox-cog">
                                                        <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                        <span class="sheet-toggle-icon"></span>
                                                    </div>
                                                    <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                                    <div class="sheet-toggle-checked">
                                                        <div class="sheet-form">
                                                            <div class="sheet-form-header">Edit Attack</div>
                                                            <div class="sheet-form-body">
                                                                <div class="sheet-form-group">
                                                                    <label>Name:</label>
                                                                    <input type="text" name="attr_atkname">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_atkflag" value="{{attack=1}}" checked="checked">
                                                                        <span>Attack:</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <select name="attr_atkattr_base">
                                                                        <option value="@{power}" selected="selected">PWR</option>
                                                                        <option value="@{agility}">AGI</option>
                                                                        <option value="@{vitality}">VIT</option>
                                                                        <option value="@{cultivation}">CUL</option>
                                                                        <option value="@{qicontrol}">QIC</option>
                                                                        <option value="@{mental}">MTL</option>
                                                                        <option value="0">-</option>
                                                                    </select>
                                                                    <span>+</span>
                                                                    <input type="text" name="attr_atkmod" placeholder="0">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Range:</label>
                                                                    <input type="text" name="attr_atkrange">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_dmgflag" value="{{damage=1}} {{dmgflag=1}}" checked="checked">
                                                                        <span>Damage 1</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Dmg</label>
                                                                    <input type="text" name="attr_dmgbase">
                                                                    <span>+</span>
                                                                    <select name="attr_dmgattr">
                                                                        <option value="@{power}" selected="selected">PWR</option>
                                                                        <option value="@{agility}">AGI</option>
                                                                        <option value="@{vitality}">VIT</option>
                                                                        <option value="@{cultivation}">CUL</option>
                                                                        <option value="@{qicontrol}">QIC</option>
                                                                        <option value="@{mental}">MTL</option>
                                                                        <option value="0">-</option>
                                                                    </select>
                                                                    <span>+</span>
                                                                    <label>Mod</label>
                                                                    <input type="text" name="attr_dmgmod">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Type:</label>
                                                                    <input type="text" name="attr_dmgtype">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_dmg2flag" value="{{damage=1}} {{dmg2flag=1}}">
                                                                        <span>Damage 2</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Dmg</label>
                                                                    <input type="text" name="attr_dmg2base">
                                                                    <span>+</span>
                                                                    <select name="attr_dmg2attr">
                                                                        <option value="@{power}">PWR</option>
                                                                        <option value="@{agility}">AGI</option>
                                                                        <option value="@{vitality}">VIT</option>
                                                                        <option value="@{cultivation}">CUL</option>
                                                                        <option value="@{qicontrol}">QIC</option>
                                                                        <option value="@{mental}">MTL</option>
                                                                        <option value="0" selected="selected">-</option>
                                                                    </select>
                                                                    <span>+</span>
                                                                    <label>Mod</label>
                                                                    <input type="text" name="attr_dmg2mod">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Type:</label>
                                                                    <input type="text" name="attr_dmg2type">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_dmg3flag" value="{{damage=1}} {{dmg3flag=1}}">
                                                                        <span>Damage 3</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Dmg</label>
                                                                    <input type="text" name="attr_dmg3base">
                                                                    <span>+</span>
                                                                    <select name="attr_dmg3attr">
                                                                        <option value="@{power}">PWR</option>
                                                                        <option value="@{agility}">AGI</option>
                                                                        <option value="@{vitality}">VIT</option>
                                                                        <option value="@{cultivation}">CUL</option>
                                                                        <option value="@{qicontrol}">QIC</option>
                                                                        <option value="@{mental}">MTL</option>
                                                                        <option value="0" selected="selected">-</option>
                                                                    </select>
                                                                    <span>+</span>
                                                                    <label>Mod</label>
                                                                    <input type="text" name="attr_dmg3mod">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Type:</label>
                                                                    <input type="text" name="attr_dmg3type">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_saveflag" value="{{saveflag=1}} {{saveattr=@{saveattr}}} {{savedesc=@{saveeffect}}} {{savedc=[[[[@{savedc}]]]]}}">
                                                                        <span>Attribute Check</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <select name="attr_saveattr">
                                                                        <option value="Power" selected="selected">PWR</option>
                                                                        <option value="Agility">AGI</option>
                                                                        <option value="Vitality">VIT</option>
                                                                        <option value="Cultivation">CUL</option>
                                                                        <option value="Qi Control">QIC</option>
                                                                        <option value="Mental">MTL</option>
                                                                    </select>
                                                                    <label>vs DC:</label>
                                                                    <select name="attr_savedc">
                                                                        <option value="(@{power_dc})">PWR</option>
                                                                        <option value="(@{agility_dc})">AGI</option>
                                                                        <option value="(@{vitality_dc})">VIT</option>
                                                                        <option value="(@{cultivation_dc})">CUL</option>
                                                                        <option value="(@{qicontrol_dc})">QIC</option>
                                                                        <option value="(@{mental_dc})">MTL</option>
                                                                        <option value="(@{saveflat})">FLAT</option>
                                                                    </select>
                                                                    <input type="hidden" name="attr_savedc">
                                                                    <input type="text" name="attr_saveflat" value="10">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Pass Effect:</label>
                                                                    <input type="text" name="attr_saveeffect">
                                                                </div>
                                                                <div class="sheet-form-group sheet-form-group-column">
                                                                    <label>Description:</label>
                                                                    <textarea name="attr_atk_desc"></textarea>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="sheet-toggle-unchecked">
                                                        <div class="sheet-pc-attack">
                                                            <input type="text" name="attr_atkbonus" class="sheet-hidden" value="">
                                                            <input type="text" name="attr_atkdmgtype" class="sheet-hidden" value="">
                                                            <button type="roll" name="roll_attack" value="@{rollbase}" class="sheet-attack-button">
                                                                <span name="attr_atkname"></span>
                                                                <span name="attr_atkbonus"></span>
                                                                <span name="attr_atkdmgtype"></span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <input type="hidden" name="attr_rollbase">
                                                <input type="hidden" name="attr_rollbase_dmg">
                                                <button type="roll" name="roll_attack_dmg" value="@{rollbase_dmg}" class="dmgroll"></button>
                                            </fieldset>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col col3">
                                <div class="sheet-container-panel sheet-container-traits">
                                    <div class="sheet-container-header">TRAITS</div>
                                    <div class="sheet-container-body">
                                        <fieldset class="repeating_mortalfeature">
                                            <div class="sheet-fieldset-item sheet-fieldset-item-mortal-feature">
                                                <div class="sheet-checkbox-cog">
                                                    <input type="checkbox" name="attr_options-flag" checked="checked" value="on">
                                                    <span class="sheet-toggle-icon"></span>
                                                </div>
                                                <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-form">
                                                        <div class="sheet-form-header">Edit Trait</div>
                                                        <div class="sheet-form-body">
                                                            <div class="sheet-form-group">
                                                                <label>Name:</label>
                                                                <input type="text" name="attr_name">
                                                            </div>
                                                            <div class="sheet-form-group form-group-description">
                                                                <label>Description:</label>
                                                                <textarea name="attr_desc"></textarea>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-toggle-unchecked">
                                                    <div class="sheet-feature">
                                                        <input class="toggle-feature" type="hidden" name="attr_toggle_feature_desc" value="0">
                                                        <div class="sheet-feature-name">
                                                            <span name="attr_name"></span>
                                                            <input class="toggle-checkbox" type="checkbox" value="1" name="attr_toggle_feature_desc">
                                                        </div>
                                                        <div class="sheet-feature-desc">
                                                            <span name="attr_desc"></span>
                                                        </div>
                                                        <button type="roll" name="roll_trait" value="@{whispertoggle}&{template:features} @{charname_output} {{name=@{name}}} {{description=@{desc}}}" class="output btn">w</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-container-resources">
                                    <div class="sheet-container-header">RESOURCES</div>
                                    <div class="sheet-container-body">
                                        <div class="sheet-resource-labels">
                                            <div class="sheet-resource-label resource-name">NAME</div>
                                            <div class="sheet-resource-label resource-current">CURRENT</div>
                                            <div class="sheet-resource-label resource-max">MAX</div>
                                        </div>
                                        <fieldset class="repeating_mortalresource">
                                            <div class="sheet-fieldset-item">
                                                <div class="sheet-form">
                                                    <div class="sheet-item-resource-name">
                                                        <input class="sheet-resource-name" type="text" name="attr_resource_name" title="@{resource_name}" placeholder="Resource">
                                                    </div>
                                                    <div class="sheet-item-resource-current">
                                                        <input class="sheet-resource-current" type="text" name="attr_resource_current" title="@{resource_current}" placeholder="0">
                                                    </div>
                                                    <div class="sheet-item-resource-max">
                                                        <input class="sheet-resource-max" type="text" name="attr_resource_max" title="@{resource_max}" placeholder="0">
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-page sheet-page-cultivator">
                    <input type="radio" name="attr_page" value="cultivator">
                    <span class="sheet-page-label">CULTIVATOR</span>
                    <div class="sheet-page-content">
                        <div class="sheet-container-well sheet-well-attributes">
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_power" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Power}} {{r1=[[@{power}d6[power]+@{power_check_bonus}[BONUS]+@{global_attribute_check_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">POWER</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_power_base" title="@{power_base}" value="0">
                                    <input type="hidden" name="attr_power" value="0">
                                    <input type="hidden" name="attr_power_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_power" title="@{power}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_power_dc" title="@{power_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_agility" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Agility}} {{r1=[[@{agility}d6[agility]+@{agility_check_bonus}[BONUS]+@{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">AGILITY</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_agility_base" title="@{agility_base}" value="0">
                                    <input type="hidden" name="attr_agility" value="0">
                                    <input type="hidden" name="attr_agility_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_agility" title="@{agility}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_agility_dc" title="@{agility_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_vitality" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Vitality}} {{r1=[[@{vitality}d6[vitality]+@{vitality_check_bonus}[BONUS]+@{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">VITALITY</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_vitality_base" title="@{vitality_base}" value="0">
                                    <input type="hidden" name="attr_vitality" value="0">
                                    <input type="hidden" name="attr_vitality_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_vitality" title="@{vitality}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_vitality_dc" title="@{vitality_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_cultivation" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Cultivation}} {{r1=[[@{cultivation}d6[cultivation]+@{cultivation_check_bonus}[BONUS]+@{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">CULTIVATION</span>
                                </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_cultivation_base" title="@{cultivation_base}" value="0">
                                    <input type="hidden" name="attr_cultivation" value="0">
                                    <input type="hidden" name="attr_cultivation_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_cultivation" title="@{cultivation}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_cultivation_dc" title="@{cultivation_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_qicontrol" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Qicontrol}} {{r1=[[@{qicontrol}d6[qicontrol]+@{qicontrol_check_bonus}[BONUS]+@{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">QI CONTROL</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_qicontrol_base" title="@{qicontrol_base}" value="0">
                                    <input type="hidden" name="attr_qicontrol" value="0">
                                    <input type="hidden" name="attr_qicontrol_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_qicontrol" title="@{qicontrol}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_qicontrol_dc" title="@{qicontrol_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_mental" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Mental}} {{r1=[[@{mental}d6[mental]+@{mental_check_bonus}[BONUS]+@{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">MENTAL</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_mental_base" title="@{mental_base}" value="0">
                                    <input type="hidden" name="attr_mental" value="0">
                                    <input type="hidden" name="attr_mental_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_mental" title="@{mental}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_mental_dc" title="@{mental_dc}">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-columns">
                            <div class="col col1">
                                <div class="sheet-container-panel sheet-container-skills">
                                    <div class="sheet-container-header">SKILLS</div>
                                    <div class="sheet-container-body">
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_acrobatics" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Acrobatics}} {{r1=[[@{acrobatics_roll}d6+@{acrobatics_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Acrobatics</span>
                                                <span name="attr_acrobatics">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_athletics" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Athletics}} {{r1=[[@{athletics_roll}d6+@{athletics_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Athletics</span>
                                                <span name="attr_athletics">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_deceit" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Deceit}} {{r1=[[@{deceit_roll}d6+@{deceit_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Deceit</span>
                                                <span name="attr_deceit">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_discretion" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Discretion}} {{r1=[[@{discretion_roll}d6+@{discretion_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Discretion</span>
                                                <span name="attr_discretion">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_disguise" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Disguise}} {{r1=[[@{disguise_roll}d6+@{disguise_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Disguise</span>
                                                <span name="attr_disguise">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_fine_arts" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Fine_arts}} {{r1=[[@{fine_arts_roll}d6+@{fine_arts_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Fine Arts</span>
                                                <span name="attr_fine_arts">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_forgery" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Forgery}} {{r1=[[@{forgery_roll}d6+@{forgery_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Forgery</span>
                                                <span name="attr_forgery">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_grapple" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Grapple}} {{r1=[[@{grapple_roll}d6+@{grapple_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Grapple</span>
                                                <span name="attr_grapple">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_history" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=History}} {{r1=[[@{history_roll}d6+@{history_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>History</span>
                                                <span name="attr_history">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_intuition" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Intuition}} {{r1=[[@{intuition_roll}d6+@{intuition_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Intuition</span>
                                                <span name="attr_intuition">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_intimidation" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Intimidation}} {{r1=[[@{intimidation_roll}d6+@{intimidation_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Intimidation</span>
                                                <span name="attr_intimidation">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_investigation" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Investigation}} {{r1=[[@{investigation_roll}d6+@{investigation_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Investigation</span>
                                                <span name="attr_investigation">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_medicine" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Medicine}} {{r1=[[@{medicine_roll}d6+@{medicine_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Medicine</span>
                                                <span name="attr_medicine">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_navigation" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Navigation}} {{r1=[[@{navigation_roll}d6+@{navigation_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Navigation</span>
                                                <span name="attr_navigation">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_perception" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Perception}} {{r1=[[@{perception_roll}d6+@{perception_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Perception</span>
                                                <span name="attr_perception">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_performance" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Performance}} {{r1=[[@{performance_roll}d6+@{performance_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Performance</span>
                                                <span name="attr_performance">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_persuade" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Persuade}} {{r1=[[@{persuade_roll}d6+@{persuade_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Persuade</span>
                                                <span name="attr_persuade">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_seduce" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Seduce}} {{r1=[[@{seduce_roll}d6+@{seduce_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Seduce</span>
                                                <span name="attr_seduce">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_stealth" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Stealth}} {{r1=[[@{stealth_roll}d6+@{stealth_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Stealth</span>
                                                <span name="attr_stealth">0d6</span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_survival" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Survival}} {{r1=[[@{survival_roll}d6+@{survival_bonus}[BONUS]+@{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Survival</span>
                                                <span name="attr_survival">0d6</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-container-tools">
                                    <div class="sheet-container-header">TOOLS</div>
                                    <div class="sheet-container-body">
                                        <fieldset class="repeating_cultivatortool">
                                            <div class="sheet-fieldset-item sheet-fieldset-item-tool">
                                                <div class="sheet-checkbox-cog">
                                                    <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                    <span class="sheet-toggle-icon"></span>
                                                </div>
                                                <input type="checkbox" name="attr_options-flag" checked="checked" hidden class="sheet-toggle">
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-form">
                                                        <div class="sheet-form-header">Edit Tool</div>
                                                        <div class="sheet-form-body">
                                                            <div class="sheet-form-group">
                                                                <label>Name:</label>
                                                                <input type="text" name="attr_toolname">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Roll:</label>
                                                                <input type="text" name="attr_tool_roll" title="@{tool_roll}" value="0">
                                                                <label>Mods:</label>
                                                                <input type="text" name="attr_tool_mod" title="@{tool_mod}" value="0">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-toggle-unchecked">
                                                    <div class="sheet-pc-tool">
                                                        <button type="roll" name="roll_roll" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=@{toolname}}} {{r1=[[@{tool_roll}+@{tool_mod}[BONUS]]]}} {{type=Custom}}">
                                                            <span name="attr_toolname"></span>
                                                            <span name="attr_tool_roll"></span>
                                                            <span>+</span>
                                                            <span name="attr_tool_mod"></span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </div>
                            <div class="col col2">
                                <div class="sheet-container-panel sheet-panel-hp">
                                    <div class="sheet-container-header">HEALTH</div>
                                    <div class="sheet-container-body">
                                        <div class="sheet-container-box sheet-pc-health">
                                            <div class="sheet-box-body sheet-health">
                                                <input type="number" name="attr_hp_max" title="@{hp_max}" placeholder="MAXIMUM">
                                                <input type="number" name="attr_hp" title="@{hp}" placeholder="CURRENT">
                                            </div>
                                        </div>
                                        <div class="sheet-container-box sheet-pc-health">
                                            <div class="sheet-box-body sheet-health-extra">
                                                <div class="sheet-box">
                                                    <span>Temp</span>
                                                    <input type="number" name="attr_hp_temp" title="@{hp_temp}" placeholder="0">
                                                </div>
                                                <div class="sheet-box">
                                                    <span>Regen</span>
                                                    <input type="number" name="attr_hp_regen" title="@{hp_regen}" placeholder="0">
                                                </div>
                                                <div class="sheet-box">
                                                    <span>Dice</span>
                                                <input type="text" name="attr_hp_die" title="@{hp_die}" placeholder="1d8">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-container-combat">
                                    <div class="sheet-container-header">COMBAT</div>
                                    <div class="sheet-container-body">
                                        <div class="sheet-container-box sheet-pc-initiative">
                                            <div class="sheet-container-bar">
                                                <button type="roll" name="roll_init" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=Initiative}} {{r1=[[@{agility}d6[INIT]+@{initiative_bonus} &{tracker}]]}} {{type=Initiative}}">INITIATIVE<span name="attr_initiative" title="@{initiative}"></span></button>
                                            </div>
                                        </div>
                                        <div class="sheet-container-box sheet-pc-defences">
                                            <div class="sheet-defence-label">HYPER RESISTANCE</div>
                                            <input class="sheet-defence" type="text" name="attr_hyper_resistances" title="@{hyper_resistances}">
                                            <div class="sheet-defence-label">RESISTANCE</div>
                                            <input class="sheet-defence" type="text" name="attr_resistances" title="@{resistances}">
                                            <div class="sheet-defence-label">WEAKNESS</div>
                                            <input class="sheet-defence" type="text" name="attr_weakness" title="@{weakness}">
                                            <div class="sheet-defence-label">HYPER WEAKNESS</div>
                                            <input class="sheet-defence" type="text" name="attr_hyper_weakness" title="@{hyper_weakness}">
                                        </div>
                                        <div class="sheet-container-box sheet-pc-evasion-durability">
                                            <div class="sheet-pc-evasion-group">
                                                <div class="sheet-pc-evasion-full">
                                                    <span class="sheet-evasion-full" name="attr_evasion-full" title="@{evasion-full}">0</span>
                                                    <div class="sheet-pc-defence-label">EVA</div>
                                                </div>
                                                <div class="sheet-pc-evasion-base">
                                                    <input class="sheet-evasion-base" type="number" name="attr_evasion-base" title="@{evasion-base}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BASE</div>
                                                </div>
                                                <div class="sheet-pc-evasion-limit">
                                                    <input class="sheet-evasion-limit" type="number" name="attr_evasion-limit" title="@{evasion-limit}" placeholder="0" value="10">
                                                    <div class="sheet-pc-defence-label">SOFT CAP</div>
                                                </div>
                                                <div class="sheet-pc-evasion-bonus">
                                                    <input class="sheet-evasion-bonus" type="number" name="attr_evasion-bonus" title="@{evasion-bonus}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BONUS</div>
                                                </div>
                                            </div>
                                            <div class="sheet-pc-durability-group">
                                                <div class="sheet-pc-durability-full">
                                                    <span class="sheet-durability-full" name="attr_durability-full" title="@{durability-full}">0</span>
                                                    <div class="sheet-pc-defence-label">DUR</div>
                                                </div>
                                                <div class="sheet-pc-durability-base">
                                                    <input class="sheet-durability-base" type="number" name="attr_durability-base" title="@{durability-base}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BASE</div>
                                                </div>
                                                <div class="sheet-pc-durability-limit">
                                                    <input class="sheet-durability-limit" type="number" name="attr_durability-limit" title="@{durability-limit}" placeholder="0" value="10">
                                                    <div class="sheet-pc-defence-label">SOFT CAP</div>
                                                </div>
                                                <div class="sheet-pc-durability-bonus">
                                                    <input class="sheet-durability-bonus" type="number" name="attr_durability-bonus" title="@{durability-bonus}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BONUS</div>
                                                </div>
                                            </div>
                                            <div class="sheet-pc-reduction-group">
                                                <div class="sheet-pc-reduction-full">
                                                    <span class="sheet-reduction-full" name="attr_reduction-full" title="@{reduction-full}">0</span>
                                                    <div class="sheet-pc-defence-label">DR</div>
                                                </div>
                                                <div class="sheet-pc-reduction-base">
                                                    <input class="sheet-reduction-base" type="number" name="attr_reduction-base" title="@{reduction-base}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BASE</div>
                                                </div>
                                                <div class="sheet-pc-reduction-armour">
                                                    <input class="sheet-reduction-armour" type="number" name="attr_reduction-armour" title="@{reduction-armour}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">ARMOUR</div>
                                                </div>
                                                <div class="sheet-pc-reduction-bonus">
                                                    <input class="sheet-reduction-bonus" type="number" name="attr_reduction-bonus" title="@{reduction-bonus}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BONUS</div>
                                                </div>
                                            </div>
                                            <div class="sheet-pc-speed-group">
                                                <div class="sheet-pc-speed-movement">
                                                    <input class="sheet-movement-movement" type="number" name="attr_movement" title="@{movement}"placeholder="0">
                                                    <div class="sheet-pc-defence-label">SPEED</div>
                                                </div>
                                                <div class="sheet-pc-speed-swim">
                                                    <input class="sheet-movement-swim" type="number" name="attr_swim" title="@{swim}"placeholder="0">
                                                    <div class="sheet-pc-defence-label">SWIM</div>
                                                </div>
                                                <div class="sheet-pc-speed-climb">
                                                    <input class="sheet-movement-climb" type="number" name="attr_climb" title="@{climb}"placeholder="0">
                                                    <div class="sheet-pc-defence-label">CLIMB</div>
                                                </div>
                                                <div class="sheet-pc-speed-fly">
                                                    <input class="sheet-movement-fly" type="number" name="attr_fly" title="@{fly}"placeholder="0">
                                                    <div class="sheet-pc-defence-label">FLY</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="sheet-container-attacks">
                                    <div class="sheet-container-panel sheet-panel-bonuses">
                                        <div class="sheet-container-header">ATTACK MODIFIERS</div>
                                        <input class="sheet-hidden" type="checkbox" name="attr_cultivator_global_attack_mod_flag" title="@{cultivator_global_attack_mod_flag}" value="1">
                                        <div class="sheet-container-body">
                                            <fieldset class="repeating_cultivatortohitmod">
                                                <div class="sheet-fieldset-item">
                                                    <div class="sheet-checkbox-cog">
                                                        <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                        <span class="sheet-toggle-icon"></span>
                                                    </div>
                                                    <input type="checkbox" name="attr_options-flag" checked="checked" hidden class="sheet-toggle">
                                                    <div class="sheet-toggle-checked">
                                                        <div class="sheet-form">
                                                            <div class="sheet-form-header">Edit Modifier</div>
                                                            <div class="sheet-form-body">
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_cultivator_global_attack_active_flag" value="1">
                                                                    </label>
                                                                    <input type="text" name="attr_cultivator_global_attack_name">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Roll:</label>
                                                                    <input type="text" name="attr_cultivator_global_attack_roll">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Applied To:</label>
                                                                    <select name="attr_cultivator_global_attack_appliesto">
                                                                        <option value="Both" selected>Both</option>
                                                                        <option value="Accuracy">Accuracy</option>
                                                                        <option value="Effectiveness">Effectiveness</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="sheet-toggle-unchecked">
                                                        <div class="sheet-pc-attack-modifier">
                                                            <div class="sheet-checkbox-image">
                                                                <input type="checkbox" name="attr_cultivator_global_attack_active_flag" value="1">
                                                                <span></span>
                                                            </div>
                                                            <span name="attr_cultivator_global_attack_name"></span>
                                                            <span name="attr_cultivator_global_attack_roll"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </div>
                                    </div>
                                    <div class="sheet-container-panel sheet-panel-bonuses">
                                        <div class="sheet-container-header">DAMAGE MODIFIERS</div>
                                        <input class="sheet-hidden" type="checkbox" name="attr_cultivator_global_damage_mod_flag" title="@{cultivator_global_damage_mod_flag}" value="1">
                                        <div class="sheet-container-body">
                                            <fieldset class="repeating_cultivatordamagemod">
                                                <div class="sheet-fieldset-item">
                                                    <div class="sheet-checkbox-cog">
                                                        <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                        <span class="sheet-toggle-icon"></span>
                                                    </div>
                                                    <input type="checkbox" name="attr_options-flag" checked="checked" hidden class="sheet-toggle">
                                                    <div class="sheet-toggle-checked">
                                                        <div class="sheet-form">
                                                            <div class="sheet-form-header">Edit Modifier</div>
                                                            <div class="sheet-form-body">
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_cultivator_global_damage_active_flag" value="1">
                                                                    </label>
                                                                    <input type="text" name="attr_cultivator_global_damage_name">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Damage:</label>
                                                                    <input type="text" name="attr_cultivator_global_damage_damage" value="">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Type:</label>
                                                                    <input type="text" name="attr_cultivator_global_damage_type" value="">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="sheet-toggle-unchecked">
                                                        <div class="sheet-pc-attack-damage-modifier">
                                                            <div class="sheet-checkbox-image">
                                                                <input type="checkbox" name="attr_cultivator_global_damage_active_flag" value="1">
                                                                <span></span>
                                                            </div>
                                                            <span name="attr_cultivator_global_damage_name"></span>
                                                            <span name="attr_cultivator_global_damage_damage"></span>
                                                            <span name="attr_cultivator_global_damage_type"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </div>
                                    </div>
                                    <div class="sheet-container-panel sheet-panel-attacks">
                                        <div class="sheet-container-header">ATTACKS</div>
                                        <div class="sheet-container-body">
                                            <fieldset class="repeating_cultivatorattack">
                                                <div class="sheet-fieldset-item">
                                                    <div class="sheet-checkbox-cog">
                                                        <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                        <span class="sheet-toggle-icon"></span>
                                                    </div>
                                                    <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                                    <div class="sheet-toggle-checked">
                                                        <div class="sheet-form">
                                                            <div class="sheet-form-header">Edit Attack</div>
                                                            <div class="sheet-form-body">
                                                                <div class="sheet-form-group">
                                                                    <label>Name:</label>
                                                                    <input type="text" name="attr_atkname">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_atkflag" value="{{attack=1}}" checked="checked">
                                                                        <span>Attack:</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <select name="attr_atkattr_base">
                                                                        <option value="@{power}" selected="selected">PWR</option>
                                                                        <option value="@{agility}">AGI</option>
                                                                        <option value="@{vitality}">VIT</option>
                                                                        <option value="@{cultivation}">CUL</option>
                                                                        <option value="@{qicontrol}">QIC</option>
                                                                        <option value="@{mental}">MTL</option>
                                                                        <option value="0">-</option>
                                                                    </select>
                                                                    <span>+</span>
                                                                    <input type="text" name="attr_atkmod" placeholder="0">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Range:</label>
                                                                    <input type="text" name="attr_atkrange">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_dmgflag" value="{{damage=1}} {{dmgflag=1}}" checked="checked">
                                                                        <span>Damage 1</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Dmg</label>
                                                                    <input type="text" name="attr_dmgbase">
                                                                    <span>+</span>
                                                                    <select name="attr_dmgattr">
                                                                        <option value="@{power}" selected="selected">PWR</option>
                                                                        <option value="@{agility}">AGI</option>
                                                                        <option value="@{vitality}">VIT</option>
                                                                        <option value="@{cultivation}">CUL</option>
                                                                        <option value="@{qicontrol}">QIC</option>
                                                                        <option value="@{mental}">MTL</option>
                                                                        <option value="0">-</option>
                                                                    </select>
                                                                    <span>+</span>
                                                                    <label>Mod</label>
                                                                    <input type="text" name="attr_dmgmod">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Type:</label>
                                                                    <input type="text" name="attr_dmgtype">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_dmg2flag" value="{{damage=1}} {{dmg2flag=1}}">
                                                                        <span>Damage 2</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Dmg</label>
                                                                    <input type="text" name="attr_dmg2base">
                                                                    <span>+</span>
                                                                    <select name="attr_dmg2attr">
                                                                        <option value="@{power}">PWR</option>
                                                                        <option value="@{agility}">AGI</option>
                                                                        <option value="@{vitality}">VIT</option>
                                                                        <option value="@{cultivation}">CUL</option>
                                                                        <option value="@{qicontrol}">QIC</option>
                                                                        <option value="@{mental}">MTL</option>
                                                                        <option value="0" selected="selected">-</option>
                                                                    </select>
                                                                    <span>+</span>
                                                                    <label>Mod</label>
                                                                    <input type="text" name="attr_dmg2mod">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Type:</label>
                                                                    <input type="text" name="attr_dmg2type">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_dmg3flag" value="{{damage=1}} {{dmg3flag=1}}">
                                                                        <span>Damage 3</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Dmg</label>
                                                                    <input type="text" name="attr_dmg3base">
                                                                    <span>+</span>
                                                                    <select name="attr_dmg3attr">
                                                                        <option value="@{power}">PWR</option>
                                                                        <option value="@{agility}">AGI</option>
                                                                        <option value="@{vitality}">VIT</option>
                                                                        <option value="@{cultivation}">CUL</option>
                                                                        <option value="@{qicontrol}">QIC</option>
                                                                        <option value="@{mental}">MTL</option>
                                                                        <option value="0" selected="selected">-</option>
                                                                    </select>
                                                                    <span>+</span>
                                                                    <label>Mod</label>
                                                                    <input type="text" name="attr_dmg3mod">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Type:</label>
                                                                    <input type="text" name="attr_dmg3type">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_saveflag" value="{{saveflag=1}} {{saveattr=@{saveattr}}} {{savedesc=@{saveeffect}}} {{savedc=[[[[@{savedc}]][@{saveattr}]]]}}">
                                                                        <span>Attribute Check</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <select name="attr_saveattr">
                                                                        <option value="Power" selected="selected">PWR</option>
                                                                        <option value="Agility">AGI</option>
                                                                        <option value="Vitality">VIT</option>
                                                                        <option value="Cultivation">CUL</option>
                                                                        <option value="Qi Control">QIC</option>
                                                                        <option value="Mental">MTL</option>
                                                                    </select>
                                                                    <label>vs DC:</label>
                                                                    <select name="attr_savedc">
                                                                        <option value="(@{power_dc})">PWR</option>
                                                                        <option value="(@{agility_dc})">AGI</option>
                                                                        <option value="(@{vitality_dc})">VIT</option>
                                                                        <option value="(@{cultivation_dc})">CUL</option>
                                                                        <option value="(@{qicontrol_dc})">QIC</option>
                                                                        <option value="(@{mental_dc})">MTL</option>
                                                                        <option value="(@{saveflat})">FLAT</option>
                                                                    </select>
                                                                    <input type="hidden" name="attr_savedc">
                                                                    <input type="text" name="attr_saveflat" value="10">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Pass Effect:</label>
                                                                    <input type="text" name="attr_saveeffect">
                                                                </div>
                                                                <div class="sheet-form-group sheet-form-group-column">
                                                                    <label>Description:</label>
                                                                    <textarea name="attr_atk_desc"></textarea>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="sheet-toggle-unchecked">
                                                        <div class="sheet-pc-attack">
                                                            <input type="text" name="attr_atkbonus" class="sheet-hidden" value="">
                                                            <input type="text" name="attr_atkdmgtype" class="sheet-hidden" value="">
                                                            <button type="roll" name="roll_attack" value="@{rollbase}" class="sheet-attack-button">
                                                                <span name="attr_atkname"></span>
                                                                <span name="attr_atkbonus"></span>
                                                                <span name="attr_atkdmgtype"></span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <input type="hidden" name="attr_rollbase">
                                                <input type="hidden" name="attr_rollbase_dmg">
                                                <button type="roll" name="roll_attack_dmg" value="@{rollbase_dmg}" class="dmgroll"></button>
                                            </fieldset>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col col3">
                                <div class="sheet-container-panel sheet-container-traits">
                                    <div class="sheet-container-header">TRAITS</div>
                                    <div class="sheet-container-body">
                                        <fieldset class="repeating_cultivatorfeature">
                                            <div class="sheet-fieldset-item sheet-fieldset-item-cultivator-feature">
                                                <div class="sheet-checkbox-cog">
                                                    <input type="checkbox" name="attr_options-flag" checked="checked" value="on">
                                                    <span class="sheet-toggle-icon"></span>
                                                </div>
                                                <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-form">
                                                        <div class="sheet-form-header">Edit Trait</div>
                                                        <div class="sheet-form-body">
                                                            <div class="sheet-form-group">
                                                                <label>Name:</label>
                                                                <input type="text" name="attr_name">
                                                            </div>
                                                            <div class="sheet-form-group form-group-description">
                                                                <label>Description:</label>
                                                                <textarea name="attr_desc"></textarea>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-toggle-unchecked">
                                                    <div class="sheet-feature">
                                                        <input class="toggle-feature" type="hidden" name="attr_toggle_feature_desc" value="0">
                                                        <div class="sheet-feature-name">
                                                            <span name="attr_name"></span>
                                                            <input class="toggle-checkbox" type="checkbox" value="1" name="attr_toggle_feature_desc">
                                                        </div>
                                                        <div class="sheet-feature-desc">
                                                            <span name="attr_desc"></span>
                                                        </div>
                                                        <button type="roll" name="roll_trait" value="@{whispertoggle}&{template:features} @{charname_output} {{name=@{name}}} {{description=@{desc}}}" class="output btn">w</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-container-resources">
                                    <div class="sheet-container-header">RESOURCES</div>
                                    <div class="sheet-container-body">
                                        <div class="sheet-resource-labels">
                                            <div class="sheet-resource-label resource-name">NAME</div>
                                            <div class="sheet-resource-label resource-current">CURRENT</div>
                                            <div class="sheet-resource-label resource-max">MAX</div>
                                        </div>
                                        <fieldset class="repeating_cultivatorresource">
                                            <div class="sheet-fieldset-item">
                                                <div class="sheet-form">
                                                    <div class="sheet-item-resource-name">
                                                        <input class="sheet-resource-name" type="text" name="attr_resource_name" title="@{resource_name}" placeholder="Resource">
                                                    </div>
                                                    <div class="sheet-item-resource-current">
                                                        <input class="sheet-resource-current" type="text" name="attr_resource_current" title="@{resource_current}" placeholder="0">
                                                    </div>
                                                    <div class="sheet-item-resource-max">
                                                        <input class="sheet-resource-max" type="text" name="attr_resource_max" title="@{resource_max}" placeholder="0">
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-page sheet-page-bio">
                    <input type="radio" name="attr_page" value="bio">
                    <span class="sheet-page-label">BIO</span>
                    <div class="sheet-page-content">
                        <div class="sheet-container-well sheet-container-well-details">
                            <div class="sheet-container-panel sheet-pc-details">
                                <div class="sheet-container-header">Character Details</div>
                                <div class="sheet-container-body">
                                    <div class="sheet-pc-detail">
                                        <label>Age</label>
                                        <select name="attr_character_age_detail" title="@{character_age_detail}">
                                            <option value=""></option>
                                            <option value="young_adult">Young adult</option>
                                            <option value="early_middle">Early-mid age</option>
                                            <option value="late_middle">Late-mid age</option>
                                            <option value="old">Old</option>
                                            <option value="very_old">Very old</option>
                                        </select>
                                        <input type="text" name="attr_character_age" title="@{character_age}">
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Size</label>
                                        <select name="attr_size" title="@{size}">
                                            <option value="tiny">Tiny</option>
                                            <option value="small">Small</option>
                                            <option value="medium" selected>Medium</option>
                                            <option value="large">Large</option>
                                            <option value="huge">Huge</option>
                                            <option value="gargantuan">Gargantuan</option>
                                        </select>
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Height</label>
                                        <select name="attr_character_height_detail" title="@{character_height_detail}">
                                            <option value=""></option>
                                            <option value="very_short">Very short</option>
                                            <option value="short">Short</option>
                                            <option value="average">Average</option>
                                            <option value="tall">Tall</option>
                                            <option value="very_tall">Very tall</option>
                                        </select>
                                        <input type="text" name="attr_character_height" title="@{character_height}">
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Weight</label>
                                        <select name="attr_character_weight" title="@{character_weight}">
                                            <option value=""></option>
                                            <option value="very_thin">Very thin</option>
                                            <option value="thin">Thin</option>
                                            <option value="average">Average</option>
                                            <option value="fat">Fat</option>
                                            <option value="very_fat">Very fat</option>
                                        </select>
                                        <input type="text" name="attr_character_weight_detail" title="@{character_weight_detail}">
                                    </div>
                                    <div class="sheet-pc-detail sheet-pc-detail-feature">
                                        <label>Feature</label>
                                        <div class="sheet-pc-detail-column">
                                            <input type="text" name="attr_character_feature_detail" title="@{character_feature_detail}">
                                        </div>
                                    </div>
                                    <div class="sheet-pc-detail sheet-pc-detail-motivation">
                                        <label>Motivation</label>
                                        <div class="sheet-pc-detail-column">
                                            <input type="text" name="attr_character_motivation_detail" title="@{character_motivation_detail}">
                                        </div>
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Habit</label>
                                        <div class="sheet-pc-detail-column">
                                            <input type="text" name="attr_character_habit_detail" title="@{character_habit_detail}">
                                        </div>
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Bloodline</label>
                                        <div class="sheet-pc-detail-column">
                                            <input type="text" name="attr_character_bloodline_detail" title="@{character_bloodline_detail}">
                                        </div>
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Family</label>
                                        <select name="attr_character_family" title="@{character_family}">
                                            <option value=""></option>
                                            <option value="none">None</option>
                                            <option value="small">Small</option>
                                            <option value="average">Average</option>
                                            <option value="large">Large</option>
                                            <option value="disowned">Disowned</option>
                                        </select>
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Raised By</label>
                                        <select name="attr_character_raised_by" title="@{character_raised_by}">
                                            <option value=""></option>
                                            <option value="natural_parents">Natural Parent(s)</option>
                                            <option value="close_family">Close Family</option>
                                            <option value="adopted">Adopted Parent(s)</option>
                                            <option value="institution">An Institution</option>
                                            <option value="streets">The Streets</option>
                                            <option value="yourself">Yourself</option>
                                        </select>
                                    </div>
                                    <div class="sheet-pc-detail sheet-pc-detail-quest">
                                        <label>Quest</label>
                                        <textarea name="attr_character_quest" title="@{character_quest}"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-gimmick">
                                <div class="sheet-container-header">Gimmick</div>
                                <div class="sheet-container-body">
                                    <textarea name="attr_gimmick" title="@{gimmick}"></textarea>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-value">
                                <div class="sheet-container-header">Values</div>
                                <div class="sheet-container-body">
                                    <textarea name="attr_values" title="@{values}"></textarea>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-conflict">
                                <div class="sheet-container-header">Conflict</div>
                                <div class="sheet-container-body">
                                    <textarea name="attr_conflict" title="@{conflict}"></textarea>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-want">
                                <div class="sheet-container-header">Want</div>
                                <div class="sheet-container-body">
                                    <textarea name="attr_want" title="@{want}"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-memories">
                            <div class="sheet-container-panel sheet-pc-custom-rolls">
                                <div class="sheet-container-header">Custom Skills</div>
                                <div class="sheet-container-body">
                                    <fieldset class="repeating_customskill">
                                        <div class="sheet-fieldset-item sheet-fieldset-item-tool">
                                            <div class="sheet-checkbox-cog">
                                                <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                <span class="sheet-toggle-icon"></span>
                                            </div>
                                            <input type="checkbox" name="attr_options-flag" checked="checked" hidden class="sheet-toggle">
                                            <div class="sheet-toggle-checked">
                                                <div class="sheet-form">
                                                    <div class="sheet-form-header">Edit Custom Skill</div>
                                                    <div class="sheet-form-body">
                                                        <div class="sheet-form-group">
                                                            <label>Name:</label>
                                                            <input type="text" name="attr_toolname">
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <label>Roll:</label>
                                                            <input type="text" name="attr_tool_roll" title="@{tool_roll}" value="0">
                                                            <label>Mods:</label>
                                                            <input type="text" name="attr_tool_mod" title="@{tool_mod}" value="0">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="sheet-toggle-unchecked">
                                                <div class="sheet-pc-tool">
                                                    <button type="roll" name="roll_roll" value="@{whispertoggle}&{template:simple} @{charname_output} {{rname=@{toolname}}} {{r1=[[@{tool_roll}+@{tool_mod}[BONUS]]]}}">
                                                        <span name="attr_toolname"></span>
                                                        <span name="attr_tool_roll"></span>
                                                        <span>+</span>
                                                        <span name="attr_tool_mod"></span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-memories">
                                <div class="sheet-container-header">Memories & Events</div>
                                <div class="sheet-container-body">
                                    <fieldset class="repeating_memories">
                                        <div class="sheet-fieldset-item">
                                            <div class="sheet-checkbox-cog">
                                                <input type="checkbox" name="attr_options-flag" checked="checked">
                                                <span class="sheet-toggle-icon"></span>
                                            </div>
                                            <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                            <div class="sheet-toggle-checked">
                                                <div class="sheet-form">
                                                    <div class="sheet-form-header">Edit Memory</div>
                                                    <div class="sheet-form-body">
                                                        <div class="sheet-form-group">
                                                            <label>Name:</label>
                                                            <input type="text" name="attr_memory_name">
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <textarea name="attr_memory_description"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="sheet-toggle-unchecked">
                                                <div class="sheet-pc-memory">
                                                    <span name="attr_memory_name"></span>
                                                    <span name="attr_memory_description"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-notes">
                                <div class="sheet-container-header">Additional Notes</div>
                                <div class="sheet-container-body">
                                    <fieldset class="repeating_notes">
                                        <div class="sheet-fieldset-item">
                                            <div class="sheet-checkbox-cog">
                                                <input type="checkbox" name="attr_options-flag" checked="checked">
                                                <span class="sheet-toggle-icon"></span>
                                            </div>
                                            <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                            <div class="sheet-toggle-checked">
                                                <div class="sheet-form">
                                                    <div class="sheet-form-header">Edit Note</div>
                                                    <div class="sheet-form-body">
                                                        <div class="sheet-form-group">
                                                            <label>Name:</label>
                                                            <input type="text" name="attr_note_name">
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <textarea name="attr_note_description"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="sheet-toggle-unchecked">
                                                <div class="sheet-pc-note">
                                                    <span name="attr_note_name"></span>
                                                    <span name="attr_note_description"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-features">
                            <div class="sheet-container-panel sheet-pc-features">
                                <div class="sheet-container-header">Traits</div>
                                <div class="sheet-container-body">
                                    <fieldset class="repeating_traits">
                                        <div class="sheet-fieldset-item">
                                            <div class="sheet-checkbox-cog">
                                                <input type="checkbox" name="attr_options-flag" checked="checked">
                                                <span class="sheet-toggle-icon"></span>
                                            </div>
                                            <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                            <div class="sheet-toggle-checked">
                                                <div class="sheet-form">
                                                    <div class="sheet-form-header">Edit Feature</div>
                                                    <div class="sheet-form-body">
                                                        <div class="sheet-form-group">
                                                            <label>Name:</label>
                                                            <input type="text" name="attr_name">
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <label>Source:</label>
                                                            <select name="attr_source">
                                                                <option selected="selected">Ancestral</option>
                                                                <option>Mortal</option>
                                                                <option>Cultivation</option>
                                                                <option>Talent</option>
                                                                <option>Background</option>
                                                                <option>Other</option>
                                                            </select>
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <label>Source Type:</label>
                                                            <input type="text" name="attr_source_type">
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <textarea name="attr_description"></textarea>
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <label class="sheet-form-checkbox">
                                                                <input type="checkbox" name="attr_hide_details" value="1">
                                                                <span>Hide Details</span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="sheet-toggle-unchecked">
                                                <div class="sheet-pc-feature">
                                                    <button type="roll" name="roll_output" value="@{whispertoggle}&{template:features} @{charname_output} {{name=@{name}}} {{source=@{source}: @{source_type}}} {{description=@{description}}}">
                                                        <div class="sheet-pc-feature-name">
                                                            <span name="attr_name"></span>
                                                        </div>
                                                        <input type="hidden" name="attr_hide_details" class="sheet-field-untoggle">
                                                        <div class="sheet-pc-feature-details">
                                                            <span class="sheet-pc-feature-source">
                                                                <span name="attr_source"></span>
                                                                <span name="attr_source_type"></span>
                                                            </span>
                                                            <span name="attr_description"></span>
                                                        </div>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-page sheet-page-notes">
                    <input type="radio" name="attr_page" value="notes">
                    <span class="sheet-page-label">NOTES</span>
                    <div class="sheet-page-content">
                        <div class="sheet-container-well sheet-pc-notes">
                            <div class="col col1">
                                <div class="sheet-container-panel sheet-pc-notes-one">
                                    <div class="sheet-container-header">
                                        <input type="text" name="attr_notes_one_header" placeholder="Additional Features & Traits" value="Additional Features & Traits">
                                    </div>
                                    <div class="sheet-container-body">
                                        <textarea name="attr_pc_notes_one"></textarea>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-pc-notes-two">
                                    <div class="sheet-container-header">
                                        <input type="text" name="attr_notes_two_header" placeholder="Character Backstory" value="Character Backstory">
                                    </div>
                                    <div class="sheet-container-body">
                                        <textarea name="attr_pc_notes_two"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="col col2">
                                <div class="sheet-container-panel sheet-pc-notes-three">
                                    <div class="sheet-container-header">
                                        <input type="text" name="attr_notes_three_header" placeholder="Allies & Organisations" value="Allies & Organisations">
                                    </div>
                                    <div class="sheet-container-body">
                                        <textarea name="attr_pc_notes_three"></textarea>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-pc-notes-four">
                                    <div class="sheet-container-header">
                                        <input type="text" name="attr_notes_four_header" placeholder="Treasures" value="Treasures">
                                    </div>
                                    <div class="sheet-container-body">
                                        <textarea name="attr_pc_notes_four"></textarea>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-pc-notes-five">
                                    <div class="sheet-container-header">
                                        <input type="text" name="attr_notes_five_header" placeholder="Extra" value="Extra">
                                    </div>
                                    <div class="sheet-container-body">
                                        <textarea name="attr_pc_notes_five"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-page sheet-page-inventory">
                    <input type="radio" name="attr_page" value="inventory">
                    <span class="sheet-page-label">INVENTORY</span>
                    <div class="sheet-page-content">
                        <div class="sheet-container-well sheet-container-well-inventory-supplies">
                            <div class="sheet-container-bar sheet-pc-rations">
                                <div class="sheet-container-header">Rations</div>
                                <div class="sheet-container-body">
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_ration_1" title="@{ration_1}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_ration_2" title="@{ration_2}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_ration_3" title="@{ration_3}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_ration_4" title="@{ration_4}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_ration_5" title="@{ration_5}">
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-water">
                                <div class="sheet-container-header">Waterskin</div>
                                <div class="sheet-container-body">
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_waterskin_1" title="@{waterskin_1}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_waterskin_2" title="@{waterskin_2}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_waterskin_3" title="@{waterskin_3}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_waterskin_4" title="@{waterskin_4}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_waterskin_5" title="@{waterskin_5}">
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-inventory-purse">
                            <div class="sheet-container-bar sheet-pc-purse-cc">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_cc_title" title="@{cc_title}" value="COPPER">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="number" name="attr_cc" title="@{cc}">
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-purse-sc">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_sc_title" title="@{sc_title}" value="SILVER">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="number" name="attr_sc" title="@{sc}">
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-purse-gc">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_gc_title" title="@{gc_title}" value="GOLD">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="number" name="attr_gc" title="@{gc}">
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-purse-ss">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_ss_title" title="@{ss_title}" value="SPIRIT STONE">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="number" name="attr_ss" title="@{ss}">
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-purse-other1">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_currency1" title="@{currency1}" value="JADE STONE">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="number" name="attr_currency1_value" title="@{currency1_value}" >
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-purse-other2">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_currency2" title="@{currency2}" value="OTHER">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="number" name="attr_currency2_value" title="@{currency2_value}" >
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-inventory-encumberance">
                            <div class="sheet-container-panel sheet-pc-weight">
                                <div class="sheet-container-header">Weight</div>
                                <div class="sheet-container-body">
                                    <input type="text" name="attr_weighttotal" title="@{weighttotal}">
                                    <span>/</span>
                                    <span name="attr_weightmaximum" title="@{weightmaximum}"></span>
                                </div>
                                <div class="sheet-container-footer">
                                    <span>Current</span>
                                    <span>Maximum</span>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-slots">
                                <div class="sheet-container-header">Inventory Slots</div>
                                <div class="sheet-container-body">
                                    <input type="text" name="attr_slotstotal" title="@{slotstotal}">
                                    <span>/</span>
                                    <span name="attr_slotsmaximum" title="@{slotsmaximum}"></span>
                                </div>
                                <div class="sheet-container-footer">
                                    <span>Current</span>
                                    <span>Maximum</span>
                                </div>
                            </div>
                            <div class="sheet-pc-carrying-status">
                                <input type="hidden" class="sheet-pc-encumberance" name="attr_encumberance">
                                <span class="sheet-pc-unencumbered">Unencumbered</span>
                                <span class="sheet-pc-encumbered">Encumbered</span>
                                <span class="sheet-pc-heavily">Heavily encumbered</span>
                                <span class="sheet-pc-immobile">Immobile</span>
                                <span class="sheet-pc-over">Over carrying capacity</span>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-inventory-general">
                            <div class="sheet-container-panel sheet-pc-inventory-other">
                                <div class="sheet-container-header">Other Items</div>
                                <div class="sheet-container-body">
                                    <fieldset class="repeating_otheritems">
                                        <div class="sheet-fieldset-item">
                                            <div class="sheet-checkbox-cog">
                                                <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                <span class="sheet-toggle-icon"></span>
                                            </div>
                                            <input type="checkbox" name="attr_options-flag" checked="checked" hidden class="sheet-toggle">
                                            <div class="sheet-toggle-checked">
                                                <div class="sheet-form">
                                                    <div class="sheet-form-header">Edit Item</div>
                                                    <div class="sheet-form-body">
                                                        <div class="sheet-form-group">
                                                            <label>Name:</label>
                                                            <input type="text" name="attr_otheritem-name">
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <textarea name="attr_otheritem-description"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="sheet-toggle-unchecked">
                                                <div class="sheet-pc-otheritem">
                                                    <span name="attr_otheritem-name"></span><span name="attr_otheritem-description"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-inventory">
                            <div class="sheet-container-panel sheet-pc-inventory">
                                <div class="sheet-container-header">Inventory & Holdings</div>
                                <div class="sheet-container-body">
                                    <input type="hidden" name="attr_use_inventory_slots" class="sheet-toggle-slots" value="1">
                                    <fieldset class="repeating_inventory">
                                        <div class="sheet-fieldset-item">
                                            <div class="sheet-checkbox-cog">
                                                <input type="checkbox" name="attr_options-flag" checked="checked">
                                                <span class="sheet-toggle-icon"></span>
                                            </div>
                                            <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                            <div class="sheet-toggle-checked">
                                                <div class="sheet-form sheet-form-item">
                                                    <div class="sheet-form-header">Edit Item</div>
                                                    <div class="sheet-form-body">
                                                        <input type="hidden" name="attr_equipped">
                                                        <input type="hidden" name="attr_carried">
                                                        <input type="hidden" name="attr_inventorysubflag">
                                                        <div class="sheet-item-contents">
                                                            <div class="sheet-form-group">
                                                                <label>Name:</label>
                                                                <input type="text" name="attr_itemname">
                                                            </div>
                                                            <input type="checkbox" name="attr_itemcontainer" value="1" class="sheet-toggle" hidden>
                                                            <div class="sheet-toggle-unchecked">
                                                                <div class="sheet-form-group">
                                                                    <label>Quantity</label>
                                                                    <input type="number" name="attr_itemcount" value="1">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Weight:</label>
                                                                    <input type="number" name="attr_itemweight">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_itemweightfixed" value="1">
                                                                        <span>Fixed (Ignore quantity)</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Size:</label>
                                                                    <select name="attr_itemsize">
                                                                        <option value="0.2">Tiny (0.2 slots)</option>
                                                                        <option value="1" selected>Small (1 slot)</option>
                                                                        <option value="2">Medium (2 slots)</option>
                                                                        <option value="3">Large (3 slots)</option>
                                                                        <option value="6">X-Large (6 slots)</option>
                                                                        <option value="9">XX-Large (9 slots)</option>
                                                                        <option value="12">XXX-Large (12 slots)</option>
                                                                        <option value="15">XXXX-Large (15 slots)</option>
                                                                        <option value="18">XXXXX-Large (18 slots)</option>
                                                                    </select>
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_itemslotsfixed" value="1">
                                                                        <span>Fixed (Ignore quantity)</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group sheet-item-columns-2">
                                                                    <div class="sheet-form-group">
                                                                        <label>Notches:</label>
                                                                        <input type="number" name="attr_itemnotches" value="0">
                                                                    </div>
                                                                    <div class="sheet-form-group">
                                                                        <label>Quality:</label>
                                                                        <select name="attr_itemquality">
                                                                            <option value="" selected="selected"></option>
                                                                            <option value="pristine">Pristine</option>
                                                                            <option value="worn">Worn</option>
                                                                            <option value="wellworn">Well-worn</option>
                                                                            <option value="scarred">Scarred</option>
                                                                            <option value="broken">Broken</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Equipped Slot</label>
                                                                    <select name="attr_equippedslot">
                                                                        <option value="" selected="selected"></option>
                                                                        <option value="Weapon">Weapon</option>
                                                                        <option value="Body">Body</option>
                                                                        <option value="Head">Head</option>
                                                                        <option value="Hands">Hands</option>
                                                                        <option value="Feet">Feet</option>
                                                                        <option value="Back">Back</option>
                                                                        <option value="Accessory">Accessory</option>
                                                                        <option value="Flying Treasure">Flying Treasure</option>
                                                                        <option value="Spatial Treasure">Spatial Treasure</option>
                                                                        <option value="Offensive Treasure">Offensive Treasure</option>
                                                                        <option value="Defensive Treasure">Defensive Treasure</option>
                                                                        <option value="Life-Saving Treasure">Life-Saving Treasure</option>
                                                                    </select>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Properties:</label>
                                                                    <input type="text" name="attr_itemproperties">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Modifiers:</label>
                                                                    <input type="text" name="attr_itemmodifiers">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Description:</label>
                                                                    <textarea name="attr_itemcontent"></textarea>
                                                                </div>
                                                            </div>
                                                            <div class="sheet-toggle-checked">
                                                                <div class="sheet-item-columns-2">
                                                                    <div class="sheet-form-group">
                                                                        <label>Type:</label>
                                                                        <select name="attr_itemcontainer_type">
                                                                            <option value="bag" selected="selected">Bag</option>
                                                                            <option value="belt">Belt</option>
                                                                            <option value="pouch">Pouch</option>
                                                                            <option value="quiver">Quiver</option>
                                                                            <option value="sheath">Sheath</option>
                                                                            <option value="stash">Stash</option>
                                                                            <option value="property">Property</option>
                                                                            <option value="vehicle">Vehicle</option>
                                                                            <option value="spacial">Spacial Treasure</option>
                                                                        </select>
                                                                    </div>
                                                                    <div class="sheet-form-group">
                                                                        <label>Max. Capacity (Slots):</label>
                                                                        <input type="number" name="attr_itemcontainer_slots" value="3">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="sheet-item-options">
                                                            <div class="sheet-form-group">
                                                                <label class="sheet-form-checkbox">
                                                                    <input type="checkbox" name="attr_equipped" value="1" checked="checked">
                                                                    <span>Equipped</span>
                                                                </label>
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label class="sheet-form-checkbox">
                                                                    <input type="checkbox" name="attr_carried" value="1" checked="checked">
                                                                    <span>Carried</span>
                                                                </label>
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label class="sheet-form-checkbox">
                                                                    <input type="checkbox" name="attr_itemcontainer" value="1">
                                                                    <span>Container</span>
                                                                </label>
                                                            </div>
                                                            <input type="checkbox" name="attr_itemcontainer" value="1" class="sheet-toggle" hidden>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="sheet-toggle-unchecked">
                                                <input type="checkbox" name="attr_itemcontainer" value="1" class="sheet-toggle" hidden>
                                                <div class="sheet-toggle-unchecked">
                                                    <div class="sheet-pc-item">
                                                        <div class="sheet-pc-item-header">
                                                            <span>Item Name</span>
                                                            <span>Quantity</span>
                                                            <span>Weight</span>
                                                            <span>Slots</span>
                                                            <span>Notches</span>
                                                        </div>
                                                        <div class="sheet-pc-item-content">
                                                            <span class="sheet-pc-item-name">
                                                                <input type="hidden" name="attr_equipped" value="1" class="sheet-field-toggle">
                                                                <span class="sheet-pc-item-equipped"><strong>E</strong></span>
                                                                <input type="hidden" name="attr_carried" value="1" class="sheet-field-toggle">
                                                                <span class="sheet-pc-item-carried"><strong>C</strong></span>
                                                                <span name="attr_itemname"></span>
                                                                <span name="attr_equippedslot"></span>
                                                            </span>
                                                            <span class="sheet-pc-item-quantity">
                                                                <input type="text" name="attr_itemcount">
                                                            </span>
                                                            <span class="sheet-pc-item-weight">
                                                                <input type="text" name="attr_itemweight">
                                                            </span>
                                                            <span class="sheet-pc-item-slots">
                                                                <input type="text" name="attr_itemsize">
                                                            </span>
                                                            <span class="sheet-pc-item-notches">
                                                                <input type="text" name="attr_itemnotches">
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-pc-inventory-container">
                                                        <input type="hidden" name="attr_equipped" value="1" class="sheet-field-toggle">
                                                        <span class="sheet-pc-item-equipped"><strong>E</strong></span>
                                                        <input type="hidden" name="attr_carried" value="1" class="sheet-field-toggle">
                                                        <span class="sheet-pc-item-carried"><strong>C</strong></span>
                                                        <span name="attr_itemname"></span>
                                                        <span class="sheet-pc-inventory-container-slots">
                                                            (
                                                            <span name="attr_itemcontainer_type"></span>
                                                            <input type="hidden" name="attr_itemcontainer_slots" class="sheet-field-toggle">
                                                            <span> capacity <span name="attr_itemcontainer_slots"></span></span>
                                                            <input type="hidden" name="attr_itemcontainer_slots_modifier" class="sheet-field-toggle">
                                                            <span> extra slots <span name="attr_itemcontainer_slots_modifier"></span></span>
                                                            )
                                                        </span>
                                                    </div>
                                                    <div class="sheet-pc-inventory-container-footer">
                                                        <span>Item Name</span>
                                                        <span>Quantity</span>
                                                        <span>Weight</span>
                                                        <span>Slots</span>
                                                        <span>Notches</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-page sheet-page-options">
                    <input type="radio" name="attr_page" value="options">
                    <span class="sheet-page-label">OPTIONS</span>
                    <div class="sheet-page-content">
                        <div class="sheet-options">
                            <div class="sheet-container-panel sheet-pc-option-general">
                                <div class="sheet-container-header">GENERAL OPTIONS</div>
                                <div class="sheet-container-body">
                                    <div class="sheet-form sheet-form-borderless">
                                        <div class="sheet-form-body">
                                            <div class="sheet-form-group">
                                                <label>Whisper Rolls to GM:</label>
                                                <select name="attr_wtype" title="@{whispertoggle}">
                                                    <option value="">Never Whisper Rolls</option>
                                                    <option value="@{whispertoggle}">Whisper Toggle</option>
                                                    <option value="?{Whisper?|Public Roll,|Whisper Roll,/w gm }">Query Whisper</option>
                                                    <option value="/w gm ">Always Whisper Rolls</option>
                                                </select>
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Auto Damage Roll:</label>
                                                <select name="attr_dtype" title="@{dtype}">
                                                    <option value="pick">Don't Auto Roll Damage</option>
                                                    <option value="full">Auto Roll Damage</option>
                                                </select>
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Add Character Name to Templates:</label>
                                                <select name="attr_charname_output" title="@{charname_output}">
                                                    <option value="{{charname=@{character_name}}}">On</option>
                                                    <option value="charname=@{character_name}" selected="selected">Off</option>
                                                </select>
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Carrying Capacity Modifier:</label>
                                                <input type="text" name="attr_carrying_capacity_mod" placeholder="*2/+2/-2" title="@{carrying_capacity_mod}">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Initiative Bonus:</label>
                                                <input type="number" name="attr_initiative_bonus" title="@{initiative_bonus}">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-option-skills">
                                <div class="sheet-container-header">SKILL OPTIONS</div>
                                <div class="sheet-container-body">
                                    <div class="sheet-form sheet-form-borderless">
                                        <div class="sheet-form-body">
                                            <div class="sheet-form-group">
                                                <label>Acrobatics</label>
                                                <input type="number" name="attr_acrobatics_flat" title="@{acrobatics_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Athletics</label>
                                                <input type="number" name="attr_athletics_flat" title="@{athletics_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Seduce</label>
                                                <input type="number" name="attr_seduce_flat" title="@{seduce_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Deceit</label>
                                                <input type="number" name="attr_deceit_flat" title="@{deceit_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Discretion</label>
                                                <input type="number" name="attr_discretion_flat" title="@{discretion_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Disguise</label>
                                                <input type="number" name="attr_disguise_flat" title="@{disguise_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Fine Arts</label>
                                                <input type="number" name="attr_fine_arts_flat" title="@{fine_arts_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Forgery</label>
                                                <input type="number" name="attr_forgery_flat" title="@{forgery_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Grapple</label>
                                                <input type="number" name="attr_grapple_flat" title="@{grapple_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>History</label>
                                                <input type="number" name="attr_history_flat" title="@{history_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Intuition</label>
                                                <input type="number" name="attr_intuition_flat" title="@{intuition_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Intimidation</label>
                                                <input type="number" name="attr_intimidation_flat" title="@{intimidation_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Investigation</label>
                                                <input type="number" name="attr_investigation_flat" title="@{investigation_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Medicine</label>
                                                <input type="number" name="attr_medicine_flat" title="@{medicine_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Navigation</label>
                                                <input type="number" name="attr_navigation_flat" title="@{navigation_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Perception</label>
                                                <input type="number" name="attr_perception_flat" title="@{perception_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Performance</label>
                                                <input type="number" name="attr_performance_flat" title="@{performance_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Persuade</label>
                                                <input type="number" name="attr_persuade_flat" title="@{persuade_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Stealth</label>
                                                <input type="number" name="attr_stealth_flat" title="@{stealth_flat}" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Survival</label>
                                                <input type="number" name="attr_survival_flat" title="@{survival_flat}" value="0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-option-attributes">
                                <div class="sheet-container-header">ATTRIBUTE OPTIONS</div>
                                <div class="sheet-container-body">
                                    <div class="sheet-form sheet-form-borderless">
                                        <div class="sheet-form-body">
                                            <div class="sheet-attribute-options">
                                                <div>
                                                    <div class="sheet-container-header">ATTRIBUTE BONUS</div>
                                                    <div class="sheet-form-group">
                                                        <label>Power:</label>
                                                        <input type="number" name="attr_power_bonus" title="@{power_bonus}" value="0">
                                                    </div>
                                                    <div class="sheet-form-group">
                                                        <label>Agility:</label>
                                                        <input type="number" name="attr_agility_bonus" title="@{agility_bonus}" value="0">
                                                    </div>
                                                    <div class="sheet-form-group">
                                                        <label>Vitality:</label>
                                                        <input type="number" name="attr_vitality_bonus" title="@{vitality_bonus}" value="0">
                                                    </div>
                                                    <div class="sheet-form-group">
                                                        <label>Cultivation:</label>
                                                        <input type="number" name="attr_cultivation_bonus" title="@{cultivation_bonus}" value="0">
                                                    </div>
                                                    <div class="sheet-form-group">
                                                        <label>Qi Control:</label>
                                                        <input type="number" name="attr_qicontrol_bonus" title="@{qi_control_bonus}" value="0">
                                                    </div>
                                                    <div class="sheet-form-group">
                                                        <label>Mental Strength:</label>
                                                        <input type="number" name="attr_mental_bonus" title="@{mental_bonus}" value="0">
                                                    </div>
                                                    <div class="sheet-form-group">
                                                        <label>Appearance:</label>
                                                        <input type="number" name="attr_appearance" title="@{appearance}" value="0">
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="sheet-container-header">ATTRIBUTE CHECK BONUS</div>
                                                    <div class="sheet-form-group">
                                                        <label>Power:</label>
                                                        <input type="number" name="attr_power_check_bonus" title="@{power_check_bonus}" value="0">
                                                    </div>
                                                    <div class="sheet-form-group">
                                                        <label>Agility:</label>
                                                        <input type="number" name="attr_agility_check_bonus" title="@{agility_check_bonus}" value="0">
                                                    </div>
                                                    <div class="sheet-form-group">
                                                        <label>Vitality:</label>
                                                        <input type="number" name="attr_vitality_check_bonus" title="@{vitality_check_bonus}" value="0">
                                                    </div>
                                                    <div class="sheet-form-group">
                                                        <label>Cultivation:</label>
                                                        <input type="number" name="attr_cultivation_check_bonus" title="@{cultivation_check_bonus}" value="0">
                                                    </div>
                                                    <div class="sheet-form-group">
                                                        <label>Qi Control:</label>
                                                        <input type="number" name="attr_qicontrol_check_bonus" title="@{qicontrol_check_bonus}" value="0">
                                                    </div>
                                                    <div class="sheet-form-group">
                                                        <label>Mental Strength:</label>
                                                        <input type="number" name="attr_mental_check_bonus" title="@{mental_check_bonus}" value="0">
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="sheet-container-header">ATTRIBUTE DC BONUS</div>
                                                    <div class="sheet-form-group">
                                                        <label>Power:</label>
                                                        <input type="number" name="attr_power_dc_bonus" title="@{power_dc_bonus}" value="0">
                                                    </div>
                                                    <div class="sheet-form-group">
                                                        <label>Agility:</label>
                                                        <input type="number" name="attr_agility_dc_bonus" title="@{agility_dc_bonus}" value="0">
                                                    </div>
                                                    <div class="sheet-form-group">
                                                        <label>Vitality:</label>
                                                        <input type="number" name="attr_vitality_dc_bonus" title="@{vitality_dc_bonus}" value="0">
                                                    </div>
                                                    <div class="sheet-form-group">
                                                        <label>Cultivation:</label>
                                                        <input type="number" name="attr_cultivation_dc_bonus" title="@{cultivation_dc_bonus}" value="0">
                                                    </div>
                                                    <div class="sheet-form-group">
                                                        <label>Qi Control:</label>
                                                        <input type="number" name="attr_qi_control_dc_bonus" title="@{qi_control_dc_bonus}" value="0">
                                                    </div>
                                                    <div class="sheet-form-group">
                                                        <label>Mental Strength:</label>
                                                        <input type="number" name="attr_mental_strength_bonus" dc_title="@{mental_strength_dc_bonus}" value="0">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-option-global">
                                <div class="sheet-container-header">GLOBAL MODIFIERS</div>
                                <div class="sheet-container-body">
                                    <div class="sheet-form sheet-form-borderless">
                                        <div class="sheet-form-body">
                                            <div class="sheet-form-group">
                                                <label>Global Attribute Modifier:</label>
                                                <input type="number" name="attr_global_attribute_bonus" title="@{global_attribute_bonus}" placeholder="0" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Global Attribute Check Modifier:</label>
                                                <input type="number" name="attr_global_attribute_check_bonus" title="@{global_attribute_check_bonus}" placeholder="0" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Global DC Modifier:</label>
                                                <input type="number" name="attr_global_dc_bonus" title="@{global_dc_bonus}" placeholder="0" value="0">
                                            </div>
                                            <div class="sheet-form-group">
                                                <label>Global Skill Modifier:</label>
                                                <input type="number" name="attr_global_skill_bonus" title="@{global_skill_bonus}" placeholder="0" value="0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="sheet-main-footer">
            <p>Venator Ignis's JTTH Character Sheet</p>
        </div>
    </div>
    <div class="sheet-variables">
        <input type="hidden" name="attr_power_base" value="0">
        <input type="hidden" name="attr_power_bonus" value="0">
        <input type="hidden" name="attr_power_flag" value="0">
        <input type="hidden" name="attr_power_dc" value="0">
        <input type="hidden" name="attr_power" value="0">
        <input type="hidden" name="attr_agility_base" value="0">
        <input type="hidden" name="attr_agility_bonus" value="0">
        <input type="hidden" name="attr_agility_flag" value="0">
        <input type="hidden" name="attr_agility_dc" value="0">
        <input type="hidden" name="attr_agility" value="0">
        <input type="hidden" name="attr_vitality_base" value="0">
        <input type="hidden" name="attr_vitality_bonus" value="0">
        <input type="hidden" name="attr_vitality_flag" value="0">
        <input type="hidden" name="attr_vitality_dc" value="0">
        <input type="hidden" name="attr_vitality" value="0">
        <input type="hidden" name="attr_cultivation_base" value="0">
        <input type="hidden" name="attr_cultivation_bonus" value="0">
        <input type="hidden" name="attr_cultivation_flag" value="0">
        <input type="hidden" name="attr_cultivation_dc" value="0">
        <input type="hidden" name="attr_cultivation" value="0">
        <input type="hidden" name="attr_qicontrol_base" value="0">
        <input type="hidden" name="attr_qicontrol_bonus" value="0">
        <input type="hidden" name="attr_qicontrol_flag" value="0">
        <input type="hidden" name="attr_qicontrol_dc" value="0">
        <input type="hidden" name="attr_qicontrol" value="0">
        <input type="hidden" name="attr_mental_base" value="0">
        <input type="hidden" name="attr_mental_bonus" value="0">
        <input type="hidden" name="attr_mental_flag" value="0">
        <input type="hidden" name="attr_mental_dc" value="0">
        <input type="hidden" name="attr_mental" value="0">
        <input type="hidden" name="attr_appearance" value="0">
        <input type="hidden" name="attr_global_skill_bonus" value="0">
        <input type="hidden" name="attr_global_attribute_bonus" value="0">
        <input type="hidden" name="attr_global_dc_bonus" value="0">
        <input type="hidden" name="attr_initiative" value="0">
        <input type="hidden" name="attr_initiative_bonus" value="0">
        <input type="hidden" name="acrobatics_bonus" value="0">
        <input type="hidden" name="acrobatics_roll" value="0">
        <input type="hidden" name="athletics_bonus" value="0">
        <input type="hidden" name="athletics_roll" value="0">
        <input type="hidden" name="seduce_bonus" value="0">
        <input type="hidden" name="seduce_roll" value="0">
        <input type="hidden" name="deceit_bonus" value="0">
        <input type="hidden" name="deceit_roll" value="0">
        <input type="hidden" name="discretion_bonus" value="0">
        <input type="hidden" name="discretion_roll" value="0">
        <input type="hidden" name="disguise_bonus" value="0">
        <input type="hidden" name="disguise_roll" value="0">
        <input type="hidden" name="fine_arts_bonus" value="0">
        <input type="hidden" name="fine_arts_roll" value="0">
        <input type="hidden" name="forgery_bonus" value="0">
        <input type="hidden" name="forgery_roll" value="0">
        <input type="hidden" name="grapple_bonus" value="0">
        <input type="hidden" name="grapple_roll" value="0">
        <input type="hidden" name="history_bonus" value="0">
        <input type="hidden" name="history_roll" value="0">
        <input type="hidden" name="intuition_bonus" value="0">
        <input type="hidden" name="intuition_roll" value="0">
        <input type="hidden" name="intimidation_bonus" value="0">
        <input type="hidden" name="intimidation_roll" value="0">
        <input type="hidden" name="investigation_bonus" value="0">
        <input type="hidden" name="investigation_roll" value="0">
        <input type="hidden" name="medicine_bonus" value="0">
        <input type="hidden" name="medicine_roll" value="0">
        <input type="hidden" name="navigation_bonus" value="0">
        <input type="hidden" name="navigation_roll" value="0">
        <input type="hidden" name="perception_bonus" value="0">
        <input type="hidden" name="perception_roll" value="0">
        <input type="hidden" name="performance_bonus" value="0">
        <input type="hidden" name="performance_roll" value="0">
        <input type="hidden" name="persuade_bonus" value="0">
        <input type="hidden" name="persuade_roll" value="0">
        <input type="hidden" name="stealth_bonus" value="0">
        <input type="hidden" name="stealth_roll" value="0">
        <input type="hidden" name="survival_bonus" value="0">
        <input type="hidden" name="survival_roll" value="0">
        <input type="hidden" name="attr_global_eff_attack">
        <input type="hidden" name="attr_global_acc_attack">
        <input type="hidden" name="attr_global_attack_mod">
        <input type="hidden" name="attr_cultivator_global_eff_attack">
        <input type="hidden" name="attr_cultivator_global_acc_attack">
        <input type="hidden" name="attr_cultivator_global_attack_mod">
        <input type="hidden" name="attr_mortal_global_damage_mod_type">
        <input type="hidden" name="attr_cultivator_global_damage_mod_type">
        <input type="hidden" name="attr_cultivator_global_attack_mod">
    </div>
    <div class="sheet-rolltemplates">
        <rolltemplate class="sheet-rolltemplate-atk">
            <div class="template-container">
                <div class="template-result">
                    <div class="template-add">
                        <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}{{#globalaccattack}} + {{globalaccattack}}{{/globalaccattack}}</span>
                    </div>
                    <div class="template-addspacer"></div>
                    <div class="template-add">
                        <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}{{#globaleffattack}} + {{globaleffattack}}{{/globaleffattack}}</span>
                    </div>
                </div>
                {{#range}}
                <div class="template-sublabel">
                    <span>{{range}}</span>
                </div>
                {{/range}}
                <div class="template-label">
                    <span>{{rname}}<span> ({{mod}})</span></span>
                </div>
                {{#charname}}
                <div class="template-charname">
                    <span>{{charname}}</span>
                </div>
                {{/charname}}
                {{#desc}}
                <div class="template-desc info">
                    <span>
                        <span class="top"></span>
                        <span class="middle">{{desc}}</span>
                        <span class="bottom"></span>
                    </span>
                </div>
                {{/desc}}
            </div>
        </rolltemplate>
        <rolltemplate class="sheet-rolltemplate-atkdmg">
            <div class="template-container">
                <div class="template-result">
                    <div class="template-add">
                        <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}{{#globalaccattack}} + {{globalaccattack}}{{/globalaccattack}}</span>
                    </div>
                    <div class="template-addspacer"></div>
                    <div class="template-add">
                        <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}{{#globaleffattack}} + {{globaleffattack}}{{/globaleffattack}}</span>
                    </div>
                </div>
                {{#range}}
                <div class="template-sublabel">
                    <span>{{range}}</span>
                </div>
                {{/range}}
                <div class="template-label">
                    <span>{{rname}}<span> ({{mod}})</span></span>
                </div>
                <div class="template-container damagetemplate">
                    <div class="template-result">
                        {{#dmgflag}}
                        <div class="template-damage-block">
                            <span class="damage">{{dmg1}}</span>
                            <span class="sublabel">{{dmg1type}}</span>
                        </div>
                        {{/dmgflag}}
                        {{#dmg2flag}}
                        <div class="template-damage-block">
                            <span class="damage">{{dmg2}}</span>
                            <span class="sublabel">{{dmg2type}}</span>
                        </div>
                        {{/dmg2flag}}
                        {{#dmg3flag}}
                        <div class="template-damage-block">
                            <span class="damage">{{dmg3}}</span>
                            <span class="sublabel">{{dmg3type}}</span>
                        </div>
                        {{/dmg3flag}}
                    </div>
                </div>
                {{#saveflag}}
                <div class="template-container save">
                    <div class="template-savedc">
                        <span>DC {{savedc}}</span>
                    </div>
                    {{#savedesc}}
                    <div class="template-sublabel">
                        <span>{{savedesc}}</span>
                    </div>
                    {{/savedesc}}
                    <div class="template-label">
                        <span>{{saveattr}} Save</span>
                    </div>
                </div>
                {{/saveflag}}
        
                {{#charname}}
                <div class="template-charname">
                    <span>{{charname}}</span>
                </div>
                {{/charname}}
                {{#desc}}
                <div class="template-desc info">
                    <span>
                        <span class="top"></span>
                        <span class="middle">{{desc}}</span>
                        <span class="bottom"></span>
                    </span>
                </div>
                {{/desc}}
            </div>
        </rolltemplate>
        <rolltemplate class="sheet-rolltemplate-dmg">
            <div class="template-container">
                <div class="damagetemplate">
                    <div class="template-result">
                        {{#dmgflag}}
                        <div class="template-damage-block">
                            <span class="damage">{{dmg1}}</span>
                            <span class="sublabel">{{dmg1type}}</span>
                        </div>
                        {{/dmgflag}}
                        {{#dmg2flag}}
                        <div class="template-damage-block">
                            <span class="damage">{{dmg2}}</span>
                            <span class="sublabel">{{dmg2type}}</span>
                        </div>
                        {{/dmg2flag}}
                        {{#dmg3flag}}
                        <div class="template-damage-block">
                            <span class="damage">{{dmg3}}</span>
                            <span class="sublabel">{{dmg3type}}</span>
                        </div>
                        {{/dmg3flag}}
                    </div>
                </div>
                {{#saveflag}}
                <div class="save">
                    <div class="template-savedc">
                        <span>{{saveattr}} Check DC: {{savedc}}</span>
                    </div>
                    {{#savedesc}}
                    <div class="template-sublabel">
                        <span>{{savedesc}}</span>
                    </div>
                    {{/savedesc}}
                </div>
                {{/saveflag}}
            </div>
        </rolltemplate>
        <rolltemplate class="sheet-rolltemplate-features">
            <div class="template-container">
                <div class="template-row header">
                    <span>{{name}}</span>
                </div>
                {{#source}}
                <div class="template-row subheader">
                    <span class="italics">{{#charname}}{{charname}} {{/charname}}{{source}}</span>
                </div>
                {{/source}}
                {{#description}}
                    <div class="template-row">
                        <span class="desc">{{description}}</span>
                    </div>
                {{/description}}
            </div>
        </rolltemplate>
        <rolltemplate class="sheet-rolltemplate-tool">
            <div class="template-container">
                <div class="template-result">
                    <div class="template-solo">
                        <span>{{r1}}</span>
                    </div>
                </div>
                <div class="template-label">
                    <span>{{rname}} ({{mod}})</span>
                </div>
                {{#charname}}
                <div class="template-charname">
                    <span>{{charname}}</span>
                </div>
                {{/charname}}
            </div>
        </rolltemplate>
        <rolltemplate class="sheet-rolltemplate-simple">
            <div class="template-container">
                <div class="template-result">
                    <div class="template-solo">
                        <span>{{r1}}</span>
                    </div>
                </div>
                <div class="template-label">
                    <span>{{rname}} {{mod}}</span>
                </div>
                {{#charname}}
                <div class="template-charname">
                    <span>{{charname}}</span>
                </div>
                {{/charname}}
            </div>
        </rolltemplate>
        <rolltemplate class="sheet-rolltemplate-simple-add">
            <div class="template-container">
                <div class="template-result">
                    <div class="template-add">
                        <span>{{r1}}</span>
                    </div>
                    <div class="template-addspacer"></div>
                    <div class="template-add">
                        <span>{{r2}}</span>
                    </div>
                </div>
                <div class="template-label">
                    <span>{{rname}}{{#mod}} ({{mod}}){{/mod}}</span>
                </div>
                {{#charname}}
                <div class="template-charname">
                    <span>{{charname}}</span>
                </div>
                {{/charname}}
            </div>
        </rolltemplate>
    </div>
    <script type="text/worker">
        "power agility vitality cultivation qicontrol mental appearance".split(" ").forEach(c => {
            on(`change:${c}_base change:${c}_bonus change:${c}_dc_bonus`, function() {
              update_attr(`${c}`);
            });
          });
          "power agility vitality cultivation qicontrol mental appearance".split(" ").forEach(c => {
            on(`change:${c}`, function() {
              update_mortalattacks(`${c}`);
              update_cultivatorattacks(`${c}`);
              switch(`${c}`) {
                case "power":
                  update_weight();
                  update_skills(["athletics", "grapple", "intimidation", "survival"]);
                  break;
                case "agility":
                  update_initiative();
                  update_evasion();
                  update_skills("acrobatics discretion stealth fine_arts forgery navigation performance".split(" "));
                  break;
                case "vitality":
                  update_durability();
                  break;
                case "qicontrol":
                  update_skills(["history", "medicine"]);
                  break;
                case "mental":
                  update_skills("seduce deceit disguise persuade fine_arts forgery navigation history medicine intuition investigation perception survival".split(" "));
                  break;
                case "appearance":
                  update_skills("seduce deceit disguise persuade intimidation performance".split(" "));
              }
            });
          });
          "acrobatics athletics seduce deceit discretion disguise fine_arts forgery grapple history intuition intimidation investigation medicine navigation perception performance persuade stealth survival".split(" ").forEach(c => {
            on(`change:${c}_flat`, function(f) {
              "sheetworker" !== f.sourceType && update_skills([`${c}`]);
            });
          });
          on("change:initiative_bonus", function() {
            update_initiative();
          });
          on("change:mortal-level", function() {
            "power agility vitality cultivation qicontrol mental appearance".split(" ").forEach(c => {
              update_attr(`${c}`);
            });
          });
          on("change:repeating_inventory:itemmodifiers change:repeating_inventory:equipped change:repeating_inventory:carried", function(c) {
            if (!c.sourceType || "sheetworker" !== c.sourceType) {
              var f = c.sourceAttribute.substring(20, 40);
              getAttrs(["repeating_inventory_" + f + "_itemmodifiers"], function(a) {
                a["repeating_inventory_" + f + "_itemmodifiers"] && check_itemmodifiers(a["repeating_inventory_" + f + "_itemmodifiers"], c.previousValue);
              });
            }
          });
          on("change:repeating_inventory:itemcontainer change:repeating_inventory:equipped change:repeating_inventory:carried change:repeating_inventory:itemweight change:repeating_inventory:itemcount change:encumberance_setting change:size change:carrying_capacity_mod change:use_inventory_slots change:inventory_slots_mod change:repeating_inventory:itemweightfixed change:repeating_inventory:itemslotsfixed change:repeating_inventory:itemsize change:repeating_inventory:itemcontainer_slots change:repeating_inventory:itemcontainer_slots_modifier", 
          function() {
            update_weight();
          });
          on("change:repeating_mortalattack:atkname change:repeating_mortalattack:atkflag change:repeating_mortalattack:atkattr_base change:repeating_mortalattack:atkmod change:repeating_mortalattack:dmgflag change:repeating_mortalattack:dmgbase change:repeating_mortalattack:dmgattr change:repeating_mortalattack:dmgmod change:repeating_mortalattack:dmgtype change:repeating_mortalattack:dmg2flag change:repeating_mortalattack:dmg2base change:repeating_mortalattack:dmg2attr change:repeating_mortalattack:dmg2mod change:repeating_mortalattack:dmg2type change:repeating_mortalattack:dmg3flag change:repeating_mortalattack:dmg3base change:repeating_mortalattack:dmg3attr change:repeating_mortalattack:dmg3mod change:repeating_mortalattack:dmg3type change:repeating_mortalattack:saveflag change:repeating_mortalattack:savedc change:repeating_mortalattack:saveflat change:repeating_mortalattack:saveattr change:repeating_mortalattack:atkrange", 
          function(c) {
            "sheetworker" !== c.sourceType && (c = c.sourceAttribute.substring(23, 43), update_mortalattacks(c));
          });
          on("change:repeating_mortaldamagemod remove:repeating_mortaldamagemod", function() {
            update_mortalglobaldamage();
          });
          on("change:repeating_mortaltohitmod remove:repeating_mortaltohitmod", function() {
            update_mortalglobalattack();
          });
          on("change:repeating_cultivatorattack:atkname change:repeating_cultivatorattack:atkflag change:repeating_cultivatorattack:atkattr_base change:repeating_cultivatorattack:atkmod change:repeating_cultivatorattack:dmgflag change:repeating_cultivatorattack:dmgbase change:repeating_cultivatorattack:dmgattr change:repeating_cultivatorattack:dmgmod change:repeating_cultivatorattack:dmgtype change:repeating_cultivatorattack:dmg2flag change:repeating_cultivatorattack:dmg2base change:repeating_cultivatorattack:dmg2attr change:repeating_cultivatorattack:dmg2mod change:repeating_cultivatorattack:dmg2type change:repeating_cultivatorattack:dmg3flag change:repeating_cultivatorattack:dmg3base change:repeating_cultivatorattack:dmg3attr change:repeating_cultivatorattack:dmg3mod change:repeating_cultivatorattack:dmg3type change:repeating_cultivatorattack:saveflag change:repeating_cultivatorattack:savedc change:repeating_cultivatorattack:saveflat change:repeating_cultivatorattack:saveattr change:repeating_cultivatorattack:atkrange", 
          function(c) {
            "sheetworker" !== c.sourceType && (c = c.sourceAttribute.substring(27, 47), update_cultivatorattacks(c));
          });
          on("change:repeating_cultivatordamagemod remove:repeating_cultivatordamagemod", function() {
            update_cultivatorglobaldamage();
          });
          on("change:repeating_cultivatortohitmod remove:repeating_cultivatortohitmod", function() {
            update_cultivatorglobalattack();
          });
          on("change:global_damage_mod_flag", function(c) {
            getSectionIDs("mortaldamagemod", function(f) {
              var a = {};
              "1" === c.newValue ? f && 0 !== f.length || (f = generateRowID(), a[`repeating_mortaldamagemod_${f}_global_damage_active_flag`] = "1") : _.each(f, function(b) {
                a[`repeating_mortaldamagemod_${b}_global_damage_active_flag`] = "0";
              });
              setAttrs(a);
            });
          });
          on("change:global_dc_bonus change:global_attribute_bonus", function(c) {
            "power agility vitality cultivation qicontrol mental".split(" ").forEach(f => {
              update_attr(`${f}`);
            });
          });
          on("change:dtype", function(c) {
            c.sourceType && "sheetworker" === c.sourceType || (update_mortalattacks("all"), update_cultivatorattacks("all"));
          });
          on("change:durability-base change:durability-limit change:durability-bonus", function() {
            update_durability();
          });
          on("change:evasion-base change:evasion-limit change:evasion-bonus", function() {
            update_evasion();
          });
          on("change:reduction-base change:reduction-armour change:reduction-bonus", function() {
            update_reduction();
          });
          on("remove:repeating_inventory", function(c) {
            var f = c.sourceAttribute.substring(20, 40);
            c.removedInfo && c.removedInfo["repeating_inventory_" + f + "_itemmodifiers"] && check_itemmodifiers(c.removedInfo["repeating_inventory_" + f + "_itemmodifiers"]);
            update_weight();
          });
          var check_itemmodifiers = function(c, f) {
            c = c.toLowerCase().split(",");
            f && (prevmods = f.toLowerCase().split(","), c = _.union(c, prevmods));
            _.each(c, function(a) {
              -1 < a.indexOf("power") && update_attr("power");
              -1 < a.indexOf("agility") && update_attr("agility");
              -1 < a.indexOf("vitality") && update_attr("vitality");
              -1 < a.indexOf("cultivation") && update_attr("cultivation");
              -1 < a.indexOf("qicontrol") && update_attr("qicontrol");
              -1 < a.indexOf("mental") && update_attr("mental");
              -1 < a.indexOf("appearance") && update_attr("appearance");
              -1 < a.indexOf("skill checks") && update_all_skill_checks();
              -1 < a.indexOf("acrobatics") && update_skills(["acrobatics"]);
              -1 < a.indexOf("athletics") && update_skills(["athletics"]);
              -1 < a.indexOf("seduce") && update_skills(["seduce"]);
              -1 < a.indexOf("deceit") && update_skills(["deceit"]);
              -1 < a.indexOf("discretion") && update_skills(["discretion"]);
              -1 < a.indexOf("disguise") && update_skills(["disguise"]);
              -1 < a.indexOf("fine_arts") && update_skills(["fine_arts"]);
              -1 < a.indexOf("forgery") && update_skills(["forgery"]);
              -1 < a.indexOf("grapple") && update_skills(["grapple"]);
              -1 < a.indexOf("history") && update_skills(["history"]);
              -1 < a.indexOf("intuition") && update_skills(["intuition"]);
              -1 < a.indexOf("intimidation") && update_skills(["intimidation"]);
              -1 < a.indexOf("investigation") && update_skills(["investigation"]);
              -1 < a.indexOf("medicine") && update_skills(["medicine"]);
              -1 < a.indexOf("navigation") && update_skills(["navigation"]);
              -1 < a.indexOf("perception") && update_skills(["perception"]);
              -1 < a.indexOf("performance") && update_skills(["performance"]);
              -1 < a.indexOf("persuade") && update_skills(["persuade"]);
              -1 < a.indexOf("stealth") && update_skills(["stealth"]);
              -1 < a.indexOf("survival") && update_skills(["survival"]);
            });
          }, update_attr = function(c) {
            var f = {}, a = [c + "_base", c + "_bonus", c + "_dc_bonus", "global_dc_bonus", "mortal-level", "global_attribute_bonus"];
            getSectionIDs("repeating_inventory", function(b) {
              _.each(b, function(h) {
                a.push("repeating_inventory_" + h + "_equipped");
                a.push("repeating_inventory_" + h + "_itemmodifiers");
              });
              getAttrs(a, function(h) {
                var g = h[c + "_base"] && !isNaN(parseInt(h[c + "_base"], 0)) ? parseInt(h[c + "_base"], 0) : 0, d = h[c + "_bonus"] && !isNaN(parseInt(h[c + "_bonus"], 0)) ? parseInt(h[c + "_bonus"], 0) : 0, k = h.global_attribute_bonus && !isNaN(parseInt(h.global_attribute_bonus, 0)) ? parseInt(h.global_attribute_bonus, 0) : 0, l = h.global_dc_bonus && !isNaN(parseInt(h.global_dc_bonus, 0)) ? parseInt(h.global_dc_bonus, 0) : 0, m = h[c + "_dc_bonus"] && !isNaN(parseInt(h[c + "_dc_bonus"], 0)) ? 
                parseInt(h[c + "_dc_bonus"], 0) : 0, n = h["mortal-level"] && !isNaN(parseInt(h["mortal-level"], 0)) ? parseInt(h["mortal-level"], 0) : 0, p = 0, v = 0;
                _.each(b, function(q) {
                  h["repeating_inventory_" + q + "_equipped"] && "1" !== h["repeating_inventory_" + q + "_equipped"] || !h["repeating_inventory_" + q + "_itemmodifiers"] || !h["repeating_inventory_" + q + "_itemmodifiers"].toLowerCase().indexOf(-1 < c) || (q = h["repeating_inventory_" + q + "_itemmodifiers"].toLowerCase().split(","), _.each(q, function(r) {
                    -1 < r.indexOf(c) && (-1 < r.indexOf(":") ? p = (r = isNaN(parseInt(r.replace(/[^0-9]/g, ""), 0)) ? !1 : parseInt(r.replace(/[^0-9]/g, ""), 0)) && r > p ? r : p : v = -1 < r.indexOf("-") ? (r = isNaN(parseInt(r.replace(/[^0-9]/g, ""), 0)) ? !1 : parseInt(r.replace(/[^0-9]/g, ""), 0)) ? v - r : v : (r = isNaN(parseInt(r.replace(/[^0-9]/g, ""), 0)) ? !1 : parseInt(r.replace(/[^0-9]/g, ""), 0)) ? v + r : v);
                  }));
                });
                f[c + "_flag"] = 0 != d || 0 != k || 0 < v || p > g ? 1 : 0;
                finalattr = (g > p ? g : p) + d + v + k;
                f[c + "_dc"] = Math.floor(finalattr * (3.5 + Math.floor(n / 7))) + l + m;
                f[c] = finalattr;
                setAttrs(f);
              });
            });
          }, update_initiative = function() {
            var c = ["agility", "initiative_bonus"];
            getSectionIDs("repeating_inventory", function(f) {
              _.each(f, function(a) {
                c.push("repeating_inventory_" + a + "_equipped");
                c.push("repeating_inventory_" + a + "_itemmodifiers");
              });
              getAttrs(c, function(a) {
                var b = {}, h = parseInt(a.agility) || 0, g = parseInt(a.dexterity_mod, 0);
                a.initiative_bonus && !isNaN(parseInt(a.initiative_bonus, 0)) && (g += parseInt(a.initiative_bonus, 0));
                _.each(f, function(d) {
                  a["repeating_inventory_" + d + "_equipped"] && "1" === a["repeating_inventory_" + d + "_equipped"] && a["repeating_inventory_" + d + "_itemmodifiers"] && -1 < a["repeating_inventory_" + d + "_itemmodifiers"].toLowerCase().indexOf("initiative") && (d = a["repeating_inventory_" + d + "_itemmodifiers"].toLowerCase().split(","), _.each(d, function(k) {
                    -1 < k.indexOf("initiative") && (g = -1 < k.indexOf("-") ? (k = isNaN(parseInt(k.replace(/[^0-9]/g, ""), 0)) ? !1 : parseInt(k.replace(/[^0-9]/g, ""), 0)) ? g - k : g : (k = isNaN(parseInt(k.replace(/[^0-9]/g, ""), 0)) ? !1 : parseInt(k.replace(/[^0-9]/g, ""), 0)) ? g + k : g);
                  }));
                });
                0 != g % 1 && (g = parseFloat(g.toPrecision(12)));
                b.initiative = h + (parseInt(a.final_init) ? `d6+${parseInt(a.final_init)}` : "d6");
                setAttrs(b, {silent:!0});
              });
            });
          }, update_mortalattacks = function(c, f) {
            console.log("DOING MORTAL_UPDATE_ATTACKS: " + c);
            "-" === c.substring(0, 1) && 20 === c.length ? do_update_mortalattack([c], f) : -1 < "power agility vitality cultivation qicontrol mental all".split(" ").indexOf(c) && getSectionIDs("repeating_mortalattack", function(a) {
              if ("all" === c) {
                do_update_mortalattack(a);
              } else {
                var b = [];
                _.each(a, function(h) {
                  b.push("repeating_attack_" + h + "_atkattr_base");
                  b.push("repeating_attack_" + h + "_dmgattr");
                  b.push("repeating_attack_" + h + "_dmg2attr");
                  b.push("repeating_attack_" + h + "_dmg3attr");
                  b.push("repeating_attack_" + h + "_savedc");
                });
                getAttrs(b, function(h) {
                  var g = [];
                  _.each(a, function(d) {
                    (h["repeating_attack_" + d + "_atkattr_base"] && -1 < h["repeating_attack_" + d + "_atkattr_base"].indexOf(c) || h["repeating_attack_" + d + "_dmgattr"] && -1 < h["repeating_attack_" + d + "_dmgattr"].indexOf(c) || h["repeating_attack_" + d + "_dmg2attr"] && -1 < h["repeating_attack_" + d + "_dmg2attr"].indexOf(c) || h["repeating_attack_" + d + "_dmg3attr"] && -1 < h["repeating_attack_" + d + "_dmg3attr"].indexOf(c) || h["repeating_attack_" + d + "_savedc"] && -1 < h["repeating_attack_" + 
                    d + "_savedc"].indexOf(c)) && g.push(d);
                  });
                  0 < g.length && do_update_mortalattack(g);
                });
              }
            });
          }, do_update_mortalattack = function(c) {
            var f = "level dtype power agility vitality cultivation qicontrol mental global_damage_damage mortal_global_damage_mod_type global_damage_percent".split(" ");
            _.each(c, function(a) {
              f.push("repeating_mortalattack_" + a + "_atkflag");
              f.push("repeating_mortalattack_" + a + "_atkname");
              f.push("repeating_mortalattack_" + a + "_atkattr_base");
              f.push("repeating_mortalattack_" + a + "_atkmod");
              f.push("repeating_mortalattack_" + a + "_dmgflag");
              f.push("repeating_mortalattack_" + a + "_dmgbase");
              f.push("repeating_mortalattack_" + a + "_dmgattr");
              f.push("repeating_mortalattack_" + a + "_dmgmod");
              f.push("repeating_mortalattack_" + a + "_dmgtype");
              f.push("repeating_mortalattack_" + a + "_dmg2flag");
              f.push("repeating_mortalattack_" + a + "_dmg2base");
              f.push("repeating_mortalattack_" + a + "_dmg2attr");
              f.push("repeating_mortalattack_" + a + "_dmg2mod");
              f.push("repeating_mortalattack_" + a + "_dmg2type");
              f.push("repeating_mortalattack_" + a + "_dmg3flag");
              f.push("repeating_mortalattack_" + a + "_dmg3base");
              f.push("repeating_mortalattack_" + a + "_dmg3attr");
              f.push("repeating_mortalattack_" + a + "_dmg3mod");
              f.push("repeating_mortalattack_" + a + "_dmg3type");
              f.push("repeating_mortalattack_" + a + "_saveflag");
              f.push("repeating_mortalattack_" + a + "_savedc");
              f.push("repeating_mortalattack_" + a + "_saveeffect");
              f.push("repeating_mortalattack_" + a + "_saveflat");
              f.push("repeating_mortalattack_" + a + "_atkrange");
              f.push("repeating_mortalattack_" + a + "_global_damage_mod_field");
            });
            getAttrs(f, function(a) {
              _.each(c, function(b) {
                var h = [], g = {}, d = "", k = "", l = "", m = "", n = "", p = "", v = p = "", q = "", r = "", t = "", u = "";
                a["repeating_mortalattack_" + b + "_atkattr_base"] && "0" !== a["repeating_mortalattack_" + b + "_atkattr_base"] ? (atkattr_base = parseInt(a[a["repeating_mortalattack_" + b + "_atkattr_base"].substring(2, a["repeating_mortalattack_" + b + "_atkattr_base"].length - 1)], 0), p = a["repeating_mortalattack_" + b + "_atkattr_base"].substring(2, a["repeating_mortalattack_" + b + "_atkattr_base"].length - 1).toUpperCase()) : atkattr_base = 0;
                a["repeating_mortalattack_" + b + "_dmgattr"] && "0" !== a["repeating_mortalattack_" + b + "_dmgattr"] ? (dmgattr = parseInt(a[a["repeating_mortalattack_" + b + "_dmgattr"].substring(2, a["repeating_mortalattack_" + b + "_dmgattr"].length - 1)], 0), v = a["repeating_mortalattack_" + b + "_dmgattr"].substring(2, a["repeating_mortalattack_" + b + "_dmgattr"].length - 1).toUpperCase()) : dmgattr = 0;
                dmgattr = Math.floor(dmgattr * a.global_damage_percent);
                a["repeating_mortalattack_" + b + "_dmg2attr"] && "0" !== a["repeating_mortalattack_" + b + "_dmg2attr"] ? (dmg2attr = parseInt(a[a["repeating_mortalattack_" + b + "_dmg2attr"].substring(2, a["repeating_mortalattack_" + b + "_dmg2attr"].length - 1)], 0), q = a["repeating_mortalattack_" + b + "_dmg2attr"].substring(2, a["repeating_mortalattack_" + b + "_dmg2attr"].length - 1).toUpperCase()) : dmg2attr = 0;
                dmg2attr = Math.floor(dmg2attr * a.global_damage_percent);
                a["repeating_mortalattack_" + b + "_dmg3attr"] && "0" !== a["repeating_mortalattack_" + b + "_dmg3attr"] ? (dmg3attr = parseInt(a[a["repeating_mortalattack_" + b + "_dmg3attr"].substring(2, a["repeating_mortalattack_" + b + "_dmg3attr"].length - 1)], 0), r = a["repeating_mortalattack_" + b + "_dmg3attr"].substring(2, a["repeating_mortalattack_" + b + "_dmg3attr"].length - 1).toUpperCase()) : dmg3attr = 0;
                dmg3attr = Math.floor(dmg3attr * a.global_damage_percent);
                var C = a["repeating_mortalattack_" + b + "_dmgbase"] && "" != a["repeating_mortalattack_" + b + "_dmgbase"] ? a["repeating_mortalattack_" + b + "_dmgbase"] : 0, D = a["repeating_mortalattack_" + b + "_dmg2base"] && "" != a["repeating_mortalattack_" + b + "_dmg2base"] ? a["repeating_mortalattack_" + b + "_dmg2base"] : 0, E = a["repeating_mortalattack_" + b + "_dmg3base"] && "" != a["repeating_mortalattack_" + b + "_dmg3base"] ? a["repeating_mortalattack_" + b + "_dmg3base"] : 0, y = a["repeating_mortalattack_" + 
                b + "_dmgmod"] && !1 === isNaN(parseInt(a["repeating_mortalattack_" + b + "_dmgmod"], 0)) ? parseInt(a["repeating_mortalattack_" + b + "_dmgmod"], 0) : 0, z = a["repeating_mortalattack_" + b + "_dmg2mod"] && !1 === isNaN(parseInt(a["repeating_mortalattack_" + b + "_dmg2mod"], 0)) ? parseInt(a["repeating_mortalattack_" + b + "_dmg2mod"], 0) : 0, A = a["repeating_mortalattack_" + b + "_dmg3mod"] && !1 === isNaN(parseInt(a["repeating_mortalattack_" + b + "_dmg3mod"], 0)) ? parseInt(a["repeating_mortalattack_" + 
                b + "_dmg3mod"], 0) : 0, F = a["repeating_mortalattack_" + b + "_dmgtype"] ? a["repeating_mortalattack_" + b + "_dmgtype"] + " " : "", G = a["repeating_mortalattack_" + b + "_dmg2type"] ? a["repeating_mortalattack_" + b + "_dmg2type"] + " " : "", H = a["repeating_mortalattack_" + b + "_dmg3type"] ? a["repeating_mortalattack_" + b + "_dmg3type"] + " " : "", I = a["repeating_mortalattack_" + b + "_atkmod"] && "" != a["repeating_mortalattack_" + b + "_atkmod"] ? parseInt(a["repeating_mortalattack_" + 
                b + "_atkmod"], 0) : 0, w = "+" + `[[ceil([[${a.global_damage_damage && "" !== a.global_damage_damage ? a.global_damage_damage : "0"}]] * ${parseFloat(a.global_damage_percent || 0)})]]` + "[" + (a.mortal_global_damage_mod_type || "") + "]", x = B => B && "0" !== B ? `[[ceil([[${B}]] * ${parseFloat(a.global_damage_percent || 0)})]]` : B;
                BB = C;
                CC = D;
                DD = E;
                C = x(C);
                D = x(D);
                E = x(E);
                a["repeating_mortalattack_" + b + "_atkflag"] && 0 != a["repeating_mortalattack_" + b + "_atkflag"] ? (bonus_mod = atkattr_base + I, plus_minus = -1 < bonus_mod ? "+" : "", bonus = plus_minus + bonus_mod) : a["repeating_mortalattack_" + b + "_saveflag"] && 0 != a["repeating_mortalattack_" + b + "_saveflag"] ? (a["repeating_mortalattack_" + b + "_savedc"] && "(@{saveflat})" === a["repeating_mortalattack_" + b + "_savedc"] ? x = !1 === isNaN(parseInt(a["repeating_mortalattack_" + b + "_saveflat"])) ? 
                parseInt(a["repeating_mortalattack_" + b + "_saveflat"]) : "0" : (x = a["repeating_mortalattack_" + b + "_savedc"].replace(/^[^{]*{/, "").replace(/_.*$/, ""), x = a[x] ? parseInt(a[x], 0) : 0), bonus = "DC" + x) : bonus = "-";
                a["repeating_mortalattack_" + b + "_dmgflag"] && 0 != a["repeating_mortalattack_" + b + "_dmgflag"] ? (0 === BB && 0 === dmgattr + y && (m = 0), 0 != BB && (m = BB), 0 != BB && 0 != dmgattr + y && (m = 0 < dmgattr + y ? m + "+" : m), 0 != dmgattr + y && (m += dmgattr + y), m = m + " " + F) : m = "";
                a["repeating_mortalattack_" + b + "_dmg2flag"] && 0 != a["repeating_mortalattack_" + b + "_dmg2flag"] ? (0 === CC && 0 === dmg2attr + z && (n = 0), 0 != CC && (n = CC), 0 != CC && 0 != dmg2attr + z && (n = 0 < dmg2attr + z ? n + "+" : n), 0 != dmg2attr + z && (n += dmg2attr + z), n = n + " " + G) : n = "";
                a["repeating_mortalattack_" + b + "_dmg3flag"] && 0 != a["repeating_mortalattack_" + b + "_dmg3flag"] ? (0 === DD && 0 === dmg3attr + A && (t = 0), 0 != DD && (t = DD), 0 != DD && 0 != dmg3attr + A && (t = 0 < dmg3attr + A ? t + "+" : t), 0 != dmg3attr + A && (t += dmg3attr + A), t = t + " " + H) : t = "";
                dmgspacer1 = a["repeating_mortalattack_" + b + "_dmgflag"] && 0 != a["repeating_mortalattack_" + b + "_dmgflag"] && a["repeating_mortalattack_" + b + "_dmg2flag"] && 0 != a["repeating_mortalattack_" + b + "_dmg2flag"] ? "+ " : "";
                dmgspacer2 = a["repeating_mortalattack_" + b + "_dmgflag"] && 0 != a["repeating_mortalattack_" + b + "_dmgflag"] && a["repeating_mortalattack_" + b + "_dmg3flag"] && 0 != a["repeating_mortalattack_" + b + "_dmg3flag"] ? "+ " : "";
                r2 = "{{r2=[[";
                a["repeating_mortalattack_" + b + "_atkflag"] && 0 != a["repeating_mortalattack_" + b + "_atkflag"] ? (0 != I && (d = I + "[MOD]" + d), 0 != atkattr_base && (d = atkattr_base + "[" + p + "]" + d)) : d = "";
                a["repeating_mortalattack_" + b + "_dmgflag"] && 0 != a["repeating_mortalattack_" + b + "_dmgflag"] ? (0 != y && (k = "+" + Math.floor(y * a.global_damage_percent) + "[MOD]" + k), 0 != dmgattr && (k = "+" + dmgattr + "[" + v + "]" + k), k = C + k) : k = "0";
                a["repeating_mortalattack_" + b + "_dmg2flag"] && 0 != a["repeating_mortalattack_" + b + "_dmg2flag"] ? (0 != z && (l = "+" + Math.floor(z * a.global_damage_percent) + "[MOD]" + l), 0 != dmg2attr && (l = "+" + dmg2attr + "[" + q + "]" + l), l = D + l) : l = "0";
                a["repeating_mortalattack_" + b + "_dmg3flag"] && 0 != a["repeating_mortalattack_" + b + "_dmg3flag"] ? (0 != A && (u = "+" + Math.floor(A * a.global_damage_percent) + "[MOD]" + u), 0 != dmg3attr && (u = "+" + dmg3attr + "[" + r + "]" + u), u = E + u) : u = "0";
                "full" === a.dtype ? (pickbase = "full", p = "@{whispertoggle}&{template:atkdmg} {{mod=@{atkbonus}}} {{rname=@{atkname}}} {{r1=[[" + d + "]]}} " + r2 + d + "]]}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[" + k + w + "]]}} {{dmg1type=" + F + "}} @{dmg2flag} {{dmg2=[[" + l + w + "]]}} {{dmg2type=" + G + "}} @{dmg3flag} {{dmg3=[[" + u + w + "]]}} {{dmg3type=" + H + "}} @{saveflag} {{desc=@{atk_desc}}} {{globalattack=@{global_attack_mod}}} {{globalaccattack=@{global_acc_attack}}} {{globaleffattack=@{global_eff_attack}}} {{globaldamagetype=@{mortal_global_damage_mod_type}}} @{charname_output}") : 
                a["repeating_mortalattack_" + b + "_atkflag"] && 0 != a["repeating_mortalattack_" + b + "_atkflag"] ? (pickbase = "pick", p = "@{whispertoggle}&{template:atk} {{mod=@{atkbonus}}} {{rname=[@{atkname}](~repeating_mortalattack_attack_dmg)}} {{r1=[[" + d + "]]}} " + r2 + d + "]]}} {{range=@{atkrange}}} {{desc=@{atk_desc}}} {{globalattack=@{global_attack_mod}}} {{globalaccattack=@{global_acc_attack}}} {{globaleffattack=@{global_eff_attack}}} @{charname_output}") : a["repeating_mortalattack_" + b + "_dmgflag"] && 
                0 != a["repeating_mortalattack_" + b + "_dmgflag"] ? (pickbase = "dmg", p = "@{whispertoggle}&{template:dmg} {{rname=@{atkname}}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[" + k + w + "]]}} {{dmg1type=" + F + "}} @{dmg2flag} {{dmg2=[[" + l + w + "]]}} {{dmg2type=" + G + "}} @{dmg3flag} {{dmg3=[[" + u + w + "]]}} {{dmg3type=" + H + "}} @{saveflag} {{desc=@{atk_desc}}} {{globaldamagetype=@{mortal_global_damage_mod_type}}} @{charname_output}") : (pickbase = "empty", p = "@{whispertoggle}&{template:dmg} {{rname=@{atkname}}} @{atkflag} {{range=@{atkrange}}} @{saveflag} {{desc=@{atk_desc}}} @{charname_output}");
                g["repeating_mortalattack_" + b + "_rollbase_dmg"] = "@{whispertoggle}&{template:dmg} {{rname=@{atkname}}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[" + k + w + "]]}} {{dmg1type=" + F + "}} @{dmg2flag} {{dmg2=[[" + l + w + "]]}} {{dmg2type=" + G + "}} @{dmg3flag} {{dmg3=[[" + u + w + "]]}} {{dmg3type=" + H + "}} @{saveflag} {{desc=@{atk_desc}}} {{globaldamagetype=@{mortal_global_damage_mod_type}}} @{charname_output}";
                g["repeating_mortalattack_" + b + "_atkbonus"] = bonus;
                g["repeating_mortalattack_" + b + "_atkdmgtype"] = m + dmgspacer1 + n + dmgspacer2 + t + " ";
                g["repeating_mortalattack_" + b + "_rollbase"] = p;
                setAttrs(g, {silent:!0}, function() {
                  h.forEach(function(B) {
                    B();
                  });
                });
              });
            });
          }, update_mortalglobaldamage = function(c) {
            getSectionIDs("mortaldamagemod", function(f) {
              if (f) {
                var a = {}, b = [];
                f.forEach(function(h) {
                  a[h] = {};
                  b.push(`repeating_mortaldamagemod_${h}_global_damage_active_flag`, `repeating_mortaldamagemod_${h}_global_damage_name`, `repeating_mortaldamagemod_${h}_global_damage_damage`, `repeating_mortaldamagemod_${h}_global_damage_type`);
                });
                getAttrs(b, function(h) {
                  var g = /^repeating_mortaldamagemod_(.+)_global_damage_(active_flag|name|damage|type)$/;
                  _.each(h, function(k, l) {
                    (l = g.exec(l)) && (a[l[1]][l[2]] = k);
                  });
                  var d = {global_damage_damage:"", global_damage_percent:0, mortal_global_damage_mod_type:""};
                  console.log("MORTAL GLOBALDAMAGE");
                  _.each(a, function(k) {
                    if ("0" != k.active_flag && k.name && "" !== k.name) {
                      if (k.damage.includes("%")) {
                        var l = parseFloat(k.damage);
                        isNaN(l) || (d.global_damage_percent += l);
                      } else {
                        d.global_damage_damage += k.damage + "[" + k.name + "]+";
                      }
                      k.type && "" !== k.type && (d.mortal_global_damage_mod_type += k.type + "/");
                    }
                  });
                  d.global_damage_damage = d.global_damage_damage.replace(/\+(?=$)/, "");
                  d.global_damage_percent = parseFloat(d.global_damage_percent) / 100 + 1 || 1;
                  d.mortal_global_damage_mod_type = d.mortal_global_damage_mod_type.replace(/\/(?=$)/, "");
                  setAttrs(d, {silent:!0}, function() {
                    update_mortalattacks("all");
                    "function" == typeof c && c();
                  });
                });
              }
            });
          }, update_mortalglobalattack = function(c) {
            getSectionIDs("mortaltohitmod", function(f) {
              if (f) {
                var a = {}, b = [];
                f.forEach(function(h) {
                  a[h] = {};
                  b.push(`repeating_mortaltohitmod_${h}_global_attack_active_flag`, `repeating_mortaltohitmod_${h}_global_attack_roll`, `repeating_mortaltohitmod_${h}_global_attack_name`, `repeating_mortaltohitmod_${h}_global_attack_appliesto`);
                });
                getAttrs(b, function(h) {
                  var g = /^repeating_mortaltohitmod_(.+)_global_attack_(active_flag|roll|name|appliesto)$/;
                  _.each(h, function(k, l) {
                    (l = g.exec(l)) && (a[l[1]][l[2]] = k);
                  });
                  var d = {global_attack_mod:"", global_acc_attack:"", global_eff_attack:""};
                  console.log("MORTAL GLOBALATTACK");
                  _.each(a, function(k) {
                    if ("0" != k.active_flag && k.roll && "" !== k.roll) {
                      switch(k.appliesto) {
                        case "Accuracy":
                          d.global_acc_attack += k.roll + "[" + k.name + "]+";
                          break;
                        case "Effectiveness":
                          d.global_eff_attack += k.roll + "[" + k.name + "]+";
                          break;
                        case "Both":
                          d.global_attack_mod += k.roll + "[" + k.name + "]+";
                      }
                    }
                  });
                  "" !== d.global_attack_mod && (d.global_attack_mod = "[[" + d.global_attack_mod.replace(/\+(?=$)/, "") + "]]");
                  "" !== d.global_acc_attack && (d.global_acc_attack = "[[" + d.global_acc_attack.replace(/\+(?=$)/, "") + "]]");
                  "" !== d.global_eff_attack && (d.global_eff_attack = "[[" + d.global_eff_attack.replace(/\+(?=$)/, "") + "]]");
                  setAttrs(d, {silent:!0}, function() {
                    "function" == typeof c && c();
                  });
                });
              }
            });
          }, update_cultivatorattacks = function(c, f) {
            console.log("DOING CULTIVATOR_UPDATE_ATTACKS: " + c);
            "-" === c.substring(0, 1) && 20 === c.length ? do_update_cultivatorattack([c], f) : -1 < "power agility vitality cultivation qicontrol mental all".split(" ").indexOf(c) && getSectionIDs("repeating_cultivatorattack", function(a) {
              if ("all" === c) {
                do_update_cultivatorattack(a);
              } else {
                var b = [];
                _.each(a, function(h) {
                  b.push("repeating_attack_" + h + "_atkattr_base");
                  b.push("repeating_attack_" + h + "_dmgattr");
                  b.push("repeating_attack_" + h + "_dmg2attr");
                  b.push("repeating_attack_" + h + "_dmg3attr");
                  b.push("repeating_attack_" + h + "_savedc");
                });
                getAttrs(b, function(h) {
                  var g = [];
                  _.each(a, function(d) {
                    (h["repeating_attack_" + d + "_atkattr_base"] && -1 < h["repeating_attack_" + d + "_atkattr_base"].indexOf(c) || h["repeating_attack_" + d + "_dmgattr"] && -1 < h["repeating_attack_" + d + "_dmgattr"].indexOf(c) || h["repeating_attack_" + d + "_dmg2attr"] && -1 < h["repeating_attack_" + d + "_dmg2attr"].indexOf(c) || h["repeating_attack_" + d + "_dmg3attr"] && -1 < h["repeating_attack_" + d + "_dmg3attr"].indexOf(c) || h["repeating_attack_" + d + "_savedc"] && -1 < h["repeating_attack_" + 
                    d + "_savedc"].indexOf(c)) && g.push(d);
                  });
                  0 < g.length && do_update_cultivatorattack(g);
                });
              }
            });
          }, do_update_cultivatorattack = function(c) {
            var f = "level dtype power agility vitality cultivation qicontrol mental cultivator_global_damage_damage cultivator_global_damage_mod_type cultivator_global_damage_percent".split(" ");
            _.each(c, function(a) {
              f.push("repeating_cultivatorattack_" + a + "_atkflag");
              f.push("repeating_cultivatorattack_" + a + "_atkname");
              f.push("repeating_cultivatorattack_" + a + "_atkattr_base");
              f.push("repeating_cultivatorattack_" + a + "_atkmod");
              f.push("repeating_cultivatorattack_" + a + "_dmgflag");
              f.push("repeating_cultivatorattack_" + a + "_dmgbase");
              f.push("repeating_cultivatorattack_" + a + "_dmgattr");
              f.push("repeating_cultivatorattack_" + a + "_dmgmod");
              f.push("repeating_cultivatorattack_" + a + "_dmgtype");
              f.push("repeating_cultivatorattack_" + a + "_dmg2flag");
              f.push("repeating_cultivatorattack_" + a + "_dmg2base");
              f.push("repeating_cultivatorattack_" + a + "_dmg2attr");
              f.push("repeating_cultivatorattack_" + a + "_dmg2mod");
              f.push("repeating_cultivatorattack_" + a + "_dmg2type");
              f.push("repeating_cultivatorattack_" + a + "_dmg3flag");
              f.push("repeating_cultivatorattack_" + a + "_dmg3base");
              f.push("repeating_cultivatorattack_" + a + "_dmg3attr");
              f.push("repeating_cultivatorattack_" + a + "_dmg3mod");
              f.push("repeating_cultivatorattack_" + a + "_dmg3type");
              f.push("repeating_cultivatorattack_" + a + "_saveflag");
              f.push("repeating_cultivatorattack_" + a + "_savedc");
              f.push("repeating_cultivatorattack_" + a + "_saveeffect");
              f.push("repeating_cultivatorattack_" + a + "_saveflat");
              f.push("repeating_cultivatorattack_" + a + "_atkrange");
              f.push("repeating_cultivatorattack_" + a + "_cultivator_global_damage_mod_field");
            });
            getAttrs(f, function(a) {
              _.each(c, function(b) {
                var h = [], g = {}, d = "", k = "", l = "", m = "", n = "", p = "", v = p = "", q = "", r = "", t = "", u = "";
                a["repeating_cultivatorattack_" + b + "_atkattr_base"] && "0" !== a["repeating_cultivatorattack_" + b + "_atkattr_base"] ? (atkattr_base = parseInt(a[a["repeating_cultivatorattack_" + b + "_atkattr_base"].substring(2, a["repeating_cultivatorattack_" + b + "_atkattr_base"].length - 1)], 0), p = a["repeating_cultivatorattack_" + b + "_atkattr_base"].substring(2, a["repeating_cultivatorattack_" + b + "_atkattr_base"].length - 1).toUpperCase()) : atkattr_base = 0;
                a["repeating_cultivatorattack_" + b + "_dmgattr"] && "0" !== a["repeating_cultivatorattack_" + b + "_dmgattr"] ? (dmgattr = parseInt(a[a["repeating_cultivatorattack_" + b + "_dmgattr"].substring(2, a["repeating_cultivatorattack_" + b + "_dmgattr"].length - 1)], 0), v = a["repeating_cultivatorattack_" + b + "_dmgattr"].substring(2, a["repeating_cultivatorattack_" + b + "_dmgattr"].length - 1).toUpperCase()) : dmgattr = 0;
                dmgattr = Math.floor(dmgattr * a.cultivator_global_damage_percent);
                a["repeating_cultivatorattack_" + b + "_dmg2attr"] && "0" !== a["repeating_cultivatorattack_" + b + "_dmg2attr"] ? (dmg2attr = parseInt(a[a["repeating_cultivatorattack_" + b + "_dmg2attr"].substring(2, a["repeating_cultivatorattack_" + b + "_dmg2attr"].length - 1)], 0), q = a["repeating_cultivatorattack_" + b + "_dmg2attr"].substring(2, a["repeating_cultivatorattack_" + b + "_dmg2attr"].length - 1).toUpperCase()) : dmg2attr = 0;
                dmg2attr = Math.floor(dmg2attr * a.cultivator_global_damage_percent);
                a["repeating_cultivatorattack_" + b + "_dmg3attr"] && "0" !== a["repeating_cultivatorattack_" + b + "_dmg3attr"] ? (dmg3attr = parseInt(a[a["repeating_cultivatorattack_" + b + "_dmg3attr"].substring(2, a["repeating_cultivatorattack_" + b + "_dmg3attr"].length - 1)], 0), r = a["repeating_cultivatorattack_" + b + "_dmg3attr"].substring(2, a["repeating_cultivatorattack_" + b + "_dmg3attr"].length - 1).toUpperCase()) : dmg3attr = 0;
                dmg3attr = Math.floor(dmg3attr * a.cultivator_global_damage_percent);
                var C = a["repeating_cultivatorattack_" + b + "_dmgbase"] && "" != a["repeating_cultivatorattack_" + b + "_dmgbase"] ? a["repeating_cultivatorattack_" + b + "_dmgbase"] : 0, D = a["repeating_cultivatorattack_" + b + "_dmg2base"] && "" != a["repeating_cultivatorattack_" + b + "_dmg2base"] ? a["repeating_cultivatorattack_" + b + "_dmg2base"] : 0, E = a["repeating_cultivatorattack_" + b + "_dmg3base"] && "" != a["repeating_cultivatorattack_" + b + "_dmg3base"] ? a["repeating_cultivatorattack_" + 
                b + "_dmg3base"] : 0, y = a["repeating_cultivatorattack_" + b + "_dmgmod"] && !1 === isNaN(parseInt(a["repeating_cultivatorattack_" + b + "_dmgmod"], 0)) ? parseInt(a["repeating_cultivatorattack_" + b + "_dmgmod"], 0) : 0, z = a["repeating_cultivatorattack_" + b + "_dmg2mod"] && !1 === isNaN(parseInt(a["repeating_cultivatorattack_" + b + "_dmg2mod"], 0)) ? parseInt(a["repeating_cultivatorattack_" + b + "_dmg2mod"], 0) : 0, A = a["repeating_cultivatorattack_" + b + "_dmg3mod"] && !1 === 
                isNaN(parseInt(a["repeating_cultivatorattack_" + b + "_dmg3mod"], 0)) ? parseInt(a["repeating_cultivatorattack_" + b + "_dmg3mod"], 0) : 0, F = a["repeating_cultivatorattack_" + b + "_dmgtype"] ? a["repeating_cultivatorattack_" + b + "_dmgtype"] + " " : "", G = a["repeating_cultivatorattack_" + b + "_dmg2type"] ? a["repeating_cultivatorattack_" + b + "_dmg2type"] + " " : "", H = a["repeating_cultivatorattack_" + b + "_dmg3type"] ? a["repeating_cultivatorattack_" + b + "_dmg3type"] + " " : 
                "", I = a["repeating_cultivatorattack_" + b + "_atkmod"] && "" != a["repeating_cultivatorattack_" + b + "_atkmod"] ? parseInt(a["repeating_cultivatorattack_" + b + "_atkmod"], 0) : 0, w = "+" + `[[ceil([[${a.cultivator_global_damage_damage && "" !== a.cultivator_global_damage_damage ? a.cultivator_global_damage_damage : "0"}]] * ${parseFloat(a.cultivator_global_damage_percent || 0)})]]` + "[" + (a.cultivator_global_damage_mod_type || "") + "]", x = B => B && "0" !== B ? `[[ceil([[${B}]] * ${parseFloat(a.cultivator_global_damage_percent || 
                0)})]]` : B;
                BB = C;
                CC = D;
                DD = E;
                C = x(C);
                D = x(D);
                E = x(E);
                a["repeating_cultivatorattack_" + b + "_atkflag"] && 0 != a["repeating_cultivatorattack_" + b + "_atkflag"] ? (bonus_mod = atkattr_base + I, plus_minus = -1 < bonus_mod ? "+" : "", bonus = plus_minus + bonus_mod) : a["repeating_cultivatorattack_" + b + "_saveflag"] && 0 != a["repeating_cultivatorattack_" + b + "_saveflag"] ? (a["repeating_cultivatorattack_" + b + "_savedc"] && "(@{saveflat})" === a["repeating_cultivatorattack_" + b + "_savedc"] ? x = !1 === isNaN(parseInt(a["repeating_cultivatorattack_" + 
                b + "_saveflat"])) ? parseInt(a["repeating_cultivatorattack_" + b + "_saveflat"]) : "0" : (x = a["repeating_cultivatorattack_" + b + "_savedc"].replace(/^[^{]*{/, "").replace(/_.*$/, ""), x = a[x] ? parseInt(a[x], 0) : 0), bonus = "DC" + x) : bonus = "-";
                a["repeating_cultivatorattack_" + b + "_dmgflag"] && 0 != a["repeating_cultivatorattack_" + b + "_dmgflag"] ? (0 === BB && 0 === dmgattr + y && (m = 0), 0 != BB && (m = BB), 0 != BB && 0 != dmgattr + y && (m = 0 < dmgattr + y ? m + "+" : m), 0 != dmgattr + y && (m += dmgattr + y), m = m + " " + F) : m = "";
                a["repeating_cultivatorattack_" + b + "_dmg2flag"] && 0 != a["repeating_cultivatorattack_" + b + "_dmg2flag"] ? (0 === CC && 0 === dmg2attr + z && (n = 0), 0 != CC && (n = CC), 0 != CC && 0 != dmg2attr + z && (n = 0 < dmg2attr + z ? n + "+" : n), 0 != dmg2attr + z && (n += dmg2attr + z), n = n + " " + G) : n = "";
                a["repeating_cultivatorattack_" + b + "_dmg3flag"] && 0 != a["repeating_cultivatorattack_" + b + "_dmg3flag"] ? (0 === DD && 0 === dmg3attr + A && (t = 0), 0 != DD && (t = DD), 0 != DD && 0 != dmg3attr + A && (t = 0 < dmg3attr + A ? t + "+" : t), 0 != dmg3attr + A && (t += dmg3attr + A), t = t + " " + H) : t = "";
                dmgspacer1 = a["repeating_cultivatorattack_" + b + "_dmgflag"] && 0 != a["repeating_cultivatorattack_" + b + "_dmgflag"] && a["repeating_cultivatorattack_" + b + "_dmg2flag"] && 0 != a["repeating_cultivatorattack_" + b + "_dmg2flag"] ? "+ " : "";
                dmgspacer2 = a["repeating_cultivatorattack_" + b + "_dmgflag"] && 0 != a["repeating_cultivatorattack_" + b + "_dmgflag"] && a["repeating_cultivatorattack_" + b + "_dmg3flag"] && 0 != a["repeating_cultivatorattack_" + b + "_dmg3flag"] ? "+ " : "";
                r2 = "{{r2=[[";
                a["repeating_cultivatorattack_" + b + "_atkflag"] && 0 != a["repeating_cultivatorattack_" + b + "_atkflag"] ? (0 != I && (d = I + "[MOD]" + d), 0 != atkattr_base && (d = atkattr_base + "[" + p + "]" + d)) : d = "";
                a["repeating_cultivatorattack_" + b + "_dmgflag"] && 0 != a["repeating_cultivatorattack_" + b + "_dmgflag"] ? (0 != y && (k = "+" + Math.floor(y * a.cultivator_global_damage_percent) + "[MOD]" + k), 0 != dmgattr && (k = "+" + dmgattr + "[" + v + "]" + k), k = C + k) : k = "0";
                a["repeating_cultivatorattack_" + b + "_dmg2flag"] && 0 != a["repeating_cultivatorattack_" + b + "_dmg2flag"] ? (0 != z && (l = "+" + Math.floor(z * a.cultivator_global_damage_percent) + "[MOD]" + l), 0 != dmg2attr && (l = "+" + dmg2attr + "[" + q + "]" + l), l = D + l) : l = "0";
                a["repeating_cultivatorattack_" + b + "_dmg3flag"] && 0 != a["repeating_cultivatorattack_" + b + "_dmg3flag"] ? (0 != A && (u = "+" + Math.floor(A * a.cultivator_global_damage_percent) + "[MOD]" + u), 0 != dmg3attr && (u = "+" + dmg3attr + "[" + r + "]" + u), u = E + u) : u = "0";
                "full" === a.dtype ? (pickbase = "full", p = "@{whispertoggle}&{template:atkdmg} {{mod=@{atkbonus}}} {{rname=@{atkname}}} {{r1=[[" + d + "]]}} " + r2 + d + "]]}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[" + k + w + "]]}} {{dmg1type=" + F + "}} @{dmg2flag} {{dmg2=[[" + l + w + "]]}} {{dmg2type=" + G + "}} @{dmg3flag} {{dmg3=[[" + u + w + "]]}} {{dmg3type=" + H + "}} @{saveflag} {{desc=@{atk_desc}}} {{globalattack=@{cultivator_global_attack_mod}}} {{globalaccattack=@{global_acc_attack}}} {{globaleffattack=@{cultivator_global_eff_attack}}} {{globaldamagetype=@{cultivator_global_damage_mod_type}}} @{charname_output}") : 
                a["repeating_cultivatorattack_" + b + "_atkflag"] && 0 != a["repeating_cultivatorattack_" + b + "_atkflag"] ? (pickbase = "pick", p = "@{whispertoggle}&{template:atk} {{mod=@{atkbonus}}} {{rname=[@{atkname}](~repeating_cultivatorattack_attack_dmg)}} {{r1=[[" + d + "]]}} " + r2 + d + "]]}} {{range=@{atkrange}}} {{desc=@{atk_desc}}} {{globalattack=@{cultivator_global_attack_mod}}} {{globalaccattack=@{cultivator_global_acc_attack}}} {{globaleffattack=@{cultivator_global_eff_attack}}} @{charname_output}") : 
                a["repeating_cultivatorattack_" + b + "_dmgflag"] && 0 != a["repeating_cultivatorattack_" + b + "_dmgflag"] ? (pickbase = "dmg", p = "@{whispertoggle}&{template:dmg} {{rname=@{atkname}}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[" + k + w + "]]}} {{dmg1type=" + F + "}} @{dmg2flag} {{dmg2=[[" + l + w + "]]}} {{dmg2type=" + G + "}} @{dmg3flag} {{dmg3=[[" + u + w + "]]}} {{dmg3type=" + H + "}} @{saveflag} {{desc=@{atk_desc}}} {{globaldamagetype=@{cultivator_global_damage_mod_type}}} @{charname_output}") : 
                (pickbase = "empty", p = "@{whispertoggle}&{template:dmg} {{rname=@{atkname}}} @{atkflag} {{range=@{atkrange}}} @{saveflag} {{desc=@{atk_desc}}} @{charname_output}");
                g["repeating_cultivatorattack_" + b + "_rollbase_dmg"] = "@{whispertoggle}&{template:dmg} {{rname=@{atkname}}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[" + k + w + "]]}} {{dmg1type=" + F + "}} @{dmg2flag} {{dmg2=[[" + l + w + "]]}} {{dmg2type=" + G + "}} @{dmg3flag} {{dmg3=[[" + u + w + "]]}} {{dmg3type=" + H + "}} @{saveflag} {{desc=@{atk_desc}}} {{globaldamagetype=@{cultivator_global_damage_mod_type}}} @{charname_output}";
                g["repeating_cultivatorattack_" + b + "_atkbonus"] = bonus;
                g["repeating_cultivatorattack_" + b + "_atkdmgtype"] = m + dmgspacer1 + n + dmgspacer2 + t + " ";
                g["repeating_cultivatorattack_" + b + "_rollbase"] = p;
                setAttrs(g, {silent:!0}, function() {
                  h.forEach(function(B) {
                    B();
                  });
                });
              });
            });
          }, update_cultivatorglobaldamage = function(c) {
            getSectionIDs("cultivatordamagemod", function(f) {
              if (f) {
                var a = {}, b = [];
                f.forEach(function(h) {
                  a[h] = {};
                  b.push(`repeating_cultivatordamagemod_${h}_cultivator_global_damage_active_flag`, `repeating_cultivatordamagemod_${h}_cultivator_global_damage_name`, `repeating_cultivatordamagemod_${h}_cultivator_global_damage_damage`, `repeating_cultivatordamagemod_${h}_cultivator_global_damage_type`);
                });
                getAttrs(b, function(h) {
                  var g = /^repeating_cultivatordamagemod_(.+)_cultivator_global_damage_(active_flag|name|damage|type)$/;
                  _.each(h, function(k, l) {
                    (l = g.exec(l)) && (a[l[1]][l[2]] = k);
                  });
                  var d = {cultivator_global_damage_damage:"", cultivator_global_damage_percent:0, cultivator_global_damage_mod_type:""};
                  console.log("CULTIVATOR GLOBALDAMAGE");
                  _.each(a, function(k) {
                    if ("0" != k.active_flag && k.name && "" !== k.name) {
                      if (k.damage.includes("%")) {
                        var l = parseFloat(k.damage);
                        isNaN(l) || (d.cultivator_global_damage_percent += l);
                      } else {
                        d.cultivator_global_damage_damage += k.damage + "[" + k.name + "]+";
                      }
                      k.type && "" !== k.type && (d.cultivator_global_damage_mod_type += k.type + "/");
                    }
                  });
                  d.cultivator_global_damage_damage = d.cultivator_global_damage_damage.replace(/\+(?=$)/, "");
                  d.cultivator_global_damage_percent = parseFloat(d.cultivator_global_damage_percent) / 100 + 1 || 1;
                  d.cultivator_global_damage_mod_type = d.cultivator_global_damage_mod_type.replace(/\/(?=$)/, "");
                  setAttrs(d, {silent:!0}, function() {
                    update_cultivatorattacks("all");
                    "function" == typeof c && c();
                  });
                });
              }
            });
          }, update_cultivatorglobalattack = function(c) {
            getSectionIDs("cultivatortohitmod", function(f) {
              if (f) {
                var a = {}, b = [];
                f.forEach(function(h) {
                  a[h] = {};
                  b.push(`repeating_cultivatortohitmod_${h}_cultivator_global_attack_active_flag`, `repeating_cultivatortohitmod_${h}_cultivator_global_attack_roll`, `repeating_cultivatortohitmod_${h}_cultivator_global_attack_name`, `repeating_cultivatortohitmod_${h}_cultivator_global_attack_appliesto`);
                });
                getAttrs(b, function(h) {
                  var g = /^repeating_cultivatortohitmod_(.+)_cultivator_global_attack_(active_flag|roll|name|appliesto)$/;
                  _.each(h, function(k, l) {
                    (l = g.exec(l)) && (a[l[1]][l[2]] = k);
                  });
                  var d = {cultivator_global_attack_mod:"", cultivator_global_acc_attack:"", cultivator_global_eff_attack:""};
                  console.log("CULTIVATOR GLOBALATTACK");
                  _.each(a, function(k) {
                    if ("0" != k.active_flag && k.roll && "" !== k.roll) {
                      switch(k.appliesto) {
                        case "Accuracy":
                          d.cultivator_global_acc_attack += k.roll + "[" + k.name + "]+";
                          break;
                        case "Effectiveness":
                          d.cultivator_global_eff_attack += k.roll + "[" + k.name + "]+";
                          break;
                        case "Both":
                          d.cultivator_global_attack_mod += k.roll + "[" + k.name + "]+";
                      }
                    }
                  });
                  "" !== d.cultivator_global_attack_mod && (d.cultivator_global_attack_mod = "[[" + d.cultivator_global_attack_mod.replace(/\+(?=$)/, "") + "]]");
                  "" !== d.cultivator_global_acc_attack && (d.cultivator_global_acc_attack = "[[" + d.cultivator_global_acc_attack.replace(/\+(?=$)/, "") + "]]");
                  "" !== d.cultivator_global_eff_attack && (d.cultivator_global_eff_attack = "[[" + d.cultivator_global_eff_attack.replace(/\+(?=$)/, "") + "]]");
                  setAttrs(d, {silent:!0}, function() {
                    "function" == typeof c && c();
                  });
                });
              }
            });
          }, update_weight = function() {
            console.log("UPDATING WEIGHT");
            var c = {}, f = 0, a = 0, b = ["power", "carrying_capacity_mod", "inventory_slots_mod", "itemweightfixed", "itemslotsfixed"];
            getSectionIDs("repeating_inventory", function(h) {
              _.each(h, function(g) {
                b.push("repeating_inventory_" + g + "_itemweight");
                b.push("repeating_inventory_" + g + "_itemcount");
                b.push("repeating_inventory_" + g + "_itemsize");
                b.push("repeating_inventory_" + g + "_equipped");
                b.push("repeating_inventory_" + g + "_carried");
                b.push("repeating_inventory_" + g + "_itemcontainer");
                b.push("repeating_inventory_" + g + "_itemweightfixed");
                b.push("repeating_inventory_" + g + "_itemslotsfixed");
                b.push("repeating_inventory_" + g + "_itemcontainer_slots");
                b.push("repeating_inventory_" + g + "_itemcontainer_slots_modifier");
              });
              getAttrs(b, function(g) {
                var d = 0, k = 0;
                _.each(h, function(q) {
                  if (1 == g["repeating_inventory_" + q + "_equipped"] || 1 == g["repeating_inventory_" + q + "_carried"]) {
                    if (1 == g["repeating_inventory_" + q + "_itemcontainer"]) {
                      if (1 == g["repeating_inventory_" + q + "_equipped"]) {
                        k += parseInt(g["repeating_inventory_" + q + "_itemcontainer_slots"], 0);
                        var r = "repeating_inventory_" + q + "_itemcontainer_slots_modifier";
                        g[r] && (-1 < ["+", "-"].indexOf(g[r]) ? (q = g[r].substring(0, 1), r = g[r].substring(1), !1 === isNaN(parseInt(r, 0)) && ("+" == q ? d += parseInt(r, 0) : "-" == q && (d -= parseInt(r, 0)))) : !1 === isNaN(parseInt(g[r], 0)) && (d += parseInt(g[r], 0)));
                      }
                    } else {
                      g["repeating_inventory_" + q + "_itemweight"] && !1 === isNaN(parseInt(g["repeating_inventory_" + q + "_itemweight"], 0)) && (1 == g["repeating_inventory_" + q + "_itemweightfixed"] ? f += parseFloat(g["repeating_inventory_" + q + "_itemweight"]) : (count = g["repeating_inventory_" + q + "_itemcount"] && !1 === isNaN(parseFloat(g["repeating_inventory_" + q + "_itemcount"])) ? parseFloat(g["repeating_inventory_" + q + "_itemcount"]) : 1, f += parseFloat(g["repeating_inventory_" + q + "_itemweight"]) * 
                      count)), g["repeating_inventory_" + q + "_itemsize"] && !1 === isNaN(parseInt(g["repeating_inventory_" + q + "_itemsize"], 0)) && (1 == g["repeating_inventory_" + q + "_itemslotsfixed"] ? a += parseFloat(g["repeating_inventory_" + q + "_itemsize"]) : (count = g["repeating_inventory_" + q + "_itemcount"] && !1 === isNaN(parseFloat(g["repeating_inventory_" + q + "_itemcount"])) ? parseFloat(g["repeating_inventory_" + q + "_itemcount"]) : 1, a += parseFloat(g["repeating_inventory_" + q + 
                      "_itemsize"]) * count));
                    }
                  }
                });
                f = Math.round(100 * f) / 100;
                a = Math.round(100 * a) / 100;
                c.weighttotal = f;
                c.slotstotal = a;
                var l = 18 + parseInt(k);
                if (g.inventory_slots_mod) {
                  var m = g.inventory_slots_mod.substring(0, 1), n = g.inventory_slots_mod.substring(1);
                  -1 < ["*", "x", "+", "-"].indexOf(m) && !1 === isNaN(parseInt(n, 0)) && ("*" == m || "x" == m ? l *= parseInt(n, 0) : "+" == m ? l += parseInt(n, 0) : "-" == m && (l -= parseInt(n, 0)));
                }
                l += d;
                var p = parseInt(g.power), v = 30 * p;
                g.carrying_capacity_mod && (m = g.carrying_capacity_mod.substring(0, 1), n = parseInt(g.carrying_capacity_mod.substring(1), 0), -1 < ["*", "x", "+", "-", "/"].indexOf(m) && !isNaN(n) && ("*" == m || "x" == m ? v *= n : "+" == m ? v += n : "-" == m ? v -= n : "/" == m && (v /= n)));
                c.weightmaximum = v;
                c.slotsmaximum = l;
                c.encumberance = a > l ? "OVER CARRYING CAPACITY" : f > 30 * p ? "IMMOBILE" : f > 22 * p ? "HEAVILY ENCUMBERED" : f > 15 * p ? "ENCUMBERED" : " ";
                setAttrs(c, {silent:!0});
              });
            });
          }, update_skills = function(c) {
            var f = "power agility vitality cultivation qicontrol mental appearance".split(" "), a = {}, b = [];
            _.each(c, function(h) {
              f.push(h + "_bonus");
              f.push(h + "_flat");
            });
            getSectionIDs("repeating_inventory", function(h) {
              _.each(h, function(g) {
                f.push("repeating_inventory_" + g + "_equipped");
                f.push("repeating_inventory_" + g + "_itemmodifiers");
              });
              getAttrs(f, function(g) {
                _.each(c, function(d) {
                  console.log("UPDATING SKILL: " + d);
                  var k = g[d + "_flat"] && !isNaN(parseInt(g[d + "_flat"], 0)) ? parseInt(g[d + "_flat"], 0) : 0, l = 0;
                  _.each(h, function(n) {
                    g["repeating_inventory_" + n + "_equipped"] && "1" === g["repeating_inventory_" + n + "_equipped"] && g["repeating_inventory_" + n + "_itemmodifiers"] && (-1 < g["repeating_inventory_" + n + "_itemmodifiers"].toLowerCase().replace(/ /g, "_").indexOf(d) || -1 < g["repeating_inventory_" + n + "_itemmodifiers"].toLowerCase().indexOf("skill checks")) && (n = g["repeating_inventory_" + n + "_itemmodifiers"].toLowerCase().split(","), _.each(n, function(p) {
                      if (-1 < p.replace(/ /g, "_").indexOf(d) || -1 < p.indexOf("skill checks")) {
                        -1 < p.indexOf("-") ? (p = isNaN(parseInt(p.replace(/[^0-9]/g, ""), 0)) ? !1 : parseInt(p.replace(/[^0-9]/g, ""), 0), l -= p ? l + p : l) : (p = isNaN(parseInt(p.replace(/[^0-9]/g, ""), 0)) ? !1 : parseInt(p.replace(/[^0-9]/g, ""), 0), l += p ? l + p : l);
                      }
                    }));
                  });
                  var m = 0;
                  switch(d) {
                    case "acrobatics":
                    case "discretion":
                    case "stealth":
                      m = parseInt(g.agility, 0);
                      break;
                    case "athletics":
                    case "grapple":
                      m = parseInt(g.power, 0);
                      break;
                    case "seduce":
                    case "deceit":
                    case "disguise":
                    case "persuade":
                      m = parseInt(g.mental, 0) + parseInt(g.appearance, 0);
                      break;
                    case "fine_arts":
                    case "forgery":
                    case "navigation":
                      m = Math.floor(parseInt(g.agility, 0) / 2) + Math.floor(parseInt(g.mental, 0) / 2);
                      break;
                    case "history":
                    case "medicine":
                      m = Math.floor(parseInt(g.qicontrol, 0) / 2) + Math.floor(parseInt(g.mental, 0) / 2);
                      break;
                    case "intuition":
                    case "investigation":
                    case "perception":
                      m = parseInt(g.mental, 0);
                      break;
                    case "intimidation":
                      m = parseInt(g.power, 0) + parseInt(g.appearance, 0);
                      break;
                    case "performance":
                      m = parseInt(g.agility, 0) + parseInt(g.appearance, 0);
                      break;
                    case "survival":
                      m = Math.floor(parseInt(g.power, 0) / 2) + Math.floor(parseInt(g.mental, 0) / 2);
                  }
                  k += l;
                  a[d] = 0 < k ? m + "d6+" + k : m + "d6";
                  a[d + "_bonus"] = k;
                  a[d + "_roll"] = m;
                });
                setAttrs(a, {silent:!0}, function() {
                  b.forEach(function(d) {
                    d();
                  });
                });
              });
            });
          }, update_all_ability_checks = function() {
            update_initiative();
            update_skills("acrobatics athletics seduce deceit discretion disguise fine_arts forgery grapple history intuition intimidation investigation medicine navigation perception performance persuade stealth survival".split(" "));
          }, update_durability = function() {
            console.log("UPDATING DURABILITY");
            getAttrs(["durability-base", "durability-limit", "durability-bonus", "vitality"], function(a) {
              var d = {}, e = parseInt(a["durability-base"]) || 0, b = parseInt(a.vitality) || 0, c = parseInt(a["durability-limit"]) || 0;
              a = parseInt(a["durability-bonus"]) || 0;
              b = 10 * Math.floor(b / 50) + a;
              d["durability-full"] = b < c ? e + b : e + c + Math.floor((b - c) / 2);
              setAttrs(d, {silent:!0});
            });
          }, update_evasion = function() {
            console.log("UPDATING EVASION");
            getAttrs(["evasion-base", "evasion-limit", "evasion-bonus", "agility"], function(c) {
              var f = {}, a = parseInt(c.agility) || 0, b = parseInt(c["evasion-base"]) || 0, h = parseInt(c["evasion-limit"]) || 0;
              c = parseInt(c["evasion-bonus"]) || 0;
              f["evasion-full"] = a < h ? b + a + c : b + h + Math.floor((a - h) / 2) + c;
              setAttrs(f, {silent:!0});
            });
          }, update_reduction = function() {
            console.log("UPDATING REDUCTION");
            getAttrs(["reduction-base", "reduction-armour", "reduction-bonus"], function(c) {
              var f = {}, a = parseInt(c["reduction-base"]) || 0, b = parseInt(c["reduction-armour"]) || 0;
              c = parseInt(c["reduction-bonus"]) || 0;
              f["reduction-full"] = a + b + c;
              setAttrs(f, {silent:!0});
            });
          };
          let toInt = function(c) {
            return c && !isNaN(c) ? parseInt(c) : 0;
          }, clamp = function(c, f, a) {
            return Math.min(Math.max(c, f), a);
          }, isDefined = function(c) {
            return null !== c && "undefined" !== typeof c;
          };
    </script>
</div>