<div class="sheet-core">
    <input class="sheet-toggle-npc" name="attr_npc" type="hidden" value="0" hidden>
    <input class="sheet-toggle-npc-edit" name="attr_npc_options-flag" type="checkbox" hidden>

    <div class="sheet-section-roll">
        <input type="hidden" name="attr_wtype" class="sheet-roll-toggle">
        <div class="sheet-section-roll-whisper">
            <label class="sheet-radio">
                <input type="radio" name="attr_whispertoggle" value="" checked="checked">
                <span title="@{whispertoggle}">Public</span>
            </label>
            <label class="sheet-radio">
                <input type="radio" name="attr_whispertoggle" value="/w gm ">
                <span title="@{whispertoggle}">To GM</span>
            </label>
        </div>
    </div>

    <div class="sheet-section-main">
        <div class="sheet-main-header">
            <div class="sheet-header-avatar">
                <img name="attr_character_avatar">
            </div>
            <div class="sheet-header-details">
                <div class="sheet-detail sheet-detail-name">
                    <div class="sheet-detail-label">Name:</div>
                    <div class="sheet-detail-value">
                        <input type="text" name="attr_character_name" title="@{character_name}">
                    </div>
                </div>
                <div class="sheet-detail sheet-detail-ancestry_species">
                    <div class="sheet-detail-label">Ancestry & Species:</div>
                    <div class="sheet-detail-value">
                        <input type="text" name="attr_ancestry_species" title="@{ancestry_species}">
                    </div>
                </div>
                <div class="sheet-detail sheet-detail-mortal-path">
                    <div class="sheet-detail-label">Mortal Path:</div>
                    <div class="sheet-detail-value">
                        <input type="text" name="attr_mortal-path" title="@{mortal-path}">
                    </div>
                </div>
                <div class="sheet-detail sheet-detail-mortal-level">
                    <div class="sheet-detail-label">Level:</div>
                    <div class="sheet-detail-value">
                        <input type="number" name="attr_mortal-level" title="@{mortal-level}">
                    </div>
                </div>
                <div class="sheet-detail sheet-detail-cultivator-path">
                    <div class="sheet-detail-label">Cultivator Path:</div>
                    <div class="sheet-detail-value">
                        <input type="text" name="attr_cultivator-path" title="@{cultivator-path}">
                    </div>
                </div>
                <div class="sheet-detail sheet-detail-cultivator-realm">
                    <div class="sheet-detail-label">Realm:</div>
                    <div class="sheet-detail-value">
                        <input type="text" name="attr_cultivator-realm" title="@{cultivator-realm}">
                    </div>
                </div>
            </div>
        </div>
        <div class="sheet-main-body">
            <div class="sheet-pages">
                <div class="sheet-page sheet-page-mortal">
                    <input type="radio" name="attr_page" value="mortal" checked="checked">
                    <span class="sheet-page-label">MORTAL</span>
                    <div class="sheet-page-content">
                        <div class="sheet-container-well sheet-well-attributes">
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_power" value="@{w_type}&{template:attribute} @{character_name_output} {{rollname=Power}} {{roll1=[[ @{power}d6[power] + @{power_check_bonus}[BONUS] + @{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">POWER</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_power_base" title="@{power_base}" value="0">
                                    <input type="hidden" name="attr_power" value="0">
                                    <input type="hidden" name="attr_power_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_power" title="@{power}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_power_dc" title="@{power_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_agility" value="@{w_type}&{template:attribute} @{character_name_output} {{rollname=Agility}} {{roll1=[[ @{agility}d6[agility] + @{agility_check_bonus}[BONUS] + @{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">AGILITY</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_agility_base" title="@{agility_base}" value="0">
                                    <input type="hidden" name="attr_agility" value="0">
                                    <input type="hidden" name="attr_agility_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_agility" title="@{agility}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_agility_dc" title="@{agility_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_vitality" value="@{w_type}&{template:attribute} @{character_name_output} {{rollname=Vitality}} {{roll1=[[ @{vitality}d6[vitality] + @{vitality_check_bonus}[BONUS] + @{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">VITALITY</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_vitality_base" title="@{vitality_base}" value="0">
                                    <input type="hidden" name="attr_vitality" value="0">
                                    <input type="hidden" name="attr_vitality_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_vitality" title="@{vitality}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_vitality_dc" title="@{vitality_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_cultivation" value="@{w_type}&{template:attribute} @{character_name_output} {{rollname=Cultivation}} {{roll1=[[ @{cultivation}d6[cultivation] + @{cultivation_check_bonus}[BONUS] + @{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">CULTIVATION</span>
                                </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_cultivation_base" title="@{cultivation_base}" value="0">
                                    <input type="hidden" name="attr_cultivation" value="0">
                                    <input type="hidden" name="attr_cultivation_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_cultivation" title="@{cultivation}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_cultivation_dc" title="@{cultivation_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_qicontrol" value="@{w_type}&{template:attribute} @{character_name_output} {{rollname=Qicontrol}} {{roll1=[[ @{qicontrol}d6[qicontrol] + @{qicontrol_check_bonus}[BONUS] + @{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">QI CONTROL</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_qicontrol_base" title="@{qicontrol_base}" value="0">
                                    <input type="hidden" name="attr_qicontrol" value="0">
                                    <input type="hidden" name="attr_qicontrol_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_qicontrol" title="@{qicontrol}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_qicontrol_dc" title="@{qicontrol_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_mental" value="@{w_type}&{template:attribute} @{character_name_output} {{rollname=Mental}} {{roll1=[[ @{mental}d6[mental] + @{mental_check_bonus}[BONUS] + @{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">MENTAL</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_mental_base" title="@{mental_base}" value="0">
                                    <input type="hidden" name="attr_mental" value="0">
                                    <input type="hidden" name="attr_mental_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_mental" title="@{mental}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_mental_dc" title="@{mental_dc}">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-columns">
                            <div class="col col1">
                                <div class="sheet-container-panel sheet-container-skills">
                                    <div class="sheet-container-header">SKILLS</div>
                                    <div class="sheet-container-body">
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_acrobatics" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Acrobatics}} {{roll1=[[@{acrobatics_roll}d6 + @{acrobatics_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Acrobatics</span>
                                                <span name="attr_acrobatics"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_athletics" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Athletics}} {{roll1=[[@{athletics_roll}d6 + @{athletics_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Athletics</span>
                                                <span name="attr_athletics"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_charm" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Charm}} {{roll1=[[@{charm_roll}d6 + @{charm_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Charm</span>
                                                <span name="attr_charm"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_deceit" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Deceit}} {{roll1=[[@{deceit_roll}d6 + @{deceit_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Deceit</span>
                                                <span name="attr_deceit"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_discretion" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Discretion}} {{roll1=[[@{discretion_roll}d6 + @{discretion_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Discretion</span>
                                                <span name="attr_discretion"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_disguise" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Disguise}} {{roll1=[[@{disguise_roll}d6 + @{disguise_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Disguise</span>
                                                <span name="attr_disguise"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_fine_arts" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Fine_arts}} {{roll1=[[@{fine_arts_roll}d6 + @{fine_arts_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Fine Arts</span>
                                                <span name="attr_fine_arts"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_forgery" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Forgery}} {{roll1=[[@{forgery_roll}d6 + @{forgery_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Forgery</span>
                                                <span name="attr_forgery"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_grapple" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Grapple}} {{roll1=[[@{grapple_roll}d6 + @{grapple_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Grapple</span>
                                                <span name="attr_grapple"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_history" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=History}} {{roll1=[[@{history_roll}d6 + @{history_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>History</span>
                                                <span name="attr_history"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_intuition" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Intuition}} {{roll1=[[@{intuition_roll}d6 + @{intuition_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Intuition</span>
                                                <span name="attr_intuition"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_intimidation" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Intimidation}} {{roll1=[[@{intimidation_roll}d6 + @{intimidation_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Intimidation</span>
                                                <span name="attr_intimidation"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_investigation" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Investigation}} {{roll1=[[@{investigation_roll}d6 + @{investigation_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Investigation</span>
                                                <span name="attr_investigation"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_medicine" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Medicine}} {{roll1=[[@{medicine_roll}d6 + @{medicine_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Medicine</span>
                                                <span name="attr_medicine"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_navigation" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Navigation}} {{roll1=[[@{navigation_roll}d6 + @{navigation_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Navigation</span>
                                                <span name="attr_navigation"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_perception" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Perception}} {{roll1=[[@{perception_roll}d6 + @{perception_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Perception</span>
                                                <span name="attr_perception"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_performance" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Performance}} {{roll1=[[@{performance_roll}d6 + @{performance_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Performance</span>
                                                <span name="attr_performance"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_persuade" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Persuade}} {{roll1=[[@{persuade_roll}d6 + @{persuade_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Persuade</span>
                                                <span name="attr_persuade"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_stealth" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Stealth}} {{roll1=[[@{stealth_roll}d6 + @{stealth_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Stealth</span>
                                                <span name="attr_stealth"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_survival" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Survival}} {{roll1=[[@{survival_roll}d6 + @{survival_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Survival</span>
                                                <span name="attr_survival"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-container-tools">
                                    <div class="sheet-container-header">TOOLS</div>
									<div class="sheet-container-body">
                                        <fieldset class="repeating_mortaltool">
                                            <div class="sheet-fieldset-item sheet-fieldset-item-tool">
                                                <div class="sheet-checkbox-cog">
                                                    <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                    <span class="sheet-toggle-icon"></span>
                                                </div>
                                                <input type="checkbox" name="attr_options-flag" checked="checked" hidden class="sheet-toggle">
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-form">
                                                        <div class="sheet-form-header">Edit Tool</div>
                                                        <div class="sheet-form-body">
                                                            <div class="sheet-form-group">
                                                                <label>Name:</label>
                                                                <input type="text" name="attr_toolname">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Roll:</label>
                                                                <input type="text" name="attr_tool_roll" title="@{tool_roll}" value="0">
                                                                <label>Mods:</label>
                                                                <input type="text" name="attr_tool_mod" title="@{tool_mod}" value="0">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-toggle-unchecked">
                                                    <div class="sheet-pc-tool">
                                                        <button type="roll" name="roll_roll" value="@{wtype}&{template:simple} @{charname_output} {{rname=@{toolname}}} {{mod=@{tool_mod}}} {{r1=[[@{tool_roll} + @{tool_mod}[BONUS]]]}} {{type=Custom}}">
                                                            <span name="attr_toolname"></span>
                                                            <span name="attr_tool_roll"></span>
                                                            <span>+</span>
                                                            <span name="attr_tool_mod"></span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </div>
                            <div class="col col2">
                                <div class="sheet-container-panel sheet-panel-hp">
                                    <div class="sheet-container-header">HEALTH</div>
                                    <div class="sheet-container-body">
                                        <div class="sheet-container-box sheet-pc-health">
                                            <div class="sheet-box-body sheet-health">
                                                <input type="number" name="attr_hp_max" title="@{hp_max}" placeholder="MAXIMUM">
                                                <input type="number" name="attr_hp" title="@{hp}" placeholder="CURRENT">
                                            </div>
                                        </div>
                                        <div class="sheet-container-box sheet-pc-health">
                                            <div class="sheet-box-body sheet-health-extra">
                                                <div class="sheet-box">
                                                    <span>Temp</span>
                                                    <input type="number" name="attr_hp_temp" title="@{hp_temp}" placeholder="0">
                                                </div>
                                                <div class="sheet-box">
                                                    <span>Dice</span>
                                                <input type="text" name="attr_hp_die" title="@{hp_die}" placeholder="1d8">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-container-combat">
                                    <div class="sheet-container-header">COMBAT</div>
                                    <div class="sheet-container-body">
                                        <div class="sheet-container-box sheet-pc-initiative">
                                            <div class="sheet-container-bar">
                                                <button type="roll" name="roll_init" value="@{wtype}&{template:simple} @{charname_output} {{rname=Initiative}} {{r1=[[@{agility}d6[AGI]+@{initiative_bonus} &{tracker}]]}} {{type=Initiative}}">INITIATIVE<span name="attr_initiative" title="@{initiative}"></span></button>
                                            </div>
                                        </div>
                                        <div class="sheet-container-box sheet-pc-defences">
                                            <div class="sheet-defence-label">HYPER RESISTANCE</div>
                                            <input class="sheet-defence" type="text" name="attr_hyper_resistances" title="@{hyper_resistances}">
                                            <div class="sheet-defence-label">RESISTANCE</div>
                                            <input class="sheet-defence" type="text" name="attr_resistances" title="@{resistances}">
                                            <div class="sheet-defence-label">WEAKNESS</div>
                                            <input class="sheet-defence" type="text" name="attr_weakness" title="@{weakness}">
                                            <div class="sheet-defence-label">HYPER WEAKNESS</div>
                                            <input class="sheet-defence" type="text" name="attr_hyper_weakness" title="@{hyper_weakness}">
                                        </div>
                                        <div class="sheet-container-box sheet-pc-evasion-durability">
                                            <div class="sheet-pc-evasion-group">
                                                <div class="sheet-pc-evasion-full">
                                                    <span class="sheet-evasion-full" name="attr_evasion-full" title="@{evasion-full}">0</span>
                                                    <div class="sheet-pc-defence-label">EVA</div>
                                                </div>
                                                <div class="sheet-pc-evasion-base">
                                                    <input class="sheet-evasion-base" type="number" name="attr_evasion-base" title="@{evasion-base}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BASE</div>
                                                </div>
                                                <div class="sheet-pc-evasion-bonus">
                                                    <input class="sheet-evasion-bonus" type="number" name="attr_evasion-bonus" title="@{evasion-bonus}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BONUS</div>
                                                </div>
                                            </div>
                                            <div class="sheet-pc-durability-group">
                                                <div class="sheet-pc-durability-full">
                                                    <span class="sheet-durability-full" name="attr_durability-full" title="@{durability-full}">0</span>
                                                    <div class="sheet-pc-defence-label">DUR</div>
                                                </div>
                                                <div class="sheet-pc-durability-base">
                                                    <input class="sheet-durability-base" type="number" name="attr_durability-base" title="@{durability-base}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BASE</div>
                                                </div>
                                                <div class="sheet-pc-durability-bonus">
                                                    <input class="sheet-durability-bonus" type="number" name="attr_durability-bonus" title="@{durability-bonus}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BONUS</div>
                                                </div>
                                            </div>
                                            <div class="sheet-pc-reduction-group">
                                                <div class="sheet-pc-reduction-full">
                                                    <span class="sheet-reduction-full" name="attr_reduction-full" title="@{reduction-full}">0</span>
                                                    <div class="sheet-pc-defence-label">DR</div>
                                                </div>
                                                <div class="sheet-pc-reduction-base">
                                                    <input class="sheet-reduction-base" type="number" name="attr_reduction-base" title="@{reduction-base}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BASE</div>
                                                </div>
                                                <div class="sheet-pc-reduction-armour">
                                                    <input class="sheet-reduction-armour" type="number" name="attr_reduction-armour" title="@{reduction-armour}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">ARMOUR</div>
                                                </div>
                                                <div class="sheet-pc-reduction-bonus">
                                                    <input class="sheet-reduction-bonus" type="number" name="attr_reduction-bonus" title="@{reduction-bonus}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BONUS</div>
                                                </div>
                                            </div>
                                            <div class="sheet-pc-speed-group">
                                                <div class="sheet-pc-speed-movement">
                                                    <input class="sheet-movement-movement" type="number" name="attr_movement" title="@{movement}"placeholder="0">
                                                    <div class="sheet-pc-defence-label">SPEED</div>
                                                </div>
                                                <div class="sheet-pc-speed-swim">
                                                    <input class="sheet-movement-swim" type="number" name="attr_swim" title="@{swim}"placeholder="0">
                                                    <div class="sheet-pc-defence-label">SWIM</div>
                                                </div>
                                                <div class="sheet-pc-speed-climb">
                                                    <input class="sheet-movement-climb" type="number" name="attr_climb" title="@{climb}"placeholder="0">
                                                    <div class="sheet-pc-defence-label">CLIMB</div>
                                                </div>
                                                <div class="sheet-pc-speed-fly">
                                                    <input class="sheet-movement-fly" type="number" name="attr_fly" title="@{fly}"placeholder="0">
                                                    <div class="sheet-pc-defence-label">FLY</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="sheet-container-attacks">
                                    <div class="sheet-container-panel sheet-panel-bonuses">
                                        <div class="sheet-container-header">ATTACK MODIFIERS</div>
                                        <input class="sheet-hidden" type="checkbox" name="attr_global_attack_mod_flag" title="@{global_attack_mod_flag}" value="1">
                                        <fieldset class="repeating_mortaltohitmod">
                                            <div class="sheet-fieldset-item">
                                                <div class="sheet-checkbox-cog">
                                                    <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                    <span class="sheet-toggle-icon"></span>
                                                </div>
                                                <input type="checkbox" name="attr_options-flag" checked="checked" hidden class="sheet-toggle">
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-form">
                                                        <div class="sheet-form-header">Edit Modifier</div>
                                                        <div class="sheet-form-body">
                                                            <div class="sheet-form-group">
                                                                <label class="sheet-form-checkbox">
                                                                    <input type="checkbox" name="attr_global_attack_active_flag" value="1">
                                                                </label>
                                                                <input type="text" name="attr_global_attack_name">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Roll:</label>
                                                                <input type="text" name="attr_global_attack_roll">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-toggle-unchecked">
                                                    <div class="sheet-pc-attack-modifier">
                                                        <div class="sheet-checkbox-image">
                                                            <input type="checkbox" name="attr_global_attack_active_flag" value="1">
                                                            <span></span>
                                                        </div>
                                                        <span name="attr_global_attack_name"></span>
                                                        <span name="attr_global_attack_roll"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                    <div class="sheet-container-panel sheet-panel-bonuses">
                                        <div class="sheet-container-header">DAMAGE MODIFIERS</div>
                                        <input class="sheet-hidden" type="checkbox" name="attr_global_damage_mod_flag" title="@{global_damage_mod_flag}" value="1">
                                        <fieldset class="repeating_mortaldamagemod">
                                            <div class="sheet-fieldset-item">
                                                <div class="sheet-checkbox-cog">
                                                    <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                    <span class="sheet-toggle-icon"></span>
                                                </div>
                                                <input type="checkbox" name="attr_options-flag" checked="checked" hidden class="sheet-toggle">
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-form">
                                                        <div class="sheet-form-header">Edit Modifier</div>
                                                        <div class="sheet-form-body">
                                                            <div class="sheet-form-group">
                                                                <label class="sheet-form-checkbox">
                                                                    <input type="checkbox" name="attr_global_damage_active_flag" value="1">
                                                                </label>
                                                                <input type="text" name="attr_global_damage_name">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Damage:</label>
                                                                <input type="text" name="attr_global_damage_damage" value="">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Type:</label>
                                                                <input type="text" name="attr_global_damage_type" value="">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-toggle-unchecked">
                                                    <div class="sheet-pc-attack-damage-modifier">
                                                        <div class="sheet-checkbox-image">
                                                            <input type="checkbox" name="attr_global_damage_active_flag" value="1">
                                                            <span></span>
                                                        </div>
                                                        <span name="attr_global_damage_name"></span>
                                                        <span name="attr_global_damage_damage"></span>
                                                        <span name="attr_global_damage_type"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                    <div class="sheet-container-panel sheet-panel-attacks">
                                        <div class="sheet-container-header">ATTACKS</div>
                                        <div class="sheet-container-body">
                                            <fieldset class="repeating_mortalattack">
                                                <div class="sheet-fieldset-item">
                                                    <div class="sheet-checkbox-cog">
                                                        <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                        <span class="sheet-toggle-icon"></span>
                                                    </div>
                                                    <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                                    <div class="sheet-toggle-checked">
                                                        <div class="sheet-form">
                                                            <div class="sheet-form-header">Edit Attack</div>
                                                            <div class="sheet-form-body">
                                                                <div class="sheet-form-group">
                                                                    <label>Name:</label>
                                                                    <input type="text" name="attr_atkname">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_atkflag" value="{{attack=1}}" checked="checked">
                                                                        <span>Attack:</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <select name="attr_atkattr_base">
                                                                        <option value="@{power}" selected="selected">PWR</option>
                                                                        <option value="@{agility}">AGI</option>
                                                                        <option value="@{vitality}">VIT</option>
                                                                        <option value="@{cultivation}">CUL</option>
                                                                        <option value="@{qicontrol}">QIC</option>
                                                                        <option value="@{mental}">MTL</option>
                                                                        <option value="0">-</option>
                                                                    </select>
                                                                    <span>+</span>
                                                                    <input type="text" name="attr_atkmod" placeholder="0">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Range:</label>
                                                                    <input type="text" name="attr_atkrange">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_dmgflag" value="{{damage=1}} {{dmg1flag=1}}" checked="checked">
                                                                        <span>Damage 1</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Dmg</label>
                                                                    <input type="text" name="attr_dmgbase">
                                                                    <span>+</span>
                                                                    <select name="attr_dmgattr">
                                                                        <option value="@{power}" selected="selected">PWR</option>
                                                                        <option value="@{agility}">AGI</option>
                                                                        <option value="@{vitality}">VIT</option>
                                                                        <option value="@{cultivation}">CUL</option>
                                                                        <option value="@{qicontrol}">QIC</option>
                                                                        <option value="@{mental}">MTL</option>
                                                                        <option value="0">-</option>
                                                                    </select>
                                                                    <span>+</span>
                                                                    <label>Mod</label>
                                                                    <input type="text" name="attr_dmgmod">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Type:</label>
                                                                    <input type="text" name="attr_dmgtype">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_dmg2flag" value="{{damage=1}} {{dmg2flag=1}}">
                                                                        <span>Damage 2</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Dmg</label>
                                                                    <input type="text" name="attr_dmg2base">
                                                                    <span>+</span>
                                                                    <select name="attr_dmg2attr">
                                                                        <option value="@{power}">PWR</option>
                                                                        <option value="@{agility}">AGI</option>
                                                                        <option value="@{vitality}">VIT</option>
                                                                        <option value="@{cultivation}">CUL</option>
                                                                        <option value="@{qicontrol}">QIC</option>
                                                                        <option value="@{mental}">MTL</option>
                                                                        <option value="0" selected="selected">-</option>
                                                                    </select>
                                                                    <span>+</span>
                                                                    <label>Mod</label>
                                                                    <input type="text" name="attr_dmg2mod">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Type:</label>
                                                                    <input type="text" name="attr_dmg2type">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_saveflag" value="{{save=1}} {{saveattr=@{saveattr}}} {{savedesc=@{saveeffect}}} {{savedc=[[[[@{savedc}]][SAVE]]]}}">
                                                                        <span>Attribute Check</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <select name="attr_saveattr">
                                                                        <option value="Power" selected="selected">PWR</option>
                                                                        <option value="Agility">AGI</option>
                                                                        <option value="Vitality">VIT</option>
                                                                        <option value="Cultivation">CUL</option>
                                                                        <option value="Qi Control">QIC</option>
                                                                        <option value="Mental">MTL</option>
                                                                    </select>
                                                                    <label>vs DC:</label>
                                                                    <select name="attr_savedc">
                                                                        <option value="(@{power_dc})">PWR</option>
                                                                        <option value="(@{agility_dc})">AGI</option>
                                                                        <option value="(@{vitality_dc})">VIT</option>
                                                                        <option value="(@{cultivation_dc})">CUL</option>
                                                                        <option value="(@{qicontrol_dc})">QIC</option>
                                                                        <option value="(@{mental_dc})">MTL</option>
                                                                        <option value="(@{saveflat})">FLAT</option>
                                                                    </select>
                                                                    <input type="hidden" name="attr_savedc">
                                                                    <input type="text" name="attr_saveflat" value="10">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Pass Effect:</label>
                                                                    <input type="text" name="attr_saveeffect">
                                                                </div>
                                                                <div class="sheet-form-group sheet-form-group-column">
                                                                    <label>Description:</label>
                                                                    <textarea name="attr_atk_desc"></textarea>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="sheet-toggle-unchecked">
                                                        <div class="sheet-pc-attack">
                                                            <input type="text" name="attr_atkbonus" class="sheet-hidden" value="">
                                                            <input type="text" name="attr_atkdmgtype" class="sheet-hidden" value="">
                                                            <button type="roll" name="roll_attack" value="@{rollbase}" class="sheet-attack-button">
                                                                <span name="attr_atkname"></span>
                                                                <span name="attr_atkbonus"></span>
                                                                <span name="attr_atkdmgtype"></span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <input type="hidden" name="attr_rollbase">
                                                <input type="hidden" name="attr_rollbase_dmg">
                                                <button type="roll" name="roll_attack_dmg" value="@{rollbase_dmg}" class="sheet-hidden"></button>
                                            </fieldset>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col col3">
                                <div class="sheet-container-panel sheet-container-traits">
                                    <div class="sheet-container-header">TRAITS</div>
                                    <div class="sheet-container-body">
                                        <fieldset class="repeating_mortalfeature">
                                            <div class="sheet-fieldset-item sheet-fieldset-item-mortal-feature">
                                                <div class="sheet-checkbox-cog">
                                                    <input type="checkbox" name="attr_options-flag" checked="checked" value="on">
                                                    <span class="sheet-toggle-icon"></span>
                                                </div>
                                                <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-form">
                                                        <div class="sheet-form-header">Edit Trait</div>
                                                        <div class="sheet-form-body">
                                                            <div class="sheet-form-group">
                                                                <label>Name:</label>
                                                                <input type="text" name="attr_name">
                                                            </div>
                                                            <div class="sheet-form-group form-group-description">
                                                                <label>Description:</label>
                                                                <textarea name="attr_desc"></textarea>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-toggle-unchecked">
                                                    <div class="sheet-feature">
                                                        <input class="toggle-feature" type="hidden" name="attr_toggle_feature_desc" value="0">
                                                        <div class="sheet-feature-name">
                                                            <span name="attr_name"></span>
                                                            <input class="toggle-checkbox" type="checkbox" value="1" name="attr_toggle_feature_desc">
                                                        </div>
                                                        <div class="sheet-feature-desc">
                                                            <span name="attr_desc"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-container-resources">
                                    <div class="sheet-container-header">RESOURCES</div>
                                    <div class="sheet-container-body">
                                        <fieldset class="repeating_mortalresource">
                                            <div class="sheet-fieldset-item">
                                                <div class="sheet-form">
                                                    <div class="sheet-item-resource-name">
                                                        <input class="sheet-resource-name" type="text" name="attr_resource_name" title="@{resource_name}" placeholder="Resource">
                                                    </div>
                                                    <div class="sheet-item-resource-current">
                                                        <input class="sheet-resource-current" type="text" name="attr_resource_current" title="@{resource_current}" placeholder="0">
                                                    </div>
                                                    <div class="sheet-item-resource-max">
                                                        <input class="sheet-resource-max" type="text" name="attr_resource_max" title="@{resource_max}" placeholder="0">
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-page sheet-page-cultivator">
                    <input type="radio" name="attr_page" value="cultivator">
                    <span class="sheet-page-label">CULTIVATOR</span>
                    <div class="sheet-page-content">
                        <div class="sheet-container-well sheet-well-attributes">
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_power" value="@{w_type}&{template:attribute} @{character_name_output} {{rollname=Power}} {{roll1=[[ @{power}d6[power] + @{power_check_bonus}[BONUS] + @{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">POWER</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_power_base" title="@{power_base}" value="0">
                                    <input type="hidden" name="attr_power" value="0">
                                    <input type="hidden" name="attr_power_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_power" title="@{power}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_power_dc" title="@{power_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_agility" value="@{w_type}&{template:attribute} @{character_name_output} {{rollname=Agility}} {{roll1=[[ @{agility}d6[agility] + @{agility_check_bonus}[BONUS] + @{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">AGILITY</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_agility_base" title="@{agility_base}" value="0">
                                    <input type="hidden" name="attr_agility" value="0">
                                    <input type="hidden" name="attr_agility_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_agility" title="@{agility}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_agility_dc" title="@{agility_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_vitality" value="@{w_type}&{template:attribute} @{character_name_output} {{rollname=Vitality}} {{roll1=[[ @{vitality}d6[vitality] + @{vitality_check_bonus}[BONUS] + @{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">VITALITY</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_vitality_base" title="@{vitality_base}" value="0">
                                    <input type="hidden" name="attr_vitality" value="0">
                                    <input type="hidden" name="attr_vitality_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_vitality" title="@{vitality}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_vitality_dc" title="@{vitality_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_cultivation" value="@{w_type}&{template:attribute} @{character_name_output} {{rollname=Cultivation}} {{roll1=[[ @{cultivation}d6[cultivation] + @{cultivation_check_bonus}[BONUS] + @{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">CULTIVATION</span>
                                </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_cultivation_base" title="@{cultivation_base}" value="0">
                                    <input type="hidden" name="attr_cultivation" value="0">
                                    <input type="hidden" name="attr_cultivation_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_cultivation" title="@{cultivation}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_cultivation_dc" title="@{cultivation_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_qicontrol" value="@{w_type}&{template:attribute} @{character_name_output} {{rollname=Qicontrol}} {{roll1=[[ @{qicontrol}d6[qicontrol] + @{qicontrol_check_bonus}[BONUS] + @{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">QI CONTROL</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_qicontrol_base" title="@{qicontrol_base}" value="0">
                                    <input type="hidden" name="attr_qicontrol" value="0">
                                    <input type="hidden" name="attr_qicontrol_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_qicontrol" title="@{qicontrol}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_qicontrol_dc" title="@{qicontrol_dc}">0</span>
                                </div>
                            </div>
                            <div class="sheet-container-attribute">
                                <div class="sheet-container-header">
                                    <button type="roll" name="roll_mental" value="@{w_type}&{template:attribute} @{character_name_output} {{rollname=Mental}} {{roll1=[[ @{mental}d6[mental] + @{mental_check_bonus}[BONUS] + @{global_attribute_bonus}[GLOBAL]]]}}" class="sheet-button-attribute">
                                        <span class="sheet-button-attribute-title">MENTAL</span>
                                    </button>
                                </div>
                                <div class="sheet-container-footer">
                                    <input class="baseattr" type="number" name="attr_mental_base" title="@{mental_base}" value="0">
                                    <input type="hidden" name="attr_mental" value="0">
                                    <input type="hidden" name="attr_mental_flag" value="0" class="sheet-field-toggle">
                                    <span name="attr_mental" title="@{mental}">0</span>
                                </div>
                                <div class="sheet-container-body">
                                    <span class="sheet-button-attribute-dc" name="attr_mental_dc" title="@{mental_dc}">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-columns">
                            <div class="col col1">
                                <div class="sheet-container-panel sheet-container-skills">
                                    <div class="sheet-container-header">SKILLS</div>
                                    <div class="sheet-container-body">
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_acrobatics" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Acrobatics}} {{roll1=[[@{acrobatics_roll}d6 + @{acrobatics_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Acrobatics</span>
                                                <span name="attr_acrobatics"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_athletics" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Athletics}} {{roll1=[[@{athletics_roll}d6 + @{athletics_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Athletics</span>
                                                <span name="attr_athletics"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_charm" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Charm}} {{roll1=[[@{charm_roll}d6 + @{charm_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Charm</span>
                                                <span name="attr_charm"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_deceit" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Deceit}} {{roll1=[[@{deceit_roll}d6 + @{deceit_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Deceit</span>
                                                <span name="attr_deceit"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_discretion" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Discretion}} {{roll1=[[@{discretion_roll}d6 + @{discretion_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Discretion</span>
                                                <span name="attr_discretion"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_disguise" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Disguise}} {{roll1=[[@{disguise_roll}d6 + @{disguise_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Disguise</span>
                                                <span name="attr_disguise"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_fine_arts" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Fine_arts}} {{roll1=[[@{fine_arts_roll}d6 + @{fine_arts_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Fine Arts</span>
                                                <span name="attr_fine_arts"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_forgery" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Forgery}} {{roll1=[[@{forgery_roll}d6 + @{forgery_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Forgery</span>
                                                <span name="attr_forgery"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_grapple" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Grapple}} {{roll1=[[@{grapple_roll}d6 + @{grapple_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Grapple</span>
                                                <span name="attr_grapple"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_history" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=History}} {{roll1=[[@{history_roll}d6 + @{history_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>History</span>
                                                <span name="attr_history"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_intuition" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Intuition}} {{roll1=[[@{intuition_roll}d6 + @{intuition_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Intuition</span>
                                                <span name="attr_intuition"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_intimidation" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Intimidation}} {{roll1=[[@{intimidation_roll}d6 + @{intimidation_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Intimidation</span>
                                                <span name="attr_intimidation"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_investigation" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Investigation}} {{roll1=[[@{investigation_roll}d6 + @{investigation_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Investigation</span>
                                                <span name="attr_investigation"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_medicine" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Medicine}} {{roll1=[[@{medicine_roll}d6 + @{medicine_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Medicine</span>
                                                <span name="attr_medicine"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_navigation" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Navigation}} {{roll1=[[@{navigation_roll}d6 + @{navigation_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Navigation</span>
                                                <span name="attr_navigation"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_perception" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Perception}} {{roll1=[[@{perception_roll}d6 + @{perception_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Perception</span>
                                                <span name="attr_perception"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_performance" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Performance}} {{roll1=[[@{performance_roll}d6 + @{performance_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Performance</span>
                                                <span name="attr_performance"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_persuade" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Persuade}} {{roll1=[[@{persuade_roll}d6 + @{persuade_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Persuade</span>
                                                <span name="attr_persuade"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_stealth" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Stealth}} {{roll1=[[@{stealth_roll}d6 + @{stealth_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Stealth</span>
                                                <span name="attr_stealth"></span>
                                            </button>
                                        </div>
                                        <div class="sheet-skill">
                                            <button type="roll" name="roll_survival" value="@{wtype}&{template:simple} @{character_name_output} {{rollname=Survival}} {{roll1=[[@{survival_roll}d6 + @{survival_bonus}[BONUS] + @{global_skill_bonus}[GLOBAL]]]}}">
                                                <span>Survival</span>
                                                <span name="attr_survival"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-container-tools">
                                    <div class="sheet-container-header">TOOLS</div>
                                    <div class="sheet-container-body">
                                        <fieldset class="repeating_cultivatortool">
                                            <div class="sheet-fieldset-item sheet-fieldset-item-tool">
                                                <div class="sheet-checkbox-cog">
                                                    <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                    <span class="sheet-toggle-icon"></span>
                                                </div>
                                                <input type="checkbox" name="attr_options-flag" checked="checked" hidden class="sheet-toggle">
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-form">
                                                        <div class="sheet-form-header">Edit Tool</div>
                                                        <div class="sheet-form-body">
                                                            <div class="sheet-form-group">
                                                                <label>Name:</label>
                                                                <input type="text" name="attr_toolname">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Roll:</label>
                                                                <input type="text" name="attr_tool_roll" title="@{tool_roll}" value="0">
                                                                <label>Mods:</label>
                                                                <input type="text" name="attr_tool_mod" title="@{tool_mod}" value="0">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-toggle-unchecked">
                                                    <div class="sheet-pc-tool">
                                                        <button type="roll" name="roll_roll" value="@{wtype}&{template:simple} @{charname_output} {{rname=@{toolname}}} {{mod=@{tool_mod}}} {{r1=[[@{tool_roll} + @{tool_mod}[BONUS]]]}} {{type=Custom}}">
                                                            <span name="attr_toolname"></span>
                                                            <span name="attr_tool_roll"></span>
                                                            <span>+</span>
                                                            <span name="attr_tool_mod"></span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </div>
                            <div class="col col2">
                                <div class="sheet-container-panel sheet-panel-hp">
                                    <div class="sheet-container-header">HEALTH</div>
                                    <div class="sheet-container-body">
                                        <div class="sheet-container-box sheet-pc-health">
                                            <div class="sheet-box-body sheet-health">
                                                <input type="number" name="attr_hp_max" title="@{hp_max}" placeholder="MAXIMUM">
                                                <input type="number" name="attr_hp" title="@{hp}" placeholder="CURRENT">
                                            </div>
                                        </div>
                                        <div class="sheet-container-box sheet-pc-health">
                                            <div class="sheet-box-body sheet-health-extra">
                                                <div class="sheet-box">
                                                    <span>Temp</span>
                                                    <input type="number" name="attr_hp_temp" title="@{hp_temp}" placeholder="0">
                                                </div>
                                                <div class="sheet-box">
                                                    <span>Regen</span>
                                                    <input type="number" name="attr_hp_regen" title="@{hp_regen}" placeholder="0">
                                                </div>
                                                <div class="sheet-box">
                                                    <span>Dice</span>
                                                <input type="text" name="attr_hp_die" title="@{hp_die}" placeholder="1d8">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-container-combat">
                                    <div class="sheet-container-header">COMBAT</div>
                                    <div class="sheet-container-body">
                                        <div class="sheet-container-box sheet-pc-initiative">
                                            <div class="sheet-container-bar">
                                                <button type="roll" name="roll_init" value="@{wtype}&{template:simple} @{charname_output} {{rname=Initiative}} {{r1=[[@{agility}d6[AGI]+@{initiative_bonus} &{tracker}]]}} {{type=Initiative}}">INITIATIVE<span name="attr_initiative" title="@{initiative}"></span></button>
                                            </div>
                                        </div>
                                        <div class="sheet-container-box sheet-pc-defences">
                                            <div class="sheet-defence-label">HYPER RESISTANCE</div>
                                            <input class="sheet-defence" type="text" name="attr_hyper_resistances" title="@{hyper_resistances}">
                                            <div class="sheet-defence-label">RESISTANCE</div>
                                            <input class="sheet-defence" type="text" name="attr_resistances" title="@{resistances}">
                                            <div class="sheet-defence-label">WEAKNESS</div>
                                            <input class="sheet-defence" type="text" name="attr_weakness" title="@{weakness}">
                                            <div class="sheet-defence-label">HYPER WEAKNESS</div>
                                            <input class="sheet-defence" type="text" name="attr_hyper_weakness" title="@{hyper_weakness}">
                                        </div>
                                        <div class="sheet-container-box sheet-pc-evasion-durability">
                                            <div class="sheet-pc-evasion-group">
                                                <div class="sheet-pc-evasion-full">
                                                    <span class="sheet-evasion-full" name="attr_evasion-full" title="@{evasion-full}">0</span>
                                                    <div class="sheet-pc-defence-label">EVA</div>
                                                </div>
                                                <div class="sheet-pc-evasion-base">
                                                    <input class="sheet-evasion-base" type="number" name="attr_evasion-base" title="@{evasion-base}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BASE</div>
                                                </div>
                                                <div class="sheet-pc-evasion-limit">
                                                    <input class="sheet-evasion-limit" type="number" name="attr_evasion-limit" title="@{evasion-limit}" placeholder="0" value="10">
                                                    <div class="sheet-pc-defence-label">LIMIT</div>
                                                </div>
                                                <div class="sheet-pc-evasion-bonus">
                                                    <input class="sheet-evasion-bonus" type="number" name="attr_evasion-bonus" title="@{evasion-bonus}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BONUS</div>
                                                </div>
                                            </div>
                                            <div class="sheet-pc-durability-group">
                                                <div class="sheet-pc-durability-full">
                                                    <span class="sheet-durability-full" name="attr_durability-full" title="@{durability-full}">0</span>
                                                    <div class="sheet-pc-defence-label">DUR</div>
                                                </div>
                                                <div class="sheet-pc-durability-base">
                                                    <input class="sheet-durability-base" type="number" name="attr_durability-base" title="@{durability-base}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BASE</div>
                                                </div>
                                                <div class="sheet-pc-durability-limit">
                                                    <input class="sheet-durability-limit" type="number" name="attr_durability-limit" title="@{durability-limit}" placeholder="0" value="10">
                                                    <div class="sheet-pc-defence-label">LIMIT</div>
                                                </div>
                                                <div class="sheet-pc-durability-bonus">
                                                    <input class="sheet-durability-bonus" type="number" name="attr_durability-bonus" title="@{durability-bonus}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BONUS</div>
                                                </div>
                                            </div>
                                            <div class="sheet-pc-reduction-group">
                                                <div class="sheet-pc-reduction-full">
                                                    <span class="sheet-reduction-full" name="attr_reduction-full" title="@{reduction-full}">0</span>
                                                    <div class="sheet-pc-defence-label">DR</div>
                                                </div>
                                                <div class="sheet-pc-reduction-base">
                                                    <input class="sheet-reduction-base" type="number" name="attr_reduction-base" title="@{reduction-base}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BASE</div>
                                                </div>
                                                <div class="sheet-pc-reduction-armour">
                                                    <input class="sheet-reduction-armour" type="number" name="attr_reduction-armour" title="@{reduction-armour}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">ARMOUR</div>
                                                </div>
                                                <div class="sheet-pc-reduction-bonus">
                                                    <input class="sheet-reduction-bonus" type="number" name="attr_reduction-bonus" title="@{reduction-bonus}" placeholder="0">
                                                    <div class="sheet-pc-defence-label">BONUS</div>
                                                </div>
                                            </div>
                                            <div class="sheet-pc-speed-group">
                                                <div class="sheet-pc-speed-movement">
                                                    <input class="sheet-movement-movement" type="number" name="attr_movement" title="@{movement}"placeholder="0">
                                                    <div class="sheet-pc-defence-label">SPEED</div>
                                                </div>
                                                <div class="sheet-pc-speed-swim">
                                                    <input class="sheet-movement-swim" type="number" name="attr_swim" title="@{swim}"placeholder="0">
                                                    <div class="sheet-pc-defence-label">SWIM</div>
                                                </div>
                                                <div class="sheet-pc-speed-climb">
                                                    <input class="sheet-movement-climb" type="number" name="attr_climb" title="@{climb}"placeholder="0">
                                                    <div class="sheet-pc-defence-label">CLIMB</div>
                                                </div>
                                                <div class="sheet-pc-speed-fly">
                                                    <input class="sheet-movement-fly" type="number" name="attr_fly" title="@{fly}"placeholder="0">
                                                    <div class="sheet-pc-defence-label">FLY</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="sheet-container-attacks">
                                    <div class="sheet-container-panel sheet-panel-bonuses">
                                        <div class="sheet-container-header">ATTACK MODIFIERS</div>
                                        <input class="sheet-hidden" type="checkbox" name="attr_cultivator_global_attack_mod_flag" title="@{cultivator_global_attack_mod_flag}" value="1">
                                        <fieldset class="repeating_cultivatortohitmod">
                                            <div class="sheet-fieldset-item">
                                                <div class="sheet-checkbox-cog">
                                                    <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                    <span class="sheet-toggle-icon"></span>
                                                </div>
                                                <input type="checkbox" name="attr_options-flag" checked="checked" hidden class="sheet-toggle">
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-form">
                                                        <div class="sheet-form-header">Edit Modifier</div>
                                                        <div class="sheet-form-body">
                                                            <div class="sheet-form-group">
                                                                <label class="sheet-form-checkbox">
                                                                    <input type="checkbox" name="attr_cultivator_global_attack_active_flag" value="1">
                                                                </label>
                                                                <input type="text" name="attr_cultivator_global_attack_name">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Roll:</label>
                                                                <input type="text" name="attr_cultivator_global_attack_roll">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-toggle-unchecked">
                                                    <div class="sheet-pc-attack-modifier">
                                                        <div class="sheet-checkbox-image">
                                                            <input type="checkbox" name="attr_cultivator_global_attack_active_flag" value="1">
                                                            <span></span>
                                                        </div>
                                                        <span name="attr_cultivator_global_attack_name"></span>
                                                        <span name="attr_cultivator_global_attack_roll"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                    <div class="sheet-container-panel sheet-panel-bonuses">
                                        <div class="sheet-container-header">DAMAGE MODIFIERS</div>
                                        <input class="sheet-hidden" type="checkbox" name="attr_cultivator_global_damage_mod_flag" title="@{cultivator_global_damage_mod_flag}" value="1">
                                        <fieldset class="repeating_cultivatordamagemod">
                                            <div class="sheet-fieldset-item">
                                                <div class="sheet-checkbox-cog">
                                                    <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                    <span class="sheet-toggle-icon"></span>
                                                </div>
                                                <input type="checkbox" name="attr_options-flag" checked="checked" hidden class="sheet-toggle">
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-form">
                                                        <div class="sheet-form-header">Edit Modifier</div>
                                                        <div class="sheet-form-body">
                                                            <div class="sheet-form-group">
                                                                <label class="sheet-form-checkbox">
                                                                    <input type="checkbox" name="attr_cultivator_global_damage_active_flag" value="1">
                                                                </label>
                                                                <input type="text" name="attr_cultivator_global_damage_name">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Damage:</label>
                                                                <input type="text" name="attr_cultivator_global_damage_damage" value="">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Type:</label>
                                                                <input type="text" name="attr_cultivator_global_damage_type" value="">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-toggle-unchecked">
                                                    <div class="sheet-pc-attack-damage-modifier">
                                                        <div class="sheet-checkbox-image">
                                                            <input type="checkbox" name="attr_cultivator_global_damage_active_flag" value="1">
                                                            <span></span>
                                                        </div>
                                                        <span name="attr_cultivator_global_damage_name"></span>
                                                        <span name="attr_cultivator_global_damage_damage"></span>
                                                        <span name="attr_cultivator_global_damage_type"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                    <div class="sheet-container-panel sheet-panel-attacks">
                                        <div class="sheet-container-header">ATTACKS</div>
                                        <div class="sheet-container-body">
                                            <fieldset class="repeating_cultivatorattack">
                                                <div class="sheet-fieldset-item">
                                                    <div class="sheet-checkbox-cog">
                                                        <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                        <span class="sheet-toggle-icon"></span>
                                                    </div>
                                                    <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                                    <div class="sheet-toggle-checked">
                                                        <div class="sheet-form">
                                                            <div class="sheet-form-header">Edit Attack</div>
                                                            <div class="sheet-form-body">
                                                                <div class="sheet-form-group">
                                                                    <label>Name:</label>
                                                                    <input type="text" name="attr_atkname">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_atkflag" value="{{attack=1}}" checked="checked">
                                                                        <span>Attack:</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <select name="attr_atkattr_base">
                                                                        <option value="@{power}" selected="selected">PWR</option>
                                                                        <option value="@{agility}">AGI</option>
                                                                        <option value="@{vitality}">VIT</option>
                                                                        <option value="@{cultivation}">CUL</option>
                                                                        <option value="@{qicontrol}">QIC</option>
                                                                        <option value="@{mental}">MTL</option>
                                                                        <option value="0">-</option>
                                                                    </select>
                                                                    <span>+</span>
                                                                    <input type="text" name="attr_atkmod" placeholder="0">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Range:</label>
                                                                    <input type="text" name="attr_atkrange">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_dmgflag" value="{{damage=1}} {{dmg1flag=1}}" checked="checked">
                                                                        <span>Damage 1</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Dmg</label>
                                                                    <input type="text" name="attr_dmgbase">
                                                                    <span>+</span>
                                                                    <select name="attr_dmgattr">
                                                                        <option value="@{power}" selected="selected">PWR</option>
                                                                        <option value="@{agility}">AGI</option>
                                                                        <option value="@{vitality}">VIT</option>
                                                                        <option value="@{cultivation}">CUL</option>
                                                                        <option value="@{qicontrol}">QIC</option>
                                                                        <option value="@{mental}">MTL</option>
                                                                        <option value="0">-</option>
                                                                    </select>
                                                                    <span>+</span>
                                                                    <label>Mod</label>
                                                                    <input type="text" name="attr_dmgmod">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Type:</label>
                                                                    <input type="text" name="attr_dmgtype">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_dmg2flag" value="{{damage=1}} {{dmg2flag=1}}">
                                                                        <span>Damage 2</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Dmg</label>
                                                                    <input type="text" name="attr_dmg2base">
                                                                    <span>+</span>
                                                                    <select name="attr_dmg2attr">
                                                                        <option value="@{power}">PWR</option>
                                                                        <option value="@{agility}">AGI</option>
                                                                        <option value="@{vitality}">VIT</option>
                                                                        <option value="@{cultivation}">CUL</option>
                                                                        <option value="@{qicontrol}">QIC</option>
                                                                        <option value="@{mental}">MTL</option>
                                                                        <option value="0" selected="selected">-</option>
                                                                    </select>
                                                                    <span>+</span>
                                                                    <label>Mod</label>
                                                                    <input type="text" name="attr_dmg2mod">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Type:</label>
                                                                    <input type="text" name="attr_dmg2type">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_saveflag" value="{{save=1}} {{saveattr=@{saveattr}}} {{savedesc=@{saveeffect}}} {{savedc=[[[[@{savedc}]][SAVE]]]}}">
                                                                        <span>Attribute Check</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <select name="attr_saveattr">
                                                                        <option value="Power" selected="selected">PWR</option>
                                                                        <option value="Agility">AGI</option>
                                                                        <option value="Vitality">VIT</option>
                                                                        <option value="Cultivation">CUL</option>
                                                                        <option value="Qi Control">QIC</option>
                                                                        <option value="Mental">MTL</option>
                                                                    </select>
                                                                    <label>vs DC:</label>
                                                                    <select name="attr_savedc">
                                                                        <option value="(@{power_dc})">PWR</option>
                                                                        <option value="(@{agility_dc})">AGI</option>
                                                                        <option value="(@{vitality_dc})">VIT</option>
                                                                        <option value="(@{cultivation_dc})">CUL</option>
                                                                        <option value="(@{qicontrol_dc})">QIC</option>
                                                                        <option value="(@{mental_dc})">MTL</option>
                                                                        <option value="(@{saveflat})">FLAT</option>
                                                                    </select>
                                                                    <input type="hidden" name="attr_savedc">
                                                                    <input type="text" name="attr_saveflat" value="10">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Pass Effect:</label>
                                                                    <input type="text" name="attr_saveeffect">
                                                                </div>
                                                                <div class="sheet-form-group sheet-form-group-column">
                                                                    <label>Description:</label>
                                                                    <textarea name="attr_atk_desc"></textarea>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="sheet-toggle-unchecked">
                                                        <div class="sheet-pc-attack">
                                                            <input type="text" name="attr_atkbonus" class="sheet-hidden" value="">
                                                            <input type="text" name="attr_atkdmgtype" class="sheet-hidden" value="">
                                                            <button type="roll" name="roll_attack" value="@{rollbase}" class="sheet-attack-button">
                                                                <span name="attr_atkname"></span>
                                                                <span name="attr_atkbonus"></span>
                                                                <span name="attr_atkdmgtype"></span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <input type="hidden" name="attr_rollbase">
                                                <input type="hidden" name="attr_rollbase_dmg">
                                                <button type="roll" name="roll_attack_dmg" value="@{rollbase_dmg}" class="sheet-hidden"></button>
                                            </fieldset>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col col3">
                                <div class="sheet-container-panel sheet-container-traits">
                                    <div class="sheet-container-header">TRAITS</div>
                                    <div class="sheet-container-body">
                                        <fieldset class="repeating_cultivatorfeature">
                                            <div class="sheet-fieldset-item sheet-fieldset-item-cultivator-feature">
                                                <div class="sheet-checkbox-cog">
                                                    <input type="checkbox" name="attr_options-flag" checked="checked" value="on">
                                                    <span class="sheet-toggle-icon"></span>
                                                </div>
                                                <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-form">
                                                        <div class="sheet-form-header">Edit Trait</div>
                                                        <div class="sheet-form-body">
                                                            <div class="sheet-form-group">
                                                                <label>Name:</label>
                                                                <input type="text" name="attr_name">
                                                            </div>
                                                            <div class="sheet-form-group form-group-description">
                                                                <label>Description:</label>
                                                                <textarea name="attr_desc"></textarea>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-toggle-unchecked">
                                                    <div class="sheet-feature">
                                                        <input class="toggle-feature" type="hidden" name="attr_toggle_feature_desc" value="0">
                                                        <div class="sheet-feature-name">
                                                            <span name="attr_name"></span>
                                                            <input class="toggle-checkbox" type="checkbox" value="1" name="attr_toggle_feature_desc">
                                                        </div>
                                                        <div class="sheet-feature-desc">
                                                            <span name="attr_desc"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-container-resources">
                                    <div class="sheet-container-header">RESOURCES</div>
                                    <div class="sheet-container-body">
                                        <fieldset class="repeating_cultivatorresource">
                                            <div class="sheet-fieldset-item">
                                                <div class="sheet-form">
                                                    <div class="sheet-item-resource-name">
                                                        <input class="sheet-resource-name" type="text" name="attr_resource_name" title="@{resource_name}" placeholder="Resource">
                                                    </div>
                                                    <div class="sheet-item-resource-current">
                                                        <input class="sheet-resource-current" type="text" name="attr_resource_current" title="@{resource_current}" placeholder="0">
                                                    </div>
                                                    <div class="sheet-item-resource-max">
                                                        <input class="sheet-resource-max" type="text" name="attr_resource_max" title="@{resource_max}" placeholder="0">
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-page sheet-page-bio">
                    <input type="radio" name="attr_page" value="bio">
                    <span class="sheet-page-label">BIO</span>
                    <div class="sheet-page-content">
                        <div class="sheet-container-well sheet-container-well-details">
                            <div class="sheet-container-panel sheet-pc-details">
                                <div class="sheet-container-header">Character Details</div>
                                <div class="sheet-container-body">
                                    <div class="sheet-pc-detail">
                                        <label>Age</label>
                                        <select name="attr_character_age_detail" title="@{character_age_detail}">
                                            <option value=""></option>
                                            <option value="young_adult">Young adult</option>
                                            <option value="early_middle">Early-mid age</option>
                                            <option value="late_middle">Late-mid age</option>
                                            <option value="old">Old</option>
                                            <option value="very_old">Very old</option>
                                        </select>
                                        <input type="text" name="attr_character_age" title="@{character_age}">
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Size</label>
                                        <select name="attr_size" title="@{size}">
                                            <option value="tiny">Tiny</option>
                                            <option value="small">Small</option>
                                            <option value="medium" selected>Medium</option>
                                            <option value="large">Large</option>
                                            <option value="huge">Huge</option>
                                            <option value="gargantuan">Gargantuan</option>
                                        </select>
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Height</label>
                                        <select name="attr_character_height_detail" title="@{character_height_detail}">
                                            <option value=""></option>
                                            <option value="very_short">Very short</option>
                                            <option value="short">Short</option>
                                            <option value="average">Average</option>
                                            <option value="tall">Tall</option>
                                            <option value="very_tall">Very tall</option>
                                        </select>
                                        <input type="text" name="attr_character_height" title="@{character_height}">
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Weight</label>
                                        <select name="attr_character_weight" title="@{character_weight}">
                                            <option value=""></option>
                                            <option value="very_thin">Very thin</option>
                                            <option value="thin">Thin</option>
                                            <option value="average">Average</option>
                                            <option value="fat">Fat</option>
                                            <option value="very_fat">Very fat</option>
                                        </select>
                                        <input type="text" name="attr_character_weight_detail" title="@{character_weight_detail}">
                                    </div>
                                    <div class="sheet-pc-detail sheet-pc-detail-feature">
                                        <label>Feature</label>
                                        <div class="sheet-pc-detail-column">
                                            <input type="text" name="attr_character_feature_detail" title="@{character_feature_detail}">
                                        </div>
                                    </div>
                                    <div class="sheet-pc-detail sheet-pc-detail-motivation">
                                        <label>Motivation</label>
                                        <div class="sheet-pc-detail-column">
                                            <input type="text" name="attr_character_motivation_detail" title="@{character_motivation_detail}">
                                        </div>
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Habit</label>
                                        <div class="sheet-pc-detail-column">
                                            <input type="text" name="attr_character_habit_detail" title="@{character_habit_detail}">
                                        </div>
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Bloodline</label>
                                        <div class="sheet-pc-detail-column">
                                            <input type="text" name="attr_character_bloodline_detail" title="@{character_bloodline_detail}">
                                        </div>
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Family</label>
                                        <select name="attr_character_family" title="@{character_family}">
                                            <option value=""></option>
                                            <option value="none">None</option>
                                            <option value="small">Small</option>
                                            <option value="average">Average</option>
                                            <option value="large">Large</option>
                                            <option value="disowned">Disowned</option>
                                        </select>
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Raised By</label>
                                        <select name="attr_character_raised_by" title="@{character_raised_by}">
                                            <option value=""></option>
                                            <option value="natural_parents">Natural parent(s)</option>
                                            <option value="close_family">Close family</option>
                                            <option value="adopted">Adopted parent(s)</option>
                                            <option value="institution">An institution</option>
                                            <option value="yourself">Yourself</option>
                                        </select>
                                    </div>
                                    <div class="sheet-pc-detail sheet-pc-detail-quest">
                                        <label>Quest</label>
                                        <textarea name="attr_character_quest" title="@{character_quest}"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-gimmick">
                                <div class="sheet-container-header">Gimmick</div>
                                <div class="sheet-container-body">
                                    <textarea name="attr_gimmick" title="@{gimmick}"></textarea>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-value">
                                <div class="sheet-container-header">Values</div>
                                <div class="sheet-container-body">
                                    <textarea name="attr_values" title="@{values}"></textarea>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-conflict">
                                <div class="sheet-container-header">Conflict</div>
                                <div class="sheet-container-body">
                                    <textarea name="attr_conflict" title="@{conflict}"></textarea>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-want">
                                <div class="sheet-container-header">Want</div>
                                <div class="sheet-container-body">
                                    <textarea name="attr_want" title="@{want}"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-memories">
                            <div class="sheet-container-panel sheet-pc-custom-rolls">
                                <div class="sheet-container-header">Custom Skills</div>
                                <div class="sheet-container-body">
                                    <fieldset class="repeating_customskill">
                                        <div class="sheet-fieldset-item sheet-fieldset-item-tool">
                                            <div class="sheet-checkbox-cog">
                                                <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                <span class="sheet-toggle-icon"></span>
                                            </div>
                                            <input type="checkbox" name="attr_options-flag" checked="checked" hidden class="sheet-toggle">
                                            <div class="sheet-toggle-checked">
                                                <div class="sheet-form">
                                                    <div class="sheet-form-header">Edit Custom Skill</div>
                                                    <div class="sheet-form-body">
                                                        <div class="sheet-form-group">
                                                            <label>Name:</label>
                                                            <input type="text" name="attr_toolname">
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <label>Roll:</label>
                                                            <input type="text" name="attr_tool_roll" title="@{tool_roll}" value="0">
                                                            <label>Mods:</label>
                                                            <input type="text" name="attr_tool_mod" title="@{tool_mod}" value="0">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="sheet-toggle-unchecked">
                                                <div class="sheet-pc-tool">
                                                    <button type="roll" name="roll_roll" value="@{wtype}&{template:simple} @{charname_output} {{rname=@{toolname}}} {{mod=@{tool_mod}}} {{r1=[[@{tool_roll} + @{tool_mod}[BONUS]]]}} {{type=Custom}}">
                                                        <span name="attr_toolname"></span>
                                                        <span name="attr_tool_roll"></span>
                                                        <span>+</span>
                                                        <span name="attr_tool_mod"></span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-memories">
                                <div class="sheet-container-header">Memories & Events</div>
                                <div class="sheet-container-body">
                                    <fieldset class="repeating_memories">
                                        <div class="sheet-fieldset-item">
                                            <div class="sheet-checkbox-cog">
                                                <input type="checkbox" name="attr_options-flag" checked="checked">
                                                <span class="sheet-toggle-icon"></span>
                                            </div>
                                            <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                            <div class="sheet-toggle-checked">
                                                <div class="sheet-form">
                                                    <div class="sheet-form-header">Edit Memory</div>
                                                    <div class="sheet-form-body">
                                                        <div class="sheet-form-group">
                                                            <label>Name:</label>
                                                            <input type="text" name="attr_memory_name">
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <textarea name="attr_memory_description"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="sheet-toggle-unchecked">
                                                <div class="sheet-pc-memory">
                                                    <span name="attr_memory_name"></span>
                                                    <span name="attr_memory_description"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-notes">
                                <div class="sheet-container-header">Additional Notes</div>
                                <div class="sheet-container-body">
                                    <fieldset class="repeating_notes">
                                        <div class="sheet-fieldset-item">
                                            <div class="sheet-checkbox-cog">
                                                <input type="checkbox" name="attr_options-flag" checked="checked">
                                                <span class="sheet-toggle-icon"></span>
                                            </div>
                                            <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                            <div class="sheet-toggle-checked">
                                                <div class="sheet-form">
                                                    <div class="sheet-form-header">Edit Note</div>
                                                    <div class="sheet-form-body">
                                                        <div class="sheet-form-group">
                                                            <label>Name:</label>
                                                            <input type="text" name="attr_note_name">
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <textarea name="attr_note_description"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="sheet-toggle-unchecked">
                                                <div class="sheet-pc-note">
                                                    <span name="attr_note_name"></span>
                                                    <span name="attr_note_description"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-features">
                            <div class="sheet-container-panel sheet-pc-features">
                                <div class="sheet-container-header">Traits</div>
                                <div class="sheet-container-body">
                                    <fieldset class="repeating_traits">
                                        <div class="sheet-fieldset-item">
                                            <div class="sheet-checkbox-cog">
                                                <input type="checkbox" name="attr_options-flag" checked="checked">
                                                <span class="sheet-toggle-icon"></span>
                                            </div>
                                            <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                            <div class="sheet-toggle-checked">
                                                <div class="sheet-form">
                                                    <div class="sheet-form-header">Edit Feature</div>
                                                    <div class="sheet-form-body">
                                                        <div class="sheet-form-group">
                                                            <label>Name:</label>
                                                            <input type="text" name="attr_name">
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <label>Source:</label>
                                                            <select name="attr_source">
                                                                <option selected="selected">Ancestral</option>
                                                                <option>Mortal path</option>
                                                                <option>Talent</option>
                                                                <option>Background</option>
                                                                <option>Other</option>
                                                            </select>
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <label>Source Type:</label>
                                                            <input type="text" name="attr_source_type">
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <textarea name="attr_description"></textarea>
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <label class="sheet-form-checkbox">
                                                                <input type="checkbox" name="attr_hide_details" value="1">
                                                                <span>Hide Details</span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="sheet-toggle-unchecked">
                                                <div class="sheet-pc-feature">
                                                    <button type="roll" name="roll_output" value="@{wtype}&{template:features} @{charname_output} {{name=@{name}}} {{source=@{source}}} {{source_type=@{source_type}}} {{description=@{description}}}">
                                                        <div class="sheet-pc-feature-name">
                                                            <span name="attr_name"></span>
                                                        </div>
                                                        <input type="hidden" name="attr_hide_details" class="sheet-field-untoggle">
                                                        <div class="sheet-pc-feature-details">
                                                            <span class="sheet-pc-feature-source">
                                                                <span name="attr_source"></span>
                                                                <span name="attr_source_type"></span>
                                                            </span>
                                                            <span name="attr_description"></span>
                                                        </div>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-page sheet-page-notes">
                    <input type="radio" name="attr_page" value="notes">
                    <span class="sheet-page-label">NOTES</span>
                    <div class="sheet-page-content">
                        <div class="sheet-container-well sheet-pc-notes">
                            <div class="col col1">
                                <div class="sheet-container-panel sheet-pc-notes-one">
                                    <div class="sheet-container-header">
                                        <input type="text" name="attr_notes_one_header" placeholder="Additional Features & Traits" value="Additional Features & Traits">
                                    </div>
                                    <div class="sheet-container-body">
                                        <textarea name="attr_pc_notes_one"></textarea>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-pc-notes-two">
                                    <div class="sheet-container-header">
                                        <input type="text" name="attr_notes_two_header" placeholder="Character Backstory" value="Character Backstory">
                                    </div>
                                    <div class="sheet-container-body">
                                        <textarea name="attr_pc_notes_two"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="col col2">
                                <div class="sheet-container-panel sheet-pc-notes-three">
                                    <div class="sheet-container-header">
                                        <input type="text" name="attr_notes_three_header" placeholder="Allies & Organisations" value="Allies & Organisations">
                                    </div>
                                    <div class="sheet-container-body">
                                        <textarea name="attr_pc_notes_three"></textarea>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-pc-notes-four">
                                    <div class="sheet-container-header">
                                        <input type="text" name="attr_notes_four_header" placeholder="Treasure" value="Treasure">
                                    </div>
                                    <div class="sheet-container-body">
                                        <textarea name="attr_pc_notes_four"></textarea>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-pc-notes-five">
                                    <div class="sheet-container-header">
                                        <input type="text" name="attr_notes_five_header" placeholder="Extra" value="Extra">
                                    </div>
                                    <div class="sheet-container-body">
                                        <textarea name="attr_pc_notes_five"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-page sheet-page-inventory">
                    <input type="radio" name="attr_page" value="inventory">
                    <span class="sheet-page-label">INVENTORY</span>
                    <div class="sheet-page-content">
                        <div class="sheet-container-well sheet-container-well-inventory-supplies">
                            <div class="sheet-container-bar sheet-pc-rations">
                                <div class="sheet-container-header">Rations</div>
                                <div class="sheet-container-body">
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_ration_1" title="@{ration_1}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_ration_2" title="@{ration_2}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_ration_3" title="@{ration_3}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_ration_4" title="@{ration_4}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_ration_5" title="@{ration_5}">
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-water">
                                <div class="sheet-container-header">Waterskin</div>
                                <div class="sheet-container-body">
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_waterskin_1" title="@{waterskin_1}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_waterskin_2" title="@{waterskin_2}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_waterskin_3" title="@{waterskin_3}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_waterskin_4" title="@{waterskin_4}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_waterskin_5" title="@{waterskin_5}">
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-inventory-purse">
                            <div class="sheet-container-bar sheet-pc-purse-cc">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_cc_title" title="@{cc_title}" value="COPPER">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="number" name="attr_cc" title="@{cc}">
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-purse-sc">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_sc_title" title="@{sc_title}" value="SILVER">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="number" name="attr_sc" title="@{sc}">
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-purse-gc">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_gc_title" title="@{gc_title}" value="GOLD">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="number" name="attr_gc" title="@{gc}">
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-purse-ss">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_ss_title" title="@{ss_title}" value="SPIRIT STONE">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="number" name="attr_ss" title="@{ss}">
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-purse-other1">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_currency1" title="@{currency1}" value="JADE STONE">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="number" name="attr_currency1_value" title="@{currency1_value}" >
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-purse-other2">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_currency2" title="@{currency2}" value="OTHER">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="number" name="attr_currency2_value" title="@{currency2_value}" >
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-inventory-encumberance">
                            <div class="sheet-container-panel sheet-pc-weight">
                                <div class="sheet-container-header">Weight</div>
                                <div class="sheet-container-body">
                                    <input type="text" name="attr_weighttotal" title="@{weighttotal}">
                                    <span>/</span>
                                    <span name="attr_weightmaximum" title="@{weightmaximum}"></span>
                                </div>
                                <div class="sheet-container-footer">
                                    <span>Current</span>
                                    <span>Maximum</span>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-slots">
                                <div class="sheet-container-header">Inventory Slots</div>
                                <div class="sheet-container-body">
                                    <input type="text" name="attr_slotstotal" title="@{slotstotal}">
                                    <span>/</span>
                                    <span name="attr_slotsmaximum" title="@{slotsmaximum}"></span>
                                </div>
                                <div class="sheet-container-footer">
                                    <span>Current</span>
                                    <span>Maximum</span>
                                </div>
                            </div>
                            <div class="sheet-pc-carrying-status">
                                <input type="hidden" class="sheet-pc-encumberance" name="attr_encumberance">
                                <span class="sheet-pc-unencumbered">Unencumbered</span>
                                <span class="sheet-pc-encumbered">Encumbered</span>
                                <span class="sheet-pc-heavily">Heavily encumbered</span>
                                <span class="sheet-pc-immobile">Immobile</span>
                                <span class="sheet-pc-over">Over carrying capacity</span>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-inventory-general">
                            <div class="sheet-container-panel sheet-pc-inventory-other">
                                <div class="sheet-container-header">Other Items</div>
                                <div class="sheet-container-body">
                                    <fieldset class="repeating_otheritems">
                                        <div class="sheet-fieldset-item">
                                            <div class="sheet-checkbox-cog">
                                                <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                <span class="sheet-toggle-icon"></span>
                                            </div>
                                            <input type="checkbox" name="attr_options-flag" checked="checked" hidden class="sheet-toggle">
                                            <div class="sheet-toggle-checked">
                                                <div class="sheet-form">
                                                    <div class="sheet-form-header">Edit Item</div>
                                                    <div class="sheet-form-body">
                                                        <div class="sheet-form-group">
                                                            <label>Name:</label>
                                                            <input type="text" name="attr_otheritem-name">
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <textarea name="attr_otheritem-description"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="sheet-toggle-unchecked">
                                                <div class="sheet-pc-otheritem">
                                                    <span name="attr_otheritem-name"></span><span name="attr_otheritem-description"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-inventory">
                            <div class="sheet-container-panel sheet-pc-inventory">
                                <div class="sheet-container-header">Inventory & Holdings</div>
                                <div class="sheet-container-body">
                                    <input type="hidden" name="attr_use_inventory_slots" class="sheet-toggle-slots" value="1">
                                    <fieldset class="repeating_inventory">
                                        <div class="sheet-fieldset-item">
                                            <div class="sheet-checkbox-cog">
                                                <input type="checkbox" name="attr_options-flag" checked="checked">
                                                <span class="sheet-toggle-icon"></span>
                                            </div>
                                            <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                            <div class="sheet-toggle-checked">
                                                <div class="sheet-form sheet-form-item">
                                                    <div class="sheet-form-header">Edit Item</div>
                                                    <div class="sheet-form-body">
                                                        <input type="hidden" name="attr_equipped">
                                                        <input type="hidden" name="attr_carried">
                                                        <input type="hidden" name="attr_inventorysubflag">
                                                        <div class="sheet-item-contents">
                                                            <div class="sheet-form-group">
                                                                <label>Name:</label>
                                                                <input type="text" name="attr_itemname">
                                                            </div>
                                                            <input type="checkbox" name="attr_itemcontainer" value="1" class="sheet-toggle" hidden>
                                                            <div class="sheet-toggle-unchecked">
                                                                <div class="sheet-form-group">
                                                                    <label>Quantity</label>
                                                                    <input type="number" name="attr_itemcount" value="1">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Weight:</label>
                                                                    <input type="number" name="attr_itemweight">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_itemweightfixed" value="1">
                                                                        <span>Fixed (Ignore quantity)</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Size:</label>
                                                                    <select name="attr_itemsize">
                                                                        <option value="0.2">Tiny (0.2 slots)</option>
                                                                        <option value="1" selected>Small (1 slot)</option>
                                                                        <option value="2">Medium (2 slots)</option>
                                                                        <option value="3">Large (3 slots)</option>
                                                                        <option value="6">X-Large (6 slots)</option>
                                                                        <option value="9">XX-Large (9 slots)</option>
                                                                        <option value="12">XXX-Large (12 slots)</option>
                                                                        <option value="15">XXXX-Large (15 slots)</option>
                                                                        <option value="18">XXXXX-Large (18 slots)</option>
                                                                    </select>
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_itemslotsfixed" value="1">
                                                                        <span>Fixed (Ignore quantity)</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group sheet-item-columns-2">
                                                                    <div class="sheet-form-group">
                                                                        <label>Notches:</label>
                                                                        <input type="number" name="attr_itemnotches" value="0">
                                                                    </div>
                                                                    <div class="sheet-form-group">
                                                                        <label>Quality:</label>
                                                                        <select name="attr_itemquality">
                                                                            <option value="" selected="selected"></option>
                                                                            <option value="pristine">Pristine</option>
                                                                            <option value="worn">Worn</option>
                                                                            <option value="wellworn">Well-worn</option>
                                                                            <option value="scarred">Scarred</option>
                                                                            <option value="broken">Broken</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Properties:</label>
                                                                    <input type="text" name="attr_itemproperties">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Modifiers:</label>
                                                                    <input type="text" name="attr_itemmodifiers">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Description:</label>
                                                                    <textarea name="attr_itemcontent"></textarea>
                                                                </div>
                                                            </div>
                                                            <div class="sheet-toggle-checked">
                                                                <div class="sheet-item-columns-2">
                                                                    <div class="sheet-form-group">
                                                                        <label>Type:</label>
                                                                        <select name="attr_itemcontainer_type">
                                                                            <option value="bag" selected="selected">Bag</option>
                                                                            <option value="belt">Belt</option>
                                                                            <option value="pouch">Pouch</option>
                                                                            <option value="quiver">Quiver</option>
                                                                            <option value="sheath">Sheath</option>
                                                                            <option value="stash">Stash</option>
                                                                            <option value="property">Property</option>
                                                                            <option value="vehicle">Vehicle</option>
                                                                            <option value="worn">Worn</option>
                                                                        </select>
                                                                    </div>
                                                                    <div class="sheet-form-group">
                                                                        <label>Max. Capacity (Slots):</label>
                                                                        <input type="number" name="attr_itemcontainer_slots" value="3">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="sheet-item-options">
                                                            <div class="sheet-form-group">
                                                                <label class="sheet-form-checkbox">
                                                                    <input type="checkbox" name="attr_equipped" value="1" checked="checked">
                                                                    <span>Equipped</span>
                                                                </label>
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label class="sheet-form-checkbox">
                                                                    <input type="checkbox" name="attr_carried" value="1" checked="checked">
                                                                    <span>Carried</span>
                                                                </label>
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label class="sheet-form-checkbox">
                                                                    <input type="checkbox" name="attr_itemcontainer" value="1">
                                                                    <span>Container</span>
                                                                </label>
                                                            </div>
                                                            <input type="checkbox" name="attr_itemcontainer" value="1" class="sheet-toggle" hidden>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="sheet-toggle-unchecked">
                                                <input type="checkbox" name="attr_itemcontainer" value="1" class="sheet-toggle" hidden>
                                                <div class="sheet-toggle-unchecked">
                                                    <div class="sheet-pc-item">
                                                        <div class="sheet-pc-item-header">
                                                            <span>Item Name</span>
                                                            <span>Quantity</span>
                                                            <span>Weight</span>
                                                            <span>Slots</span>
                                                            <span>Notches</span>
                                                        </div>
                                                        <div class="sheet-pc-item-content">
                                                            <span class="sheet-pc-item-name">
                                                                <input type="hidden" name="attr_equipped" value="1" class="sheet-field-toggle">
                                                                <span class="sheet-pc-item-equipped"><strong>E</strong></span>
                                                                <input type="hidden" name="attr_carried" value="1" class="sheet-field-toggle">
                                                                <span class="sheet-pc-item-carried"><strong>C</strong></span>
                                                                <span name="attr_itemname"></span>
                                                            </span>
                                                            <span class="sheet-pc-item-quantity">
                                                                <input type="text" name="attr_itemcount">
                                                            </span>
                                                            <span class="sheet-pc-item-weight">
                                                                <input type="text" name="attr_itemweight">
                                                            </span>
                                                            <span class="sheet-pc-item-slots">
                                                                <input type="text" name="attr_itemsize">
                                                            </span>
                                                            <span class="sheet-pc-item-notches">
                                                                <input type="text" name="attr_itemnotches">
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-pc-inventory-container">
                                                        <input type="hidden" name="attr_equipped" value="1" class="sheet-field-toggle">
                                                        <span class="sheet-pc-item-equipped"><strong>E</strong></span>
                                                        <input type="hidden" name="attr_carried" value="1" class="sheet-field-toggle">
                                                        <span class="sheet-pc-item-carried"><strong>C</strong></span>
                                                        <span name="attr_itemname"></span>
                                                        <span class="sheet-pc-inventory-container-slots">
                                                            (
                                                            <span name="attr_itemcontainer_type"></span>
                                                            <input type="hidden" name="attr_itemcontainer_slots" class="sheet-field-toggle">
                                                            <span>· capacity <span name="attr_itemcontainer_slots"></span></span>
                                                            <input type="hidden" name="attr_itemcontainer_slots_modifier" class="sheet-field-toggle">
                                                            <span>· extra slots <span name="attr_itemcontainer_slots_modifier"></span></span>
                                                            )
                                                        </span>
                                                    </div>
                                                    <div class="sheet-pc-inventory-container-footer">
                                                        <span>Item Name</span>
                                                        <span>Quantity</span>
                                                        <span>Weight</span>
                                                        <span>Slots</span>
                                                        <span>Notches</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-page sheet-page-options">
                    <input type="radio" name="attr_page" value="options">
                    <span class="sheet-page-label">OPTIONS</span>
                    <div class="sheet-page-content">
                        <div class="sheet-form sheet-form-inline tool-mod">
                            <div class="sheet-form-header">Tool Modifiers</div>
                            <div class="sheet-form-body">
                                <fieldset class="repeating_skillmod">
                                    <div class="sheet-fieldset-item">
                                        <div class="sheet-checkbox-cog">
                                            <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                            <span class="sheet-toggle-icon"></span>
                                        </div>
                                        <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                        <div class="sheet-toggle-checked">
                                            <div class="sheet-form">
                                                <div class="sheet-form-header">Edit Modifier</div>
                                                <div class="sheet-form-body">
                                                    <div class="sheet-form-group">
                                                        <div class="sheet-form-checkbox">
                                                            <input type="checkbox" name="attr_global_skill_active_flag" value="1">
                                                        </div>
                                                        <input type="text" name="attr_global_skill_name">
                                                    </div>
                                                    <div class="sheet-form-group">
                                                        <label>Bonus:</label>
                                                        <input type="text" name="attr_global_skill_roll">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="sheet-toggle-unchecked">
                                            <div class="sheet-pc-tool-modifier">
                                                <div class="sheet-checkbox-image">
                                                    <input type="checkbox" name="attr_global_skill_active_flag" value="1">
                                                    <span></span>
                                                </div>
                                                <span name="attr_global_skill_name"></span>
                                                <span name="attr_global_skill_roll"></span>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                        <div class="sheet-container-panel sheet-pc-option-general">
                            <div class="sheet-container-header">GENERAL OPTIONS</div>
                            <div class="sheet-container-body">
                                <div class="sheet-form sheet-form-borderless">
                                    <div class="sheet-form-body">
                                        <div class="sheet-form-group">
                                            <label>Whisper Rolls to GM:</label>
                                            <select name="attr_wtype" title="@{wtype}">
                                                <option value="">Never Whisper Rolls</option>
                                                <option value="@{whispertoggle}">Whisper Toggle</option>
                                                <option value="?{Whisper?|Public Roll,|Whisper Roll,/w gm }">Query Whisper</option>
                                                <option value="/w gm ">Always Whisper Rolls</option>
                                            </select>
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Auto Damage Roll:</label>
                                            <select name="attr_dtype" title="@{dtype}">
                                                <option value="pick">Don't Auto Roll Damage</option>
                                                <option value="full">Auto Roll Damage & Crit</option>
                                            </select>
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Add Character Name to Templates:</label>
                                            <select name="attr_charname_output" title="@{charname_output}">
                                                <option value="{{charname=@{character_name}}}">On</option>
                                                <option value="charname=@{character_name}" selected="selected">Off</option>
                                            </select>
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Carrying Capacity Modifier:</label>
                                            <input type="text" name="attr_carrying_capacity_mod" placeholder="*2/+2/-2" title="@{carrying_capacity_mod}">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Initiative Bonus:</label>
                                            <input type="text" name="attr_initiative_bonus" title="@{initiative_bonus}">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-panel sheet-pc-option-skills">
                            <div class="sheet-container-header">SKILL OPTIONS</div>
                            <div class="sheet-container-body">
                                <div class="sheet-form sheet-form-borderless">
                                    <div class="sheet-form-body">
                                        <div class="sheet-form-group">
                                            <label>Acrobatics</label>
                                            <input type="text" name="attr_acrobatics_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Athletics</label>
                                            <input type="text" name="attr_athletics_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Charm</label>
                                            <input type="text" name="attr_charm_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Deceit</label>
                                            <input type="text" name="attr_deceit_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Discretion</label>
                                            <input type="text" name="attr_discretion_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Disguise</label>
                                            <input type="text" name="attr_disguise_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Fine Arts</label>
                                            <input type="text" name="attr_fine_arts_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Forgery</label>
                                            <input type="text" name="attr_forgery_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Grapple</label>
                                            <input type="text" name="attr_grapple_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>History</label>
                                            <input type="text" name="attr_history_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Intuition</label>
                                            <input type="text" name="attr_intuition_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Intimidation</label>
                                            <input type="text" name="attr_intimidation_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Investigation</label>
                                            <input type="text" name="attr_investigation_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Medicine</label>
                                            <input type="text" name="attr_medicine_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Navigation</label>
                                            <input type="text" name="attr_navigation_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Perception</label>
                                            <input type="text" name="attr_perception_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Performance</label>
                                            <input type="text" name="attr_performance_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Persuade</label>
                                            <input type="text" name="attr_persuade_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Stealth</label>
                                            <input type="text" name="attr_stealth_flat" value="">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Survival</label>
                                            <input type="text" name="attr_survival_flat" value="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-panel sheet-pc-option-attributes">
                            <div class="sheet-container-header">ATTRIBUTE OPTIONS</div>
                            <div class="sheet-container-body">
                                <div class="sheet-form sheet-form-borderless">
                                    <div class="sheet-form-body">
                                        <div class="sheet-attribute-options">
                                            <div>
                                                <div class="sheet-container-header">ATTRIBUTE BONUS</div>
                                                <div class="sheet-form-group">
                                                    <label>Power:</label>
                                                    <input type="number" name="attr_power_bonus" title="@{power_bonus}" value="0">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Agility:</label>
                                                    <input type="number" name="attr_agility_bonus" title="@{agility_bonus}" value="0">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Vitality:</label>
                                                    <input type="number" name="attr_vitality_bonus" title="@{vitality_bonus}" value="0">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Cultivation:</label>
                                                    <input type="number" name="attr_cultivation_bonus" title="@{cultivation_bonus}" value="0">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Qi Control:</label>
                                                    <input type="number" name="attr_qicontrol_bonus" title="@{qi_control_bonus}" value="0">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Mental Strength:</label>
                                                    <input type="number" name="attr_mental_bonus" title="@{mental_bonus}" value="0">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Appearance:</label>
                                                    <input type="number" name="attr_appearance" title="@{appearance}" value="0">
                                                </div>
                                            </div>
                                            <div>
                                                <div class="sheet-container-header">ATTRIBUTE CHECK BONUS</div>
                                                <div class="sheet-form-group">
                                                    <label>Power:</label>
                                                    <input type="number" name="attr_power_check_bonus" title="@{power_check_bonus}" value="0">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Agility:</label>
                                                    <input type="number" name="attr_agility_check_bonus" title="@{agility_check_bonus}" value="0">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Vitality:</label>
                                                    <input type="number" name="attr_vitality_check_bonus" title="@{vitality_check_bonus}" value="0">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Cultivation:</label>
                                                    <input type="number" name="attr_cultivation_check_bonus" title="@{cultivation_check_bonus}" value="0">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Qi Control:</label>
                                                    <input type="number" name="attr_qicontrol_check_bonus" title="@{qicontrol_check_bonus}" value="0">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Mental Strength:</label>
                                                    <input type="number" name="attr_mental_check_bonus" title="@{mental_check_bonus}" value="0">
                                                </div>
                                            </div>
                                            <div>
                                                <div class="sheet-container-header">ATTRIBUTE DC BONUS</div>
                                                <div class="sheet-form-group">
                                                    <label>Power:</label>
                                                    <input type="number" name="attr_power_dc_bonus" title="@{power_dc_bonus}" value="0">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Agility:</label>
                                                    <input type="number" name="attr_agility_dc_bonus" title="@{agility_dc_bonus}" value="0">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Vitality:</label>
                                                    <input type="number" name="attr_vitality_dc_bonus" title="@{vitality_dc_bonus}" value="0">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Cultivation:</label>
                                                    <input type="number" name="attr_cultivation_dc_bonus" title="@{cultivation_dc_bonus}" value="0">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Qi Control:</label>
                                                    <input type="number" name="attr_qi_control_dc_bonus" title="@{qi_control_dc_bonus}" value="0">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Mental Strength:</label>
                                                    <input type="number" name="attr_mental_strength_bonus" dc_title="@{mental_strength_dc_bonus}" value="0">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-panel sheet-pc-option-global">
                            <div class="sheet-container-header">GLOBAL MODIFIERS</div>
                            <div class="sheet-container-body">
                                <div class="sheet-form sheet-form-borderless">
                                    <div class="sheet-form-body">
                                        <div class="sheet-form-group">
                                            <label>Global Attribute Modifier:</label>
                                            <input type="text" name="attr_global_attribute_mod" title="@{global_attribute_mod}">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Global DC Modifier:</label>
                                            <input type="text" name="attr_global_dc_mod" title="@{global_dc_mod}">
                                        </div>
                                        <div class="sheet-form-group">
                                            <label>Global Skill Modifier:</label>
                                            <input type="text" name="attr_global_skill_mod" title="@{global_skill_mod}">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="sheet-main-footer">
            <p>Venator Ignis's JTTH Character Sheet</p>
        </div>
    </div>

    <div class="sheet-variables">
        <input type="hidden" name="attr_initiative_bonus" value="0">
        
        <input type="hidden" name="attr_power" value="0">
        <input type="hidden" name="attr_agility" value="0">
        <input type="hidden" name="attr_vitality" value="0">
        <input type="hidden" name="attr_cultivation" value="0">
        <input type="hidden" name="attr_qicontrol" value="0">
        <input type="hidden" name="attr_mental" value="0">
        <input type="hidden" name="attr_appearance" value="0">

        <input type="hidden" name="attr_global_skill_bonus" value="0">

        <input type="hidden" name="acrobatics_bonus" value="0">
        <input type="hidden" name="athletics_bonus" value="0">
        <input type="hidden" name="charm_bonus" value="0">
        <input type="hidden" name="deceit_bonus" value="0">
        <input type="hidden" name="discretion_bonus" value="0">
        <input type="hidden" name="disguise_bonus" value="0">
        <input type="hidden" name="fine_arts_bonus" value="0">
        <input type="hidden" name="forgery_bonus" value="0">
        <input type="hidden" name="grapple_bonus" value="0">
        <input type="hidden" name="history_bonus" value="0">
        <input type="hidden" name="intuition_bonus" value="0">
        <input type="hidden" name="intimidation_bonus" value="0">
        <input type="hidden" name="investigation_bonus" value="0">
        <input type="hidden" name="medicine_bonus" value="0">
        <input type="hidden" name="navigation_bonus" value="0">
        <input type="hidden" name="perception_bonus" value="0">
        <input type="hidden" name="performance_bonus" value="0">
        <input type="hidden" name="persuade_bonus" value="0">
        <input type="hidden" name="stealth_bonus" value="0">
        <input type="hidden" name="survival_bonus" value="0">

        <input type="hidden" name="acrobatics_roll" value="0">
        <input type="hidden" name="athletics_roll" value="0">
        <input type="hidden" name="charm_roll" value="0">
        <input type="hidden" name="deceit_roll" value="0">
        <input type="hidden" name="discretion_roll" value="0">
        <input type="hidden" name="disguise_roll" value="0">
        <input type="hidden" name="fine_arts_roll" value="0">
        <input type="hidden" name="forgery_roll" value="0">
        <input type="hidden" name="grapple_roll" value="0">
        <input type="hidden" name="history_roll" value="0">
        <input type="hidden" name="intuition_roll" value="0">
        <input type="hidden" name="intimidation_roll" value="0">
        <input type="hidden" name="investigation_roll" value="0">
        <input type="hidden" name="medicine_roll" value="0">
        <input type="hidden" name="navigation_roll" value="0">
        <input type="hidden" name="perception_roll" value="0">
        <input type="hidden" name="performance_roll" value="0">
        <input type="hidden" name="persuade_roll" value="0">
        <input type="hidden" name="stealth_roll" value="0">
        <input type="hidden" name="survival_roll" value="0">

        <input type="hidden" name="attr_global_damage_mod_type" value="none">
        <input type="hidden" name="attr_global_attack_mod" value="0">
        <input type="hidden" name="attr_cultivator_global_damage_mod_type" value="none">
        <input type="hidden" name="attr_cultivator_global_attack_mod" value="0">
    </div>

    <div class="sheet-rolltemplates">
        <rolltemplate class="sheet-rolltemplate-atk">
            <div class="container">
                <div class="result">
                    <div class="adv">
                        <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                    </div>
                    <div class="advspacer"></div>
                    <div class="adv">
                        <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                    </div>
                </div>
                {{#range}}
                    <div class="sublabel">
                        <span>{{range}}</span>
                    </div>
                {{/range}}
                <div class="label">
                    <span>{{rname}}<span>({{mod}})</span></span>
                </div>
                {{#charname}}
                    <div class="charname">
                        <span>{{charname}}</span>
                    </div>
                {{/charname}}
            </div>
            {{#desc}}
                <div class="desc info">
                    <span>
                        <span class="top"></span><span class="middle">{{desc}}</span><span class="bottom"></span>
                    </span>
                </div>
            {{/desc}}
        </rolltemplate>

        <rolltemplate class="sheet-rolltemplate-atkdmg">
            {{#attack}}
                <div class="container atk">
                    <div class="result">
                        {{#always}}
                            <div class="adv">
                                <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                            </div>
                        {{/always}}
                        {{#normal}}
                            <div class="solo">
                                <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                            </div>
                        {{/normal}}
                        {{#advantage}}
                            {{#rollLess() r1 r2}}
                                <div class="adv">
                                    <span class="grey">{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                                </div>
                            {{/rollLess() r1 r2}}
                            {{#rollTotal() r1 r2}}
                                <div class="adv">
                                    <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                                </div>
                            {{/rollTotal() r1 r2}}
                            {{#rollGreater() r1 r2}}
                                <div class="adv">
                                    <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span class="grey">{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                                </div>
                            {{/rollGreater() r1 r2}}
                        {{/advantage}}
                        {{#disadvantage}}
                            {{#rollLess() r1 r2}}
                                <div class="adv">
                                    <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span class="grey">{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                                </div>
                            {{/rollLess() r1 r2}}
                            {{#rollTotal() r1 r2}}
                                <div class="adv">
                                    <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                                </div>
                            {{/rollTotal() r1 r2}}
                            {{#rollGreater() r1 r2}}
                                <div class="adv">
                                    <span class="grey">{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                                </div>
                            {{/rollGreater() r1 r2}}
                        {{/disadvantage}}
                    </div>
                    {{#range}}
                        <div class="sublabel">
                            <span>{{range}}</span>
                        </div>
                    {{/range}}
                    <div class="label">
                        <span>{{rname}}{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}}{{#attack}} <span>({{mod}})</span>{{/attack}}</span>
                    </div>
                    {{#charname}}
                        <div class="charname">
                            <span>{{charname}}</span>
                        </div>
                    {{/charname}}
                </div>
            {{/attack}}
            {{#save}}
                <div class="container {{#attack}}desc{{/attack}}{{^attack}}atk{{/attack}} save">
                    <div class="savedc">
                        <span class="rolltemplate-inline">DC</span><span class="rolltemplate-inline">{{savedc}}</span>
                    </div>
                    {{#savedesc}}
                        <div class="sublabel">
                            <span>{{savedesc}}</span>
                        </div>
                    {{/savedesc}}
                    <div class="label">
                        <span class="rolltemplate-inline">{{saveattr}}</span> <span class="rolltemplate-inline">Save</span>
                    </div>
                </div>
            {{/save}}
            {{#desc}}
                <div class="desc info">
                    <span>
                        <span class="top"></span><span class="middle">{{desc}}</span><span class="bottom"></span>
                    </span>
                </div>
            {{/desc}}
            {{#globaldamage}}
                {{#^rollTotal() globaldamage 0}}
                    <div class="desc">
                        <span>
                            {{globaldamage}}
                            {{#attack}}
                                {{#normal}}
                                    {{#rollWasCrit() r1}}<span class="plus"> + </span>{{globaldamagecrit}}{{/rollWasCrit() r1}}
                                {{/normal}}
                                {{#always}}
                                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}<span class="plus"> + </span>{{globaldamagecrit}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{globaldamagecrit}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{globaldamagecrit}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                {{/always}}
                                {{#advantage}}
                                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}<span class="plus"> + </span>{{globaldamagecrit}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{globaldamagecrit}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{globaldamagecrit}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                {{/advantage}}
                                {{#disadvantage}}
                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{globaldamagecrit}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                {{/disadvantage}}
                            {{/attack}}
                        </span>
                        <span class="sublabel">{{globaldamagetype}}</span>
                    </div>
                {{/^rollTotal() globaldamage 0}}
            {{/globaldamage}}
            {{#hldmg}}
                {{#^rollTotal() hldmg 0}}
                    <div class="desc">
                        <span>
                            {{hldmg}}
                            <!-- {{#hldmgcrit}} + {{hldmgcrit}}{{/hldmgcrit}} -->
                            {{#attack}}
                                {{#normal}}
                                    {{#rollWasCrit() r1}}<span class="plus"> + </span>{{hldmgcrit}}{{/rollWasCrit() r1}}
                                {{/normal}}
                                {{#always}}
                                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}<span class="plus"> + </span>{{hldmgcrit}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{hldmgcrit}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{hldmgcrit}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                {{/always}}
                                {{#advantage}}
                                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}<span class="plus"> + </span>{{hldmgcrit}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{hldmgcrit}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{hldmgcrit}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                {{/advantage}}
                                {{#disadvantage}}
                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{hldmgcrit}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                {{/disadvantage}}
                            {{/attack}}
                        </span>
                        <span class="sublabel">{{dmg1type}}</span>
                        <div class="label">
                            <span>Higher Level Cast</span>
                        </div>
                    </div>
                {{/^rollTotal() hldmg 0}}
            {{/hldmg}}
            {{#damage}}
                <div class="container damagetemplate">
                    <div class="result">
                        {{#dmg1flag}}
                            {{^dmg2flag}}
                                <div class="solo">
                                    <span class="damage">
                                        {{dmg1}}
                                        {{#attack}}
                                            {{#normal}}
                                                {{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}
                                            {{/normal}}
                                            {{#always}}
                                                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                            {{/always}}
                                            {{#advantage}}
                                                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                            {{/advantage}}
                                            {{#disadvantage}}
                                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                            {{/disadvantage}}
                                        {{/attack}}
                                    </span>
                                    <span class="sublabel">{{dmg1type}}</span>
                                </div>
                            {{/dmg2flag}}
                        {{/dmg1flag}}
                        {{#dmg2flag}}
                            {{^dmg1flag}}
                                <div class="solo">
                                    <span class="damage">
                                        {{dmg2}}
                                        {{#attack}}
                                            {{#normal}}
                                                {{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}
                                            {{/normal}}
                                            {{#always}}
                                                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                            {{/always}}
                                            {{#advantage}}
                                                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                            {{/advantage}}
                                            {{#disadvantage}}
                                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                            {{/disadvantage}}
                                        {{/attack}}
                                    </span>
                                    <span class="sublabel">{{dmg2type}}</span>
                                </div>
                            {{/dmg1flag}}
                        {{/dmg2flag}}
                        {{#dmg1flag}}
                            {{#dmg2flag}}
                                <div class="adv">
                                    <span class="damage">
                                        {{dmg1}}
                                        {{#attack}}
                                            {{#normal}}
                                                {{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}
                                            {{/normal}}
                                            {{#always}}
                                                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                            {{/always}}
                                            {{#advantage}}
                                                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                            {{/advantage}}
                                            {{#disadvantage}}
                                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                            {{/disadvantage}}
                                        {{/attack}}
                                    </span>
                                    <span class="sublabel">{{dmg1type}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span>
                                        {{dmg2}}
                                        {{#attack}}
                                            {{#normal}}
                                                {{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}
                                            {{/normal}}
                                            {{#always}}
                                                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                            {{/always}}
                                            {{#advantage}}
                                                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                            {{/advantage}}
                                            {{#disadvantage}}
                                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                            {{/disadvantage}}
                                        {{/attack}}
                                    </span>
                                    <span class="sublabel">{{dmg2type}}</span>
                                </div>
                            {{/dmg2flag}}
                        {{/dmg1flag}}
                    </div>
                    {{^attack}}
                        {{#range}}
                            <div class="sublabel">
                                <span>{{range}}</span>
                            </div>
                        {{/range}}
                        <div class="label">
                            <span>{{rname}}</span>{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}}
                        </div>
                        {{#charname}}
                            <div class="charname">
                                <span>{{charname}}</span>
                            </div>
                        {{/charname}}
                    {{/attack}}
                </div>
            {{/damage}}
        </rolltemplate>

        <rolltemplate class="sheet-rolltemplate-desc">
            <div class="desc info">
                <span>
                    <span class="top"></span><span class="middle">{{desc}}</span><span class="bottom"></span>
                </span>
            </div>
        </rolltemplate>

        <rolltemplate class="sheet-rolltemplate-dmg">
            {{#save}}
                <div class="{{#attack}}desc{{/attack}}{{^attack}}atk{{/attack}} save">
                    <div class="savedc">
                        <span class="rolltemplate-inline">DC</span><span class="rolltemplate-inline">{{savedc}}</span>
                    </div>
                    {{#savedesc}}
                        <div class="sublabel">
                            <span>{{savedesc}}</span>
                        </div>
                    {{/savedesc}}
                    <div class="label">
                        <span class="rolltemplate-inline">{{saveattr}}</span> <span class="rolltemplate-inline">Save</span>
                    </div>
                </div>
            {{/save}}
            {{^attack}}
                {{#desc}}
                    <div class="desc info">
                        <span>
                            <span class="top"></span><span class="middle">{{desc}}</span><span class="bottom"></span>
                        </span>
                    </div>
                {{/desc}}
            {{/attack}}
            <div class="container damagetemplate">
                <div class="result">
                    {{#dmg1flag}}
                        {{^dmg2flag}}
                            <div class="solo">
                                <span class="damage">{{dmg1}}</span>
                                <span class="sublabel">{{dmg1type}}</span>
                            </div>
                        {{/dmg2flag}}
                    {{/dmg1flag}}
                    {{#dmg2flag}}
                        {{^dmg1flag}}
                            <div class="solo">
                                <span class="damage">{{dmg2}}</span>
                                <span class="sublabel">{{dmg2type}}</span>
                            </div>
                        {{/dmg1flag}}
                    {{/dmg2flag}}
                    {{#dmg1flag}}
                        {{#dmg2flag}}
                            <div class="adv">
                                <span class="damage">{{dmg1}}</span>
                                <span class="sublabel">{{dmg1type}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span class="damage">{{dmg2}}</span>
                                <span class="sublabel">{{dmg2type}}</span>
                            </div>
                        {{/dmg2flag}}
                    {{/dmg1flag}}
                </div>
                {{^attack}}
                    {{#range}}
                        <div class="sublabel" style="color: black;">
                            <span>{{range}}</span>
                        </div>
                    {{/range}}
                    <div class="label">
                        <span>{{rname}}</span>
                    </div>
                    {{#charname}}
                        <div class="charname">
                            <span>{{charname}}</span>
                        </div>
                    {{/charname}}
                {{/attack}}
            </div>
        </rolltemplate>

        <rolltemplate class="sheet-rolltemplate-npc">
            <div class="row header">
                <span>{{rname}}</span>
            </div>
            {{#name}}
                <div class="row subheader">
                    <span class="italics">{{name}}</span>
                </div>
            {{/name}}
            <div class="arrow-right"></div>
            <div class="row">
                {{#normal}}
                    <span class="italics">{{type}}: </span><span>{{r1}}</span>
                {{/normal}}
                {{#always}}
                    <span class="italics">{{type}}: </span><span>{{r1}}</span><span> | </span><span>{{r2}}</span>
                {{/always}}
                {{#advantage}}
                    {{#rollLess() r1 r2}}
                        <span class="italics">{{type}}: </span><span class="grey">{{r1}}</span><span> | </span><span>{{r2}}</span>
                    {{/rollLess() r1 r2}}
                    {{#rollTotal() r1 r2}}
                        <span class="italics">{{type}}: </span><span>{{r1}}</span><span> | </span><span>{{r2}}</span>
                    {{/rollTotal() r1 r2}}
                    {{#rollGreater() r1 r2}}
                        <span class="italics">{{type}}: </span><span>{{r1}}</span><span> | </span><span class="grey">{{r2}}</span>
                    {{/rollGreater() r1 r2}}
                {{/advantage}}
                {{#disadvantage}}
                    {{#rollLess() r1 r2}}
                        <span class="italics">{{type}}: </span><span>{{r1}}</span><span> | </span><span class="grey">{{r2}}</span>
                    {{/rollLess() r1 r2}}
                    {{#rollTotal() r1 r2}}
                        <span class="italics">{{type}}: </span><span>{{r1}}</span><span> | </span><span>{{r2}}</span>
                    {{/rollTotal() r1 r2}}
                    {{#rollGreater() r1 r2}}
                        <span class="italics">{{type}}: </span><span class="grey">{{r1}}</span><span> | </span><span>{{r2}}</span>
                    {{/rollGreater() r1 r2}}
                {{/disadvantage}}
            </div>
        </rolltemplate>

        <rolltemplate class="sheet-rolltemplate-npcaction">
            <div class="container">
                <div class="row header">
                    <span>{{rname}}</span>
                </div>
                {{#name}}
                    <div class="row subheader">
                        <span class="italics">{{name}}</span>
                    </div>
                {{/name}}
                <div class="arrow-right"></div>
                {{#attack}}
                    <div class="row">
                        {{#normal}}
                            <span class="italics">Attack: </span><span>{{r1}}</span>
                        {{/normal}}
                        {{#always}}
                            <span class="italics">Attack: </span><span>{{r1}}</span><span> | </span><span>{{r2}}</span>
                        {{/always}}
                        {{#advantage}}
                            {{#rollLess() r1 r2}}
                                <span class="italics">Attack: </span><span class="grey">{{r1}}</span><span> | </span><span>{{r2}}</span>
                            {{/rollLess() r1 r2}}
                            {{#rollTotal() r1 r2}}
                                <span class="italics">Attack: </span><span>{{r1}}</span><span> | </span><span>{{r2}}</span>
                            {{/rollTotal() r1 r2}}
                            {{#rollGreater() r1 r2}}
                                <span class="italics">Attack: </span><span>{{r1}}</span><span> | </span><span class="grey">{{r2}}</span>
                            {{/rollGreater() r1 r2}}
                        {{/advantage}}
                        {{#disadvantage}}
                            {{#rollLess() r1 r2}}
                                <span class="italics">Attack: </span><span>{{r1}}</span><span> | </span><span class="grey">{{r2}}</span>
                            {{/rollLess() r1 r2}}
                            {{#rollTotal() r1 r2}}
                                <span class="italics">Attack: </span><span>{{r1}}</span><span> | </span><span>{{r2}}</span>
                            {{/rollTotal() r1 r2}}
                            {{#rollGreater() r1 r2}}
                                <span class="italics">Attack: </span><span class="grey">{{r1}}</span><span> | </span><span>{{r2}}</span>
                            {{/rollGreater() r1 r2}}
                        {{/disadvantage}}
                    </div>
                {{/attack}}
                {{#description}}
                    <span class="desc">{{description}}</span>
                {{/description}}
            </div>
            {{#damage}}
                <div class="container dmgcontainer damagetemplate">
                    <span class="italics">Damage: </span>
                    <span>
                        {{#dmg1flag}}
                            {{dmg1}}
                            {{#normal}}
                                {{#rollWasCrit() r1}} + {{crit1}}{{/rollWasCrit() r1}}
                            {{/normal}}
                            {{#always}}
                                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}} + {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}} + {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}} + {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                            {{/always}}
                            {{#advantage}}
                                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}} + {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}} + {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}} + {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                            {{/advantage}}
                            {{#disadvantage}}
                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}} + {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                            {{/disadvantage}}
                            {{dmg1type}}
                        {{/dmg1flag}}
                        {{#dmg1flag}}{{#dmg2flag}}+{{/dmg2flag}}{{/dmg1flag}}
                        {{#dmg2flag}}
                            {{dmg2}}
                            {{#normal}}
                                {{#rollWasCrit() r1}} + {{crit2}}{{/rollWasCrit() r1}}
                            {{/normal}}
                            {{#always}}
                                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}} + {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}} + {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}} + {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                            {{/always}}
                            {{#advantage}}
                                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}} + {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}} + {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}} + {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                            {{/advantage}}
                            {{#disadvantage}}
                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}} + {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                            {{/disadvantage}}
                            {{dmg2type}}
                        {{/dmg2flag}}
                    </span>
                </div>
            {{/damage}}
        </rolltemplate>

        <rolltemplate class="sheet-rolltemplate-npcatk">
            <div class="row header">
                {{#normal}}
                    {{#rollWasCrit() r1}}{{rnamec}}{{/rollWasCrit() r1}}
                    {{#^rollWasCrit() r1}}{{rname}}{{/^rollWasCrit() r1}}
                {{/normal}}
                {{#always}}
                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}{{rnamec}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}{{rnamec}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}{{rnamec}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                    {{#^rollWasCrit() r1}}{{#^rollWasCrit() r2}}{{rname}}{{/^rollWasCrit() r2}}{{/^rollWasCrit() r1}}
                {{/always}}
                {{#advantage}}
                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}{{rnamec}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}{{rnamec}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}{{rnamec}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                    {{#^rollWasCrit() r1}}{{#^rollWasCrit() r2}}{{rname}}{{/^rollWasCrit() r2}}{{/^rollWasCrit() r1}}
                {{/advantage}}
                {{#disadvantage}}
                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}{{rnamec}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                    {{#rollTotal() r1 r2}}{{#^rollWasCrit() r1}}{{rname}}{{/^rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                    {{#rollLess() r1 r2}}{{rname}}{{/rollLess() r1 r2}}
                    {{#rollGreater() r1 r2}}{{rnamec}}{{/rollGreater() r1 r2}}
                {{/disadvantage}}
            </div>
            {{#name}}
                <div class="row subheader">
                    <span class="italics">{{name}}</span>
                </div>
            {{/name}}
            <div class="arrow-right"></div>
            <div class="row">
                {{#normal}}
                    {{#rollWasCrit() r1}}<span class="italics">{{typec}}: </span>{{/rollWasCrit() r1}}
                    {{#^rollWasCrit() r1}}<span class="italics">{{type}}: </span>{{/^rollWasCrit() r1}}
                {{/normal}}
                {{#always}}
                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}<span class="italics">{{typec}}: </span>{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="italics">{{typec}}: </span>{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}<span class="italics">{{typec}}: </span>{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                    {{#^rollWasCrit() r1}}{{#^rollWasCrit() r2}}<span class="italics">{{type}}: </span>{{/^rollWasCrit() r2}}{{/^rollWasCrit() r1}}
                {{/always}}
                {{#advantage}}
                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}<span class="italics">[{{typec}}: </span>{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="italics">{{typec}}: </span>{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}<span class="italics">{{typec}}: </span>{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                    {{#^rollWasCrit() r1}}{{#^rollWasCrit() r2}}<span class="italics">{{type}}: </span>{{/^rollWasCrit() r2}}{{/^rollWasCrit() r1}}
                {{/advantage}}
                {{#disadvantage}}
                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="italics">{{typec}}: </span>{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                    {{#rollTotal() r1 r2}}{{#^rollWasCrit() r1}}<span class="italics">{{type}}: </span>{{/^rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                    {{#rollLess() r1 r2}}<span class="italics">{{type}}: </span>{{/rollLess() r1 r2}}
                    {{#rollGreater() r1 r2}}<span class="italics">{{typec}}: </span>{{/rollGreater() r1 r2}}
                {{/disadvantage}}
                {{#normal}}
                    <span>{{r1}}</span>
                {{/normal}}
                {{#always}}
                    <span>{{r1}}</span><span> | </span><span>{{r2}}</span>
                {{/always}}
                {{#advantage}}
                    {{#rollLess() r1 r2}}
                        <span class="grey">{{r1}}</span><span> | </span><span>{{r2}}</span>
                    {{/rollLess() r1 r2}}
                    {{#rollTotal() r1 r2}}
                        <span>{{r1}}</span><span> | </span><span>{{r2}}</span>
                    {{/rollTotal() r1 r2}}
                    {{#rollGreater() r1 r2}}
                        <span>{{r1}}</span><span> | </span><span class="grey">{{r2}}</span>
                    {{/rollGreater() r1 r2}}
                {{/advantage}}
                {{#disadvantage}}
                    {{#rollLess() r1 r2}}
                        <span>{{r1}}</span><span> | </span><span class="grey">{{r2}}</span>
                    {{/rollLess() r1 r2}}
                    {{#rollTotal() r1 r2}}
                        <span>{{r1}}</span><span> | </span><span>{{r2}}</span>
                    {{/rollTotal() r1 r2}}
                    {{#rollGreater() r1 r2}}
                        <span class="grey">{{r1}}</span><span> | </span><span>{{r2}}</span>
                    {{/rollGreater() r1 r2}}
                {{/disadvantage}}
            </div>
            {{#description}}
                <div class="row">
                    <span class="desc">{{description}}</span>
                </div>
            {{/description}}
        </rolltemplate>

        <rolltemplate class="sheet-rolltemplate-npcdmg">
            <div class="container dmgcontainer damagetemplate">
                <span class="italics">Damage: </span>
                <span>
                    {{#dmg1flag}}
                        {{dmg1}}{{#crit}} + {{crit1}}{{/crit}}{{dmg1type}}
                    {{/dmg1flag}}
                    {{#dmg1flag}}{{#dmg2flag}}+{{/dmg2flag}}{{/dmg1flag}}
                    {{#dmg2flag}}
                        {{dmg2}}{{#crit}} + {{crit2}}{{/crit}}{{dmg2type}}
                    {{/dmg2flag}}
                </span>
            </div>
        </rolltemplate>

        <rolltemplate class="sheet-rolltemplate-simple">
            <div class="container">
                <div class="result">
                    {{#always}}
                        <div class="adv">
                            <span>{{r1}}{{#global}} + {{global}}{{/global}}</span>
                        </div>
                        <div class="advspacer"></div>
                        <div class="adv">
                            <span>{{r2}}{{#global}} + {{global}}{{/global}}</span>
                        </div>
                    {{/always}}
                    {{#normal}}
                        <div class="solo">
                            <span>{{r1}}{{#global}} + {{global}}{{/global}}</span>
                        </div>
                    {{/normal}}
                    {{#advantage}}
                        {{#rollLess() r1 r2}}
                            <div class="adv">
                                <span class="grey">{{r1}}{{#global}} + {{global}}{{/global}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span>{{r2}}{{#global}} + {{global}}{{/global}}</span>
                            </div>
                        {{/rollLess() r1 r2}}
                        {{#rollTotal() r1 r2}}
                            <div class="adv">
                                <span>{{r1}}{{#global}} + {{global}}{{/global}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span>{{r2}}{{#global}} + {{global}}{{/global}}</span>
                            </div>
                        {{/rollTotal() r1 r2}}
                        {{#rollGreater() r1 r2}}
                            <div class="adv">
                                <span>{{r1}}{{#global}} + {{global}}{{/global}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span class="grey">{{r2}}{{#global}} + {{global}}{{/global}}</span>
                            </div>
                        {{/rollGreater() r1 r2}}
                    {{/advantage}}
                    {{#disadvantage}}
                        {{#rollLess() r1 r2}}
                            <div class="adv">
                                <span>{{r1}}{{#global}} + {{global}}{{/global}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span class="grey">{{r2}}{{#global}} + {{global}}{{/global}}</span>
                            </div>
                        {{/rollLess() r1 r2}}
                        {{#rollTotal() r1 r2}}
                            <div class="adv">
                                <span>{{r1}}{{#global}} + {{global}}{{/global}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span>{{r2}}{{#global}} + {{global}}{{/global}}</span>
                            </div>
                        {{/rollTotal() r1 r2}}
                        {{#rollGreater() r1 r2}}
                            <div class="adv">
                                <span class="grey">{{r1}}{{#global}} + {{global}}{{/global}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span>{{r2}}{{#global}} + {{global}}{{/global}}</span>
                            </div>
                        {{/rollGreater() r1 r2}}
                    {{/disadvantage}}
                </div>
                <div class="label">
                    <span>{{rname}}{{#mod}} <span>({{mod}})</span>{{/mod}}</span>
                </div>
                {{#charname}}
                    <div class="charname">
                        <span>{{charname}}</span>
                    </div>
                {{/charname}}
            </div>
        </rolltemplate>

        <rolltemplate class="sheet-rolltemplate-spell">
            <div class="container">
                <div class="title row">
                    <span>{{name}}</span>{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}}
                </div>
                <div class="italics row">
                    <span>{{level}}{{#ritual}} (<span></span>){{/ritual}}</span>
                </div>
                <div class="spacer"></div>
                {{#castingtime}}
                    <div class="row">
                        <span class="bold">Casting Time:</span> <span>{{castingtime}}</span>
                    </div>
                {{/castingtime}}
                {{#range}}
                    <div class="row">
                        <span class="bold">Range:</span> <span>{{range}}</span>
                    </div>
                {{/range}}
                {{#target}}
                    <div class="row">
                        <span class="bold">Target:</span> <span>{{target}}</span>
                    </div>
                {{/target}}
                <div class="row">
                    <span class="bold">Components:</span>
                    <span>
                        {{#v}}V{{#s}}, {{/s}}{{^s}}{{#m}}, {{/m}}{{/s}}{{/v}}
                        {{#s}}S{{#m}}, {{/m}}{{/s}}
                        {{#m}}M {{#material}}({{material}}){{/material}}{{/m}}
                    </span>
                </div>
                {{#duration}}
                    <div class="row">
                        <span class="bold">Duration:</span> <span>{{#concentration}}<span>Concentration</span> {{/concentration}}{{duration}}</span>
                    </div>
                {{/duration}}
                <div class="spacer"></div>
                {{#description}}
                    <div class="row">
                        <span class="description">{{description}}</span>
                    </div>
                {{/description}}
                {{#athigherlevels}}
                    <div class="row">
                        <span class="bold italics">At Higher Levels</span>. <span class="description">{{athigherlevels}}</span>
                    </div>
                {{/athigherlevels}}
            </div>
        </rolltemplate>

        <rolltemplate class="sheet-rolltemplate-traits">
            <div class="row header">
                <span>{{name}}</span>
            </div>
            {{#source}}
            <div class="row subheader">
                <span class="italics">{{#charname}}{{charname}} {{/charname}}{{source}}</span>
            </div>
            {{/source}}
            {{#description}}
                <div class="row">
                    <span class="desc">{{description}}</span>
                </div>
            {{/description}}
        </rolltemplate>
    </div>

    <script type="text/worker">
        ['power', 'agility', 'vitality', 'cultivation', 'qicontrol', 'mental', 'appearance'].forEach(attr => {
            on(`change:${attr}_base change:${attr}_bonus`, function(){
                update_attr(`${attr}`);
            });
        });

        ['power', 'agility', 'vitality', 'cultivation', 'qicontrol', 'mental', 'appearance'].forEach(attr => {
            on(`change:${attr}`, function() {
                update_mortalattacks(`${attr}`);
                update_cultivatorattacks(`${attr}`);
                update_tool(`${attr}`);
                switch (`${attr}`) {
                    case "power":
                        update_weight()
                        update_skills(["athletics", "grapple", "intimidation","survival"]);
                        break;
                    case "agility":
                        update_initiative();
                        update_skills([,"acrobatics","discretion","stealth","fine_arts","forgery","navigation","performance"]);
                        break;
                    case "vitality":
                        update_skills(["", ""]);
                    case "cultivation":
                        update_skills(["", ""]);
                        break;
                    case "qicontrol":
                        update_skills(["history","medicine"]);
                        break;
                    case "mental":
                        update_skills(["charm","deceit","disguise","persuade","fine_arts","forgery","navigation","history","medicine","intuition","investigation","perception","survival"]);
                        break;
                    case "appearance":
                        update_skills(["charm","deceit","disguise","persuade","intimidation","performance"]);
                        break;
                    default:
                        false;
                }
            });
        });

        on("change:initiative_bonus", function(eventInfo){
            update_initiative();
        });

        on('change:mortal-level', function(eventInfo){
            ['power', 'agility', 'vitality', 'cultivation', 'qicontrol', 'mental', 'appearance'].forEach(attr => {
                update_attr(`${attr}`);
            });
        });

        on("change:repeating_inventory:itemmodifiers change:repeating_inventory:equipped change:repeating_inventory:carried", function(eventinfo) {
            if (eventinfo.sourceType && eventinfo.sourceType === "sheetworker") {
                return;
            }
            var itemid = eventinfo.sourceAttribute.substring(20, 40);
            getAttrs(["repeating_inventory_" + itemid + "_itemmodifiers"], function(v) {
                if (v["repeating_inventory_" + itemid + "_itemmodifiers"]) {
                    check_itemmodifiers(v["repeating_inventory_" + itemid + "_itemmodifiers"], eventinfo.previousValue);
                };
            });
        });

        on("change:repeating_inventory:itemcontainer change:repeating_inventory:equipped change:repeating_inventory:carried change:repeating_inventory:itemweight change:repeating_inventory:itemcount change:encumberance_setting change:size change:carrying_capacity_mod change:use_inventory_slots change:inventory_slots_mod change:repeating_inventory:itemweightfixed change:repeating_inventory:itemslotsfixed change:repeating_inventory:itemsize change:repeating_inventory:itemcontainer_slots change:repeating_inventory:itemcontainer_slots_modifier", function() {
            update_weight();
        });

        on("change:acrobatics_flat change:athletics_flat change:charm_flat change:deceit_flat change:disguise_flat change:fine_arts_flat change:forgery_flat change:grapple_flat change:history_flat change:intuition_flat change:intimidation_flat change:investigation_flat change:medicine_flat change:navigation_flat change:perception_flat change:performance_flat change:persuade_flat change:discretion_flat change:stealth_flat change:survival_flat", function(eventinfo) {
            update_skills(["acrobatics","athletics","charm","deceit","discretion","disguise","fine_arts","forgery","grapple","history","intuition","intimidation","investigation","medicine","navigation","perception","performance","persuade","stealth","survival"]);
        });

        on("change:repeating_mortalattack:atkname change:repeating_mortalattack:atkflag change:repeating_mortalattack:atkattr_base change:repeating_mortalattack:atkmod change:repeating_mortalattack:dmgflag change:repeating_mortalattack:dmgbase change:repeating_mortalattack:dmgattr change:repeating_mortalattack:dmgmod change:repeating_mortalattack:dmgtype change:repeating_mortalattack:dmg2flag change:repeating_mortalattack:dmg2base change:repeating_mortalattack:dmg2attr change:repeating_mortalattack:dmg2mod change:repeating_mortalattack:dmg2type change:repeating_mortalattack:saveflag change:repeating_mortalattack:savedc change:repeating_mortalattack:saveflat change:repeating_mortalattack:saveattr change:repeating_mortalattack:atkrange", function(eventinfo) {
            if (eventinfo.sourceType === "sheetworker") {
                return;
            }

            var attackid = eventinfo.sourceAttribute.substring(23, 43);
            update_mortalattacks(attackid);
        });

        on("change:repeating_mortaldamagemod remove:repeating_mortaldamagemod", function(eventinfo) {
            update_mortalglobaldamage();
        });

        on("change:repeating_mortaltohitmod remove:repeating_mortaltohitmod", function(eventinfo) {
            update_mortalglobalattack();
        });

        on("change:repeating_cultivatorattack:atkname change:repeating_cultivatorattack:atkflag change:repeating_cultivatorattack:atkattr_base change:repeating_cultivatorattack:atkmod change:repeating_cultivatorattack:dmgflag change:repeating_cultivatorattack:dmgbase change:repeating_cultivatorattack:dmgattr change:repeating_cultivatorattack:dmgmod change:repeating_cultivatorattack:dmgtype change:repeating_cultivatorattack:dmg2flag change:repeating_cultivatorattack:dmg2base change:repeating_cultivatorattack:dmg2attr change:repeating_cultivatorattack:dmg2mod change:repeating_cultivatorattack:dmg2type change:repeating_cultivatorattack:saveflag change:repeating_cultivatorattack:savedc change:repeating_cultivatorattack:saveflat change:repeating_cultivatorattack:saveattr change:repeating_cultivatorattack:atkrange", function(eventinfo) {
            if (eventinfo.sourceType === "sheetworker") {
                return;
            }

            var attackid = eventinfo.sourceAttribute.substring(27, 47);
            update_cultivatorattacks(attackid);
        });

        on("change:repeating_cultivatordamagemod remove:repeating_cultivatordamagemod", function(eventinfo) {
            update_cultivatorglobaldamage();
        });

        on("change:repeating_cultivatortohitmod remove:repeating_cultivatortohitmod", function(eventinfo) {
            update_cultivatorglobalattack();
        });

        on("change:global_damage_mod_flag", function(eventinfo) {
            getSectionIDs("mortaldamagemod", function(ids) {
                var update = {};
                if (eventinfo.newValue === "1") {
                    if (!ids || ids.length === 0) {
                        var rowid = generateRowID();
                        update[`repeating_mortaldamagemod_${rowid}_global_damage_active_flag`] = "1";
                    }
                } else {
                    _.each(ids, function(rowid) {
                        update[`repeating_mortaldamagemod_${rowid}_global_damage_active_flag`] = "0";
                    });
                }
                setAttrs(update);
            });
        });

        on("change:dtype", function(eventinfo) {
            if (eventinfo.sourceType && eventinfo.sourceType === "sheetworker") {
                return;
            }
            update_mortalattacks("all");
            update_cultivatorattacks("all");
        });

        on("change:durability-base change:durability-limit change:durability-bonus", function(eventinfo) {
            update_durability();
        });

        on("change:evasion-base change:evasion-limit change:evasion-bonus", function(eventinfo) {
            update_evasion();
        });

        on("change:reduction-base change:reduction-armour change:reduction-bonus", function(eventinfo) {
            update_reduction();
        });

        on("remove:repeating_inventory", function(eventinfo) {
            var itemid = eventinfo.sourceAttribute.substring(20, 40);

            if (eventinfo.removedInfo && eventinfo.removedInfo["repeating_inventory_" + itemid + "_itemmodifiers"]) {
                check_itemmodifiers(eventinfo.removedInfo["repeating_inventory_" + itemid + "_itemmodifiers"]);
            }

            update_weight();
        });

        var check_itemmodifiers = function(modifiers, previousValue) {
            var mods = modifiers.toLowerCase().split(",");
            if (previousValue) {
                prevmods = previousValue.toLowerCase().split(",");
                mods = _.union(mods, prevmods);
            };
            _.each(mods, function(mod) {
                if (mod.indexOf("power") > -1) {
                    update_attr("power");
                };
                if (mod.indexOf("agility") > -1) {
                    update_attr("agility");
                };
                if (mod.indexOf("vitality") > -1) {
                    update_attr("vitality");
                };
                if (mod.indexOf("cultivation") > -1) {
                    update_attr("cultivation");
                };
                if (mod.indexOf("qicontrol") > -1) {
                    update_attr("qicontrol");
                };
                if (mod.indexOf("mental") > -1) {
                    update_attr("mental");
                };
                if (mod.indexOf("skill checks") > -1) {
                    update_all_skill_checks();
                };
                if (mod.indexOf("acrobatics") > -1) {
                    update_skills(["acrobatics"]);
                };
                if (mod.indexOf("athletics") > -1) {
                    update_skills(["athletics"]);
                };
                if (mod.indexOf("charm") > -1) {
                    update_skills(["charm"]);
                };
                if (mod.indexOf("deceit") > -1) {
                    update_skills(["deceit"]);
                };
                if (mod.indexOf("discretion") > -1) {
                    update_skills(["discretion"]);
                };
                if (mod.indexOf("disguise") > -1) {
                    update_skills(["disguise"]);
                };
                if (mod.indexOf("fine_arts") > -1) {
                    update_skills(["fine_arts"]);
                };
                if (mod.indexOf("forgery") > -1) {
                    update_skills(["forgery"]);
                };
                if (mod.indexOf("grapple") > -1) {
                    update_skills(["grapple"]);
                };
                if (mod.indexOf("history") > -1) {
                    update_skills(["history"]);
                };
                if (mod.indexOf("intuition") > -1) {
                    update_skills(["intuition"]);
                };
                if (mod.indexOf("intimidation") > -1) {
                    update_skills(["intimidation"]);
                };
                if (mod.indexOf("investigation") > -1) {
                    update_skills(["investigation"]);
                };
                if (mod.indexOf("medicine") > -1) {
                    update_skills(["medicine"]);
                };
                if (mod.indexOf("navigation") > -1) {
                    update_skills(["navigation"]);
                };
                if (mod.indexOf("perception") > -1) {
                    update_skills(["perception"]);
                };
                if (mod.indexOf("performance") > -1) {
                    update_skills(["performance"]);
                };
                if (mod.indexOf("persuade") > -1) {
                    update_skills(["persuade"]);
                };
                if (mod.indexOf("stealth") > -1) {
                    update_skills(["stealth"]);
                };
                if (mod.indexOf("survival") > -1) {
                    update_skills(["survival"]);
                };
            });
        };

        var update_attr = function(attr) {
            var update = {};
            var attr_fields = [attr + "_base", attr + "_bonus", attr + "_dc_bonus", "global_dc_mod", "mortal-level"];
            getSectionIDs("repeating_inventory", function(idarray) {
                _.each(idarray, function(currentID, i) {
                    attr_fields.push("repeating_inventory_" + currentID + "_equipped");
                    attr_fields.push("repeating_inventory_" + currentID + "_itemmodifiers");
                });
                getAttrs(attr_fields, function(v) {
                    var base = v[attr + "_base"] && !isNaN(parseInt(v[attr + "_base"], 10)) ? parseInt(v[attr + "_base"], 10) : 10;
                    var bonus = v[attr + "_bonus"] && !isNaN(parseInt(v[attr + "_bonus"], 10)) ? parseInt(v[attr + "_bonus"], 10) : 0;
                    var global_dc_mod = v["global_dc_bonus"] && !isNaN(parseInt(v["global_dc_bonus"], 10)) ? parseInt(v["global_dc_bonus"], 10) : 0;
                    var attr_dc_bonus = v[attr + "_dc_bonus"] && !isNaN(parseInt(v[attr + "_dc_bonus"], 10)) ? parseInt(v[attr + "_dc_bonus"], 10) : 0;
                    var level = v["mortal-level"] && !isNaN(parseInt(v["mortal-level"], 10)) ? parseInt(v["mortal-level"], 10) : 0;
                    var item_base = 0;
                    var item_bonus = 0;
                    _.each(idarray, function(currentID) {
                        if ((!v["repeating_inventory_" + currentID + "_equipped"] || v["repeating_inventory_" + currentID + "_equipped"] === "1") && v["repeating_inventory_" + currentID + "_itemmodifiers"] && v["repeating_inventory_" + currentID + "_itemmodifiers"].toLowerCase().indexOf(attr > -1)) {
                            var mods = v["repeating_inventory_" + currentID + "_itemmodifiers"].toLowerCase().split(",");
                            _.each(mods, function(mod) {
                                if (mod.indexOf(attr) > -1) {
                                    if (mod.indexOf(":") > -1) {
                                        var new_base = !isNaN(parseInt(mod.replace(/[^0-9]/g, ""), 10)) ? parseInt(mod.replace(/[^0-9]/g, ""), 10) : false;
                                        item_base = new_base && new_base > item_base ? new_base : item_base;
                                    } else if (mod.indexOf("-") > -1) {
                                        var new_mod = !isNaN(parseInt(mod.replace(/[^0-9]/g, ""), 10)) ? parseInt(mod.replace(/[^0-9]/g, ""), 10) : false;
                                        item_bonus = new_mod ? item_bonus - new_mod : item_bonus;
                                    } else {
                                        var new_mod = !isNaN(parseInt(mod.replace(/[^0-9]/g, ""), 10)) ? parseInt(mod.replace(/[^0-9]/g, ""), 10) : false;
                                        item_bonus = new_mod ? item_bonus + new_mod : item_bonus;
                                    }
                                };
                            });
                        }
                    });

                    update[attr + "_flag"] = bonus != 0 || item_bonus > 0 || item_base > base ? 1 : 0;
                    base = base > item_base ? base : item_base;
                    finalattr = base + bonus + item_bonus;

                    var finaldc = Math.floor(finalattr * (3.5 + Math.floor(level / 7))) + global_dc_mod + attr_dc_bonus;
                    update[attr + "_dc"] = finaldc;
                    update[attr] = finalattr
                    setAttrs(update);
                });
            });
        };

        var update_initiative = function() {
            var attrs_to_get = ["agility", "initiative_bonus"];
            getSectionIDs("repeating_inventory", function(idarray) {
                _.each(idarray, function(currentID, i) {
                    attrs_to_get.push("repeating_inventory_" + currentID + "_equipped");
                    attrs_to_get.push("repeating_inventory_" + currentID + "_itemmodifiers");
                });
                getAttrs(attrs_to_get, function(v) {
                    var update = {};
                    var agility = parseInt(v.agility) || 0;
                    var final_init = parseInt(v["dexterity_mod"], 10);
                    if (v["initiative_bonus"] && !isNaN(parseInt(v["initiative_bonus"], 10))) {
                        final_init = final_init + parseInt(v["initiative_bonus"], 10);
                    }
                    _.each(idarray, function(currentID) {
                        if (v["repeating_inventory_" + currentID + "_equipped"] && v["repeating_inventory_" + currentID + "_equipped"] === "1" && v["repeating_inventory_" + currentID + "_itemmodifiers"] && v["repeating_inventory_" + currentID + "_itemmodifiers"].toLowerCase().indexOf("initiative") > -1) {
                            var mods = v["repeating_inventory_" + currentID + "_itemmodifiers"].toLowerCase().split(",");
                            _.each(mods, function(mod) {
                                if (mod.indexOf("initiative") > -1) {
                                    if (mod.indexOf("-") > -1) {
                                        var new_mod = !isNaN(parseInt(mod.replace(/[^0-9]/g, ""), 10)) ? parseInt(mod.replace(/[^0-9]/g, ""), 10) : false;
                                        final_init = new_mod ? final_init - new_mod : final_init;
                                    } else {
                                        var new_mod = !isNaN(parseInt(mod.replace(/[^0-9]/g, ""), 10)) ? parseInt(mod.replace(/[^0-9]/g, ""), 10) : false;
                                        final_init = new_mod ? final_init + new_mod : final_init;
                                    }
                                }
                            });
                        }
                    });
                    if (final_init % 1 != 0) {
                        final_init = parseFloat(final_init.toPrecision(12));
                    }
                    update["initiative"] = agility + (parseInt(v.final_init) ? `d6 + ${parseInt(v.final_init)}` : 'd6');
                    setAttrs(update, {
                        silent: true
                    });
                });
            });
        };

        var update_mortalattacks = function(update_id, source) {
            console.log("DOING UPDATE_ATTACKS: " + update_id);
            if (update_id.substring(0, 1) === "-" && update_id.length === 20) {
                do_update_mortalattack([update_id], source);
            } else if (["power", "agility", "vitality", "cultivation", "qicontrol", "mental", "all"].indexOf(update_id) > -1) {
                getSectionIDs("repeating_mortalattack", function(idarray) {
                    if (update_id === "all") {
                        do_update_mortalattack(idarray);
                    } else {
                        var attack_attribs = [];
                        _.each(idarray, function(id) {
                            attack_attribs.push("repeating_attack_" + id + "_atkattr_base");
                            attack_attribs.push("repeating_attack_" + id + "_dmgattr");
                            attack_attribs.push("repeating_attack_" + id + "_dmg2attr");
                            attack_attribs.push("repeating_attack_" + id + "_savedc");
                        });
                        getAttrs(attack_attribs, function(v) {
                            var attr_attack_ids = [];
                            _.each(idarray, function(id) {
                                if ((v["repeating_attack_" + id + "_atkattr_base"] && v["repeating_attack_" + id + "_atkattr_base"].indexOf(update_id) > -1) || (v["repeating_attack_" + id + "_dmgattr"] && v["repeating_attack_" + id + "_dmgattr"].indexOf(update_id) > -1) || (v["repeating_attack_" + id + "_dmg2attr"] && v["repeating_attack_" + id + "_dmg2attr"].indexOf(update_id) > -1) || (v["repeating_attack_" + id + "_savedc"] && v["repeating_attack_" + id + "_savedc"].indexOf(update_id) > -1)) {
                                    attr_attack_ids.push(id);
                                }
                            });
                            if (attr_attack_ids.length > 0) {
                                do_update_mortalattack(attr_attack_ids);
                            }
                        });
                    };
                });
            };
        };

        var do_update_mortalattack = function(attack_array, source) {
            var attack_attribs = ["level", "dtype", "power", "agility", "vitality", "cultivation", "qicontrol", "mental", "global_damage_mod_roll", "global_damage_mod_type"];
            _.each(attack_array, function(attackid) {
                attack_attribs.push("repeating_mortalattack_" + attackid + "_atkflag");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_atkname");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_atkattr_base");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_atkmod");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_dmgflag");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_dmgbase");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_dmgattr");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_dmgmod");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_dmgtype");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_dmg2flag");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_dmg2base");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_dmg2attr");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_dmg2mod");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_dmg2type");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_saveflag");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_savedc");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_saveeffect");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_saveflat");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_atkrange");
                attack_attribs.push("repeating_mortalattack_" + attackid + "_global_damage_mod_field");
            });

            getAttrs(attack_attribs, function(v) {
                _.each(attack_array, function(attackid) {
                    var callbacks = [];
                    var update = {};
                    var hbonus = "";
                    var hdmg1 = "";
                    var hdmg2 = "";
                    var dmg = "";
                    var dmg2 = "";
                    var rollbase = "";
                    var atkattr_abrev = "";
                    var dmgattr_abrev = "";
                    var dmg2attr_abrev = "";
                    
                    if (!v["repeating_mortalattack_" + attackid + "_atkattr_base"] || v["repeating_mortalattack_" + attackid + "_atkattr_base"] === "0") {
                        atkattr_base = 0
                    } else {
                        atkattr_base = parseInt(v[v["repeating_mortalattack_" + attackid + "_atkattr_base"].substring(2, v["repeating_mortalattack_" + attackid + "_atkattr_base"].length - 1)], 10);
                        atkattr_abrev = v["repeating_mortalattack_" + attackid + "_atkattr_base"].substring(2, v["repeating_mortalattack_" + attackid + "_atkattr_base"].length - 1).toUpperCase();
                    };

                    if (!v["repeating_mortalattack_" + attackid + "_dmgattr"] || v["repeating_mortalattack_" + attackid + "_dmgattr"] === "0") {
                        dmgattr = 0;
                    } else {
                        dmgattr = parseInt(v[v["repeating_mortalattack_" + attackid + "_dmgattr"].substring(2, v["repeating_mortalattack_" + attackid + "_dmgattr"].length - 1)], 10);
                        dmgattr_abrev = v["repeating_mortalattack_" + attackid + "_dmgattr"].substring(2, v["repeating_mortalattack_" + attackid + "_dmgattr"].length - 1).toUpperCase();
                    };

                    if (!v["repeating_mortalattack_" + attackid + "_dmg2attr"] || v["repeating_mortalattack_" + attackid + "_dmg2attr"] === "0") {
                        dmg2attr = 0;
                    } else {
                        dmg2attr = parseInt(v[v["repeating_mortalattack_" + attackid + "_dmg2attr"].substring(2, v["repeating_mortalattack_" + attackid + "_dmg2attr"].length - 1)], 10);
                        dmg2attr_abrev = v["repeating_mortalattack_" + attackid + "_dmg2attr"].substring(2, v["repeating_mortalattack_" + attackid + "_dmg2attr"].length - 1).toUpperCase();
                    };

                    var dmgbase = v["repeating_mortalattack_" + attackid + "_dmgbase"] && v["repeating_mortalattack_" + attackid + "_dmgbase"] != "" ? v["repeating_mortalattack_" + attackid + "_dmgbase"] : 0;
                    var dmg2base = v["repeating_mortalattack_" + attackid + "_dmg2base"] && v["repeating_mortalattack_" + attackid + "_dmg2base"] != "" ? v["repeating_mortalattack_" + attackid + "_dmg2base"] : 0;
                    var dmgmod = v["repeating_mortalattack_" + attackid + "_dmgmod"] && isNaN(parseInt(v["repeating_mortalattack_" + attackid + "_dmgmod"], 10)) === false ? parseInt(v["repeating_mortalattack_" + attackid + "_dmgmod"], 10) : 0;
                    var dmg2mod = v["repeating_mortalattack_" + attackid + "_dmg2mod"] && isNaN(parseInt(v["repeating_mortalattack_" + attackid + "_dmg2mod"], 10)) === false ? parseInt(v["repeating_mortalattack_" + attackid + "_dmg2mod"], 10) : 0;
                    var dmgtype = v["repeating_mortalattack_" + attackid + "_dmgtype"] ? v["repeating_mortalattack_" + attackid + "_dmgtype"] + " " : "";
                    var dmg2type = v["repeating_mortalattack_" + attackid + "_dmg2type"] ? v["repeating_mortalattack_" + attackid + "_dmg2type"] + " " : "";
                    var atkmod = v["repeating_mortalattack_" + attackid + "_atkmod"] && v["repeating_mortalattack_" + attackid + "_atkmod"] != "" ? parseInt(v["repeating_mortalattack_" + attackid + "_atkmod"], 10) : 0;

                    var mortal_globaldamage = `[[${v.global_damage_mod_roll && v.global_damage_mod_roll !== "" ? v.global_damage_mod_roll : "0"}]]`;
                    var globalDamageType = v["global_damage_mod_type"] || "";
                    var gbdmg = " + " + mortal_globaldamage + "[" + globalDamageType + "]"
                    
                    if (v["repeating_mortalattack_" + attackid + "_atkflag"] && v["repeating_mortalattack_" + attackid + "_atkflag"] != 0) {
                        bonus_mod = atkattr_base + atkmod;
                        plus_minus = bonus_mod > -1 ? "+" : "";
                        bonus = plus_minus + bonus_mod;
                    } else if (v["repeating_mortalattack_" + attackid + "_saveflag"] && v["repeating_mortalattack_" + attackid + "_saveflag"] != 0) {
                        if (v["repeating_mortalattack_" + attackid + "_savedc"] && v["repeating_mortalattack_" + attackid + "_savedc"] === "(@{saveflat})") {
                            var tempdc = isNaN(parseInt(v["repeating_mortalattack_" + attackid + "_saveflat"])) === false ? parseInt(v["repeating_mortalattack_" + attackid + "_saveflat"]) : "0";
                        } else {
                            var savedcattr = v["repeating_mortalattack_" + attackid + "_savedc"].replace(/^[^{]*{/, "").replace(/\_.*$/, "");
                            var safe_attr = v[savedcattr] ? parseInt(v[savedcattr], 10) : 0;
                            var tempdc = safe_attr;
                        };
                        bonus = "DC" + tempdc;
                    } else {
                        bonus = "-";
                    }
                    if (v["repeating_mortalattack_" + attackid + "_dmgflag"] && v["repeating_mortalattack_" + attackid + "_dmgflag"] != 0) {
                        if (dmgbase === 0 && (dmgattr + dmgmod === 0)) {
                            dmg = 0;
                        }
                        if (dmgbase != 0) {
                            dmg = dmgbase;
                        }
                        if (dmgbase != 0 && (dmgattr + dmgmod != 0)) {
                            dmg = dmgattr + dmgmod > 0 ? dmg + "+" : dmg;
                        }
                        if (dmgattr + dmgmod != 0) {
                            dmg = dmg + (dmgattr + dmgmod);
                        }
                        dmg = dmg + " " + dmgtype;
                    } else {
                        dmg = "";
                    };
                    if (v["repeating_mortalattack_" + attackid + "_dmg2flag"] && v["repeating_mortalattack_" + attackid + "_dmg2flag"] != 0) {
                        if (dmg2base === 0 && (dmg2attr + dmg2mod === 0)) {
                            dmg2 = 0;
                        }
                        if (dmg2base != 0) {
                            dmg2 = dmg2base;
                        }
                        if (dmg2base != 0 && (dmg2attr + dmg2mod != 0)) {
                            dmg2 = dmg2attr + dmg2mod > 0 ? dmg2 + "+" : dmg2;
                        }
                        if (dmg2attr + dmg2mod != 0) {
                            dmg2 = dmg2 + (dmg2attr + dmg2mod);
                        }
                        dmg2 = dmg2 + " " + dmg2type;
                    } else {
                        dmg2 = "";
                    };
                    dmgspacer = v["repeating_mortalattack_" + attackid + "_dmgflag"] && v["repeating_mortalattack_" + attackid + "_dmgflag"] != 0 && v["repeating_mortalattack_" + attackid + "_dmg2flag"] && v["repeating_mortalattack_" + attackid + "_dmg2flag"] != 0 ? "+ " : "";
                    r2 = v["repeating_mortalattack_" + attackid + "_atkflag"] && v["repeating_mortalattack_" + attackid + "_atkflag"] != 0 ? "{{r2=[[" : "{{r2=[[";
                    if (v["repeating_mortalattack_" + attackid + "_atkflag"] && v["repeating_mortalattack_" + attackid + "_atkflag"] != 0) {
                        if (atkmod != 0) {
                            hbonus = atkmod + "[MOD]" + hbonus
                        };
                        if (atkattr_base != 0) {
                            hbonus = atkattr_base + "[" + atkattr_abrev + "]" + hbonus
                        };
                    } else {
                        hbonus = "";
                    }
                    if (v["repeating_mortalattack_" + attackid + "_dmgflag"] && v["repeating_mortalattack_" + attackid + "_dmgflag"] != 0) {
                        if (dmgmod != 0) {
                            hdmg1 = " + " + dmgmod + "[MOD]" + hdmg1
                        };
                        if (dmgattr != 0) {
                            hdmg1 = " + " + dmgattr + "[" + dmgattr_abrev + "]" + hdmg1
                        };
                        hdmg1 = dmgbase + hdmg1;
                    } else {
                        hdmg1 = "0";
                    }
                    if (v["repeating_mortalattack_" + attackid + "_dmg2flag"] && v["repeating_mortalattack_" + attackid + "_dmg2flag"] != 0) {
                        if (dmg2mod != 0) {
                            hdmg2 = " + " + dmg2mod + "[MOD]" + hdmg2
                        };
                        if (dmg2attr != 0) {
                            hdmg2 = " + " + dmg2attr + "[" + dmg2attr_abrev + "]" + hdmg2
                        };
                        hdmg2 = dmg2base + hdmg2;
                    } else {
                        hdmg2 = "0";
                    }

                    if (v.dtype === "full") {
                        pickbase = "full";
                        rollbase = "@{wtype}&{template:atkdmg} {{mod=@{atkbonus}}} {{rname=@{atkname}}} {{r1=[[" + hbonus + "]]}} " + r2 + hbonus + "]]}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[" + hdmg1 + gbdmg + "]]}} {{dmg1type=" + dmgtype + "}} @{dmg2flag} {{dmg2=[[" + hdmg2 + gbdmg + "]]}} {{dmg2type=" + dmg2type + "}} @{saveflag} {{desc=@{atk_desc}}} {{globalattack=@{global_attack_mod}}}  {{globaldamagetype=@{global_damage_mod_type}}} @{charname_output}";
                    } else if (v["repeating_mortalattack_" + attackid + "_atkflag"] && v["repeating_mortalattack_" + attackid + "_atkflag"] != 0) {
                        pickbase = "pick";
                        rollbase = "@{wtype}&{template:atk} {{mod=@{atkbonus}}} {{rname=[@{atkname}](~repeating_mortalattack_attack_dmg)}} {{r1=[[" + hbonus + "]]}} " + r2 + hbonus + "]]}} {{range=@{atkrange}}} {{desc=@{atk_desc}}} {{globalattack=@{global_attack_mod}}} @{charname_output}";
                    } else if (v["repeating_mortalattack_" + attackid + "_dmgflag"] && v["repeating_mortalattack_" + attackid + "_dmgflag"] != 0) {
                        pickbase = "dmg";
                        rollbase = "@{wtype}&{template:dmg} {{rname=@{atkname}}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[" + hdmg1 + gbdmg + "]]}} {{dmg1type=" + dmgtype + "}} @{dmg2flag} {{dmg2=[[" + hdmg2 + gbdmg + "]]}} {{dmg2type=" + dmg2type + "}} @{saveflag} {{desc=@{atk_desc}}} {{globaldamagetype=@{mortal_global_damage_mod_type}}} @{charname_output}"
                    } else {
                        pickbase = "empty";
                        rollbase = "@{wtype}&{template:dmg} {{rname=@{atkname}}} @{atkflag} {{range=@{atkrange}}} @{saveflag} {{desc=@{atk_desc}}} @{charname_output}"
                    }
                    update["repeating_mortalattack_" + attackid + "_rollbase_dmg"] = "@{wtype}&{template:dmg} {{rname=@{atkname}}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[" + hdmg1 + gbdmg + "]]}} {{dmg1type=" + dmgtype + "}} @{dmg2flag} {{dmg2=[[" + hdmg2 + gbdmg + "]]}} {{dmg2type=" + dmg2type + "}} @{saveflag} {{desc=@{atk_desc}}} {{globaldamagetype=@{mortal_global_damage_mod_type}}} @{charname_output}";
                    update["repeating_mortalattack_" + attackid + "_atkbonus"] = bonus;
                    update["repeating_mortalattack_" + attackid + "_atkdmgtype"] = dmg + dmgspacer + dmg2 + " ";
                    update["repeating_mortalattack_" + attackid + "_rollbase"] = rollbase;
                    
                    setAttrs(update, {
                        silent: true
                    }, function() {
                        callbacks.forEach(function(callback) {
                            callback();
                        })
                    });
                });
            });
        };

        var update_mortalglobaldamage = function(callback) {
            getSectionIDs("mortaldamagemod", function(ids) {
                if (ids) {
                    var fields = {};
                    var attr_name_list = [];
                    ids.forEach(function(id) {
                        fields[id] = {};
                        attr_name_list.push(`repeating_mortaldamagemod_${id}_global_damage_active_flag`, `repeating_mortaldamagemod_${id}_global_damage_name`, `repeating_mortaldamagemod_${id}_global_damage_damage`, `repeating_mortaldamagemod_${id}_global_damage_type`);
                    });

                    getAttrs(attr_name_list, function(attrs) {
                        var regex = /^repeating_mortaldamagemod_(.+)_global_damage_(active_flag|name|damage|type)$/;
                        _.each(attrs, function(obj, name) {
                            var r = regex.exec(name);
                            if (r) {
                                fields[r[1]][r[2]] = obj;
                            };
                        });

                        var update = {
                            global_damage_mod_roll: "",
                            global_damage_mod_type: ""
                        };

                        console.log("GLOBALDAMAGE");
                        _.each(fields, function(element) {
                            if (element.active_flag != "0") {
                                if (element.name && element.name !== "") {
                                    update["global_damage_mod_roll"] += element.damage + '[' + element.name + ']' + "+";
                                }
                                if (element.type && element.type !== "") {
                                    update["global_damage_mod_type"] += element.type + "/";
                                }
                            }
                        });

                        update["global_damage_mod_roll"] = update["global_damage_mod_roll"].replace(/\+(?=$)/, '');
                        update["global_damage_mod_type"] = update["global_damage_mod_type"].replace(/\/(?=$)/, '');

                        setAttrs(update, {
                            silent: true
                        }, function() {
                            update_mortalattacks("all");
                            if (typeof callback == "function") callback();
                        });
                    });
                }
            });
        };

        var update_mortalglobalattack = function(callback) {
            getSectionIDs("mortaltohitmod", function(ids) {
                if (ids) {
                    var fields = {};
                    var attr_name_list = [];
                    ids.forEach(function(id) {
                        fields[id] = {};
                        attr_name_list.push(`repeating_mortaltohitmod_${id}_global_attack_active_flag`, `repeating_mortaltohitmod_${id}_global_attack_roll`, `repeating_mortaltohitmod_${id}_global_attack_name`);
                    });
                    getAttrs(attr_name_list, function(attrs) {
                        var regex = /^repeating_mortaltohitmod_(.+)_global_attack_(active_flag|roll|name)$/;
                        _.each(attrs, function(obj, name) {
                            var r = regex.exec(name);
                            if (r) {
                                fields[r[1]][r[2]] = obj;
                            }
                        });

                        var update = {
                            global_attack_mod: ""
                        };
                        console.log("GLOBALATTACK");
                        _.each(fields, function(element) {
                            if (element.active_flag != "0") {
                                if (element.roll && element.roll !== "") {
                                    update["global_attack_mod"] += element.roll + "[" + element.name + "]" + "+";
                                }
                            }
                        });
                        if (update["global_attack_mod"] !== "") {
                            update["global_attack_mod"] = "[[" + update["global_attack_mod"].replace(/\+(?=$)/, '') + "]]";
                        }
                        setAttrs(update, {
                            silent: true
                        }, function() {
                            if (typeof callback == "function") callback();
                        });
                    });
                }
            });
        };

        var update_cultivatorattacks = function(update_id, source) {
            console.log("DOING UPDATE_ATTACKS: " + update_id);
            if (update_id.substring(0, 1) === "-" && update_id.length === 20) {
                do_update_cultivatorattack([update_id], source);
            } else if (["power", "agility", "vitality", "cultivation", "qicontrol", "mental", "all"].indexOf(update_id) > -1) {
                getSectionIDs("repeating_cultivatorattack", function(idarray) {
                    if (update_id === "all") {
                        do_update_cultivatorattack(idarray);
                    } else {
                        var attack_attribs = [];
                        _.each(idarray, function(id) {
                            attack_attribs.push("repeating_attack_" + id + "_atkattr_base");
                            attack_attribs.push("repeating_attack_" + id + "_dmgattr");
                            attack_attribs.push("repeating_attack_" + id + "_dmg2attr");
                            attack_attribs.push("repeating_attack_" + id + "_savedc");
                        });
                        getAttrs(attack_attribs, function(v) {
                            var attr_attack_ids = [];
                            _.each(idarray, function(id) {
                                if ((v["repeating_attack_" + id + "_atkattr_base"] && v["repeating_attack_" + id + "_atkattr_base"].indexOf(update_id) > -1) || (v["repeating_attack_" + id + "_dmgattr"] && v["repeating_attack_" + id + "_dmgattr"].indexOf(update_id) > -1) || (v["repeating_attack_" + id + "_dmg2attr"] && v["repeating_attack_" + id + "_dmg2attr"].indexOf(update_id) > -1) || (v["repeating_attack_" + id + "_savedc"] && v["repeating_attack_" + id + "_savedc"].indexOf(update_id) > -1)) {
                                    attr_attack_ids.push(id);
                                }
                            });
                            if (attr_attack_ids.length > 0) {
                                do_update_cultivatorattack(attr_attack_ids);
                            }
                        });
                    };
                });
            };
        };

        var do_update_cultivatorattack = function(attack_array, source) {
            var attack_attribs = ["level", "dtype", "power", "agility", "vitality", "cultivation", "qicontrol", "mental", "cultivator_global_damage_mod_roll", "cultivator_global_damage_mod_type"];
            _.each(attack_array, function(attackid) {
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_atkflag");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_atkname");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_atkattr_base");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_atkmod");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_dmgflag");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_dmgbase");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_dmgattr");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_dmgmod");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_dmgtype");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_dmg2flag");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_dmg2base");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_dmg2attr");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_dmg2mod");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_dmg2type");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_saveflag");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_savedc");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_saveeffect");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_saveflat");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_atkrange");
                attack_attribs.push("repeating_cultivatorattack_" + attackid + "_cultivator_global_damage_mod_field");
            });

            getAttrs(attack_attribs, function(v) {
                _.each(attack_array, function(attackid) {
                    var callbacks = [];
                    var update = {};
                    var hbonus = "";
                    var hdmg1 = "";
                    var hdmg2 = "";
                    var dmg = "";
                    var dmg2 = "";
                    var rollbase = "";
                    var atkattr_abrev = "";
                    var dmgattr_abrev = "";
                    var dmg2attr_abrev = "";
                    
                    if (!v["repeating_cultivatorattack_" + attackid + "_atkattr_base"] || v["repeating_cultivatorattack_" + attackid + "_atkattr_base"] === "0") {
                        atkattr_base = 0
                    } else {
                        atkattr_base = parseInt(v[v["repeating_cultivatorattack_" + attackid + "_atkattr_base"].substring(2, v["repeating_cultivatorattack_" + attackid + "_atkattr_base"].length - 1)], 10);
                        atkattr_abrev = v["repeating_cultivatorattack_" + attackid + "_atkattr_base"].substring(2, v["repeating_cultivatorattack_" + attackid + "_atkattr_base"].length - 1).toUpperCase();
                    };

                    if (!v["repeating_cultivatorattack_" + attackid + "_dmgattr"] || v["repeating_cultivatorattack_" + attackid + "_dmgattr"] === "0") {
                        dmgattr = 0;
                    } else {
                        dmgattr = parseInt(v[v["repeating_cultivatorattack_" + attackid + "_dmgattr"].substring(2, v["repeating_cultivatorattack_" + attackid + "_dmgattr"].length - 1)], 10);
                        dmgattr_abrev = v["repeating_cultivatorattack_" + attackid + "_dmgattr"].substring(2, v["repeating_cultivatorattack_" + attackid + "_dmgattr"].length - 1).toUpperCase();
                    };

                    if (!v["repeating_cultivatorattack_" + attackid + "_dmg2attr"] || v["repeating_cultivatorattack_" + attackid + "_dmg2attr"] === "0") {
                        dmg2attr = 0;
                    } else {
                        dmg2attr = parseInt(v[v["repeating_cultivatorattack_" + attackid + "_dmg2attr"].substring(2, v["repeating_cultivatorattack_" + attackid + "_dmg2attr"].length - 1)], 10);
                        dmg2attr_abrev = v["repeating_cultivatorattack_" + attackid + "_dmg2attr"].substring(2, v["repeating_cultivatorattack_" + attackid + "_dmg2attr"].length - 1).toUpperCase();
                    };

                    var dmgbase = v["repeating_cultivatorattack_" + attackid + "_dmgbase"] && v["repeating_cultivatorattack_" + attackid + "_dmgbase"] != "" ? v["repeating_cultivatorattack_" + attackid + "_dmgbase"] : 0;
                    var dmg2base = v["repeating_cultivatorattack_" + attackid + "_dmg2base"] && v["repeating_cultivatorattack_" + attackid + "_dmg2base"] != "" ? v["repeating_cultivatorattack_" + attackid + "_dmg2base"] : 0;
                    var dmgmod = v["repeating_cultivatorattack_" + attackid + "_dmgmod"] && isNaN(parseInt(v["repeating_cultivatorattack_" + attackid + "_dmgmod"], 10)) === false ? parseInt(v["repeating_cultivatorattack_" + attackid + "_dmgmod"], 10) : 0;
                    var dmg2mod = v["repeating_cultivatorattack_" + attackid + "_dmg2mod"] && isNaN(parseInt(v["repeating_cultivatorattack_" + attackid + "_dmg2mod"], 10)) === false ? parseInt(v["repeating_cultivatorattack_" + attackid + "_dmg2mod"], 10) : 0;
                    var dmgtype = v["repeating_cultivatorattack_" + attackid + "_dmgtype"] ? v["repeating_cultivatorattack_" + attackid + "_dmgtype"] + " " : "";
                    var dmg2type = v["repeating_cultivatorattack_" + attackid + "_dmg2type"] ? v["repeating_cultivatorattack_" + attackid + "_dmg2type"] + " " : "";
                    var atkmod = v["repeating_cultivatorattack_" + attackid + "_atkmod"] && v["repeating_cultivatorattack_" + attackid + "_atkmod"] != "" ? parseInt(v["repeating_cultivatorattack_" + attackid + "_atkmod"], 10) : 0;

                    var cultivator_globaldamage = `[[${v.cultivator_global_damage_mod_roll && v.cultivator_global_damage_mod_roll !== "" ? v.cultivator_global_damage_mod_roll : "0"}]]`;
                    var globalDamageType = v["cultivator_global_damage_mod_type"] || "";
                    var gbdmg = " + " + cultivator_globaldamage + "[" + globalDamageType + "]"
                    
                    if (v["repeating_cultivatorattack_" + attackid + "_atkflag"] && v["repeating_cultivatorattack_" + attackid + "_atkflag"] != 0) {
                        bonus_mod = atkattr_base + atkmod;
                        plus_minus = bonus_mod > -1 ? "+" : "";
                        bonus = plus_minus + bonus_mod;
                    } else if (v["repeating_cultivatorattack_" + attackid + "_saveflag"] && v["repeating_cultivatorattack_" + attackid + "_saveflag"] != 0) {
                        if (v["repeating_cultivatorattack_" + attackid + "_savedc"] && v["repeating_cultivatorattack_" + attackid + "_savedc"] === "(@{saveflat})") {
                            var tempdc = isNaN(parseInt(v["repeating_cultivatorattack_" + attackid + "_saveflat"])) === false ? parseInt(v["repeating_cultivatorattack_" + attackid + "_saveflat"]) : "0";
                        } else {
                            var savedcattr = v["repeating_cultivatorattack_" + attackid + "_savedc"].replace(/^[^{]*{/, "").replace(/\_.*$/, "");
                            var safe_attr = v[savedcattr] ? parseInt(v[savedcattr], 10) : 0;
                            var tempdc = safe_attr;
                        };
                        bonus = "DC" + tempdc;
                    } else {
                        bonus = "-";
                    }
                    if (v["repeating_cultivatorattack_" + attackid + "_dmgflag"] && v["repeating_cultivatorattack_" + attackid + "_dmgflag"] != 0) {
                        if (dmgbase === 0 && (dmgattr + dmgmod === 0)) {
                            dmg = 0;
                        }
                        if (dmgbase != 0) {
                            dmg = dmgbase;
                        }
                        if (dmgbase != 0 && (dmgattr + dmgmod != 0)) {
                            dmg = dmgattr + dmgmod > 0 ? dmg + "+" : dmg;
                        }
                        if (dmgattr + dmgmod != 0) {
                            dmg = dmg + (dmgattr + dmgmod);
                        }
                        dmg = dmg + " " + dmgtype;
                    } else {
                        dmg = "";
                    };
                    if (v["repeating_cultivatorattack_" + attackid + "_dmg2flag"] && v["repeating_cultivatorattack_" + attackid + "_dmg2flag"] != 0) {
                        if (dmg2base === 0 && (dmg2attr + dmg2mod === 0)) {
                            dmg2 = 0;
                        }
                        if (dmg2base != 0) {
                            dmg2 = dmg2base;
                        }
                        if (dmg2base != 0 && (dmg2attr + dmg2mod != 0)) {
                            dmg2 = dmg2attr + dmg2mod > 0 ? dmg2 + "+" : dmg2;
                        }
                        if (dmg2attr + dmg2mod != 0) {
                            dmg2 = dmg2 + (dmg2attr + dmg2mod);
                        }
                        dmg2 = dmg2 + " " + dmg2type;
                    } else {
                        dmg2 = "";
                    };
                    dmgspacer = v["repeating_cultivatorattack_" + attackid + "_dmgflag"] && v["repeating_cultivatorattack_" + attackid + "_dmgflag"] != 0 && v["repeating_cultivatorattack_" + attackid + "_dmg2flag"] && v["repeating_cultivatorattack_" + attackid + "_dmg2flag"] != 0 ? "+ " : "";
                    r2 = v["repeating_cultivatorattack_" + attackid + "_atkflag"] && v["repeating_cultivatorattack_" + attackid + "_atkflag"] != 0 ? "{{r2=[[" : "{{r2=[[";
                    if (v["repeating_cultivatorattack_" + attackid + "_atkflag"] && v["repeating_cultivatorattack_" + attackid + "_atkflag"] != 0) {
                        if (atkmod != 0) {
                            hbonus = atkmod + "[MOD]" + hbonus
                        };
                        if (atkattr_base != 0) {
                            hbonus = atkattr_base + "[" + atkattr_abrev + "]" + hbonus
                        };
                    } else {
                        hbonus = "";
                    }
                    if (v["repeating_cultivatorattack_" + attackid + "_dmgflag"] && v["repeating_cultivatorattack_" + attackid + "_dmgflag"] != 0) {
                        if (dmgmod != 0) {
                            hdmg1 = " + " + dmgmod + "[MOD]" + hdmg1
                        };
                        if (dmgattr != 0) {
                            hdmg1 = " + " + dmgattr + "[" + dmgattr_abrev + "]" + hdmg1
                        };
                        hdmg1 = dmgbase + hdmg1;
                    } else {
                        hdmg1 = "0";
                    }
                    if (v["repeating_cultivatorattack_" + attackid + "_dmg2flag"] && v["repeating_cultivatorattack_" + attackid + "_dmg2flag"] != 0) {
                        if (dmg2mod != 0) {
                            hdmg2 = " + " + dmg2mod + "[MOD]" + hdmg2
                        };
                        if (dmg2attr != 0) {
                            hdmg2 = " + " + dmg2attr + "[" + dmg2attr_abrev + "]" + hdmg2
                        };
                        hdmg2 = dmg2base + hdmg2;
                    } else {
                        hdmg2 = "0";
                    }

                    if (v.dtype === "full") {
                        pickbase = "full";
                        rollbase = "@{wtype}&{template:atkdmg} {{mod=@{atkbonus}}} {{rname=@{atkname}}} {{r1=[[" + hbonus + "]]}} " + r2 + hbonus + "]]}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[" + hdmg1 + gbdmg + "]]}} {{dmg1type=" + dmgtype + "}} @{dmg2flag} {{dmg2=[[" + hdmg2 + gbdmg + "]]}} {{dmg2type=" + dmg2type + "}} @{saveflag} {{desc=@{atk_desc}}} {{globalattack=@{cultivator_global_attack_mod}}}  {{globaldamagetype=@{cultivator_global_damage_mod_type}}} @{charname_output}";
                    } else if (v["repeating_cultivatorattack_" + attackid + "_atkflag"] && v["repeating_cultivatorattack_" + attackid + "_atkflag"] != 0) {
                        pickbase = "pick";
                        rollbase = "@{wtype}&{template:atk} {{mod=@{atkbonus}}} {{rname=[@{atkname}](~repeating_cultivatorattack_attack_dmg)}} {{r1=[[" + hbonus + "]]}} " + r2 + hbonus + "]]}} {{range=@{atkrange}}} {{desc=@{atk_desc}}} {{globalattack=@{cultivator_global_attack_mod}}} @{charname_output}";
                    } else if (v["repeating_cultivatorattack_" + attackid + "_dmgflag"] && v["repeating_cultivatorattack_" + attackid + "_dmgflag"] != 0) {
                        pickbase = "dmg";
                        rollbase = "@{wtype}&{template:dmg} {{rname=@{atkname}}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[" + hdmg1 + gbdmg + "]]}} {{dmg1type=" + dmgtype + "}} @{dmg2flag} {{dmg2=[[" + hdmg2 + gbdmg + "]]}} {{dmg2type=" + dmg2type + "}} @{saveflag} {{desc=@{atk_desc}}} {{globaldamagetype=@{cultivator_global_damage_mod_type}}} @{charname_output}"
                    } else {
                        pickbase = "empty";
                        rollbase = "@{wtype}&{template:dmg} {{rname=@{atkname}}} @{atkflag} {{range=@{atkrange}}} @{saveflag} {{desc=@{atk_desc}}} @{charname_output}"
                    }
                    update["repeating_cultivatorattack_" + attackid + "_rollbase_dmg"] = "@{wtype}&{template:dmg} {{rname=@{atkname}}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[" + hdmg1 + gbdmg + "]]}} {{dmg1type=" + dmgtype + "}} @{dmg2flag} {{dmg2=[[" + hdmg2 + gbdmg + "]]}} {{dmg2type=" + dmg2type + "}} @{saveflag} {{desc=@{atk_desc}}} {{globaldamagetype=@{cultivator_global_damage_mod_type}}} @{charname_output}";
                    update["repeating_cultivatorattack_" + attackid + "_atkbonus"] = bonus;
                    update["repeating_cultivatorattack_" + attackid + "_atkdmgtype"] = dmg + dmgspacer + dmg2 + " ";
                    update["repeating_cultivatorattack_" + attackid + "_rollbase"] = rollbase;
                    
                    setAttrs(update, {
                        silent: true
                    }, function() {
                        callbacks.forEach(function(callback) {
                            callback();
                        })
                    });
                });
            });
        };

        var update_cultivatorglobaldamage = function(callback) {
            getSectionIDs("cultivatordamagemod", function(ids) {
                if (ids) {
                    var fields = {};
                    var attr_name_list = [];
                    ids.forEach(function(id) {
                        fields[id] = {};
                        attr_name_list.push(`repeating_cultivatordamagemod_${id}_cultivator_global_damage_active_flag`, `repeating_cultivatordamagemod_${id}_cultivator_global_damage_name`, `repeating_cultivatordamagemod_${id}_cultivator_global_damage_damage`, `repeating_cultivatordamagemod_${id}_cultivator_global_damage_type`);
                    });

                    getAttrs(attr_name_list, function(attrs) {
                        var regex = /^repeating_cultivatordamagemod_(.+)_cultivator_global_damage_(active_flag|name|damage|type)$/;
                        _.each(attrs, function(obj, name) {
                            var r = regex.exec(name);
                            if (r) {
                                fields[r[1]][r[2]] = obj;
                            };
                        });

                        var update = {
                            cultivator_global_damage_mod_roll: "",
                            cultivator_global_damage_mod_type: ""
                        };

                        console.log("GLOBALDAMAGE");
                        _.each(fields, function(element) {
                            if (element.active_flag != "0") {
                                if (element.name && element.name !== "") {
                                    update["cultivator_global_damage_mod_roll"] += element.damage + '[' + element.name + ']' + "+";
                                }
                                if (element.type && element.type !== "") {
                                    update["cultivator_global_damage_mod_type"] += element.type + "/";
                                }
                            }
                        });

                        update["cultivator_global_damage_mod_roll"] = update["cultivator_global_damage_mod_roll"].replace(/\+(?=$)/, '');
                        update["cultivator_global_damage_mod_type"] = update["cultivator_global_damage_mod_type"].replace(/\/(?=$)/, '');

                        setAttrs(update, {
                            silent: true
                        }, function() {
                            update_cultivatorattacks("all");
                            if (typeof callback == "function") callback();
                        });
                    });
                }
            });
        };

        var update_cultivatorglobalattack = function(callback) {
            getSectionIDs("cultivatortohitmod", function(ids) {
                if (ids) {
                    var fields = {};
                    var attr_name_list = [];
                    ids.forEach(function(id) {
                        fields[id] = {};
                        attr_name_list.push(`repeating_cultivatortohitmod_${id}_cultivator_global_attack_active_flag`, `repeating_cultivatortohitmod_${id}_cultivator_global_attack_roll`, `repeating_cultivatortohitmod_${id}_cultivator_global_attack_name`);
                    });
                    getAttrs(attr_name_list, function(attrs) {
                        var regex = /^repeating_cultivatortohitmod_(.+)_cultivator_global_attack_(active_flag|roll|name)$/;
                        _.each(attrs, function(obj, name) {
                            var r = regex.exec(name);
                            if (r) {
                                fields[r[1]][r[2]] = obj;
                            }
                        });

                        var update = {
                            cultivator_global_attack_mod: ""
                        };
                        console.log("GLOBALATTACK");
                        _.each(fields, function(element) {
                            if (element.active_flag != "0") {
                                if (element.roll && element.roll !== "") {
                                    update["cultivator_global_attack_mod"] += element.roll + "[" + element.name + "]" + "+";
                                }
                            }
                        });
                        if (update["cultivator_global_attack_mod"] !== "") {
                            update["cultivator_global_attack_mod"] = "[[" + update["cultivator_global_attack_mod"].replace(/\+(?=$)/, '') + "]]";
                        }
                        setAttrs(update, {
                            silent: true
                        }, function() {
                            if (typeof callback == "function") callback();
                        });
                    });
                }
            });
        };

        var update_weight = function() {
            var update = {};
            var wtotal = 0;
            var stotal = 0;
            var weight_attrs = ["power", "carrying_capacity_mod", "inventory_slots_mod", "itemweightfixed", "itemslotsfixed"];
            getSectionIDs("repeating_inventory", function(idarray) {
                _.each(idarray, function(currentID, i) {
                    weight_attrs.push("repeating_inventory_" + currentID + "_itemweight");
                    weight_attrs.push("repeating_inventory_" + currentID + "_itemcount");
                    weight_attrs.push("repeating_inventory_" + currentID + "_itemsize");
                    weight_attrs.push("repeating_inventory_" + currentID + "_equipped");
                    weight_attrs.push("repeating_inventory_" + currentID + "_carried");
                    weight_attrs.push("repeating_inventory_" + currentID + "_itemcontainer");
                    weight_attrs.push("repeating_inventory_" + currentID + "_itemweightfixed");
                    weight_attrs.push("repeating_inventory_" + currentID + "_itemslotsfixed");
                    weight_attrs.push("repeating_inventory_" + currentID + "_itemcontainer_slots");
                    weight_attrs.push("repeating_inventory_" + currentID + "_itemcontainer_slots_modifier");
                });
                getAttrs(weight_attrs, function(v) {
                    var slots_modifier = 0;
                    var containerslots = 0;

                    _.each(idarray, function(currentID, i) {
                        if (v["repeating_inventory_" + currentID + "_equipped"] == 1 || v["repeating_inventory_" + currentID + "_carried"] == 1) {
                            if (v["repeating_inventory_" + currentID + "_itemcontainer"] == 1) {
                                // GET SLOTS MODIFIER IF EQUIPPED
                                if (v["repeating_inventory_" + currentID + "_equipped"] == 1) {
                                    var slotsID = "repeating_inventory_" + currentID + "_itemcontainer_slots";
                                    containerslots = parseInt(v[slotsID], 0);
                                    var field_id = "repeating_inventory_" + currentID + "_itemcontainer_slots_modifier";
                                    if (v[field_id]) {
                                        if (["+", "-"].indexOf(v[field_id]) > -1) {
                                            var operator = v[field_id].substring(0, 1);
                                            var value = v[field_id].substring(1);
                                            if (isNaN(parseInt(value, 0)) === false) {
                                                if (operator == "+") {
                                                    slots_modifier += parseInt(value, 0);
                                                } else if (operator == "-") {
                                                    slots_modifier -= parseInt(value, 0);
                                                }
                                            }
                                        } else {
                                            if (isNaN(parseInt(v[field_id], 0)) === false) {
                                                slots_modifier += parseInt(v[field_id], 0);
                                            }
                                        }
                                    }
                                }
                            } else {
                                // UPDATE WEIGHT
                                if (v["repeating_inventory_" + currentID + "_itemweight"] && isNaN(parseInt(v["repeating_inventory_" + currentID + "_itemweight"], 0)) === false) {
                                    if (v["repeating_inventory_" + currentID + "_itemweightfixed"] == 1) {
                                        wtotal += parseFloat(v["repeating_inventory_" + currentID + "_itemweight"]);
                                    } else {
                                        count = v["repeating_inventory_" + currentID + "_itemcount"] && isNaN(parseFloat(v["repeating_inventory_" + currentID + "_itemcount"])) === false ? parseFloat(v["repeating_inventory_" + currentID + "_itemcount"]) : 1;
                                        wtotal = wtotal + (parseFloat(v["repeating_inventory_" + currentID + "_itemweight"]) * count);
                                    }
                                }
                                // UPDATE SLOTS
                                if (v["repeating_inventory_" + currentID + "_itemsize"] && isNaN(parseInt(v["repeating_inventory_" + currentID + "_itemsize"], 0)) === false) {
                                    if (v["repeating_inventory_" + currentID + "_itemslotsfixed"] == 1) {
                                        stotal += parseFloat(v["repeating_inventory_" + currentID + "_itemsize"]);
                                    } else {
                                        count = v["repeating_inventory_" + currentID + "_itemcount"] && isNaN(parseFloat(v["repeating_inventory_" + currentID + "_itemcount"])) === false ? parseFloat(v["repeating_inventory_" + currentID + "_itemcount"]) : 1;
                                        stotal = stotal + (parseFloat(v["repeating_inventory_" + currentID + "_itemsize"]) * count);
                                    }
                                }
                            }
                        }
                    });

                    wtotal = Math.round(wtotal * 100) / 100;
                    stotal = Math.round(stotal * 100) / 100;

                    update["weighttotal"] = wtotal;
                    update["slotstotal"] = stotal;

                    var size_slots = 18;
                    size_slots += parseInt(v.power) + parseInt(containerslots);

                    if (v.inventory_slots_mod) {
                        var operator = v.inventory_slots_mod.substring(0, 1);
                        var value = v.inventory_slots_mod.substring(1);
                        if (["*", "x", "+", "-"].indexOf(operator) > -1 && isNaN(parseInt(value, 0)) === false) {
                            if (operator == "*" || operator == "x") {
                                size_slots *= parseInt(value, 0);
                            } else if (operator == "+") {
                                size_slots += parseInt(value, 0);
                            } else if (operator == "-") {
                                size_slots -= parseInt(value, 0);
                            }
                        }
                    }

                    size_slots += slots_modifier;
                    
                    var str_base = parseInt(v.power);
                    var str = str_base;
                    var weight_maximum = str * 30;
                    var weight_mod = weight_maximum;

                    if (v.carrying_capacity_mod) {
                        var operator = v.carrying_capacity_mod.substring(0, 1);
                        var value = parseInt(v.carrying_capacity_mod.substring(1), 10);
                        if (["*", "x", "+", "-", "/"].indexOf(operator) > -1 && !isNaN(value)) {
                            if (operator == "*" || operator == "x") {
                                weight_mod *= value;
                            } else if (operator == "+") {
                                weight_mod += value;
                            } else if (operator == "-") {
                                weight_mod -= value;
                            } else if (operator == "/") {
                                weight_mod /= value;
                            }
                        }
                    }

                    update["weightmaximum"] = weight_mod;
                    update["slotsmaximum"] = size_slots;

                    if (stotal > size_slots) {
                        update["encumberance"] = "OVER CARRYING CAPACITY";
                    } else if (wtotal > str * 30) {
                        update["encumberance"] = "IMMOBILE";
                    } else if (wtotal > str * 22) {
                        update["encumberance"] = "HEAVILY ENCUMBERED";
                    } else if (wtotal > str * 15) {
                        update["encumberance"] = "ENCUMBERED";
                    } else {
                        update["encumberance"] = " ";
                    }

                    setAttrs(update, {
                        silent: true
                    });
                });
            });
        };

        var update_skills = function(skills_array) {
            var attrs_to_get = ["power", "agility", "vitality", "cultivation", "qicontrol", "mental", "appearance"];
            var update = {};
            var callbacks = [];

            _.each(skills_array, function(s) {
                attrs_to_get.push(s + "_bonus");
            });

            getSectionIDs("repeating_inventory", function(idarray) {
                _.each(idarray, function(currentID, i) {
                    attrs_to_get.push("repeating_inventory_" + currentID + "_equipped");
                    attrs_to_get.push("repeating_inventory_" + currentID + "_itemmodifiers");
                });

                getAttrs(attrs_to_get, function(v) {
                    _.each(skills_array, function(s) {
                        console.log("UPDATING SKILL: " + s);
                        var flat = v[s + "_flat"] && !isNaN(parseInt(v[s + "_flat"], 10)) ? parseInt(v[s + "_flat"], 10) : 0;
                        var item_bonus = 0;

                        _.each(idarray, function(currentID) {
                            if (v["repeating_inventory_" + currentID + "_equipped"] && v["repeating_inventory_" + currentID + "_equipped"] === "1" && v["repeating_inventory_" + currentID + "_itemmodifiers"] && (v["repeating_inventory_" + currentID + "_itemmodifiers"].toLowerCase().replace(/ /g, "_").indexOf(s) > -1 || v["repeating_inventory_" + currentID + "_itemmodifiers"].toLowerCase().indexOf("skill checks") > -1)) {
                                var mods = v["repeating_inventory_" + currentID + "_itemmodifiers"].toLowerCase().split(",");
                                _.each(mods, function(mod) {
                                    if (mod.replace(/ /g, "_").indexOf(s) > -1 || mod.indexOf("skill checks") > -1) {
                                        if (mod.indexOf("-") > -1) {
                                            var new_mod = !isNaN(parseInt(mod.replace(/[^0-9]/g, ""), 10)) ? parseInt(mod.replace(/[^0-9]/g, ""), 10) : false;
                                            item_bonus -= new_mod ? item_bonus + new_mod : item_bonus;
                                        } else {
                                            var new_mod = !isNaN(parseInt(mod.replace(/[^0-9]/g, ""), 10)) ? parseInt(mod.replace(/[^0-9]/g, ""), 10) : false;
                                            item_bonus += new_mod ? item_bonus + new_mod : item_bonus;
                                        }
                                    };
                                });
                            };
                        });

                        var roll = 0;
                        switch(s) {
                            case "acrobatics":
                            case "discretion":
                            case "stealth":
                                roll = parseInt(v.agility, 10);
                                break;
                            case "athletics":
                            case "grapple":
                                roll = parseInt(v.power, 10);
                                break;
                            case "charm":
                            case "deceit":
                            case "disguise":
                            case "persuade":
                                roll = parseInt(v.mental, 10) + parseInt(v.appearance, 10);
                                break;
                            case "fine_arts":
                            case "forgery":
                            case "navigation":
                                roll = Math.floor(parseInt(v.agility, 10) / 2) + Math.floor(parseInt(v.mental, 10) / 2);
                                break;
                            case "history":
                            case "medicine":
                                roll = Math.floor(parseInt(v.qicontrol, 10) / 2) + Math.floor(parseInt(v.mental, 10) / 2);
                                break;
                            case "intuition":
                            case "investigation":
                            case "perception":
                                roll = parseInt(v.mental, 10);
                                break;
                            case "intimidation":
                                roll = parseInt(v.power, 10) + parseInt(v.appearance, 10);
                                break;
                            case "performance":
                                roll = parseInt(v.agility, 10) + parseInt(v.appearance, 10);
                                break;
                            case "survival":
                                roll = Math.floor(parseInt(v.power, 10) / 2) + Math.floor(parseInt(v.mental, 10) / 2);
                                break;
                        }

                        var total = flat + item_bonus;
                        
                        if (total > 0) {
                            update[s] = roll + "d6 + " + total;
                        } else {
                            update[s] = roll + "d6";
                        }
                        update[s + "_bonus"] = total;
                        update[s + "_roll"] = roll;
                    });

                    setAttrs(update, {
                        silent: true
                    }, function() {
                        callbacks.forEach(function(callback) {
                            callback();
                        })
                    });
                });
            });
        };

        var update_all_ability_checks = function() {
            update_initiative();
            update_skills(["acrobatics","athletics","charm","deceit","discretion","disguise","fine_arts","forgery","grapple","history","intuition","intimidation","investigation","medicine","navigation","perception","performance","persuade","stealth","survival"]);
        };

        var update_durability = function(){
            getAttrs(["durability-base", "durability-limit", "durability-bonus", "power", "agility", "vitality", "cultivation", "qicontrol", "mental"], function(v) {
                var update = {};

                var base = parseInt(v["durability-base"]) || 0;
                var limit = parseInt(v["durability-limit"]) || 0;
                var bonus = parseInt(v["durability-bonus"]) || 0;

                update["durability-full"] = base + bonus;

                setAttrs(update, {
                    silent: true
                });
            });
        };

        var update_evasion = function() {
            getAttrs(["evasion-base", "evasion-limit", "evasion-bonus", "agility"], function(v) {
                var update = {};

                var agility = parseInt(v.agility) || 0;
                var base = parseInt(v["evasion-base"]) || 0;
                var limit = parseInt(v["evasion-limit"]) || 0;
                var bonus = parseInt(v["evasion-bonus"]) || 0;

                if (agility < limit) {
                    update["evasion-full"] = base + agility + bonus;
                } else {
                    update["evasion-full"] = base + limit + Math.floor((agility - limit) / 2) + bonus;
                }

                setAttrs(update, {
                    silent: true
                });
            });
        };

        var update_reduction = function(){
            getAttrs(["reduction-base", "reduction-armour", "reduction-bonus"], function(v) {
                var update = {};

                var base = parseInt(v["reduction-base"]) || 0;
                var armour = parseInt(v["reduction-armour"]) || 0;
                var bonus = parseInt(v["reduction-bonus"]) || 0;

                update["reduction-full"] = base + armour + bonus;

                setAttrs(update, {
                    silent: true
                });
            });
        };

        let toInt = function(value) {
            return (value && !isNaN(value)) ? parseInt(value) : 0;
        };

        let clamp = function(value, min, max) {
            return Math.min(Math.max(value, min), max);
        };

        let isDefined = function(value) {
            return value !== null && typeof(value) !== 'undefined';
        };        
    </script>
</div>