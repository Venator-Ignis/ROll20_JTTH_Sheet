<div class="sheet-core">
    <input class="sheet-toggle-npc" name="attr_npc" type="hidden" value="0">
    <input class="sheet-toggle-npc-edit" name="attr_npc_options-flag" type="checkbox" hidden>
    <label class="sheet-form-checkbox">
        <input type="checkbox" name="attr_npc" value="1">
        <span>NPC</span>
    </label>
    <div class="sheet-section-roll">
        <input type="hidden" name="attr_rtype" class="sheet-roll-toggle">
        <input type="hidden" name="attr_wtype" class="sheet-roll-toggle">
        <div class="sheet-section-roll-whisper">
            <label class="sheet-radio">
                <input type="radio" name="attr_whispertoggle" value="" checked="checked">
                <span title="@{whispertoggle}">Public</span>
            </label>
            <label class="sheet-radio">
                <input type="radio" name="attr_whispertoggle" value="/w gm ">
                <span title="@{whispertoggle}">To GM</span>
            </label>
        </div>
    </div>
    
    <div class="sheet-section-npc">
        <div class="sheet-checkbox-cog">
            <input type="checkbox" name="attr_npc_options-flag" checked="checked">
            <span class="sheet-toggle-icon"></span>
        </div>
        <input type="checkbox" name="attr_npc_options-flag" checked="checked" class="sheet-toggle" hidden>
        <div class="sheet-toggle-checked sheet-section-npc-edit">
            <div class="sheet-form sheet-form-sm">
                <div class="sheet-form-header">NPC Options</div>
                <div class="sheet-form-body">
                    <div class="sheet-form-group">
                        <label>Name</label>
                        <input type="text" name="attr_character_name">
                    </div>
                    <div class="sheet-form-group">
                        <label>NPC Type</label>
                        <input type="text" name="attr_npc_type">
                    </div>
                    <div class="sheet-form-group">
                        <label>Evasion</label>
                        <input type="text" name="attr_npc_eva">
                        <label>Limit</label>
                        <input type="text" name="attr_npc_evalimit" value="">
                    </div>
                    <div class="sheet-form-group">
                        <label>Damage Reduction</label>
                        <input type="text" name="attr_npc_dr">
                        <label>Type</label>
                        <input type="text" name="attr_npc_drtype" value="">
                    </div>
                    <div class="sheet-form-group">
                        <label>Hit Points</label>
                        <input type="text" name="attr_hp_max">
                        <label>Formula</label>
                        <input type="text" name="attr_npc_hpformula">
                    </div>
                    <div class="sheet-form-group">
                        <label>Speed</label>
                        <input type="text" name="attr_npc_speed">
                    </div>
                    <div class="sheet-form-fieldset sheet-form-fieldset-npc-attributes">
                        <div class="sheet-form-fieldset-header">Attributes</div>
                        <div class="sheet-form-fieldset-body">
                            <div class="sheet-form-group">
                                <label>Pwr</label>
                                <input type="text" name="attr_power" value="1" class="sheet-text-center">
                            </div>
                            <div class="sheet-form-group">
                                <label>Agi</label>
                                <input type="text" name="attr_agility" value="1" class="sheet-text-center">
                            </div>
                            <div class="sheet-form-group">
                                <label>Vit</label>
                                <input type="text" name="attr_vitality" value="1" class="sheet-text-center">
                            </div>
                            <div class="sheet-form-group">
                                <label>Cul</label>
                                <input type="text" name="attr_cultivation" value="1" class="sheet-text-center">
                            </div>
                            <div class="sheet-form-group">
                                <label>Qic</label>
                                <input type="text" name="attr_qi_control" value="1" class="sheet-text-center">
                            </div>
                            <div class="sheet-form-group">
                                <label>Mtl</label>
                                <input type="text" name="attr_mental_strength" value="1" class="sheet-text-center">
                            </div>
                            <div class="sheet-form-group">
                                <label>App</label>
                                <input type="text" name="attr_appearance" value="1" class="sheet-text-center">
                            </div>
                        </div>
                    </div>
                    <div class="sheet-form-fieldset sheet-form-fieldset-npc-skills">
                        <div class="sheet-form-fieldset-header">Skills</div>
                        <div class="sheet-form-fieldset-body">
                            <div class="sheet-form-group">
                                <label>Acrobatics</label>
                                <input type="text" name="attr_npc_acrobatics_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Athletics</label>
                                <input type="text" name="attr_npc_athletics_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Charm</label>
                                <input type="text" name="attr_npc_charm_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Deceit</label>
                                <input type="text" name="attr_npc_deceit_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Disguise</label>
                                <input type="text" name="attr_npc_disguise_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Fine Arts</label>
                                <input type="text" name="attr_npc_fine_arts_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Forgery</label>
                                <input type="text" name="attr_npc_forgery_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>History</label>
                                <input type="text" name="attr_npc_history_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Intuition</label>
                                <input type="text" name="attr_npc_intuition_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Intimidation</label>
                                <input type="text" name="attr_npc_intimidation_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Investigation</label>
                                <input type="text" name="attr_npc_investigation_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Medicine</label>
                                <input type="text" name="attr_npc_medicine_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Navigation</label>
                                <input type="text" name="attr_npc_navigation_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Perception</label>
                                <input type="text" name="attr_npc_perception_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Performance</label>
                                <input type="text" name="attr_npc_performance_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Persuade</label>
                                <input type="text" name="attr_npc_persuade_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Sleight of Hand</label>
                                <input type="text" name="attr_npc_sleight_of_hand_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Stealth</label>
                                <input type="text" name="attr_npc_stealth_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Survival</label>
                                <input type="text" name="attr_npc_survival_bonus" value="0">
                            </div>
                        </div>
                    </div>
                    <div class="sheet-form-group">
                        <label>Damage Hyper Resistances</label>
                        <input type="text" name="attr_npc_hyper_resistances">
                    </div>
                    <div class="sheet-form-group">
                        <label>Damage Resistances</label>
                        <input type="text" name="attr_npc_resistances">
                    </div>
                    <div class="sheet-form-group">
                        <label>Damage Weakness</label>
                        <input type="text" name="attr_npc_weakness">
                    </div>
                    <div class="sheet-form-group">
                        <label>Damage Hyper Weakness</label>
                        <input type="text" name="attr_npc_hyper_weakness">
                    </div>
                    <div class="sheet-form-group">
                        <label>Senses</label>
                        <input type="text" name="attr_npc_senses">
                    </div>
                    <div class="sheet-form-group">
                        <label>Level</label>
                        <input type="text" name="attr_npc_level">
                        <label>XP</label>
                        <input type="text" name="attr_npc_xp">
                    </div>
                    <div class="sheet-form-group">
                        <label class="sheet-form-checkbox">
                            <input type="checkbox" name="attr_npcresponsesflag" value="1">
                            <span>Has Responses</span>
                        </label>
                    </div>
                    <div class="sheet-form-group">
                        <label>Legendary Moves</label>
                        <input type="text" name="attr_npc_legendary_moves" value="0">
                    </div>
                    <div class="sheet-form-fieldset">
                        <div class="sheet-form-fieldset-header">General Options</div>
                        <div class="sheet-form-fieldset-body">
                            <div class="sheet-form-group">
                                <label class="sheet-form-checkbox">
                                    <input type="checkbox" name="attr_npc" value="1">
                                    <span>NPC</span>
                                </label>
                            </div>
                            <div class="sheet-form-group">
                                <label>Whisper Rolls to GM</label>
                                <select name="attr_wtype">
                                    <option value="">Never Whisper Rolls</option>
                                    <option value="@{whispertoggle}">Whisper Toggle</option>
                                    <option value="?{Whisper?|Public Roll,|Whisper Roll,/w gm }">Query Whisper</option>
                                    <option value="/w gm ">Always Whisper Rolls</option>
                                </select>
                            </div>
                            <div class="sheet-form-group">
                                <label>Auto Damage Roll</label>
                                <select name="attr_dtype">
                                    <option value="pick">Don't Auto Roll Damage</option>
                                    <option value="full">Auto Roll Damage</option>
                                </select>
                            </div>
                            <div class="sheet-form-group">
                                <label>NPC Name in Rolls</label>
                                <select name="attr_npc_name_flag">
                                    <option value="{{name=@{character_name}}}">Show</option>
                                    <option value="0">Hide</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="sheet-form-fieldset">
                        <div class="sheet-form-fieldset-header">Talents</div>
                        <div class="sheet-form-fieldset-body">

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="sheet-toggle-unchecked sheet-section-npc-display">
            <div class="sheet-npc-header">
                <div class="sheet-npc-header-name">
                    <button type="roll" name="roll_npc_init" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Initiative}} {{r1=[[@{agility}d6+[[@{initiative_bonus}]][AGI] &{tracker}]]}} {{type=Initiative}}" class="sheet-btn-text">
                        <span name="attr_character_name"></span>
                    </button>
                </div>
                <span name="attr_npc_type"></span>
            </div>
            <div class="sheet-npc-body">
                <div class="sheet-npc-section sheet-npc-section-hp">
                    <button type="roll" name="roll_npc_init" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Initiative}} {{r1=[[@{agility}d6+[[@{initiative_bonus}]][AGI] &{tracker}]]}} {{type=Initiative}}" class="sheet-btn-npc-initiative">
                        <span>t</span>
                        <span>INIT</span>
                    </button>
                    <div>
                        <label>Evasion</label>
                        <span name="attr_npc_eva"></span>
                    </div>
                    <div>
                        <label>Damage Reduction</label>
                        <span name="attr_npc_dr"></span>
                        <input type="hidden" name="attr_npc_drtype" value="">
                        <span name="attr_npc_drtype" class="sheet-display-brackets"></span>
                    </div>
                    <div>
                        <label>Hit Points</label>
                        <span name="attr_hp_max"></span>
                        <button type="roll" name="roll_npc_hpformula" value="@{wtype}&{template:npc} {{type=Hit Points}} @{npc_name_flag} {{rname=Hit Points}} {{mod=@{npc_hpformula}}} {{r1=[[@{npc_hpformula}]]}} charname=@{character_name}" class="sheet-btn-inline">
                            <span name="attr_npc_hpformula" class="sheet-display-brackets"></span>
                        </button>
                    </div>
                    <div>
                        <label>Speed</label>
                        <span name="attr_npc_speed"></span>
                    </div>
                </div>
                <div class="sheet-npc-section sheet-npc-section-abilities">
                    <button type="roll" name="roll_npc_pwr" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Power}} {{r1=[[@{power}d6[PWR]]]}} @{rtype}+[[@{power}]][PWR]]]}} {{type=Ability}}" class="sheet-btn-npc-ability">
                        <span class="sheet-btn-npc-ability-title">POW</span>
                        <span name="attr_power" class="sheet-btn-npc-ability"></span>
                    </button>
                    <button type="roll" name="roll_npc_agi" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Agility}} {{r1=[[@{agility}d6[AGI]]]}} @{rtype}+[[@{agility}]][AGI]]]}} {{type=Ability}}" class="sheet-btn-npc-ability">
                        <span class="sheet-btn-npc-ability-title">AGI</span>
                        <span name="attr_agility" class="sheet-btn-npc-ability"></span>
                    </button>
                    <button type="roll" name="roll_npc_vit" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Vitality}} {{r1=[[@{vitality}d6[VIT]]]}} @{rtype}+[[@{vitality}]][VIT]]]}} {{type=Ability}}" class="sheet-btn-npc-ability">
                        <span class="sheet-btn-npc-ability-title">VIT</span>
                        <span name="attr_vitality" class="sheet-btn-npc-ability"></span>
                    </button>
                    <button type="roll" name="roll_npc_cul" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Cultivation}} {{r1=[[@{cultivation}d6[CUL]]]}} @{rtype}+[[@{cultivation}]][CUL]]]}} {{type=Ability}}" class="sheet-btn-npc-ability">
                        <span class="sheet-btn-npc-ability-title">CUL</span>
                        <span name="attr_cultivation" class="sheet-btn-npc-ability"></span>
                    </button>
                    <button type="roll" name="roll_npc_qic" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Qi Control}} {{r1=[[@{qi_control}d6[QIC]]]}} @{rtype}+[[@{qi_control}]][QIC]]]}} {{type=Ability}}" class="sheet-btn-npc-ability">
                        <span class="sheet-btn-npc-ability-title">QIC</span>
                        <span name="attr_qi_control" class="sheet-btn-npc-ability"></span>
                    </button>
                    <button type="roll" name="roll_npc_mtl" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Mental Strength}} {{r1=[[@{mental_strength}d6[MTL]]]}} @{rtype}+[[@{mental_strength}]][MTL]]]}} {{type=Ability}}" class="sheet-btn-npc-ability">
                        <span class="sheet-btn-npc-ability-title">MTL</span>
                        <span name="attr_mental_strength" class="sheet-btn-npc-ability"></span>
                    </button>
                    <button type="roll" class="sheet-btn-npc-ability">
                        <span class="sheet-btn-npc-ability-title">APP</span>
                        <span name="attr_appearance" class="sheet-btn-npc-ability"></span>
                    </button>
                </div>
                <div class="sheet-npc-section sheet-npc-section-details">
                    <input type="hidden" name="attr_npc_skills_flag" value="1" class="sheet-field-toggle">
                    <div class="sheet-npc-section-skills">
                        <label>Skills</label>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_acrobatics" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Acrobatics}} {{mod=@{npc_acrobatics}}} {{r1=[[@{npc_acrobatics_roll}d6 + @{npc_acrobatics_bonus}]]}} {{type=Skill}}">
                                <span>Acrobatics</span>
                                <span name="attr_npc_acrobatics"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_athletics" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Athletics}} {{mod=@{npc_athletics}}} {{r1=[[@{npc_athletics_roll}d6 + @{npc_athletics_bonus}]]}} {{type=Skill}}">
                                <span>Athletics</span>
                                <span name="attr_npc_athletics"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_charm" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Charm}} {{mod=@{npc_charm}}} {{r1=[[@{npc_charm_roll}d6 + @{npc_charm_bonus}]]}} {{type=Skill}}">
                                <span>Charm</span>
                                <span name="attr_npc_charm"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_deceit" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Deceit}} {{mod=@{npc_deceit}}} {{r1=[[@{npc_deceit_roll}d6 + @{npc_deceit_bonus}]]}} {{type=Skill}}">
                                <span>Deceit</span>
                                <span name="attr_npc_deceit"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_disguise" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Disguise}} {{mod=@{npc_disguise}}} {{r1=[[@{npc_disguise_roll}d6 + @{npc_disguise_bonus}]]}} {{type=Skill}}">
                                <span>Disguise</span>
                                <span name="attr_npc_disguise"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_fine_arts" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Fine Arts}} {{mod=@{npc_fine_arts}}} {{r1=[[@{_rollnpc_fine_arts}d6 + @{npc_fine_arts_bonus}]]}} {{type=Skill}}">
                                <span>Fine Arts</span>
                                <span name="attr_npc_fine_arts"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_forgery" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Forgery}} {{mod=@{npc_forgery}}} {{r1=[[@{npc_forgery_roll}d6 + @{npc_forgery_bonus}]]}} {{type=Skill}}">
                                <span>Forgery</span>
                                <span name="attr_npc_forgery"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_history" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=History}} {{mod=@{npc_history}}} {{r1=[[@{npc_history_roll}d6 + @{npc_history_bonus}]]}} {{type=Skill}}">
                                <span>History</span>
                                <span name="attr_npc_history"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_intuition" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Intuition}} {{mod=@{npc_intuition}}} {{r1=[[@{npc_intuition_roll}d6 + @{npc_intuition_bonus}]]}} {{type=Skill}}">
                                <span>Intuition</span>
                                <span name="attr_npc_intuition"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_intimidation" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Intimidation}} {{mod=@{npc_intimidation}}} {{r1=[[@{npc_intimidation_roll}d6 + @{npc_intimidation_bonus}]]}} {{type=Skill}}">
                                <span>Intimidation</span>
                                <span name="attr_npc_intimidation"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_investigation" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Investigation}} {{mod=@{npc_investigation}}} {{r1=[[@{npc_investigation_roll}d6 + @{npc_investigation_bonus}]]}} {{type=Skill}}">
                                <span>Investigation</span>
                                <span name="attr_npc_investigation"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_medicine" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Medicine}} {{mod=@{npc_medicine}}} {{r1=[[@{npc_medicine_roll}d6 + @{npc_medicine_bonus}]]}} {{type=Skill}}">
                                <span>Medicine</span>
                                <span name="attr_npc_medicine"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_navigation" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Navigation}} {{mod=@{npc_navigation}}} {{r1=[[@{npc_navigation_roll}d6 + @{npc_navigation_bonus}]]}} {{type=Skill}}">
                                <span>Navigation</span>
                                <span name="attr_npc_navigation"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_perception" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Perception}} {{mod=@{npc_perception}}} {{r1=[[@{npc_perception_roll}d6 + @{npc_perception_bonus}]]}} {{type=Skill}}">
                                <span>Perception</span>
                                <span name="attr_npc_perception"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_performance" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Performance}} {{mod=@{npc_performance}}} {{r1=[[@{npc_performance_roll}d6 + @{npc_performance_bonus}]]}} {{type=Skill}}">
                                <span>Performance</span>
                                <span name="attr_npc_performance"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_persuade" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Persuade}} {{mod=@{npc_persuade}}} {{r1=[[@{npc_persuade_roll}d6 + @{npc_persuade_bonus}]]}} {{type=Skill}}">
                                <span>Persuade</span>
                                <span name="attr_npc_persuade"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_sleight_of_hand" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Sleight of Hand}} {{mod=@{npc_sleight_of_hand}}} {{r1_roll=[[@{npc_sleight_of_hand}d6 + @{npc_sleight_of_hand_bonus}]]}} {{type=Skill}}">
                                <span>Sleight of Hand</span>
                                <span name="attr_npc_sleight_of_hand"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_stealth" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Stealth}} {{mod=@{npc_stealth}}} {{r1=[[@{npc_stealth_roll}d6 + @{npc_stealth_bonus}]]}} {{type=Skill}}">
                                <span>Stealth</span>
                                <span name="attr_npc_stealth"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_survival" value="@{wtype}&{template:npc} @{npc_name_flag} {{rname=Survival}} {{mod=@{npc_survival}}} {{r1=[[@{npc_survival_roll}d6 + @{npc_survival_bonus}]]}} {{type=Skill}}">
                                <span>Survival</span>
                                <span name="attr_npc_survival"></span>
                            </button>
                        </span>
                    </div>
                    <input type="hidden" name="attr_npc_hyper_resistances" class="sheet-field-toggle">
                    <div>
                        <label>Damage Hyper Resistances</label>
                        <span name="attr_npc_hyper_resistances"></span>
                    </div>
                    <input type="hidden" name="attr_npc_resistances" class="sheet-field-toggle">
                    <div>
                        <label>Damage Resistances</label>
                        <span name="attr_npc_resistances"></span>
                    </div>
                    <input type="hidden" name="attr_npc_weakness" class="sheet-field-toggle">
                    <div>
                        <label>Damage Weakness</label>
                        <span name="attr_npc_weakness"></span>
                    </div>
                    <input type="hidden" name="attr_npc_hyper_weakness" class="sheet-field-toggle">
                    <div>
                        <label>Damage Hyper Weakness</label>
                        <span name="attr_npc_hyper_weakness"></span>
                    </div>
                    <div>
                        <label>Senses</label>
                        <span name="attr_npc_senses"></span>
                    </div>
                    <div>
                        <label>Level</label>
                        <span name="attr_npc_level"></span>
                        <span name="attr_npc_xp" class="sheet-display-brackets-xp"></span>
                    </div>
                </div>
                <div class="sheet-container-well">
                    <div class="sheet-container-panel sheet-npc-features">
                        <div class="sheet-container-header">Features</div>
                        <div class="sheet-container-body">
                            <fieldset class="repeating_npctrait">
                                <div class="sheet-fieldset-item sheet-fieldset-item-npctrait">
                                    <div class="sheet-checkbox-cog">
                                        <input type="checkbox" name="attr_npc_options-flag" checked="checked" value="on">
                                        <span class="sheet-toggle-icon"></span>
                                    </div>
                                    <input type="checkbox" name="attr_npc_options-flag" checked="checked" class="sheet-toggle" hidden>
                                    <div class="sheet-toggle-checked">
                                        <div class="sheet-form">
                                            <div class="sheet-form-header">Edit Trait</div>
                                            <div class="sheet-form-body">
                                                <div class="sheet-form-group">
                                                    <label>Name:</label>
                                                    <input type="text" name="attr_name">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Description:</label>
                                                    <textarea name="attr_desc"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="sheet-toggle-unchecked">
                                        <div class="sheet-npc-trait">
                                            <div class="sheet-npc-trait-name">
                                                <span name="attr_name"></span>
                                            </div>
                                            <div class="sheet-npc-trait-desc">
                                                <span name="attr_desc"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <input type="hidden" name="attr_dflag" value="pick">
                    <div class="sheet-container-panel sheet-npc-moves">
                        <div class="sheet-container-header">Moves</div>
                        <div class="sheet-container-body">
                            <fieldset class="repeating_npcmove">
                                <div class="sheet-fieldset-item sheet-fieldset-item-npcmove">
                                    <div class="sheet-checkbox-cog">
                                        <input type="checkbox" name="attr_npc_options-flag" checked="checked" value="on">
                                        <span class="sheet-toggle-icon"></span>
                                    </div>
                                    <input type="checkbox" name="attr_npc_options-flag" checked="checked" class="sheet-toggle" hidden>
                                    <div class="sheet-toggle-checked">
                                        <div class="sheet-form">
                                            <div class="sheet-form-header">Edit Move</div>
                                            <div class="sheet-form-body">
                                                <div class="sheet-form-group">
                                                    <label>Name:</label>
                                                    <input type="text" name="attr_name">
                                                    <label class="sheet-form-checkbox">
                                                        <input type="checkbox" name="attr_attack_flag" value="on">
                                                        <span>Attack</span>
                                                    </label>
                                                </div>
                                                <input type="checkbox" name="attr_attack_flag" value="on" class="sheet-toggle" hidden>
                                                <div class="sheet-form-group sheet-toggle-checked">
                                                    <div class="sheet-form-fieldset">
                                                        <div class="sheet-form-fieldset-header">Attack</div>
                                                        <div class="sheet-form-fieldset-body">
                                                            <input type="hidden" name="attr_damage_flag">
                                                            <div class="sheet-form-group">
                                                                <label>Type:</label>
                                                                <select name="attr_attack_type">
                                                                    <option value="Melee">Melee</option>
                                                                    <option value="Ranged">Ranged</option>
                                                                </select>
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Range/Reach:</label>
                                                                <input type="text" name="attr_attack_range">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>To Hit:</label>
                                                                <select name="attr_attack_tohit">
                                                                    <option value="@{power}">Power</option>
                                                                    <option value="@{agility}">Agility</option>
                                                                    <option value="@{vitality}">Vitality</option>
                                                                    <option value="@{cultivation}">Cultivation</option>
                                                                    <option value="@{qi_control}">Qi Control</option>
                                                                    <option value="@{mental_strength}">Mental Strength</option>
                                                                </select>
                                                                <label>Bonus:</label>
                                                                <input type="text" name="attr_attack_bonus">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Damage 1:</label>
                                                                <input type="text" name="attr_attack_damage">
                                                                <select name="attr_attack_damage1attribute">
                                                                    <option value="none">None</option>
                                                                    <option value="@{power}">Power</option>
                                                                    <option value="@{agility}">Agility</option>
                                                                    <option value="@{vitality}">Vitality</option>
                                                                    <option value="@{cultivation}">Cultivation</option>
                                                                    <option value="@{qi_control}">Qi Control</option>
                                                                    <option value="@{mental_strength}">Mental Strength</option>
                                                                </select>
                                                                <label>Bonus:</label>
                                                                <input type="text" name="attr_attack_damage1bonus">
                                                                <label>Type:</label>
                                                                <input type="text" name="attr_attack_damagetype">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Damage 2:</label>
                                                                <input type="text" name="attr_attack_damage2">
                                                                <select name="attr_attack_damage2attribute">
                                                                    <option value="none">None</option>
                                                                    <option value="@{power}">Power</option>
                                                                    <option value="@{agility}">Agility</option>
                                                                    <option value="@{vitality}">Vitality</option>
                                                                    <option value="@{cultivation}">Cultivation</option>
                                                                    <option value="@{qi_control}">Qi Control</option>
                                                                    <option value="@{mental_strength}">Mental Strength</option>
                                                                </select>
                                                                <label>Bonus:</label>
                                                                <input type="text" name="attr_attack_damage2bonus">
                                                                <label>Type:</label>
                                                                <input type="text" name="attr_attack_damagetype2">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Description:</label>
                                                    <select name="attr_show_desc">
                                                        <option value="@{description}">Show</option>
                                                        <option value=" ">Hide</option>
                                                    </select>
                                                </div>
                                                <div class="sheet-form-group">
                                                    <textarea name="attr_description"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="sheet-toggle-unchecked">
                                        <div class="sheet-npc-move">
                                            <button type="roll" name="roll_npc_move" value="@{rollbase}" class="sheet-fieldset-item-npcmove-checked-roll sheet-btn-text">
                                                <div class="sheet-fieldset-item-npcmove-checked-name">
                                                    <span name="attr_name"></span>
                                                </div>
                                                <input type="checkbox" name="attr_attack_flag" value="on" class="sheet-toggle" hidden>
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-fieldset-item-npcmove-checked-attack">
                                                        <span name="attr_attack_type"></span><span> Weapon Attack: </span><span name="attr_attack_tohitrange"></span>
                                                    </div>
                                                    <div class="sheet-fieldset-item-npcmove-checked-onhit">
                                                        <span>Hit: </span><span name="attr_attack_onhit"></span>
                                                    </div>
                                                </div>
                                                <div class="sheet-fieldset-item-npcmove-checked-description">
                                                    <span name="attr_description"></span>
                                                </div>
                                            </button>
                                            <input type="hidden" name="attr_rollbase">
                                            <button type="roll" name="roll_npc_dmg" value="@{wtype}&{template:npcdmg} @{damage_flag} {{dmg1=[[@{attack_damage}]]}} {{dmg1type=@{attack_damagetype}}} {{dmg2=[[@{attack_damage2}]]}} {{dmg2type=@{attack_damagetype2}}}" class="sheet-hidden"></button>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <input type="hidden" name="attr_npcresponsesflag" value="0" class="sheet-field-toggle">
                    <div class="sheet-container-panel sheet-npc-responses">
                        <div class="sheet-container-header">Responses</div>
                        <div class="sheet-container-body">
                            <fieldset class="repeating_npcresponses">
                                <div class="sheet-fieldset-item sheet-fieldset-item-npcresponses">
                                    <div class="sheet-checkbox-cog">
                                        <input type="checkbox" name="attr_npc_options-flag" checked="checked" value="on">
                                        <span class="sheet-toggle-icon"></span>
                                    </div>
                                    <input type="checkbox" name="attr_npc_options-flag" checked="checked" class="sheet-toggle" hidden>
                                    <div class="sheet-toggle-checked">
                                        <div class="sheet-form">
                                            <div class="sheet-form-header">Edit Response</div>
                                            <div class="sheet-form-body">
                                                <div class="sheet-form-group">
                                                    <label>Name:</label>
                                                    <input type="text" name="attr_name">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Description:</label>
                                                    <textarea name="attr_desc"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="sheet-toggle-unchecked">
                                        <div class="sheet-npc-responses">
                                            <button type="roll" name="roll_npc_move" value="@{wtype}&{template:npcmove} @{npc_name_flag} {{rname=@{name}}} {{description=@{desc}}} @{charname_output}" class="sheet-fieldset-item-npcmove-checked-roll sheet-btn-text">
                                                <div class="sheet-npc-response-name">
                                                    <span name="attr_name"></span>
                                                </div>
                                                <div class="sheet-npc-response-description">
                                                    <span name="attr_desc"></span>
                                                </div>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <input type="hidden" name="attr_npc_legendary_moves" value="0" class="sheet-field-toggle">
                    <div class="sheet-container-panel sheet-npc-legendary-moves">
                        <div class="sheet-container-header">Legendary Moves</div>
                        <div class="sheet-container-body">
                            <input type="hidden" name="attr_npc_legendary_move_desc" class="sheet-field-toggle">
                            <div class="sheet-npc-legendary-move-description">
                                <span name="attr_npc_legendary_move_desc"></span>
                            </div>
                            <fieldset class="repeating_npcmove-l">
                                <div class="sheet-fieldset-item sheet-fieldset-item-npcmove">
                                    <div class="sheet-checkbox-cog">
                                        <input type="checkbox" name="attr_npc_options-flag" checked="checked" value="on">
                                        <span class="sheet-toggle-icon"></span>
                                    </div>
                                    <input type="checkbox" name="attr_npc_options-flag" checked="checked" class="sheet-toggle" hidden>
                                    <div class="sheet-toggle-checked">
                                        <div class="sheet-form">
                                            <div class="sheet-form-header">Edit Legendary Move</div>
                                            <div class="sheet-form-body">
                                                <div class="sheet-form-group">
                                                    <label>Name:</label>
                                                    <input type="text" name="attr_name">
                                                    <label class="sheet-form-checkbox">
                                                        <input type="checkbox" name="attr_attack_flag" value="on">
                                                        <span>Attack</span>
                                                    </label>
                                                </div>
                                                <input type="checkbox" name="attr_attack_flag" value="on" class="sheet-toggle" hidden>
                                                <div class="sheet-form-group sheet-toggle-checked">
                                                    <div class="sheet-form-fieldset">
                                                        <div class="sheet-form-fieldset-header">Attack</div>
                                                        <div class="sheet-form-fieldset-body">
                                                            <input type="hidden" name="attr_damage_flag">
                                                            <div class="sheet-form-group">
                                                                <label>Type:</label>
                                                                <select name="attr_attack_type">
                                                                    <option value="Melee">Melee</option>
                                                                    <option value="Ranged">Ranged</option>
                                                                </select>
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Range/Reach:</label>
                                                                <input type="text" name="attr_attack_range">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>To Hit:</label>
                                                                <select name="attr_attack_tohit">
                                                                    <option value="@{power}">Power</option>
                                                                    <option value="@{agility}">Agility</option>
                                                                    <option value="@{vitality}">Vitality</option>
                                                                    <option value="@{cultivation}">Cultivation</option>
                                                                    <option value="@{qi_control}">Qi Control</option>
                                                                    <option value="@{mental_strength}">Mental Strength</option>
                                                                </select>
                                                                <label>Bonus:</label>
                                                                <input type="text" name="attr_attack_bonus">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Damage 1:</label>
                                                                <input type="text" name="attr_attack_damage">
                                                                <select name="attr_attack_damage1attribute">
                                                                    <option value="none">None</option>
                                                                    <option value="@{power}">Power</option>
                                                                    <option value="@{agility}">Agility</option>
                                                                    <option value="@{vitality}">Vitality</option>
                                                                    <option value="@{cultivation}">Cultivation</option>
                                                                    <option value="@{qi_control}">Qi Control</option>
                                                                    <option value="@{mental_strength}">Mental Strength</option>
                                                                </select>
                                                                <label>Bonus:</label>
                                                                <input type="text" name="attr_attack_damage1bonus">
                                                                <label>Type:</label>
                                                                <input type="text" name="attr_attack_damagetype">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Damage 2:</label>
                                                                <input type="text" name="attr_attack_damage2">
                                                                <select name="attr_attack_damage2attribute">
                                                                    <option value="none">None</option>
                                                                    <option value="@{power}">Power</option>
                                                                    <option value="@{agility}">Agility</option>
                                                                    <option value="@{vitality}">Vitality</option>
                                                                    <option value="@{cultivation}">Cultivation</option>
                                                                    <option value="@{qi_control}">Qi Control</option>
                                                                    <option value="@{mental_strength}">Mental Strength</option>
                                                                </select>
                                                                <label>Bonus:</label>
                                                                <input type="text" name="attr_attack_damage2bonus">
                                                                <label>Type:</label>
                                                                <input type="text" name="attr_attack_damagetype2">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Description:</label>
                                                    <select name="attr_show_desc">
                                                        <option value="@{description}">Show</option>
                                                        <option value=" ">Hide</option>
                                                    </select>
                                                </div>
                                                <div class="sheet-form-group">
                                                    <textarea name="attr_description"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="sheet-toggle-unchecked">
                                        <div class="sheet-npc-legendary-moves">
                                            <button type="roll" name="roll_npc_move" value="@{rollbase}" class="sheet-fieldset-item-npcmove-checked-roll sheet-btn-text">
                                                <div class="sheet-fieldset-item-npcmove-checked-name">
                                                    <span name="attr_name"></span>
                                                </div>
                                                <input type="checkbox" name="attr_attack_flag" value="on" class="sheet-toggle" hidden>
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-fieldset-item-npcmove-checked-attack">
                                                        <span name="attr_attack_type"></span><span> Weapon Attack: </span><span name="attr_attack_tohitrange"></span>
                                                    </div>
                                                    <div class="sheet-fieldset-item-npcmove-checked-onhit">
                                                        <span>Hit: </span><span name="attr_attack_onhit"></span>
                                                    </div>
                                                </div>
                                                <div class="sheet-fieldset-item-npcmove-checked-description">
                                                    <span name="attr_description"></span>
                                                </div>
                                            </button>
                                            <input type="hidden" name="attr_rollbase">
                                            <button type="roll" name="roll_npc_dmg" value="@{wtype}&{template:npcdmg} @{damage_flag} {{dmg1=[[@{attack_damage}]]}} {{dmg1type=@{attack_damagetype}}} {{dmg2=[[@{attack_damage2}]]}} {{dmg2type=@{attack_damagetype2}}}" class="sheet-hidden"></button>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>                    
                </div>
            </div>
        </div>
        <div class="sheet-section-npc-footer">
            <p>Venator Ignis's JTTH Character Sheet</p>
        </div>
    </div>

    <div class="sheet-section-pc">
        <div class="sheet-section-pc-header"></div>
        <div class="sheet-section-pc-body"></div>
        <div class="sheet-section-pc-footer">
            <p>Venator Ignis's JTTH Character Sheet</p>
        </div>
    </div>

    <div class="sheet-variables">
        <input type="hidden" name="attr_level" value="1">
        <input type="hidden" name="attr_hitdie_final" value="">
        <input type="hidden" name="attr_initiative_bonus" value="0">
        <input type="hidden" name="attr_npc_legendary_move_desc" value="">
        <input type="hidden" name="attr_global_damage_mod_roll" value="0">
        <input type="hidden" name="attr_global_damage_mod_type" value="">
        <input type="hidden" name="attr_global_attack_mod" value="">
        <input type="hidden" name="attr_global_check_mod" value="">
        <input type="hidden" name="attr_global_skill_mod" value="">
        <!-- ATTRIBUTES -->
        <input type="hidden" name="attr_power" value="0">
        <input type="hidden" name="attr_agility" value="0">
        <input type="hidden" name="attr_vitality" value="0">
        <input type="hidden" name="attr_cultivation" value="0">
        <input type="hidden" name="attr_qi_control" value="0">
        <input type="hidden" name="attr_mental_strength" value="0">
        <!-- ATTRIBUTE BONUS -->
        <input type="hidden" name="attr_power_check_bonus" value="0">
        <input type="hidden" name="attr_agility_check_bonus" value="0">
        <input type="hidden" name="attr_vitality_check_bonus" value="0">
        <input type="hidden" name="attr_cultivation_check_bonus" value="0">
        <input type="hidden" name="attr_qi_control_check_bonus" value="0">
        <input type="hidden" name="attr_mental_strength_check_bonus" value="0">
        <!-- NPC SKILL FULL -->
        <input type='hidden' name='attr_npc_acrobatics' value=''>
        <input type='hidden' name='attr_npc_athletics' value=''>
        <input type='hidden' name='attr_npc_charm' value=''>
        <input type='hidden' name='attr_npc_deceit' value=''>
        <input type='hidden' name='attr_npc_disguise' value=''>
        <input type='hidden' name='attr_npc_fine_arts' value=''>
        <input type='hidden' name='attr_npc_forgery' value=''>
        <input type='hidden' name='attr_npc_history' value=''>
        <input type='hidden' name='attr_npc_intuition' value=''>
        <input type='hidden' name='attr_npc_intimidate' value=''>
        <input type='hidden' name='attr_npc_investigate' value=''>
        <input type='hidden' name='attr_npc_medicine' value=''>
        <input type='hidden' name='attr_npc_navigation' value=''>
        <input type='hidden' name='attr_npc_perception' value=''>
        <input type='hidden' name='attr_npc_performance' value=''>
        <input type='hidden' name='attr_npc_persuade' value=''>
        <input type='hidden' name='attr_npc_sleight_of_hand' value=''>
        <input type='hidden' name='attr_npc_stealth' value=''>
        <input type='hidden' name='attr_npc_survival' value=''>
        <!-- NPC SKILL ROLL -->
        <input type="hidden" name="attr_npc_acrobatics_roll" value="0">
        <input type="hidden" name="attr_npc_athletics_roll" value="0">
        <input type="hidden" name="attr_npc_charm_roll" value="0">
        <input type="hidden" name="attr_npc_deceit_roll" value="0">
        <input type="hidden" name="attr_npc_disguise_roll" value="0">
        <input type="hidden" name="attr_npc_fine_arts_roll" value="0">
        <input type="hidden" name="attr_npc_forgery_roll" value="0">
        <input type="hidden" name="attr_npc_history_roll" value="0">
        <input type="hidden" name="attr_npc_intuition_roll" value="0">
        <input type="hidden" name="attr_npc_intimidation_roll" value="0">
        <input type="hidden" name="attr_npc_investigation_roll" value="0">
        <input type="hidden" name="attr_npc_medicine_roll" value="0">
        <input type="hidden" name="attr_npc_navigation_roll" value="0">
        <input type="hidden" name="attr_npc_perception_roll" value="0">
        <input type="hidden" name="attr_npc_performance_roll" value="0">
        <input type="hidden" name="attr_npc_persuade_roll" value="0">
        <input type="hidden" name="attr_npc_sleight_of_hand_roll" value="0">
        <input type="hidden" name="attr_npc_stealth_roll" value="0">
        <input type="hidden" name="attr_npc_survival_roll" value="0">
        <!-- NPC SKILL BONUS -->
        <input type='hidden' name='attr_npc_acrobatics_bonus' value='0'>
        <input type='hidden' name='attr_npc_athletics_bonus' value='0'>
        <input type='hidden' name='attr_npc_charm_bonus' value='0'>
        <input type='hidden' name='attr_npc_deceit_bonus' value='0'>
        <input type='hidden' name='attr_npc_disguise_bonus' value='0'>
        <input type='hidden' name='attr_npc_fine_arts_bonus' value='0'>
        <input type='hidden' name='attr_npc_forgery_bonus' value='0'>
        <input type='hidden' name='attr_npc_history_bonus' value='0'>
        <input type='hidden' name='attr_npc_intuition_bonus' value='0'>
        <input type='hidden' name='attr_npc_intimidate_bonus' value='0'>
        <input type='hidden' name='attr_npc_investigate_bonus' value='0'>
        <input type='hidden' name='attr_npc_medicine_bonus' value='0'>
        <input type='hidden' name='attr_npc_navigation_bonus' value='0'>
        <input type='hidden' name='attr_npc_perception_bonus' value='0'>
        <input type='hidden' name='attr_npc_performance_bonus' value='0'>
        <input type='hidden' name='attr_npc_persuade_bonus' value='0'>
        <input type='hidden' name='attr_npc_sleight_of_hand_bonus' value='0'>
        <input type='hidden' name='attr_npc_stealth_bonus' value='0'>
        <input type='hidden' name='attr_npc_survival_bonus' value='0'>
        <!-- PLAYER SKILL FULL -->
        <input type='hidden' name='attr_acrobatics' value='0'>
        <input type='hidden' name='attr_athletics' value='0'>
        <input type='hidden' name='attr_charm' value='0'>
        <input type='hidden' name='attr_deceit' value='0'>
        <input type='hidden' name='attr_disguise' value='0'>
        <input type='hidden' name='attr_fine_arts' value='0'>
        <input type='hidden' name='attr_forgery' value='0'>
        <input type='hidden' name='attr_history' value='0'>
        <input type='hidden' name='attr_intuition' value='0'>
        <input type='hidden' name='attr_intimidate' value='0'>
        <input type='hidden' name='attr_investigate' value='0'>
        <input type='hidden' name='attr_medicine' value='0'>
        <input type='hidden' name='attr_navigation' value='0'>
        <input type='hidden' name='attr_perception' value='0'>
        <input type='hidden' name='attr_performance' value='0'>
        <input type='hidden' name='attr_persuade' value='0'>
        <input type='hidden' name='attr_sleight_of_hand' value='0'>
        <input type='hidden' name='attr_stealth' value='0'>
        <input type='hidden' name='attr_survival' value='0'>
        <!-- PLAYER SKILL ROLL -->
        <input type='hidden' name='attr_acrobatics_roll' value='0'>
        <input type='hidden' name='attr_athletics_roll' value='0'>
        <input type='hidden' name='attr_charm_roll' value='0'>
        <input type='hidden' name='attr_deceit_roll' value='0'>
        <input type='hidden' name='attr_disguise_roll' value='0'>
        <input type='hidden' name='attr_fine_arts_roll' value='0'>
        <input type='hidden' name='attr_forgery_roll' value='0'>
        <input type='hidden' name='attr_history_roll' value='0'>
        <input type='hidden' name='attr_intuition_roll' value='0'>
        <input type='hidden' name='attr_intimidate_roll' value='0'>
        <input type='hidden' name='attr_investigate_roll' value='0'>
        <input type='hidden' name='attr_medicine_roll' value='0'>
        <input type='hidden' name='attr_navigation_roll' value='0'>
        <input type='hidden' name='attr_perception_roll' value='0'>
        <input type='hidden' name='attr_performance_roll' value='0'>
        <input type='hidden' name='attr_persuade_roll' value='0'>
        <input type='hidden' name='attr_sleight_of_hand_roll' value='0'>
        <input type='hidden' name='attr_stealth_roll' value='0'>
        <input type='hidden' name='attr_survival_roll' value='0'>
        <!-- PLAYER SKILL BONUS -->
        <input type='hidden' name='attr_acrobatics_bonus' value='0'>
        <input type='hidden' name='attr_athletics_bonus' value='0'>
        <input type='hidden' name='attr_charm_bonus' value='0'>
        <input type='hidden' name='attr_deceit_bonus' value='0'>
        <input type='hidden' name='attr_disguise_bonus' value='0'>
        <input type='hidden' name='attr_fine_arts_bonus' value='0'>
        <input type='hidden' name='attr_forgery_bonus' value='0'>
        <input type='hidden' name='attr_history_bonus' value='0'>
        <input type='hidden' name='attr_intuition_bonus' value='0'>
        <input type='hidden' name='attr_intimidate_bonus' value='0'>
        <input type='hidden' name='attr_investigate_bonus' value='0'>
        <input type='hidden' name='attr_medicine_bonus' value='0'>
        <input type='hidden' name='attr_navigation_bonus' value='0'>
        <input type='hidden' name='attr_perception_bonus' value='0'>
        <input type='hidden' name='attr_performance_bonus' value='0'>
        <input type='hidden' name='attr_persuade_bonus' value='0'>
        <input type='hidden' name='attr_sleight_of_hand_bonus' value='0'>
        <input type='hidden' name='attr_stealth_bonus' value='0'>
        <input type='hidden' name='attr_survival_bonus' value='0'>
    </div>

    <div class="sheet-rolltemplate">
        <div class="sheet-rolltemplates">
            <rolltemplate class="sheet-rolltemplate-atk">
                <div class="container">
                    <div class="result">
                        <div class="adv">
                            <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                        </div>
                        <div class="advspacer"></div>
                        <div class="adv">
                            <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                        </div>
                    </div>
                    {{#range}}
                        <div class="sublabel">
                            <span>{{range}}</span>
                        </div>
                    {{/range}}
                    <div class="label">
                        {{#rollTotal() r1 r2}}{{/rollTotal() r1 r2}}
                    </div>
                    {{#charname}}
                        <div class="charname">
                            <span>{{charname}}</span>
                        </div>
                    {{/charname}}
                </div>
                {{#desc}}
                    <div class="desc info">
                        <span>
                            <span class="top"></span><span class="middle">{{desc}}</span><span class="bottom"></span>
                        </span>
                    </div>
                {{/desc}}
            </rolltemplate>

            <rolltemplate class="sheet-rolltemplate-atkdmg">
                {{#attack}}
                    <div class="container atk">
                        <div class="result">
                            <div class="adv">
                                <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                            </div>
                        </div>
                        {{#range}}
                            <div class="sublabel">
                                <span>{{range}}</span>
                            </div>
                        {{/range}}
                        <div class="label">
                            <span>{{rname}}<span class="grey">, {{innate}}</span>{{/innate}}{{#attack}} <span>({{mod}})</span>{{/attack}}</span>
                        </div>
                        {{#charname}}
                            <div class="charname">
                                <span>{{charname}}</span>
                            </div>
                        {{/charname}}
                    </div>
                {{/attack}}
                {{#desc}}
                    <div class="desc info">
                        <span>
                            <span class="top"></span><span class="middle">{{desc}}</span><span class="bottom"></span>
                        </span>
                    </div>
                {{/desc}}
                {{#globaldamage}}
                    {{#^rollTotal() globaldamage 0}}
                        <div class="desc">
                            <span>
                                {{globaldamage}}
                                {{#attack}}
                                    {{#rollTotal() r1 r2}}{{/rollTotal() r1 r2}}
                                {{/attack}}
                            </span>
                            <span class="sublabel">{{globaldamagetype}}</span>
                        </div>
                    {{/^rollTotal() globaldamage 0}}
                {{/globaldamage}}
                {{#damage}}
                    <div class="container damagetemplate">
                        <div class="result">
                            {{#dmg1flag}}
                                {{^dmg2flag}}
                                    <div class="solo">
                                        <span class="damage">
                                            {{dmg1}}
                                            {{#attack}}
                                                {{#rollTotal() r1 r2}}{{/rollTotal() r1 r2}}
                                            {{/attack}}
                                        </span>
                                        <span class="sublabel">{{dmg1type}}</span>
                                    </div>
                                {{/dmg2flag}}
                            {{/dmg1flag}}
                            {{#dmg2flag}}
                                {{^dmg1flag}}
                                    <div class="solo">
                                        <span class="damage">
                                            {{dmg2}}
                                            {{#attack}}
                                                {{#rollTotal() r1 r2}}{{/rollTotal() r1 r2}}
                                            {{/attack}}
                                        </span>
                                        <span class="sublabel">{{dmg2type}}</span>
                                    </div>
                                {{/dmg1flag}}
                            {{/dmg2flag}}
                            {{#dmg1flag}}
                                {{#dmg2flag}}
                                    <div class="adv">
                                        <span class="damage">
                                            {{dmg1}}
                                            {{#attack}}
                                                {{#rollTotal() r1 r2}}{{/rollTotal() r1 r2}}
                                            {{/attack}}
                                        </span>
                                        <span class="sublabel">{{dmg1type}}</span>
                                    </div>
                                    <div class="advspacer"></div>
                                    <div class="adv">
                                        <span>
                                            {{dmg2}}
                                            {{#attack}}
                                                {{#rollTotal() r1 r2}}{{/rollTotal() r1 r2}}
                                            {{/attack}}
                                        </span>
                                        <span class="sublabel">{{dmg2type}}</span>
                                    </div>
                                {{/dmg2flag}}
                            {{/dmg1flag}}
                        </div>
                        {{^attack}}
                            {{#range}}
                                <div class="sublabel">
                                    <span>{{range}}</span>
                                </div>
                            {{/range}}
                            <div class="label">
                                <span>{{rname}}</span><span class="grey">, {{innate}}</span>{{/innate}}
                            </div>
                            {{#charname}}
                                <div class="charname">
                                    <span>{{charname}}</span>
                                </div>
                            {{/charname}}
                        {{/attack}}
                    </div>
                {{/damage}}
            </rolltemplate>

            <rolltemplate class="sheet-rolltemplate-desc">
                <div class="desc info">
                    <span>
                        <span class="top"></span><span class="middle">{{description}}</span><span class="bottom"></span>
                    </span>
                </div>
            </rolltemplate>

            <rolltemplate class="sheet-rolltemplate-dmg">
                {{^attack}}
                    {{#desc}}
                        <div class="desc info">
                            <span>
                                <span class="top"></span><span class="middle">{{desc}}</span><span class="bottom"></span>
                            </span>
                        </div>
                    {{/desc}}
                {{/attack}}
                {{#globaldamage}}
                    {{#^rollTotal() globaldamage 0}}
                        <div class="desc">
                            <span>{{globaldamage}}</span>
                            <span class="sublabel">{{globaldamagetype}}</span>
                        </div>
                    {{/^rollTotal() globaldamage 0}}
                {{/globaldamage}}
                <div class="container damagetemplate">
                    <div class="result">
                        {{#dmg1flag}}
                            {{^dmg2flag}}
                                <div class="solo">
                                    <span class="damage">{{dmg1}}</span>
                                    <span class="sublabel">{{dmg1type}}</span>
                                </div>
                            {{/dmg2flag}}
                        {{/dmg1flag}}
                        {{#dmg2flag}}
                            {{^dmg1flag}}
                                <div class="solo">
                                    <span class="damage">{{dmg2}}</span>
                                    <span class="sublabel">{{dmg2type}}</span>
                                </div>
                            {{/dmg1flag}}
                        {{/dmg2flag}}
                        {{#dmg1flag}}
                            {{#dmg2flag}}
                                <div class="adv">
                                    <span class="damage">{{dmg1}}</span>
                                    <span class="sublabel">{{dmg1type}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span class="damage">{{dmg2}}</span>
                                    <span class="sublabel">{{dmg2type}}</span>
                                </div>
                            {{/dmg2flag}}
                        {{/dmg1flag}}
                    </div>
                    {{^attack}}
                        {{#range}}
                            <div class="sublabel" style="color: black;">
                                <span>{{range}}</span>
                            </div>
                        {{/range}}
                        <div class="label">
                            <span>{{rname}}</span><span class="grey">, {{innate}}</span>{{/innate}}
                        </div>
                        {{#charname}}
                            <div class="charname">
                                <span>{{charname}}</span>
                            </div>
                        {{/charname}}
                    {{/attack}}
                </div>
            </rolltemplate>

            <rolltemplate class="sheet-rolltemplate-npc">
                <div class="row header">
                    <span>{{rname}}</span>
                </div>
                {{#name}}
                    <div class="row subheader">
                        <span class="italics">{{name}}</span>
                    </div>
                {{/name}}
                <div class="row">
                    <span class="italics">{{type}}: </span><span>{{r1}}</span>
                </div>
            </rolltemplate>

            <rolltemplate class="sheet-rolltemplate-npcmove">
                <div class="container">
                    <div class="row header">
                        <span>{{rname}}</span>
                    </div>
                    {{#name}}
                        <div class="row subheader">
                            <span class="italics">{{name}}</span>
                        </div>
                    {{/name}}
                    {{#range}}
                        <div class="sublabel">
                            <span>{{range}}</span>
                        </div>
                    {{/range}}
                    {{#attack}}
                    <div class="row">
                        <span class="italics">Attack: </span><span>{{r1}}</span><span> | </span><span>{{r2}}</span>
                    </div>
                    {{/attack}}
                    {{#description}}
                    <div class="row">
                        <span class="desc">{{description}}</span>
                    </div>
                    {{/description}}
                </div>
                {{#damage}}
                    <div class="container dmgcontainer damagetemplate">
                        <span class="italics">Damage: </span>
                        <span>
                            {{#dmg1flag}}
                                {{dmg1}}{{dmg1type}}
                            {{/dmg1flag}}
                            {{#dmg1flag}}{{#dmg2flag}} + {{/dmg2flag}}{{/dmg1flag}}
                            {{#dmg2flag}}
                                {{dmg2}}{{dmg2type}}
                            {{/dmg2flag}}
                        </span>
                    </div>
                {{/damage}}
            </rolltemplate>

            <rolltemplate class="sheet-rolltemplate-npcatk">
                <div class="row header">
                    {{rname}}
                </div>
                {{#name}}
                    <div class="row subheader">
                        <span class="italics">{{name}}</span>
                    </div>
                {{/name}}
                {{#range}}
                    <div class="sublabel">
                        <span>{{range}}</span>
                    </div>
                {{/range}}
                <div class="row">
                    <span>{{r1}}</span><span> | </span><span>{{r2}}</span>
                </div>
                {{#description}}
                    <div class="row">
                        <span class="desc">{{description}}</span>
                    </div>
                {{/description}}
            </rolltemplate>

            <rolltemplate class="sheet-rolltemplate-npcdmg">
                <div class="container dmgcontainer damagetemplate">
                    <span class="italics">Damage: </span>
                    <span>
                        {{#dmg1flag}}
                            {{dmg1}}{{dmg1type}}
                        {{/dmg1flag}}
                        {{#dmg1flag}}{{#dmg2flag}} + {{/dmg2flag}}{{/dmg1flag}}
                        {{#dmg2flag}}
                            {{dmg2}}{{dmg2type}}
                        {{/dmg2flag}}
                    </span>
                </div>
            </rolltemplate>

            <rolltemplate class="sheet-rolltemplate-simple">
                <div class="container">
                    <div class="result">
                        <div class="adv">
                            <span>{{r1}}{{#global}} + {{global}}{{/global}}</span>
                        </div>
                        <div class="advspacer"></div>
                        <div class="adv">
                            <span>{{r2}}{{#global}} + {{global}}{{/global}}</span>
                        </div>
                    </div>
                    <div class="label">
                        <span>{{rname}}{{#mod}} <span>({{mod}})</span>{{/mod}}</span>
                    </div>
                    {{#charname}}
                        <div class="charname">
                            <span>{{charname}}</span>
                        </div>
                    {{/charname}}
                </div>
            </rolltemplate>

            <rolltemplate class="sheet-rolltemplate-technique">
                <div class="container">
                    <div class="title row">
                        <span>{{name}}</span>
                    </div>
                    <div class="italics row">
                        <span>{{level}}</span>
                    </div>
                    <div class="spacer"></div>
                    {{#executiontime}}
                        <div class="row">
                            <span class="bold">Execution Time:</span> <span>{{executiontime}}</span>
                        </div>
                    {{/executiontime}}
                    {{#range}}
                        <div class="row">
                            <span class="bold">Range:</span> <span>{{range}}</span>
                        </div>
                    {{/range}}
                    {{#duration}}
                        <div class="row">
                            <span class="bold">Duration:</span> <span>{{duration}}</span>
                        </div>
                    {{/duration}}
                    <div class="spacer"></div>
                    {{#description}}
                        <div class="row">
                            <span class="description">{{description}}</span>
                        </div>
                    {{/description}}
                </div>
            </rolltemplate>

            <rolltemplate class="sheet-rolltemplate-features">
                <div class="row header">
                    <span>{{name}}</span>
                </div>
                {{#source}}
                <div class="row subheader">
                    <span class="italics">{{#charname}}{{charname}} {{/charname}}{{source}}</span>
                </div>
                {{/source}}
                {{#description}}
                    <div class="row">
                        <span class="desc">{{description}}</span>
                    </div>
                {{/description}}
            </rolltemplate>
        </div>
    </div>

    <script type="text/worker">
        on("change:agility change:power change:mental_strength change:appearance change:qi_control", function(eventinfo) {
            update_npc_skills();
            update_npc_moves();
            update_npc_legendary_moves();
        });
        
        on("change:npc_acrobatics_bonus change:npc_athletics_bonus change:npc_charm_bonus change:npc_deceit_bonus change:npc_disguise_bonus change:npc_fine_arts_bonus change:npc_forgery_bonus change:npc_history_bonus change:npc_intuition_bonus change:npc_intimidation_bonus change:npc_investigation_bonus change:npc_medicine_bonus change:npc_navigation_bonus change:npc_perception_bonus change:npc_performance_bonus change:npc_persuade_bonus change:npc_sleight_of_hand_bonus change:npc_stealth_bonus change:npc_survival_bonus change:agility change:power change:mental_strength change:appearance change:qi_control", function(eventinfo) {
            update_npc_skills();
            console.log("Updating Skills");
        });
        
        on("change:repeating_npcmove:name change:repeating_npcmove:attack_flag change:repeating_npcmove:attack_type change:repeating_npcmove:attack_range change:repeating_npcmove:attack_tohit change:repeating_npcmove:attack_bonus change:repeating_npcmove:attack_damage change:repeating_npcmove:attack_damage1attribute change:repeating_npcmove:attack_damage1bonus change:repeating_npcmove:attack_damagetype change:repeating_npcmove:attack_damage2 change:repeating_npcmove:attack_damage2attribute change:repeating_npcmove:attack_damage2bonus change:repeating_npcmove:attack_damagetype2 change:repeating_npcmove:description change:power change:agility change:vitality change:cultivation change:qi_control change:mental_strength", function(eventinfo) {
            update_npc_moves();
            console.log("Updating Moves");
        });
        
        on("change:repeating_npcmove-l:name change:repeating_npcmove-l:attack_flag change:repeating_npcmove-l:attack_type change:repeating_npcmove-l:attack_range change:repeating_npcmove-l:attack_tohit change:repeating_npcmove-l:attack_bonus change:repeating_npcmove-l:attack_damage change:repeating_npcmove-l:attack_damage1attribute change:repeating_npcmove-l:attack_damage1bonus change:repeating_npcmove-l:attack_damagetype change:repeating_npcmove-l:attack_damage2 change:repeating_npcmove-l:attack_damage2attribute change:repeating_npcmove-l:attack_damage2bonus change:repeating_npcmove-l:attack_damagetype2 change:repeating_npcmove-l:description change:power change:agility change:vitality change:cultivation change:qi_control change:mental_strength", function(eventinfo) {
            update_npc_legendary_moves();
            console.log("Updating Legendary Moves");
        });
        
        on("change:dtype", function(eventinfo) {
            if (eventinfo.sourceType && eventinfo.sourceType === "sheetworker") {
                return;
            }
            update_npc_moves();
            update_npc_legendary_moves();
            console.log("Updating DType");
        });
        
        var update_npc_skills = function() {
            getAttrs(["npc_acrobatics_bonus", "npc_athletics_bonus", "npc_charm_bonus", "npc_deceit_bonus", "npc_disguise_bonus", "npc_fine_arts_bonus", "npc_forgery_bonus", "npc_history_bonus", "npc_intuition_bonus", "npc_intimidation_bonus", "npc_investigation_bonus", "npc_medicine_bonus", "npc_navigation_bonus", "npc_perception_bonus", "npc_performance_bonus", "npc_persuade_bonus", "npc_sleight_of_hand_bonus", "npc_stealth_bonus", "npc_survival_bonus", "agility", "power", "mental_strength", "appearance", "qi_control"], function(v) {
                var update = {};   
        
                // Calculate base values
                var agility = parseInt(v.agility) || 0;
                var power = parseInt(v.power) || 0;
                var mental_strength = parseInt(v.mental_strength) || 0;
                var appearance = parseInt(v.appearance) || 0;
                var qi_control = parseInt(v.qi_control) || 0;
        
                update["npc_acrobatics_roll"] = agility;
                update["npc_athletics_roll"] = power;
                update["npc_charm_roll"] = Math.round(mental_strength + appearance);
                update["npc_deceit_roll"] = Math.round(mental_strength + appearance);
                update["npc_disguise_roll"] = Math.round(mental_strength + appearance);
                update["npc_fine_arts_roll"] = Math.round(agility / 2 + mental_strength / 2);
                update["npc_forgery_roll"] = Math.round(agility / 2 + mental_strength / 2);
                update["npc_history_roll"] = Math.round(qi_control / 2 + mental_strength / 2);
                update["npc_intuition_roll"] = mental_strength;
                update["npc_intimidation_roll"] = Math.round(power + appearance);
                update["npc_investigation_roll"] = mental_strength;
                update["npc_medicine_roll"] = Math.round(qi_control / 2 + mental_strength / 2);
                update["npc_navigation_roll"] = Math.round(agility / 2 + mental_strength / 2);
                update["npc_perception_roll"] = mental_strength;
                update["npc_performance_roll"] = Math.round(agility + appearance);
                update["npc_persuade_roll"] = Math.round(mental_strength + appearance);
                update["npc_sleight_of_hand_roll"] = agility;
                update["npc_stealth_roll"] = agility;
                update["npc_survival_roll"] = Math.round(power / 2 + mental_strength / 2);
        
                // Calculate full rolls
                update["npc_acrobatics"] = update["npc_acrobatics_roll"] + (parseInt(v.npc_acrobatics_bonus) ? `d6 + ${parseInt(v.npc_acrobatics_bonus)}` : 'd6');
                update["npc_athletics"] = update["npc_athletics_roll"] + (parseInt(v.npc_athletics_bonus) ? `d6 + ${parseInt(v.npc_athletics_bonus)}` : 'd6');
                update["npc_charm"] = update["npc_charm_roll"] + (parseInt(v.npc_charm_bonus) ? `d6 + ${parseInt(v.npc_charm_bonus)}` : 'd6');
                update["npc_deceit"] = update["npc_deceit_roll"] + (parseInt(v.npc_deceit_bonus) ? `d6 + ${parseInt(v.npc_deceit_bonus)}` : 'd6');
                update["npc_disguise"] = update["npc_disguise_roll"] + (parseInt(v.npc_disguise_bonus) ? `d6 + ${parseInt(v.npc_disguise_bonus)}` : 'd6');
                update["npc_fine_arts"] = update["npc_fine_arts_roll"] + (parseInt(v.npc_fine_arts_bonus) ? `d6 + ${parseInt(v.npc_fine_arts_bonus)}` : 'd6');
                update["npc_forgery"] = update["npc_forgery_roll"] + (parseInt(v.npc_forgery_bonus) ? `d6 + ${parseInt(v.npc_forgery_bonus)}` : 'd6');
                update["npc_history"] = update["npc_history_roll"] + (parseInt(v.npc_history_bonus) ? `d6 + ${parseInt(v.npc_history_bonus)}` : 'd6');
                update["npc_intuition"] = update["npc_intuition_roll"] + (parseInt(v.npc_intuition_bonus) ? `d6 + ${parseInt(v.npc_intuition_bonus)}` : 'd6');
                update["npc_intimidation"] = update["npc_intimidation_roll"] + (parseInt(v.npc_intimidation_bonus) ? `d6 + ${parseInt(v.npc_intimidation_bonus)}` : 'd6');
                update["npc_investigation"] = update["npc_investigation_roll"] + (parseInt(v.npc_investigation_bonus) ? `d6 + ${parseInt(v.npc_investigation_bonus)}` : 'd6');
                update["npc_medicine"] = update["npc_medicine_roll"] + (parseInt(v.npc_medicine_bonus) ? `d6 + ${parseInt(v.npc_medicine_bonus)}` : 'd6');
                update["npc_navigation"] = update["npc_navigation_roll"] + (parseInt(v.npc_navigation_bonus) ? `d6 + ${parseInt(v.npc_navigation_bonus)}` : 'd6');
                update["npc_perception"] = update["npc_perception_roll"] + (parseInt(v.npc_perception_bonus) ? `d6 + ${parseInt(v.npc_perception_bonus)}` : 'd6');
                update["npc_performance"] = update["npc_performance_roll"] + (parseInt(v.npc_performance_bonus) ? `d6 + ${parseInt(v.npc_performance_bonus)}` : 'd6');
                update["npc_persuade"] = update["npc_persuade_roll"] + (parseInt(v.npc_persuade_bonus) ? `d6 + ${parseInt(v.npc_persuade_bonus)}` : 'd6');
                update["npc_sleight_of_hand"] = update["npc_sleight_of_hand_roll"] + (parseInt(v.npc_sleight_of_hand_bonus) ? `d6 + ${parseInt(v.npc_sleight_of_hand_bonus)}` : 'd6');
                update["npc_stealth"] = update["npc_stealth_roll"] + (parseInt(v.npc_stealth_bonus) ? `d6 + ${parseInt(v.npc_stealth_bonus)}` : 'd6');
                update["npc_survival"] = update["npc_survival_roll"] + (parseInt(v.npc_survival_bonus) ? `d6 + ${parseInt(v.npc_survival_bonus)}` : 'd6');
        
                setAttrs(update, {
                    silent: true
                });
            });
        };
        
        var update_npc_moves = function() {
            getSectionIDs("repeating_npcmove", function(idarray) {
                _.each(idarray, function(id) {
                    getAttrs([
                        `repeating_npcmove_${id}_name`,
                        `repeating_npcmove_${id}_attack_flag`,
                        `repeating_npcmove_${id}_attack_type`,
                        `repeating_npcmove_${id}_attack_range`,
                        `repeating_npcmove_${id}_attack_tohit`,
                        `repeating_npcmove_${id}_attack_bonus`,
                        `repeating_npcmove_${id}_attack_damage`,
                        `repeating_npcmove_${id}_attack_damage1attribute`,
                        `repeating_npcmove_${id}_attack_damage1bonus`,
                        `repeating_npcmove_${id}_attack_damagetype`,
                        `repeating_npcmove_${id}_attack_damage2`,
                        `repeating_npcmove_${id}_attack_damage2attribute`,
                        `repeating_npcmove_${id}_attack_damage2bonus`,
                        `repeating_npcmove_${id}_attack_damagetype2`,
                        `repeating_npcmove_${id}_show_desc`,
                        `repeating_npcmove_${id}_description`,
                        "power", "agility", "vitality", "cultivation", "qi_control", "mental_strength", "dtype"
                    ], function(v) {
                        var update = {};
        
                        var attackFlag = v[`repeating_npcmove_${id}_attack_flag`] === "on" ? 1 : 0;
                        var atkFlag = (attackFlag === 1) ? "{{attack=1}}" : "";
        
                        var attackType = v[`repeating_npcmove_${id}_attack_type`];
                        var attackRange = v[`repeating_npcmove_${id}_attack_range`];
                        var attackToHit = v[`repeating_npcmove_${id}_attack_tohit`].replace("@{", "").replace("}", "");
                        var attackBonus = parseInt(v[`repeating_npcmove_${id}_attack_bonus`]) || 0;
        
                        var damage1 = v[`repeating_npcmove_${id}_attack_damage`];
                        var damage1Attribute = v[`repeating_npcmove_${id}_attack_damage1attribute`];
                        var damage1Bonus = parseInt(v[`repeating_npcmove_${id}_attack_damage1bonus`]) || 0;
                        var damage1Type = v[`repeating_npcmove_${id}_attack_damagetype`];
        
                        var damage2 = v[`repeating_npcmove_${id}_attack_damage2`];
                        var damage2Attribute = v[`repeating_npcmove_${id}_attack_damage2attribute`];
                        var damage2Bonus = parseInt(v[`repeating_npcmove_${id}_attack_damage2bonus`]) || 0;
                        var damage2Type = v[`repeating_npcmove_${id}_attack_damagetype2`];
        
                        var damage_flag = "";
                        if (damage1 != "" || damage2 != "") {
                            damage_flag = damage_flag + "{{damage=1}} ";
                        }
                        if (damage1 != "") {
                            damage_flag = damage_flag + "{{dmg1flag=1}} ";
                        }
                        if (damage2 != "") {
                            damage_flag = damage_flag + "{{dmg2flag=1}} ";
                        }
        
                        var description = v[`repeating_npcmove_${id}_description`];
        
                        var toHitValue = parseInt(v[attackToHit.replace("@{", "").replace("}", "")]) || 0;
                        var toHitString = attackBonus !== 0 ? `${toHitValue} + ${attackBonus}` : `${toHitValue}`;
        
                        var damage1AttrValue = damage1Attribute !== "none" ? (parseInt(v[damage1Attribute.replace("@{", "").replace("}", "")]) || 0) : 0;
                        var damage1String = `${damage1} + ${damage1AttrValue} + ${damage1Bonus}`;
                        var avgDamage1 = calculateAverageDamage(damage1) + damage1AttrValue + damage1Bonus;
        
                        var damage2AttrValue = damage2Attribute !== "none" ? (parseInt(v[damage2Attribute.replace("@{", "").replace("}", "")]) || 0) : 0;
                        var damage2String = `${damage2} + ${damage2AttrValue} + ${damage2Bonus}`;
                        var avgDamage2 = calculateAverageDamage(damage2) + damage2AttrValue + damage2Bonus;
        
                        var details = `${attackType} Weapon Attack: ${toHitString}, Reach: ${attackRange}\n`;
                        details += `Damage: ${avgDamage1} (${damage1String}) ${damage1Type}`;
                        if (damage2) {
                            details += ` + ${avgDamage2} (${damage2String}) ${damage2Type}`;
                        }
                        details += `\nDescription: ${description}`;
        
                        var rollbase = "";
                        if (v.dtype === "full") {
                            rollbase = `@{wtype}&{template:npcmove} {{range=${attackRange}}} {{rname=@{name}}} ${atkFlag} ${damage_flag} {{r1=[[@{${attackToHit}}+${attackBonus}]]}} `;
                            if (damage1) {
                                rollbase += `{{dmg1=[[@{attack_damage} + [[${damage1AttrValue}]] + [[${damage1Bonus}]] ]]}} {{dmg1type=${damage1Type}}} `;
                            }
                            if (damage2) {
                                rollbase += `{{dmg2=[[@{attack_damage2} + [[${damage2AttrValue}]] + [[${damage2Bonus}]] ]]}} {{dmg2type=${damage2Type}}} `;
                            }
                        } else {
                            rollbase = `@{wtype}&{template:npcatk} ${atkFlag} ${damage_flag} {{range=${attackRange}}} {{rname=[@{name}](~repeating_attack_npc_dmg)}} {{type=[Attack](~repeating_npcmove_npc_dmg)}} {{r1=[[@{${attackToHit}}+${attackBonus}]]}} {{description=@{show_desc}}}`;
                        }
        
                        var dmgRollBase = `@{wtype}&{template:npcdmg} ${damage_flag} `;
                        if (damage1) {
                            dmgRollBase += `{{dmg1=[[@{attack_damage} + [[${damage1AttrValue}]] + [[${damage1Bonus}]] ]]}} {{dmg1type=${damage1Type}}} `;
                        }
                        if (damage2) {
                            dmgRollBase += `{{dmg2=[[@{attack_damage2} + [[${damage2AttrValue}]] + [[${damage2Bonus}]] ]]}} {{dmg2type=${damage2Type}}} `;
                        }
        
                        update[`repeating_npcmove_${id}_attack_details`] = details;
                        update[`repeating_npcmove_${id}_attack_tohitrange`] = `To Hit: ${toHitString}, Range: ${attackRange}`;
                        update[`repeating_npcmove_${id}_attack_onhit`] = `Damage: ${avgDamage1} (${damage1String}) ${damage1Type}`;
                        if (damage2) {
                            update[`repeating_npcmove_${id}_attack_onhit`] += ` + ${avgDamage2} (${damage2String}) ${damage2Type}`;
                        }
                        update[`repeating_npcmove_${id}_attack_description`] = description;
                        update[`repeating_npcmove_${id}_rollbase`] = rollbase;
                        update[`repeating_npcmove_${id}_damage_flag`] = damage_flag;
                        update[`repeating_npcmove_${id}_roll_dmg`] = dmgRollBase;
        
                        setAttrs(update, { silent: true });
                    });
                });
            });
        };
        
        var update_npc_legendary_moves = function() {
            getSectionIDs("repeating_npcmove-l", function(idarray) {
                _.each(idarray, function(id) {
                    getAttrs([
                        `repeating_npcmove-l_${id}_name`,
                        `repeating_npcmove-l_${id}_attack_flag`,
                        `repeating_npcmove-l_${id}_attack_type`,
                        `repeating_npcmove-l_${id}_attack_range`,
                        `repeating_npcmove-l_${id}_attack_tohit`,
                        `repeating_npcmove-l_${id}_attack_bonus`,
                        `repeating_npcmove-l_${id}_attack_damage`,
                        `repeating_npcmove-l_${id}_attack_damage1attribute`,
                        `repeating_npcmove-l_${id}_attack_damage1bonus`,
                        `repeating_npcmove-l_${id}_attack_damagetype`,
                        `repeating_npcmove-l_${id}_attack_damage2`,
                        `repeating_npcmove-l_${id}_attack_damage2attribute`,
                        `repeating_npcmove-l_${id}_attack_damage2bonus`,
                        `repeating_npcmove-l_${id}_attack_damagetype2`,
                        `repeating_npcmove_${id}_show_desc`,
                        `repeating_npcmove-l_${id}_description`,
                        "power", "agility", "vitality", "cultivation", "qi_control", "mental_strength"
                    ], function(v) {
                        var update = {};
        
                        var name = v[`repeating_npcmove-l_${id}_name`];
                        var attackFlag = v[`repeating_npcmove-l_${id}_attack_flag`] === "on" ? 1 : 0;
                        var atkFlag = (attackFlag === 1) ? "{{attack=1}}" : "";
        
                        var attackType = v[`repeating_npcmove-l_${id}_attack_type`];
                        var attackRange = v[`repeating_npcmove-l_${id}_attack_range`];
                        var attackToHit = v[`repeating_npcmove-l_${id}_attack_tohit`].replace("@{", "").replace("}", "");
                        var attackBonus = parseInt(v[`repeating_npcmove-l_${id}_attack_bonus`]) || 0;
        
                        var damage1 = v[`repeating_npcmove-l_${id}_attack_damage`];
                        var damage1Attribute = v[`repeating_npcmove-l_${id}_attack_damage1attribute`];
                        var damage1Bonus = parseInt(v[`repeating_npcmove-l_${id}_attack_damage1bonus`]) || 0;
                        var damage1Type = v[`repeating_npcmove-l_${id}_attack_damagetype`];
        
                        var damage2 = v[`repeating_npcmove-l_${id}_attack_damage2`];
                        var damage2Attribute = v[`repeating_npcmove-l_${id}_attack_damage2attribute`];
                        var damage2Bonus = parseInt(v[`repeating_npcmove-l_${id}_attack_damage2bonus`]) || 0;
                        var damage2Type = v[`repeating_npcmove-l_${id}_attack_damagetype2`];
        
                        var description = v[`repeating_npcmove-l_${id}_description`];
        
                        var toHitValue = parseInt(v[attackToHit.replace("@{", "").replace("}", "")]) || 0;
                        var toHitString = attackBonus !== 0 ? `${toHitValue} + ${attackBonus}` : `${toHitValue}`;
        
                        var damage1AttrValue = damage1Attribute !== "none" ? (parseInt(v[damage1Attribute.replace("@{", "").replace("}", "")]) || 0) : 0;
                        var damage1String = `${damage1} + ${damage1AttrValue} + ${damage1Bonus}`;
                        var avgDamage1 = calculateAverageDamage(damage1) + damage1AttrValue + damage1Bonus;
        
                        var damage2AttrValue = damage2Attribute !== "none" ? (parseInt(v[damage2Attribute.replace("@{", "").replace("}", "")]) || 0) : 0;
                        var damage2String = `${damage2} + ${damage2AttrValue} + ${damage2Bonus}`;
                        var avgDamage2 = calculateAverageDamage(damage2) + damage2AttrValue + damage2Bonus;
        
                        var details = `${attackType} Weapon Attack: ${toHitString}, Reach: ${attackRange}\n`;
                        details += `Damage: ${avgDamage1} (${damage1String}) ${damage1Type}`;
                        if (damage2) {
                            details += ` + ${avgDamage2} (${damage2String}) ${damage2Type}`;
                        }
                        details += `\nDescription: ${description}`;
        
                        update[`repeating_npcmove-l_${id}_attack_details`] = details;
                        update[`repeating_npcmove-l_${id}_attack_tohitrange`] = `To Hit: ${toHitString}, Range: ${attackRange}`;
                        update[`repeating_npcmove-l_${id}_attack_onhit`] = `Damage: ${avgDamage1} (${damage1String}) ${damage1Type}`;
                        if (damage2) {
                            update[`repeating_npcmove-l_${id}_attack_onhit`] += ` + ${avgDamage2} (${damage2String}) ${damage2Type}`;
                        }
                        update[`repeating_npcmove-l_${id}_attack_description`] = description;
        
                        var rollbase = `@{wtype}&{template:npcmove} {{rname=${name}}} ${atkFlag} {{r1=[[${toHitString}]]}} {{dmg1=${damage1}}} {{dmg1type=${damage1Type}}}`;
                        if (damage2) {
                            rollbase += ` {{dmg2=${damage2}}} {{dmg2type=${damage2Type}}}`;
                        }
                        rollbase += ` {{description=@{show_desc}}}`;
        
                        update[`repeating_npcmove-l_${id}_rollbase`] = rollbase;
        
                        setAttrs(update, { silent: true });
                    });
                });
            });
        };
        
        var calculateAverageDamage = function(damageString) {
            var dicePattern = /(\d+)d(\d+)/;
            var match = damageString.match(dicePattern);
            if (match) {
                var numberOfDice = parseInt(match[1]);
                var sidesOfDice = parseInt(match[2]);
                return numberOfDice * ((sidesOfDice / 2) + 0.5);
            }
            return 0;
        };
    </script>
</div>