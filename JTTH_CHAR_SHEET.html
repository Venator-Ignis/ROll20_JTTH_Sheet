<div class="sheet-core">
    <input class="sheet-toggle-npc" name="attr_npc" type="hidden" value="0" hidden>
    <input class="sheet-toggle-npc-edit" name="attr_npc_options-flag" type="checkbox" hidden>
    <label class="sheet-form-checkbox">
        <input type="checkbox" name="attr_npc" value="1">
        <span>NPC</span>
    </label>
    <div class="sheet-section-roll">
        <input type="hidden" name="attr_wtype" class="sheet-roll-toggle">
        <div class="sheet-section-roll-whisper">
            <label class="sheet-radio">
                <input type="radio" name="attr_whispertoggle" value="" checked="checked">
                <span title="@{whispertoggle}">Public</span>
            </label>
            <label class="sheet-radio">
                <input type="radio" name="attr_whispertoggle" value="/w gm ">
                <span title="@{whispertoggle}">To GM</span>
            </label>
        </div>
    </div>
    
    <div class="sheet-section-npc">
        <div class="sheet-checkbox-cog">
            <input type="checkbox" name="attr_npc_options-flag" checked="checked">
            <span class="sheet-toggle-icon"></span>
        </div>
        <input type="checkbox" name="attr_npc_options-flag" checked="checked" class="sheet-toggle" hidden>
        <div class="sheet-toggle-checked sheet-section-npc-edit">
            <div class="sheet-form sheet-form-sm">
                <div class="sheet-form-header">NPC Options</div>
                <div class="sheet-form-body">
                    <div class="sheet-form-group">
                        <label>Name</label>
                        <input type="text" name="attr_character_name">
                    </div>
                    <div class="sheet-form-group">
                        <label>NPC Type</label>
                        <input type="text" name="attr_npc_type">
                    </div>
                    <div class="sheet-form-group">
                        <label>Evasion</label>
                        <input type="text" name="attr_npc_eva">
                        <label>Limit</label>
                        <input type="text" name="attr_npc_evalimit" value="">
                    </div>
                    <div class="sheet-form-group">
                        <label>Damage Reduction</label>
                        <input type="text" name="attr_npc_dr">
                        <label>Type</label>
                        <input type="text" name="attr_npc_drtype" value="">
                    </div>
                    <div class="sheet-form-group">
                        <label>Hit Points</label>
                        <input type="text" name="attr_hp_max">
                        <label>Formula</label>
                        <input type="text" name="attr_npc_hpformula">
                    </div>
                    <div class="sheet-form-group">
                        <label>Speed</label>
                        <input type="text" name="attr_npc_speed">
                    </div>
                    <div class="sheet-form-fieldset sheet-form-fieldset-npc-attributes">
                        <div class="sheet-form-fieldset-header">Attributes</div>
                        <div class="sheet-form-fieldset-body">
                            <div class="sheet-form-group">
                                <label>Pwr</label>
                                <input type="number" name="attr_power" value="1" class="sheet-text-center">
                            </div>
                            <div class="sheet-form-group">
                                <label>Agi</label>
                                <input type="number" name="attr_agility" value="1" class="sheet-text-center">
                            </div>
                            <div class="sheet-form-group">
                                <label>Vit</label>
                                <input type="number" name="attr_vitality" value="1" class="sheet-text-center">
                            </div>
                            <div class="sheet-form-group">
                                <label>Cul</label>
                                <input type="number" name="attr_cultivation" value="1" class="sheet-text-center">
                            </div>
                            <div class="sheet-form-group">
                                <label>Qic</label>
                                <input type="number" name="attr_qi_control" value="1" class="sheet-text-center">
                            </div>
                            <div class="sheet-form-group">
                                <label>Mtl</label>
                                <input type="number" name="attr_mental_strength" value="1" class="sheet-text-center">
                            </div>
                            <div class="sheet-form-group">
                                <label>App</label>
                                <input type="number" name="attr_appearance" value="1" class="sheet-text-center">
                            </div>
                        </div>
                    </div>
                    <div class="sheet-form-fieldset sheet-form-fieldset-npc-skills">
                        <div class="sheet-form-fieldset-header">Skills</div>
                        <div class="sheet-form-fieldset-body">
                            <div class="sheet-form-group">
                                <label>Acrobatics</label>
                                <input type="text" name="attr_npc_acrobatics_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Athletics</label>
                                <input type="text" name="attr_npc_athletics_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Charm</label>
                                <input type="text" name="attr_npc_charm_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Deceit</label>
                                <input type="text" name="attr_npc_deceit_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Discretion</label>
                                <input type="text" name="attr_npc_discretion_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Disguise</label>
                                <input type="text" name="attr_npc_disguise_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Fine Arts</label>
                                <input type="text" name="attr_npc_fine_arts_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Forgery</label>
                                <input type="text" name="attr_npc_forgery_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>History</label>
                                <input type="text" name="attr_npc_history_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Intuition</label>
                                <input type="text" name="attr_npc_intuition_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Intimidation</label>
                                <input type="text" name="attr_npc_intimidation_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Investigation</label>
                                <input type="text" name="attr_npc_investigation_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Medicine</label>
                                <input type="text" name="attr_npc_medicine_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Navigation</label>
                                <input type="text" name="attr_npc_navigation_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Perception</label>
                                <input type="text" name="attr_npc_perception_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Performance</label>
                                <input type="text" name="attr_npc_performance_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Persuade</label>
                                <input type="text" name="attr_npc_persuade_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Stealth</label>
                                <input type="text" name="attr_npc_stealth_bonus" value="0">
                            </div>
                            <div class="sheet-form-group">
                                <label>Survival</label>
                                <input type="text" name="attr_npc_survival_bonus" value="0">
                            </div>
                        </div>
                    </div>
                    <div class="sheet-form-group">
                        <label>Damage Hyper Resistances</label>
                        <input type="text" name="attr_npc_hyper_resistances">
                    </div>
                    <div class="sheet-form-group">
                        <label>Damage Resistances</label>
                        <input type="text" name="attr_npc_resistances">
                    </div>
                    <div class="sheet-form-group">
                        <label>Damage Weakness</label>
                        <input type="text" name="attr_npc_weakness">
                    </div>
                    <div class="sheet-form-group">
                        <label>Damage Hyper Weakness</label>
                        <input type="text" name="attr_npc_hyper_weakness">
                    </div>
                    <div class="sheet-form-group">
                        <label>Senses</label>
                        <input type="text" name="attr_npc_senses">
                    </div>
                    <div class="sheet-form-group">
                        <label>Level</label>
                        <input type="text" name="attr_npc_level">
                        <label>XP</label>
                        <input type="text" name="attr_npc_xp">
                    </div>
                    <div class="sheet-form-group">
                        <label class="sheet-form-checkbox">
                            <input type="checkbox" name="attr_npcresponsesflag" value="1">
                            <span>Has Responses</span>
                        </label>
                    </div>
                    <div class="sheet-form-group">
                        <label>Legendary Moves</label>
                        <input type="text" name="attr_npc_legendary_moves" value="0">
                    </div>
                    <div class="sheet-form-fieldset">
                        <div class="sheet-form-fieldset-header">General Options</div>
                        <div class="sheet-form-fieldset-body">
                            <div class="sheet-form-group">
                                <label class="sheet-form-checkbox">
                                    <input type="checkbox" name="attr_npc" value="1">
                                    <span>NPC</span>
                                </label>
                            </div>
                            <div class="sheet-form-group">
                                <label>Whisper Rolls to GM</label>
                                <select name="attr_wtype">
                                    <option value="">Never Whisper Rolls</option>
                                    <option value="@{whispertoggle}">Whisper Toggle</option>
                                    <option value="?{Whisper?|Public Roll,|Whisper Roll,/w gm }">Query Whisper</option>
                                    <option value="/w gm ">Always Whisper Rolls</option>
                                </select>
                            </div>
                            <div class="sheet-form-group">
                                <label>Auto Damage Roll</label>
                                <select name="attr_dtype">
                                    <option value="pick">Don't Auto Roll Damage</option>
                                    <option value="full">Auto Roll Damage</option>
                                </select>
                            </div>
                            <div class="sheet-form-group">
                                <label>NPC Name in Rolls</label>
                                <select name="attr_npc_name_flag">
                                    <option value="{{name=@{character_name}}}">Show</option>
                                    <option value="0">Hide</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="sheet-toggle-unchecked sheet-section-npc-display">
            <div class="sheet-npc-header">
                <div class="sheet-npc-header-name">
                    <button type="roll" name="roll_npc_init" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Initiative}} {{r1=[[@{agility}d6+[[@{initiative_bonus}]][AGI] &{tracker}]]}} {{type=Initiative}}" class="sheet-btn-text">
                        <span name="attr_character_name"></span>
                    </button>
                </div>
                <span name="attr_npc_type"></span>
            </div>
            <div class="sheet-npc-body">
                <div class="sheet-npc-section sheet-npc-section-hp">
                    <button type="roll" name="roll_npc_init" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Initiative}} {{r1=[[@{agility}d6+[[@{initiative_bonus}]][AGI] &{tracker}]]}} {{type=Initiative}}" class="sheet-btn-npc-initiative">
                        <span>t</span>
                        <span>INIT</span>
                    </button>
                    <div>
                        <label>Evasion</label>
                        <span name="attr_npc_eva"></span>
                    </div>
                    <div>
                        <label>Damage Reduction</label>
                        <span name="attr_npc_dr"></span>
                        <input type="hidden" name="attr_npc_drtype" value="">
                        <span name="attr_npc_drtype" class="sheet-display-brackets"></span>
                    </div>
                    <div>
                        <label>Hit Points</label>
                        <span name="attr_hp_max"></span>
                        <button type="roll" name="roll_npc_hpformula" value="@{wtype}&{template:simple} {{type=Hit Points}} @{npc_name_flag} {{rname=Hit Points}} {{mod=@{npc_hpformula}}} {{r1=[[@{npc_hpformula}]]}} charname=@{character_name}" class="sheet-btn-inline">
                            <span name="attr_npc_hpformula" class="sheet-display-brackets"></span>
                        </button>
                    </div>
                    <div>
                        <label>Speed</label>
                        <span name="attr_npc_speed"></span>
                    </div>
                </div>
                <div class="sheet-npc-section sheet-npc-section-abilities">
                    <button type="roll" name="roll_npc_pwr" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Power}} {{r1=[[@{power}d6[PWR]]]}} {{type=Ability}}" class="sheet-btn-npc-ability">
                        <span class="sheet-btn-npc-ability-title">PWR</span>
                        <span name="attr_power" class="sheet-btn-npc-ability"></span>
                    </button>
                    <button type="roll" name="roll_npc_agi" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Agility}} {{r1=[[@{agility}d6[AGI]]]}} {{type=Ability}}" class="sheet-btn-npc-ability">
                        <span class="sheet-btn-npc-ability-title">AGI</span>
                        <span name="attr_agility" class="sheet-btn-npc-ability"></span>
                    </button>
                    <button type="roll" name="roll_npc_vit" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Vitality}} {{r1=[[@{vitality}d6[VIT]]]}} {{type=Ability}}" class="sheet-btn-npc-ability">
                        <span class="sheet-btn-npc-ability-title">VIT</span>
                        <span name="attr_vitality" class="sheet-btn-npc-ability"></span>
                    </button>
                    <button type="roll" name="roll_npc_cul" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Cultivation}} {{r1=[[@{cultivation}d6[CUL]]]}} {{type=Ability}}" class="sheet-btn-npc-ability">
                        <span class="sheet-btn-npc-ability-title">CUL</span>
                        <span name="attr_cultivation" class="sheet-btn-npc-ability"></span>
                    </button>
                    <button type="roll" name="roll_npc_qic" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Qi Control}} {{r1=[[@{qi_control}d6[QIC]]]}} {{type=Ability}}" class="sheet-btn-npc-ability">
                        <span class="sheet-btn-npc-ability-title">QIC</span>
                        <span name="attr_qi_control" class="sheet-btn-npc-ability"></span>
                    </button>
                    <button type="roll" name="roll_npc_mtl" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Mental Strength}} {{r1=[[@{mental_strength}d6[MTL]]]}} {{type=Ability}}" class="sheet-btn-npc-ability">
                        <span class="sheet-btn-npc-ability-title">MTL</span>
                        <span name="attr_mental_strength" class="sheet-btn-npc-ability"></span>
                    </button>
                    <button type="roll" class="sheet-btn-npc-ability">
                        <span class="sheet-btn-npc-ability-title">APP</span>
                        <span name="attr_appearance" class="sheet-btn-npc-ability"></span>
                    </button>
                </div>
                <div class="sheet-npc-section sheet-npc-section-details">
                    <input type="hidden" name="attr_npc_skills_flag" value="1" class="sheet-field-toggle">
                    <div class="sheet-npc-section-skills">
                        <label>Skills</label>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_acrobatics" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Acrobatics}} {{mod=@{npc_acrobatics}}} {{r1=[[@{npc_acrobatics_roll}d6 + @{npc_acrobatics_bonus}]]}} {{type=Skill}}">
                                <span>Acrobatics</span>
                                <span name="attr_npc_acrobatics"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_athletics" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Athletics}} {{mod=@{npc_athletics}}} {{r1=[[@{npc_athletics_roll}d6 + @{npc_athletics_bonus}]]}} {{type=Skill}}">
                                <span>Athletics</span>
                                <span name="attr_npc_athletics"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_charm" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Charm}} {{mod=@{npc_charm}}} {{r1=[[@{npc_charm_roll}d6 + @{npc_charm_bonus}]]}} {{type=Skill}}">
                                <span>Charm</span>
                                <span name="attr_npc_charm"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_deceit" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Deceit}} {{mod=@{npc_deceit}}} {{r1=[[@{npc_deceit_roll}d6 + @{npc_deceit_bonus}]]}} {{type=Skill}}">
                                <span>Deceit</span>
                                <span name="attr_npc_deceit"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_disguise" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Disguise}} {{mod=@{npc_disguise}}} {{r1=[[@{npc_disguise_roll}d6 + @{npc_disguise_bonus}]]}} {{type=Skill}}">
                                <span>Disguise</span>
                                <span name="attr_npc_disguise"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_fine_arts" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Fine Arts}} {{mod=@{npc_fine_arts}}} {{r1=[[@{_rollnpc_fine_arts}d6 + @{npc_fine_arts_bonus}]]}} {{type=Skill}}">
                                <span>Fine Arts</span>
                                <span name="attr_npc_fine_arts"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_forgery" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Forgery}} {{mod=@{npc_forgery}}} {{r1=[[@{npc_forgery_roll}d6 + @{npc_forgery_bonus}]]}} {{type=Skill}}">
                                <span>Forgery</span>
                                <span name="attr_npc_forgery"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_history" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=History}} {{mod=@{npc_history}}} {{r1=[[@{npc_history_roll}d6 + @{npc_history_bonus}]]}} {{type=Skill}}">
                                <span>History</span>
                                <span name="attr_npc_history"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_intuition" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Intuition}} {{mod=@{npc_intuition}}} {{r1=[[@{npc_intuition_roll}d6 + @{npc_intuition_bonus}]]}} {{type=Skill}}">
                                <span>Intuition</span>
                                <span name="attr_npc_intuition"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_intimidation" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Intimidation}} {{mod=@{npc_intimidation}}} {{r1=[[@{npc_intimidation_roll}d6 + @{npc_intimidation_bonus}]]}} {{type=Skill}}">
                                <span>Intimidation</span>
                                <span name="attr_npc_intimidation"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_investigation" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Investigation}} {{mod=@{npc_investigation}}} {{r1=[[@{npc_investigation_roll}d6 + @{npc_investigation_bonus}]]}} {{type=Skill}}">
                                <span>Investigation</span>
                                <span name="attr_npc_investigation"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_medicine" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Medicine}} {{mod=@{npc_medicine}}} {{r1=[[@{npc_medicine_roll}d6 + @{npc_medicine_bonus}]]}} {{type=Skill}}">
                                <span>Medicine</span>
                                <span name="attr_npc_medicine"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_navigation" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Navigation}} {{mod=@{npc_navigation}}} {{r1=[[@{npc_navigation_roll}d6 + @{npc_navigation_bonus}]]}} {{type=Skill}}">
                                <span>Navigation</span>
                                <span name="attr_npc_navigation"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_perception" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Perception}} {{mod=@{npc_perception}}} {{r1=[[@{npc_perception_roll}d6 + @{npc_perception_bonus}]]}} {{type=Skill}}">
                                <span>Perception</span>
                                <span name="attr_npc_perception"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_performance" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Performance}} {{mod=@{npc_performance}}} {{r1=[[@{npc_performance_roll}d6 + @{npc_performance_bonus}]]}} {{type=Skill}}">
                                <span>Performance</span>
                                <span name="attr_npc_performance"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_persuade" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Persuade}} {{mod=@{npc_persuade}}} {{r1=[[@{npc_persuade_roll}d6 + @{npc_persuade_bonus}]]}} {{type=Skill}}">
                                <span>Persuade</span>
                                <span name="attr_npc_persuade"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_discretion" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Discretion}} {{mod=@{npc_discretion}}} {{r1=[[@{npc_discretion_roll}d6 + @{npc_discretion_bonus}]]}} {{type=Skill}}">
                                <span>Discretion</span>
                                <span name="attr_npc_discretion"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_stealth" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Stealth}} {{mod=@{npc_stealth}}} {{r1=[[@{npc_stealth_roll}d6 + @{npc_stealth_bonus}]]}} {{type=Skill}}">
                                <span>Stealth</span>
                                <span name="attr_npc_stealth"></span>
                            </button>
                        </span>
                        <span>
                            <input type="hidden" name="attr_npc_skill_flag" value="1" class="sheet-field-toggle">
                            <button type="roll" name="roll_npc_survival" value="@{wtype}&{template:simple} @{npc_name_flag} {{rname=Survival}} {{mod=@{npc_survival}}} {{r1=[[@{npc_survival_roll}d6 + @{npc_survival_bonus}]]}} {{type=Skill}}">
                                <span>Survival</span>
                                <span name="attr_npc_survival"></span>
                            </button>
                        </span>
                    </div>
                    <input type="hidden" name="attr_npc_hyper_resistances" class="sheet-field-toggle">
                    <div>
                        <label>Damage Hyper Resistances</label>
                        <span name="attr_npc_hyper_resistances"></span>
                    </div>
                    <input type="hidden" name="attr_npc_resistances" class="sheet-field-toggle">
                    <div>
                        <label>Damage Resistances</label>
                        <span name="attr_npc_resistances"></span>
                    </div>
                    <input type="hidden" name="attr_npc_weakness" class="sheet-field-toggle">
                    <div>
                        <label>Damage Weakness</label>
                        <span name="attr_npc_weakness"></span>
                    </div>
                    <input type="hidden" name="attr_npc_hyper_weakness" class="sheet-field-toggle">
                    <div>
                        <label>Damage Hyper Weakness</label>
                        <span name="attr_npc_hyper_weakness"></span>
                    </div>
                    <div>
                        <label>Senses</label>
                        <span name="attr_npc_senses"></span>
                    </div>
                    <div>
                        <label>Level</label>
                        <span name="attr_npc_level"></span>
                        <span name="attr_npc_xp" class="sheet-display-brackets-xp"></span>
                    </div>
                </div>
                <div class="sheet-container-well">
                    <div class="sheet-container-panel sheet-npc-features">
                        <div class="sheet-container-header">Features</div>
                        <div class="sheet-container-body">
                            <fieldset class="repeating_npctrait">
                                <div class="sheet-fieldset-item sheet-fieldset-item-npctrait">
                                    <div class="sheet-checkbox-cog">
                                        <input type="checkbox" name="attr_npc_options-flag" checked="checked" value="on">
                                        <span class="sheet-toggle-icon"></span>
                                    </div>
                                    <input type="checkbox" name="attr_npc_options-flag" checked="checked" class="sheet-toggle" hidden>
                                    <div class="sheet-toggle-checked">
                                        <div class="sheet-form">
                                            <div class="sheet-form-header">Edit Trait</div>
                                            <div class="sheet-form-body">
                                                <div class="sheet-form-group">
                                                    <label>Name:</label>
                                                    <input type="text" name="attr_name">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Description:</label>
                                                    <textarea name="attr_desc"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="sheet-toggle-unchecked">
                                        <div class="sheet-npc-trait">
                                            <div class="sheet-npc-trait-name">
                                                <span name="attr_name"></span>
                                            </div>
                                            <div class="sheet-npc-trait-desc">
                                                <span name="attr_desc"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <input type="hidden" name="attr_dflag" value="pick">
                    <div class="sheet-container-panel sheet-npc-moves">
                        <div class="sheet-container-header">Moves</div>
                        <div class="sheet-container-body">
                            <fieldset class="repeating_npcmove">
                                <div class="sheet-fieldset-item sheet-fieldset-item-npcmove">
                                    <div class="sheet-checkbox-cog">
                                        <input type="checkbox" name="attr_npc_options-flag" checked="checked" value="on">
                                        <span class="sheet-toggle-icon"></span>
                                    </div>
                                    <input type="checkbox" name="attr_npc_options-flag" checked="checked" class="sheet-toggle" hidden>
                                    <div class="sheet-toggle-checked">
                                        <div class="sheet-form">
                                            <div class="sheet-form-header">Edit Move</div>
                                            <div class="sheet-form-body">
                                                <div class="sheet-form-group">
                                                    <label>Name:</label>
                                                    <input type="text" name="attr_name">
                                                    <label class="sheet-form-checkbox">
                                                        <input type="checkbox" name="attr_attack_flag" value="on">
                                                        <span>Attack</span>
                                                    </label>
                                                </div>
                                                <input type="checkbox" name="attr_attack_flag" value="on" class="sheet-toggle" hidden>
                                                <div class="sheet-form-group sheet-toggle-checked">
                                                    <div class="sheet-form-fieldset">
                                                        <div class="sheet-form-fieldset-header">Attack</div>
                                                        <div class="sheet-form-fieldset-body">
                                                            <input type="hidden" name="attr_damage_flag">
                                                            <input type="hidden" name="attr_full_damage">
                                                            <div class="sheet-form-group">
                                                                <label>Type:</label>
                                                                <select name="attr_attack_type">
                                                                    <option value="Melee">Melee</option>
                                                                    <option value="Ranged">Ranged</option>
                                                                </select>
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Range/Reach:</label>
                                                                <input type="text" name="attr_attack_range">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>To Hit:</label>
                                                                <select name="attr_attack_tohit">
                                                                    <option value="@{power}">Power</option>
                                                                    <option value="@{agility}">Agility</option>
                                                                    <option value="@{vitality}">Vitality</option>
                                                                    <option value="@{cultivation}">Cultivation</option>
                                                                    <option value="@{qi_control}">Qi Control</option>
                                                                    <option value="@{mental_strength}">Mental Strength</option>
                                                                </select>
                                                                <label>Bonus:</label>
                                                                <input type="text" name="attr_attack_bonus">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Damage 1:</label>
                                                                <input type="text" name="attr_attack_damage">
                                                                <select name="attr_attack_damage1attribute">
                                                                    <option value="none">None</option>
                                                                    <option value="@{power}">Power</option>
                                                                    <option value="@{agility}">Agility</option>
                                                                    <option value="@{vitality}">Vitality</option>
                                                                    <option value="@{cultivation}">Cultivation</option>
                                                                    <option value="@{qi_control}">Qi Control</option>
                                                                    <option value="@{mental_strength}">Mental Strength</option>
                                                                </select>
                                                                <label>Bonus:</label>
                                                                <input type="text" name="attr_attack_damage1bonus">
                                                                <label>Type:</label>
                                                                <input type="text" name="attr_attack_damagetype">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Damage 2:</label>
                                                                <input type="text" name="attr_attack_damage2">
                                                                <select name="attr_attack_damage2attribute">
                                                                    <option value="none">None</option>
                                                                    <option value="@{power}">Power</option>
                                                                    <option value="@{agility}">Agility</option>
                                                                    <option value="@{vitality}">Vitality</option>
                                                                    <option value="@{cultivation}">Cultivation</option>
                                                                    <option value="@{qi_control}">Qi Control</option>
                                                                    <option value="@{mental_strength}">Mental Strength</option>
                                                                </select>
                                                                <label>Bonus:</label>
                                                                <input type="text" name="attr_attack_damage2bonus">
                                                                <label>Type:</label>
                                                                <input type="text" name="attr_attack_damagetype2">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Description:</label>
                                                </div>
                                                <div class="sheet-form-group">
                                                    <textarea name="attr_description"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="sheet-toggle-unchecked">
                                        <div class="sheet-npc-move">
                                            <button type="roll" name="roll_npc_move" value="@{rollbase}" class="sheet-fieldset-item-npcmove-checked-roll sheet-btn-text">
                                                <div class="sheet-fieldset-item-npcmove-checked-name">
                                                    <span name="attr_name"></span>
                                                </div>
                                                <input type="checkbox" name="attr_attack_flag" value="on" class="sheet-toggle" hidden>
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-fieldset-item-npcmove-checked-attack">
                                                        <span name="attr_attack_type"></span><span> Weapon Attack: </span><span name="attr_attack_tohitrange"></span>
                                                    </div>
                                                    <div class="sheet-fieldset-item-npcmove-checked-onhit">
                                                        <span>Hit: </span><span name="attr_attack_onhit"></span>
                                                    </div>
                                                </div>
                                                <div class="sheet-fieldset-item-npcmove-checked-description">
                                                    <span name="attr_description"></span>
                                                </div>
                                            </button>
                                            <input type="hidden" name="attr_rollbase">
                                            <button type="roll" name="roll_npc_dmg" value="@{full_damage}" class="sheet-hidden"></button>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <input type="hidden" name="attr_npcresponsesflag" value="0" class="sheet-field-toggle">
                    <div class="sheet-container-panel sheet-npc-responses">
                        <div class="sheet-container-header">Responses</div>
                        <div class="sheet-container-body">
                            <fieldset class="repeating_npcresponses">
                                <div class="sheet-fieldset-item sheet-fieldset-item-npcresponses">
                                    <div class="sheet-checkbox-cog">
                                        <input type="checkbox" name="attr_npc_options-flag" checked="checked" value="on">
                                        <span class="sheet-toggle-icon"></span>
                                    </div>
                                    <input type="checkbox" name="attr_npc_options-flag" checked="checked" class="sheet-toggle" hidden>
                                    <div class="sheet-toggle-checked">
                                        <div class="sheet-form">
                                            <div class="sheet-form-header">Edit Response</div>
                                            <div class="sheet-form-body">
                                                <div class="sheet-form-group">
                                                    <label>Name:</label>
                                                    <input type="text" name="attr_name">
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Description:</label>
                                                    <textarea name="attr_desc"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="sheet-toggle-unchecked">
                                        <div class="sheet-npc-responses">
                                            <button type="roll" name="roll_npc_move" value="@{wtype}&{template:move} @{npc_name_flag} {{rname=@{name}}} {{description=@{desc}}} " class="sheet-fieldset-item-npcmove-checked-roll sheet-btn-text">
                                                <div class="sheet-npc-response-name">
                                                    <span name="attr_name"></span>
                                                </div>
                                                <div class="sheet-npc-response-description">
                                                    <span name="attr_desc"></span>
                                                </div>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <input type="hidden" name="attr_npc_legendary_moves" value="0" class="sheet-field-toggle">
                    <div class="sheet-container-panel sheet-npc-legendary-moves">
                        <div class="sheet-container-header">Legendary Moves</div>
                        <div class="sheet-container-body">
                            <input type="hidden" name="attr_npc_legendary_move_desc" class="sheet-field-toggle">
                            <div class="sheet-npc-legendary-move-description">
                                <span name="attr_npc_legendary_move_desc"></span>
                            </div>
                            <fieldset class="repeating_npcmove-l">
                                <div class="sheet-fieldset-item sheet-fieldset-item-npcmove">
                                    <div class="sheet-checkbox-cog">
                                        <input type="checkbox" name="attr_npc_options-flag" checked="checked" value="on">
                                        <span class="sheet-toggle-icon"></span>
                                    </div>
                                    <input type="checkbox" name="attr_npc_options-flag" checked="checked" class="sheet-toggle" hidden>
                                    <div class="sheet-toggle-checked">
                                        <div class="sheet-form">
                                            <div class="sheet-form-header">Edit Legendary Move</div>
                                            <div class="sheet-form-body">
                                                <div class="sheet-form-group">
                                                    <label>Name:</label>
                                                    <input type="text" name="attr_name">
                                                    <label class="sheet-form-checkbox">
                                                        <input type="checkbox" name="attr_attack_flag" value="on">
                                                        <span>Attack</span>
                                                    </label>
                                                </div>
                                                <input type="checkbox" name="attr_attack_flag" value="on" class="sheet-toggle" hidden>
                                                <div class="sheet-form-group sheet-toggle-checked">
                                                    <div class="sheet-form-fieldset">
                                                        <div class="sheet-form-fieldset-header">Attack</div>
                                                        <div class="sheet-form-fieldset-body">
                                                            <input type="hidden" name="attr_damage_flag">
                                                            <input type="hidden" name="attr_full_damage">
                                                            <div class="sheet-form-group">
                                                                <label>Type:</label>
                                                                <select name="attr_attack_type">
                                                                    <option value="Melee">Melee</option>
                                                                    <option value="Ranged">Ranged</option>
                                                                </select>
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Range/Reach:</label>
                                                                <input type="text" name="attr_attack_range">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>To Hit:</label>
                                                                <select name="attr_attack_tohit">
                                                                    <option value="@{power}">Power</option>
                                                                    <option value="@{agility}">Agility</option>
                                                                    <option value="@{vitality}">Vitality</option>
                                                                    <option value="@{cultivation}">Cultivation</option>
                                                                    <option value="@{qi_control}">Qi Control</option>
                                                                    <option value="@{mental_strength}">Mental Strength</option>
                                                                </select>
                                                                <label>Bonus:</label>
                                                                <input type="text" name="attr_attack_bonus">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Damage 1:</label>
                                                                <input type="text" name="attr_attack_damage">
                                                                <select name="attr_attack_damage1attribute">
                                                                    <option value="none">None</option>
                                                                    <option value="@{power}">Power</option>
                                                                    <option value="@{agility}">Agility</option>
                                                                    <option value="@{vitality}">Vitality</option>
                                                                    <option value="@{cultivation}">Cultivation</option>
                                                                    <option value="@{qi_control}">Qi Control</option>
                                                                    <option value="@{mental_strength}">Mental Strength</option>
                                                                </select>
                                                                <label>Bonus:</label>
                                                                <input type="text" name="attr_attack_damage1bonus">
                                                                <label>Type:</label>
                                                                <input type="text" name="attr_attack_damagetype">
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label>Damage 2:</label>
                                                                <input type="text" name="attr_attack_damage2">
                                                                <select name="attr_attack_damage2attribute">
                                                                    <option value="none">None</option>
                                                                    <option value="@{power}">Power</option>
                                                                    <option value="@{agility}">Agility</option>
                                                                    <option value="@{vitality}">Vitality</option>
                                                                    <option value="@{cultivation}">Cultivation</option>
                                                                    <option value="@{qi_control}">Qi Control</option>
                                                                    <option value="@{mental_strength}">Mental Strength</option>
                                                                </select>
                                                                <label>Bonus:</label>
                                                                <input type="text" name="attr_attack_damage2bonus">
                                                                <label>Type:</label>
                                                                <input type="text" name="attr_attack_damagetype2">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-form-group">
                                                    <label>Description:</label>
                                                </div>
                                                <div class="sheet-form-group">
                                                    <textarea name="attr_description"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="sheet-toggle-unchecked">
                                        <div class="sheet-npc-legendary-move">
                                            <button type="roll" name="roll_npc_move" value="@{rollbase}" class="sheet-fieldset-item-npcmove-checked-roll sheet-btn-text">
                                                <div class="sheet-fieldset-item-npcmove-checked-name">
                                                    <span name="attr_name"></span>
                                                </div>
                                                <input type="checkbox" name="attr_attack_flag" value="on" class="sheet-toggle" hidden>
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-fieldset-item-npcmove-checked-attack">
                                                        <span name="attr_attack_type"></span><span> Weapon Attack: </span><span name="attr_attack_tohitrange"></span>
                                                    </div>
                                                    <div class="sheet-fieldset-item-npcmove-checked-onhit">
                                                        <span>Hit: </span><span name="attr_attack_onhit"></span>
                                                    </div>
                                                </div>
                                                <div class="sheet-fieldset-item-npcmove-checked-description">
                                                    <span name="attr_description"></span>
                                                </div>
                                            </button>
                                            <input type="hidden" name="attr_rollbase">
                                            <button type="roll" name="roll_npc_dmg" value="@{full_damage}" class="sheet-hidden"></button>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>  
                </div>
            </div>
        </div>
        <div class="sheet-section-npc-footer">
            <p>Venator Ignis's JTTH NPC Sheet</p>
        </div>
    </div>

    <div class="sheet-section-pc">
        <div class="sheet-section-pc-header">
            <div class="sheet-section-pc-header-character-image">
                <img name="attr_character_avatar">
            </div>
            <div class="sheet-section-pc-header-character-details">
                <div class="sheet-character-detail">
                    <div class="sheet-character-detail-label label-name">Name:</div>
                    <div class="sheet-character-detail-value value-name">
                        <input type="text" name="attr_character_name"title="@{character_name}">
                    </div>
                </div>
                <div class="sheet-character-detail">
                    <div class="sheet-character-detail-label label-level">Level:</div>
                    <div class="sheet-character-detail-value value-level">
                        <input type="number" name="attr_character_level"title="@{character_level}">
                    </div>
                    <div class="sheet-character-detail-label label-path">Mortal Path:</div>
                    <div class="sheet-character-detail-value value-path">
                        <input type="text" name="attr_character_path"title="@{character_path}">
                    </div>
                    <div class="sheet-character-detail-label label-subpath">Sub Path:</div>
                    <div class="sheet-character-detail-value value-subpath">
                        <input type="text" name="attr_character_subpath" title="@{character_subpath}">
                    </div>
                </div>
                <div class="sheet-character-detail">
                    <div class="sheet-character-detail-label label-background">Background:</div>
                    <div class="sheet-character-detail-value value-background">
                        <input type="text" name="attr_character_background" title="@{character_background}">
                    </div>
                </div>
                <div class="sheet-character-detail">
                    <div class="sheet-character-detail-label label-age">Age:</div>
                    <div class="sheet-character-detail-value value-age">
                        <input type="number" name="attr_character_age" title="@{character_age}">
                    </div>
                    <div class="sheet-character-detail-label label-height">Height:</div>
                    <div class="sheet-character-detail-value value-height">
                        <input type="text" name="attr_character_height" title="@{character_height}">
                    </div>
                    <div class="sheet-character-detail-label label-gender">Gender:</div>
                    <div class="sheet-character-detail-value value-gender">
                        <input type="text" name="attr_character_gender" title="@{character_gender}">
                    </div>
                </div>
                <div class="sheet-character-detail">
                    <div class="sheet-character-detail-label label-ancestry">Ancestry:</div>
                    <div class="sheet-character-detail-value value-ancestry">
                        <input type="text" name="attr_character_ancestry" title="@{character_ancestry}">
                    </div>
                    <div class="sheet-character-detail-label label-species">Species:</div>
                    <div class="sheet-character-detail-value value-species">
                        <input type="text" name="attr_character_species" title="@{character_species}">
                    </div>
                </div>
                <div class="sheet-character-detail">
                    <div class="sheet-character-detail-label label-personality">Personality:</div>
                    <div class="sheet-character-detail-value value-personality">
                        <input type="text" name="attr_character_personality" title="@{character_personality}">
                    </div>
                </div>
            </div>
        </div>
        <div class="sheet-section-pc-body">
            <div class="sheet-tabs">
                <div class="sheet-tab sheet-tab-character">
                    <input type="radio" name="attr_tab" value="character" checked="checked">
                    <span class="sheet-tab-label">Character</span>
                    <div class="sheet-tab-content">
                        <div class="sheet-container-well sheet-well-attributes">
                            <div class="sheet-container-attribute">
                                <input type="number" name="attr_power" value="1" class="sheet-text-center">
                                <button type="roll" name="roll_power" value="@{wtype}&{template:simple} {{rname=Power}} {{type=Attribute}} {{r1=[[@{power}d6[PWR]+@{power_bonus}]]}}" class="sheet-btn-ability">
                                    <span class="sheet-btn-ability-title">PWR</span>
                                </button>
                            </div>
                            <div class="sheet-container-attribute">
                                <input type="number" name="attr_agility" value="1" class="sheet-text-center">
                                <button type="roll" name="roll_agility" value="@{wtype}&{template:simple} {{rname=Agility}} {{type=Attribute}} {{r1=[[@{agility}d6[AGI]+@{agility_bonus}]]}}" class="sheet-btn-ability">
                                    <span class="sheet-btn-ability-title">AGI</span>
                                </button>
                            </div>
                            <div class="sheet-container-attribute">
                                <input type="number" name="attr_vitality" value="1" class="sheet-text-center">
                                <button type="roll" name="roll_vitality" value="@{wtype}&{template:simple} {{rname=Vitality}} {{type=Attribute}} {{r1=[[@{vitality}d6[VIT]+@{vitality_bonus}]]}}" class="sheet-btn-ability">
                                    <span class="sheet-btn-ability-title">VIT</span>
                                </button>
                            </div>
                            <div class="sheet-container-attribute">
                                <input type="number" name="attr_cultivation" value="1" class="sheet-text-center">
                                <button type="roll" name="roll_cultivation" value="@{wtype}&{template:simple} {{rname=Cultivation}} {{type=Attribute}} {{r1=[[@{cultivation}d6[CUL]+@{cultivation_bonus}]]}}" class="sheet-btn-ability">
                                    <span class="sheet-btn-ability-title">CUL</span>
                                </button>
                            </div>
                            <div class="sheet-container-attribute">
                                <input type="number" name="attr_qi_control" value="1" class="sheet-text-center">
                                <button type="roll" name="roll_qi_control" value="@{wtype}&{template:simple} {{rname=Qi Control}} {{type=Attribute}} {{r1=[[@{qi_control}d6[QIC]+@{qi_control_bonus}]]}}" class="sheet-btn-ability">
                                    <span class="sheet-btn-ability-title">QIC</span>
                                </button>
                            </div>
                            <div class="sheet-container-attribute">
                                <input type="number" name="attr_mental_strength" value="1" class="sheet-text-center">
                                <button type="roll" name="roll_mental_strength" value="@{wtype}&{template:simple} {{rname=Mental Strength}} {{type=Attribute}} {{r1=[[@{mental_strength}d6[MTL]+@{mental_strength_bonus}]]}}" class="sheet-btn-ability">
                                    <span class="sheet-btn-ability-title">MTL</span>
                                </button>
                            </div>
                            <div class="sheet-container-attribute">
                                <input type="number" name="attr_appearance" value="1" class="sheet-text-center">
                                <span class="sheet-btn-npc-ability-title">APP</span>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-well-columns">
                            <div class="sheet-column">
                                <div class="sheet-container-well container-skill-combat">
                                    <div class="sheet-container-panel sheet-panel-skills">
                                        <div class="sheet-container-header">SKILLS</div>
                                        <div class="sheet-container-body">
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_acrobatics" value="@{wtype}&{template:simple} @{name_flag} {{rname=Acrobatics}} {{mod=@{acrobatics}}} {{r1=[[@{acrobatics_roll}d6 + @{acrobatics_bonus}]]}} {{type=Skill}}">
                                                    <span>Acrobatics</span>
                                                    <span name="attr_acrobatics"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_athletics" value="@{wtype}&{template:simple} @{name_flag} {{rname=Athletics}} {{mod=@{athletics}}} {{r1=[[@{athletics_roll}d6 + @{athletics_bonus}]]}} {{type=Skill}}">
                                                    <span>Athletics</span>
                                                    <span name="attr_athletics"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_charm" value="@{wtype}&{template:simple} @{name_flag} {{rname=Charm}} {{mod=@{charm}}} {{r1=[[@{charm_roll}d6 + @{charm_bonus}]]}} {{type=Skill}}">
                                                    <span>Charm</span>
                                                    <span name="attr_charm"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_deceit" value="@{wtype}&{template:simple} @{name_flag} {{rname=Deceit}} {{mod=@{deceit}}} {{r1=[[@{deceit_roll}d6 + @{deceit_bonus}]]}} {{type=Skill}}">
                                                    <span>Deceit</span>
                                                    <span name="attr_deceit"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_discretion" value="@{wtype}&{template:simple} @{name_flag} {{rname=Discretion}} {{mod=@{discretion}}} {{r1=[[@{discretion_roll}d6 + @{discretion_bonus}]]}} {{type=Skill}}">
                                                    <span>Discretion</span>
                                                    <span name="attr_discretion"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_disguise" value="@{wtype}&{template:simple} @{name_flag} {{rname=Disguise}} {{mod=@{disguise}}} {{r1=[[@{disguise_roll}d6 + @{disguise_bonus}]]}} {{type=Skill}}">
                                                    <span>Disguise</span>
                                                    <span name="attr_disguise"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_fine_arts" value="@{wtype}&{template:simple} @{name_flag} {{rname=Fine Arts}} {{mod=@{fine_arts}}} {{r1=[[@{_rollfine_arts}d6 + @{fine_arts_bonus}]]}} {{type=Skill}}">
                                                    <span>Fine Arts</span>
                                                    <span name="attr_fine_arts"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_forgery" value="@{wtype}&{template:simple} @{name_flag} {{rname=Forgery}} {{mod=@{forgery}}} {{r1=[[@{forgery_roll}d6 + @{forgery_bonus}]]}} {{type=Skill}}">
                                                    <span>Forgery</span>
                                                    <span name="attr_forgery"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_history" value="@{wtype}&{template:simple} @{name_flag} {{rname=History}} {{mod=@{history}}} {{r1=[[@{history_roll}d6 + @{history_bonus}]]}} {{type=Skill}}">
                                                    <span>History</span>
                                                    <span name="attr_history"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_intuition" value="@{wtype}&{template:simple} @{name_flag} {{rname=Intuition}} {{mod=@{intuition}}} {{r1=[[@{intuition_roll}d6 + @{intuition_bonus}]]}} {{type=Skill}}">
                                                    <span>Intuition</span>
                                                    <span name="attr_intuition"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_intimidation" value="@{wtype}&{template:simple} @{name_flag} {{rname=Intimidation}} {{mod=@{intimidation}}} {{r1=[[@{intimidation_roll}d6 + @{intimidation_bonus}]]}} {{type=Skill}}">
                                                    <span>Intimidation</span>
                                                    <span name="attr_intimidation"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_investigation" value="@{wtype}&{template:simple} @{name_flag} {{rname=Investigation}} {{mod=@{investigation}}} {{r1=[[@{investigation_roll}d6 + @{investigation_bonus}]]}} {{type=Skill}}">
                                                    <span>Investigation</span>
                                                    <span name="attr_investigation"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_medicine" value="@{wtype}&{template:simple} @{name_flag} {{rname=Medicine}} {{mod=@{medicine}}} {{r1=[[@{medicine_roll}d6 + @{medicine_bonus}]]}} {{type=Skill}}">
                                                    <span>Medicine</span>
                                                    <span name="attr_medicine"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_navigation" value="@{wtype}&{template:simple} @{name_flag} {{rname=Navigation}} {{mod=@{navigation}}} {{r1=[[@{navigation_roll}d6 + @{navigation_bonus}]]}} {{type=Skill}}">
                                                    <span>Navigation</span>
                                                    <span name="attr_navigation"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_perception" value="@{wtype}&{template:simple} @{name_flag} {{rname=Perception}} {{mod=@{perception}}} {{r1=[[@{perception_roll}d6 + @{perception_bonus}]]}} {{type=Skill}}">
                                                    <span>Perception</span>
                                                    <span name="attr_perception"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_performance" value="@{wtype}&{template:simple} @{name_flag} {{rname=Performance}} {{mod=@{performance}}} {{r1=[[@{performance_roll}d6 + @{performance_bonus}]]}} {{type=Skill}}">
                                                    <span>Performance</span>
                                                    <span name="attr_performance"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_persuade" value="@{wtype}&{template:simple} @{name_flag} {{rname=Persuade}} {{mod=@{persuade}}} {{r1=[[@{persuade_roll}d6 + @{persuade_bonus}]]}} {{type=Skill}}">
                                                    <span>Persuade</span>
                                                    <span name="attr_persuade"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_stealth" value="@{wtype}&{template:simple} @{name_flag} {{rname=Stealth}} {{mod=@{stealth}}} {{r1=[[@{stealth_roll}d6 + @{stealth_bonus}]]}} {{type=Skill}}">
                                                    <span>Stealth</span>
                                                    <span name="attr_stealth"></span>
                                                </button>
                                            </div>
                                            <div class="sheet-pc-skill">
                                                <button type="roll" name="roll_survival" value="@{wtype}&{template:simple} @{name_flag} {{rname=Survival}} {{mod=@{survival}}} {{r1=[[@{survival_roll}d6 + @{survival_bonus}]]}} {{type=Skill}}">
                                                    <span>Survival</span>
                                                    <span name="attr_survival"></span>
                                                </button>
                                            </div>
                                            </span>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="sheet-container-panel sheet-panel-hp">
                                            <div class="sheet-container-header">HEALTH</div>
                                            <div class="sheet-container-body">
                                                <div class="sheet-container-box sheet-pc-health">
                                                    <div class="sheet-box-body sheet-health">
                                                        <input type="number" name="attr_hp_max" title="@{hp_max}" placeholder="MAXIMUM">
                                                        <input type="number" name="attr_hp" title="@{hp}" placeholder="CURRENT">
                                                    </div>
                                                </div>
                                                <div class="sheet-container-box sheet-pc-health">
                                                    <div class="sheet-box-body sheet-health-extra">
                                                        <div class="sheet-box">
                                                            <span>Dice</span>
                                                        <input type="text" name="attr_hp_die" title="@{hp_die}" placeholder="1d8">
                                                        </div>
                                                        <div class="sheet-box">
                                                            <span>Temp</span>
                                                            <input type="number" name="attr_hp_temp" title="@{hp_temp}" placeholder="0">
                                                        </div>
                                                        <div class="sheet-box">
                                                            <span>Regen</span>
                                                            <input type="number" name="attr_hp_regen" title="@{hp_regen}" placeholder="0">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="sheet-container-panel sheet-panel-combat">
                                            <div class="sheet-container-header">COMBAT</div>
                                            <div class="sheet-container-body">
                                                <div class="sheet-container-box sheet-pc-initiative">
                                                    <div class="sheet-container-bar">
                                                        <button type="roll" name="roll_init" value="@{wtype}&{template:simple} @{name_flag} {{rname=Initiative}} {{r1=[[@{agility}d6[AGI]+@{initiative_bonus} &{tracker}]]}} {{type=Initiative}}">INITIATIVE<span name="attr_initiative" title="@{initiative}"></span></button>
                                                    </div>
                                                </div>
                                                <div class="sheet-container-box sheet-pc-defences">
                                                    <div class="sheet-defence-label">HYPER RESISTANCE</div>
                                                    <input class="sheet-defence" type="text" name="attr_hyper_resistances" title="@{hyper_resistances}">
                                                    <div class="sheet-defence-label">RESISTANCE</div>
                                                    <input class="sheet-defence" type="text" name="attr_resistances" title="@{resistances}">
                                                    <div class="sheet-defence-label">WEAKNESS</div>
                                                    <input class="sheet-defence" type="text" name="attr_weakness" title="@{weakness}">
                                                    <div class="sheet-defence-label">HYPER WEAKNESS</div>
                                                    <input class="sheet-defence" type="text" name="attr_hyper_weakness" title="@{hyper_weakness}">
                                                </div>
                                                <div class="sheet-container-box sheet-pc-evasion-durability">
                                                    <div class="sheet-pc-evasion-group">
                                                        <div class="sheet-pc-evasion-full">
                                                            <span class="sheet-evasion-full" name="attr_evasion-full" title="@{evasion-full}"></span>
                                                            <div class="sheet-pc-defence-label">EVA</div>
                                                        </div>
                                                        <div class="sheet-pc-evasion-base">
                                                            <input class="sheet-evasion-base" type="number" name="attr_evasion-base" title="@{evasion-base}" placeholder="0">
                                                            <div class="sheet-pc-defence-label">BASE</div>
                                                        </div>
                                                        <div class="sheet-pc-evasion-limit">
                                                            <input class="sheet-evasion-limit" type="number" name="attr_evasion-limit" title="@{evasion-limit}" placeholder="0" value="10">
                                                            <div class="sheet-pc-defence-label">LIMIT</div>
                                                        </div>
                                                        <div class="sheet-pc-evasion-bonus">
                                                            <input class="sheet-evasion-bonus" type="number" name="attr_evasion-bonus" title="@{evasion-bonus}" placeholder="0">
                                                            <div class="sheet-pc-defence-label">BONUS</div>
                                                        </div>
                                                    </div>
                                                    <div class="sheet-pc-durability-group">
                                                        <div class="sheet-pc-durability-full">
                                                            <span class="sheet-durability-full" name="attr_durability-full" title="@{durability-full}"></span>
                                                            <div class="sheet-pc-defence-label">DUR</div>
                                                        </div>
                                                        <div class="sheet-pc-durability-base">
                                                            <input class="sheet-durability-base" type="number" name="attr_durability-base" title="@{durability-base}" placeholder="0">
                                                            <div class="sheet-pc-defence-label">BASE</div>
                                                        </div>
                                                        <div class="sheet-pc-durability-limit">
                                                            <input class="sheet-durability-limit" type="number" name="attr_durability-limit" title="@{durability-limit}" placeholder="0" value="10">
                                                            <div class="sheet-pc-defence-label">LIMIT</div>
                                                        </div>
                                                        <div class="sheet-pc-durability-bonus">
                                                            <input class="sheet-durability-bonus" type="number" name="attr_durability-bonus" title="@{durability-bonus}" placeholder="0">
                                                            <div class="sheet-pc-defence-label">BONUS</div>
                                                        </div>
                                                    </div>
                                                    <div class="sheet-pc-reduction-group">
                                                        <div class="sheet-pc-reduction-full">
                                                            <span class="sheet-reduction-full" name="attr_reduction-full" title="@{reduction-full}"></span>
                                                            <div class="sheet-pc-defence-label">DR</div>
                                                        </div>
                                                        <div class="sheet-pc-reduction-base">
                                                            <input class="sheet-reduction-base" type="number" name="attr_reduction-base" title="@{reduction-base}" placeholder="0">
                                                            <div class="sheet-pc-defence-label">BASE</div>
                                                        </div>
                                                        <div class="sheet-pc-reduction-armour">
                                                            <input class="sheet-reduction-armour" type="number" name="attr_reduction-armour" title="@{reduction-armour}" placeholder="0">
                                                            <div class="sheet-pc-defence-label">ARMOUR</div>
                                                        </div>
                                                        <div class="sheet-pc-reduction-bonus">
                                                            <input class="sheet-reduction-bonus" type="number" name="attr_reduction-bonus" title="@{reduction-bonus}" placeholder="0">
                                                            <div class="sheet-pc-defence-label">BONUS</div>
                                                        </div>
                                                    </div>
                                                    <div class="sheet-pc-speed-group">
                                                        <div class="sheet-pc-speed-movement">
                                                            <input class="sheet-movement-movement" type="number" name="attr_movement" title="@{movement}" placeholder="0">
                                                            <div class="sheet-pc-defence-label">SPEED</div>
                                                        </div>
                                                        <div class="sheet-pc-speed-swim">
                                                            <input class="sheet-movement-swim" type="number" name="attr_swim" title="@{swim}" placeholder="0">
                                                            <div class="sheet-pc-defence-label">SWIM</div>
                                                        </div>
                                                        <div class="sheet-pc-speed-climb">
                                                            <input class="sheet-movement-climb" type="number" name="attr_climb" title="@{climb}" placeholder="0">
                                                            <div class="sheet-pc-defence-label">CLIMB</div>
                                                        </div>
                                                        <div class="sheet-pc-speed-fly">
                                                            <input class="sheet-movement-fly" type="number" name="attr_fly" title="@{fly}" placeholder="0">
                                                            <div class="sheet-pc-defence-label">FLY</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="sheet-container-well container-attacks">
                                    <div class="sheet-container-panel sheet-panel-attacks">
                                        <div class="sheet-container-header">ATTACKS</div>
                                        <div class="sheet-container-body">
                                            <fieldset class="repeating_move">
                                                <div class="sheet-fieldset-item sheet-fieldset-item-move">
                                                    <div class="sheet-checkbox-cog">
                                                        <input type="checkbox" name="attr_options-flag" checked="checked" value="on">
                                                        <span class="sheet-toggle-icon"></span>
                                                    </div>
                                                    <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                                    <div class="sheet-toggle-checked">
                                                        <div class="sheet-form">
                                                            <div class="sheet-form-header">Edit Move</div>
                                                            <div class="sheet-form-body">
                                                                <div class="sheet-form-group">
                                                                    <label>Name:</label>
                                                                    <input type="text" name="attr_name">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_attack_flag" value="on">
                                                                        <span>Attack</span>
                                                                    </label>
                                                                </div>
                                                                <input type="checkbox" name="attr_attack_flag" value="on" class="sheet-toggle" hidden>
                                                                <div class="sheet-form-group sheet-toggle-checked">
                                                                    <div class="sheet-form-fieldset">
                                                                        <div class="sheet-form-fieldset-header">Attack</div>
                                                                        <div class="sheet-form-fieldset-body">
                                                                            <input type="hidden" name="attr_damage_flag">
                                                                            <input type="hidden" name="attr_full_damage">
                                                                            <div class="sheet-form-group">
                                                                                <label>Type:</label>
                                                                                <select name="attr_attack_type">
                                                                                    <option value="Melee">Melee</option>
                                                                                    <option value="Ranged">Ranged</option>
                                                                                </select>
                                                                            </div>
                                                                            <div class="sheet-form-group">
                                                                                <label>Range/Reach:</label>
                                                                                <input type="text" name="attr_attack_range">
                                                                            </div>
                                                                            <div class="sheet-form-group">
                                                                                <label>To Hit:</label>
                                                                                <select name="attr_attack_tohit">
                                                                                    <option value="@{power}">Power</option>
                                                                                    <option value="@{agility}">Agility</option>
                                                                                    <option value="@{vitality}">Vitality</option>
                                                                                    <option value="@{cultivation}">Cultivation</option>
                                                                                    <option value="@{qi_control}">Qi Control</option>
                                                                                    <option value="@{mental_strength}">Mental Strength</option>
                                                                                </select>
                                                                                <label>Bonus:</label>
                                                                                <input type="text" name="attr_attack_bonus">
                                                                            </div>
                                                                            <div class="sheet-form-group">
                                                                                <label>Damage 1:</label>
                                                                                <input type="text" name="attr_attack_damage">
                                                                                <select name="attr_attack_damage1attribute">
                                                                                    <option value="none">None</option>
                                                                                    <option value="@{power}">Power</option>
                                                                                    <option value="@{agility}">Agility</option>
                                                                                    <option value="@{vitality}">Vitality</option>
                                                                                    <option value="@{cultivation}">Cultivation</option>
                                                                                    <option value="@{qi_control}">Qi Control</option>
                                                                                    <option value="@{mental_strength}">Mental Strength</option>
                                                                                </select>
                                                                                <label>Bonus:</label>
                                                                                <input type="text" name="attr_attack_damage1bonus">
                                                                                <label>Type:</label>
                                                                                <input type="text" name="attr_attack_damagetype">
                                                                            </div>
                                                                            <div class="sheet-form-group">
                                                                                <label>Damage 2:</label>
                                                                                <input type="text" name="attr_attack_damage2">
                                                                                <select name="attr_attack_damage2attribute">
                                                                                    <option value="none">None</option>
                                                                                    <option value="@{power}">Power</option>
                                                                                    <option value="@{agility}">Agility</option>
                                                                                    <option value="@{vitality}">Vitality</option>
                                                                                    <option value="@{cultivation}">Cultivation</option>
                                                                                    <option value="@{qi_control}">Qi Control</option>
                                                                                    <option value="@{mental_strength}">Mental Strength</option>
                                                                                </select>
                                                                                <label>Bonus:</label>
                                                                                <input type="text" name="attr_attack_damage2bonus">
                                                                                <label>Type:</label>
                                                                                <input type="text" name="attr_attack_damagetype2">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Description:</label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <textarea name="attr_description"></textarea>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="sheet-toggle-unchecked">
                                                        <div class="sheet-move">
                                                            <button type="roll" name="roll_move" value="@{rollbase}" class="sheet-fieldset-item-move-checked-roll sheet-btn-text">
                                                                <div class="sheet-fieldset-item-move-checked-name">
                                                                    <span name="attr_name"></span>
                                                                </div>
                                                                <input type="checkbox" name="attr_attack_flag" value="on" class="sheet-toggle" hidden>
                                                                <div class="sheet-toggle-checked">
                                                                    <div class="sheet-fieldset-item-move-checked-attack">
                                                                        <span name="attr_attack_hitdamage"></span>
                                                                    </div>
                                                                </div>
                                                            </button>
                                                            <input type="hidden" name="attr_rollbase">
                                                            <button type="roll" name="roll_dmg" value="@{full_damage}" class="sheet-hidden"></button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="sheet-column">
                                <div class="sheet-container-well container-features">
                                    <div class="sheet-container-panel sheet-panel-features">
                                        <div class="sheet-container-header">FEATURES</div>
                                        <div class="sheet-container-body">
                                            <fieldset class="repeating_feature">
                                                <div class="sheet-fieldset-item sheet-fieldset-item-feature">
                                                    <div class="sheet-checkbox-cog">
                                                        <input type="checkbox" name="attr_options-flag" checked="checked" value="on">
                                                        <span class="sheet-toggle-icon"></span>
                                                    </div>
                                                    <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                                    <div class="sheet-toggle-checked">
                                                        <div class="sheet-form">
                                                            <div class="sheet-form-header">Edit Feature</div>
                                                            <div class="sheet-form-body">
                                                                <div class="sheet-form-group">
                                                                    <label>Name:</label>
                                                                    <input type="text" name="attr_name">
                                                                </div>
                                                                <div class="sheet-form-group form-group-description">
                                                                    <label>Description:</label>
                                                                    <textarea name="attr_desc"></textarea>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="sheet-toggle-unchecked">
                                                        <div class="sheet-feature">
                                                            <input class="toggle-feature" type="hidden" name="attr_toggle_feature_desc" value="0">
                                                            <div class="sheet-feature-name">
                                                                <span name="attr_name"></span>
                                                                <input class="toggle-checkbox" type="checkbox" value="1" name="attr_toggle_feature_desc">
                                                            </div>
                                                            <div class="sheet-feature-desc">
                                                                <span name="attr_desc"></span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </div>
                                    </div>
                                </div>
                                <div class="sheet-container-well container-resources">
                                    <div class="sheet-container-panel sheet-panel-resources">
                                        <div class="sheet-container-header">RESOURCES</div>
                                        <div class="sheet-container-body">
                                            <div class="sheet-resource-labels">
                                                <div class="sheet-resource-label resource-name">NAME</div>
                                                <div class="sheet-resource-label resource-current">CURRENT</div>
                                                <div class="sheet-resource-label resource-max">MAX</div>
                                            </div>
                                            <fieldset class="repeating_resource">
                                                <div class="sheet-fieldset-item">
                                                    <div class="sheet-form">
                                                        <div class="sheet-item-resource-name">
                                                            <input class="sheet-resource-name" type="text" name="attr_resource_name" title="@{resource_name}" placeholder="Resource Name">
                                                        </div>
                                                        <div class="sheet-item-resource-current">
                                                            <input class="sheet-resource-current" type="number" name="attr_resource_current" title="@{resource_current}" placeholder="0">
                                                        </div>
                                                        <div class="sheet-item-resource-max">
                                                            <input class="sheet-resource-max" type="number" name="attr_resource_max" title="@{resource_max}" placeholder="0">
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-tab sheet-tab-features">
                    <input type="radio" name="attr_tab" value="features">
                    <span class="sheet-tab-label">Features</span>
                    <div class="sheet-tab-content">
                        <div class="sheet-container-well sheet-container-well-details">
                            <div class="sheet-container-panel sheet-pc-details">
                                <div class="sheet-container-header">Character Details</div>
                                <div class="sheet-container-body">
                                    <div class="sheet-pc-detail">
                                        <label>Age</label>
                                        <select name="attr_character_age_detail" title="@{character_age_detail}">
                                            <option value=""></option>
                                            <option value="young_adult">Young adult</option>
                                            <option value="early_middle">Early-mid age</option>
                                            <option value="late_middle">Late-mid age</option>
                                            <option value="old">Old</option>
                                            <option value="very_old">Very old</option>
                                        </select>
                                        <input type="text" name="attr_character_age" title="@{character_age}">
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Size</label>
                                        <select name="attr_size" title="@{size}">
                                            <option value="tiny">Tiny</option>
                                            <option value="small">Small</option>
                                            <option value="medium" selected>Medium</option>
                                            <option value="large">Large</option>
                                            <option value="huge">Huge</option>
                                            <option value="gargantuan">Gargantuan</option>
                                        </select>
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Height</label>
                                        <select name="attr_character_height_detail" title="@{character_height_detail}">
                                            <option value=""></option>
                                            <option value="very_short">Very short</option>
                                            <option value="short">Short</option>
                                            <option value="average">Average</option>
                                            <option value="tall">Tall</option>
                                            <option value="very_tall">Very tall</option>
                                        </select>
                                        <input type="text" name="attr_character_height" title="@{character_height}">
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Weight</label>
                                        <select name="attr_character_weight" title="@{character_weight}">
                                            <option value=""></option>
                                            <option value="very_thin">Very thin</option>
                                            <option value="thin">Thin</option>
                                            <option value="average">Average</option>
                                            <option value="fat">Fat</option>
                                            <option value="very_fat">Very fat</option>
                                        </select>
                                        <input type="text" name="attr_character_weight_detail" title="@{character_weight_detail}">
                                    </div>
                                    <div class="sheet-pc-detail sheet-pc-detail-feature">
                                        <label>Feature</label>
                                        <div class="sheet-pc-detail-column">
                                            <input type="text" name="attr_character_feature_detail" title="@{character_feature_detail}">
                                        </div>
                                    </div>
                                    <div class="sheet-pc-detail sheet-pc-detail-motivation">
                                        <label>Motivation</label>
                                        <div class="sheet-pc-detail-column">
                                            <input type="text" name="attr_character_motivation_detail" title="@{character_motivation_detail}">
                                        </div>
                                    </div>
                                    <div class="sheet-pc-detail sheet-pc-detail-habit">
                                        <label>Habit</label>
                                        <div class="sheet-pc-detail-column">
                                            <select name="attr_character_habit" title="@{character_habit}">
                                            <input type="text" name="attr_character_habit_detail" title="@{character_habit_detail}">
                                        </div>
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Family</label>
                                        <select name="attr_character_family" title="@{character_family}">
                                            <option value=""></option>
                                            <option value="none">None</option>
                                            <option value="small">Small</option>
                                            <option value="average">Average</option>
                                            <option value="large">Large</option>
                                            <option value="disowned">Disowned</option>
                                        </select>
                                    </div>
                                    <div class="sheet-pc-detail">
                                        <label>Raised By</label>
                                        <select name="attr_character_raised_by" title="@{character_raised_by}">
                                            <option value=""></option>
                                            <option value="natural_parents">Natural parent(s)</option>
                                            <option value="close_family">Close family</option>
                                            <option value="adopted">Adopted parent(s)</option>
                                            <option value="institution">An institution</option>
                                            <option value="yourself">Yourself</option>
                                        </select>
                                    </div>
                                    <div class="sheet-pc-detail sheet-pc-detail-quest">
                                        <label>Quest</label>
                                        <textarea name="attr_character_quest" title="@{character_quest}"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-gimmick">
                                <div class="sheet-container-header">Gimmick</div>
                                <div class="sheet-container-body">
                                    <textarea name="attr_gimmick" title="@{gimmick}"></textarea>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-value">
                                <div class="sheet-container-header">Values</div>
                                <div class="sheet-container-body">
                                    <textarea name="attr_values" title="@{values}"></textarea>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-conflict">
                                <div class="sheet-container-header">Conflict</div>
                                <div class="sheet-container-body">
                                    <textarea name="attr_conflict" title="@{conflict}"></textarea>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-want">
                                <div class="sheet-container-header">Want</div>
                                <div class="sheet-container-body">
                                    <textarea name="attr_want" title="@{want}"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-memories">
                            <div class="sheet-container-panel sheet-pc-memories">
                                <div class="sheet-container-header">Memories & Events</div>
                                <div class="sheet-container-body">
                                    <fieldset class="repeating_memories">
                                        <div class="sheet-fieldset-item">
                                            <div class="sheet-checkbox-cog">
                                                <input type="checkbox" name="attr_options-flag" checked="checked">
                                                <span class="sheet-toggle-icon"></span>
                                            </div>
                                            <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                            <div class="sheet-toggle-checked">
                                                <div class="sheet-form">
                                                    <div class="sheet-form-header">Edit Memory</div>
                                                    <div class="sheet-form-body">
                                                        <div class="sheet-form-group">
                                                            <label>Name:</label>
                                                            <input type="text" name="attr_memory_name">
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <textarea name="attr_memory_description"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="sheet-toggle-unchecked">
                                                <div class="sheet-pc-memory">
                                                    <span name="attr_memory_name"></span>
                                                    <span name="attr_memory_description"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                            <div class="sheet-container-panel sheet-pc-notes">
                                <div class="sheet-container-header">Additional Notes</div>
                                <div class="sheet-container-body">
                                    <fieldset class="repeating_notes">
                                        <div class="sheet-fieldset-item">
                                            <div class="sheet-checkbox-cog">
                                                <input type="checkbox" name="attr_options-flag" checked="checked">
                                                <span class="sheet-toggle-icon"></span>
                                            </div>
                                            <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                            <div class="sheet-toggle-checked">
                                                <div class="sheet-form">
                                                    <div class="sheet-form-header">Edit Note</div>
                                                    <div class="sheet-form-body">
                                                        <div class="sheet-form-group">
                                                            <label>Name:</label>
                                                            <input type="text" name="attr_note_name">
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <textarea name="attr_note_description"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="sheet-toggle-unchecked">
                                                <div class="sheet-pc-note">
                                                    <span name="attr_note_name"></span>
                                                    <span name="attr_note_description"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-features">
                            <div class="sheet-container-panel sheet-pc-features">
                                <div class="sheet-container-header">Features & Traits</div>
                                <div class="sheet-container-body">
                                    <fieldset class="repeating_traits">
                                        <div class="sheet-fieldset-item">
                                            <div class="sheet-checkbox-cog">
                                                <input type="checkbox" name="attr_options-flag" checked="checked">
                                                <span class="sheet-toggle-icon"></span>
                                            </div>
                                            <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                            <div class="sheet-toggle-checked">
                                                <div class="sheet-form">
                                                    <div class="sheet-form-header">Edit Feature</div>
                                                    <div class="sheet-form-body">
                                                        <div class="sheet-form-group">
                                                            <label>Name:</label>
                                                            <input type="text" name="attr_name">
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <label>Source:</label>
                                                            <select name="attr_source">
                                                                <option selected="selected">Ancestral</option>
                                                                <option>Mortal path</option>
                                                                <option>Talent</option>
                                                                <option>Background</option>
                                                                <option>Other</option>
                                                            </select>
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <label>Source Type:</label>
                                                            <input type="text" name="attr_source_type">
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <textarea name="attr_description"></textarea>
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <label class="sheet-form-checkbox">
                                                                <input type="checkbox" name="attr_hide_details" value="1">
                                                                <span>Hide Details</span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="sheet-toggle-unchecked">
                                                <div class="sheet-pc-feature">
                                                    <button type="roll" name="roll_output" value="@{wtype}&{template:features} {{name=@{name}}} {{source=@{source}: @{source_type}}} {{description=@{description}}}">
                                                        <div class="sheet-pc-feature-name">
                                                            <span name="attr_name"></span>
                                                        </div>
                                                        <input type="hidden" name="attr_hide_details" class="sheet-field-untoggle">
                                                        <div class="sheet-pc-feature-details">
                                                            <span class="sheet-pc-feature-source">
                                                                <span name="attr_source"></span>
                                                                <span name="attr_source_type"></span>
                                                            </span>
                                                            <span name="attr_description"></span>
                                                        </div>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-tab sheet-tab-notes">
                    <input type="radio" name="attr_tab" value="notes">
                    <span class="sheet-tab-label">Notes</span>
                    <div class="sheet-tab-content">
                        <div class="sheet-container-well sheet-pc-notes">
                            <div class="col col1">
                                <div class="sheet-container-panel sheet-pc-notes-one">
                                    <div class="sheet-container-header">
                                        <input type="text" name="attr_notes_one_header" placeholder="Additional Features & Traits" value="Additional Features & Traits">
                                    </div>
                                    <div class="sheet-container-body">
                                        <textarea name="attr_pc_notes_one"></textarea>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-pc-notes-two">
                                    <div class="sheet-container-header">
                                        <input type="text" name="attr_notes_two_header" placeholder="Character Backstory" value="Character Backstory">
                                    </div>
                                    <div class="sheet-container-body">
                                        <textarea name="attr_pc_notes_two"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="col col2">
                                <div class="sheet-container-panel sheet-pc-notes-three">
                                    <div class="sheet-container-header">
                                        <input type="text" name="attr_notes_three_header" placeholder="Allies & Organisations" value="Allies & Organisations">
                                    </div>
                                    <div class="sheet-container-body">
                                        <textarea name="attr_pc_notes_three"></textarea>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-pc-notes-four">
                                    <div class="sheet-container-header">
                                        <input type="text" name="attr_notes_four_header" placeholder="Treasure" value="Treasure">
                                    </div>
                                    <div class="sheet-container-body">
                                        <textarea name="attr_pc_notes_four"></textarea>
                                    </div>
                                </div>
                                <div class="sheet-container-panel sheet-pc-notes-five">
                                    <div class="sheet-container-header">
                                        <input type="text" name="attr_notes_five_header" placeholder="Extra" value="Extra">
                                    </div>
                                    <div class="sheet-container-body">
                                        <textarea name="attr_pc_notes_five"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-tab sheet-tab-inventory">
                    <input type="radio" name="attr_tab" value="inventory">
                    <span class="sheet-tab-label">Inventory</span>
                    <div class="sheet-tab-content">
                        <div class="sheet-container-well sheet-container-well-inventory-supplies">
                            <div class="sheet-container-bar sheet-pc-rations">
                                <div class="sheet-container-header">Rations</div>
                                <div class="sheet-container-body">
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_ration_1" title="@{ration_1}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_ration_2" title="@{ration_2}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_ration_3" title="@{ration_3}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_ration_4" title="@{ration_4}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_ration_5" title="@{ration_5}">
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-water">
                                <div class="sheet-container-header">Waterskin</div>
                                <div class="sheet-container-body">
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_waterskin_1" title="@{waterskin_1}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_waterskin_2" title="@{waterskin_2}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_waterskin_3" title="@{waterskin_3}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_waterskin_4" title="@{waterskin_4}">
                                        <span></span>
                                    </div>
                                    <div class="sheet-checkbox-image">
                                        <input type="checkbox" name="attr_waterskin_5" title="@{waterskin_5}">
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-inventory-purse">
                            <div class="sheet-container-bar sheet-pc-purse-cc">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_cc_title" title="@{cc_title}" value="COPPER">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="text" name="attr_cc" title="@{cc}">
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-purse-sc">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_sc_title" title="@{sc_title}" value="SILVER">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="text" name="attr_sc" title="@{sc}">
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-purse-gc">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_gc_title" title="@{gc_title}" value="GOLD">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="text" name="attr_gc" title="@{gc}">
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-purse-ss">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_ss_title" title="@{ss_title}" value="SPIRIT STONE">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="text" name="attr_ss" title="@{ss}">
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-purse-other1">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_currency1" title="@{currency1}">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="text" name="attr_currency1_value" title="@{currency1_value}">
                                </div>
                            </div>
                            <div class="sheet-container-bar sheet-pc-purse-other2">
                                <div class="sheet-container-header">
                                    <input type="text" name="attr_currency2" title="@{currency2}">
                                </div>
                                <div class="sheet-container-body">
                                    <input type="text" name="attr_currency2_value" title="@{currency2_value}">
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-inventory-encumberance">
                            <input type="hidden" name="attr_use_inventory_slots" value="1" class="sheet-field-untoggle">
                            <div class="sheet-container-box sheet-pc-weight">
                                <div class="sheet-container-header">Weight</div>
                                <div class="sheet-container-body">
                                    <input type="text" name="attr_weighttotal" title="@{weighttotal}">
                                    <span>/</span>
                                    <span name="attr_weightmaximum" title="@{weightmaximum}"></span>
                                </div>
                                <div class="sheet-container-footer">
                                    <span>Current</span>
                                    <span>Maximum</span>
                                </div>
                            </div>
                            <input type="hidden" name="attr_use_inventory_slots" value="1" class="sheet-field-toggle">
                            <div class="sheet-container-box sheet-pc-slots">
                                <div class="sheet-container-header">Inventory Slots</div>
                                <div class="sheet-container-body">
                                    <input type="text" name="attr_slotstotal" title="@{slotstotal}">
                                    <span>/</span>
                                    <span name="attr_slotsmaximum" title="@{slotsmaximum}"></span>
                                </div>
                                <div class="sheet-container-footer">
                                    <span>Current</span>
                                    <span>Maximum</span>
                                </div>
                            </div>
                            <div class="sheet-pc-carrying-status">
                                <input type="hidden" class="sheet-pc-encumberance" name="attr_encumberance">
                                <span class="sheet-pc-unencumbered">Unencumbered</span>
                                <span class="sheet-pc-encumbered">Encumbered</span>
                                <span class="sheet-pc-heavily">Heavily encumbered</span>
                                <span class="sheet-pc-immobile">Immobile</span>
                                <span class="sheet-pc-over">Over carrying capacity</span>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-inventory-general">
                            <div class="sheet-container-panel sheet-pc-inventory-other">
                                <div class="sheet-container-header">Other Items</div>
                                <div class="sheet-container-body">
                                    <fieldset class="repeating_otheritems">
                                        <div class="sheet-fieldset-item">
                                            <div class="sheet-checkbox-cog">
                                                <input type="checkbox" name="attr_options-flag" checked="checked"><span></span>
                                                <span class="sheet-toggle-icon"></span>
                                            </div>
                                            <input type="checkbox" name="attr_options-flag" checked="checked" hidden class="sheet-toggle">
                                            <div class="sheet-toggle-checked">
                                                <div class="sheet-form">
                                                    <div class="sheet-form-header">Edit Item</div>
                                                    <div class="sheet-form-body">
                                                        <div class="sheet-form-group">
                                                            <label>Name:</label>
                                                            <input type="text" name="attr_otheritem-name">
                                                        </div>
                                                        <div class="sheet-form-group">
                                                            <textarea name="attr_otheritem-description"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="sheet-toggle-unchecked">
                                                <div class="sheet-pc-otheritem">
                                                    <span name="attr_otheritem-name"></span><span name="attr_otheritem-description"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                        <div class="sheet-container-well sheet-container-well-inventory">
                            <div class="sheet-container-panel sheet-pc-inventory">
                                <div class="sheet-container-header">inventory & Holdings</div>
                                <div class="sheet-container-body">
                                    <input type="hidden" name="attr_use_inventory_slots" class="sheet-toggle-slots" value="1">
                                    <input type="hidden" name="attr_armorwarningflag" class="sheet-field-toggle">
                                    <div class="sheet-alert-warning">
                                        WARNING: Multiple sets of armor or shields are currently equipped and your AC is not correctly calculated.
                                    </div>
                                    <fieldset class="repeating_inventory">
                                        <div class="sheet-fieldset-item">
                                            <div class="sheet-checkbox-cog">
                                                <input type="checkbox" name="attr_options-flag" checked="checked">
                                                <span class="sheet-toggle-icon"></span>
                                            </div>
                                            <input type="checkbox" name="attr_options-flag" checked="checked" class="sheet-toggle" hidden>
                                            <div class="sheet-toggle-checked">
                                                <div class="sheet-form sheet-form-item">
                                                    <div class="sheet-form-header">Edit Item</div>
                                                    <div class="sheet-form-body">
                                                        <input type="hidden" name="attr_equipped">
                                                        <input type="hidden" name="attr_carried">
                                                        <input type="hidden" name="attr_inventorysubflag">
                                                        <input type="hidden" name="attr_itemattackid">
                                                        <input type="hidden" name="attr_itemresourceid">
                                                        <div class="sheet-item-contents">
                                                            <div class="sheet-form-group">
                                                                <label>Name:</label>
                                                                <input type="text" name="attr_itemname">
                                                            </div>
                                                            <input type="checkbox" name="attr_itemcontainer" value="1" class="sheet-toggle" hidden>
                                                            <div class="sheet-toggle-unchecked">
                                                                <div class="sheet-form-group">
                                                                    <label>Quantity</label>
                                                                    <input type="text" name="attr_itemcount" value="1">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Weight:</label>
                                                                    <input type="text" name="attr_itemweight">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_itemweightfixed" value="1">
                                                                        <span>Fixed (Ignore quantity)</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Size:</label>
                                                                    <select name="attr_itemsize">
                                                                        <option value="0.2">Tiny (0.2 slots)</option>
                                                                        <option value="1" selected>Small (1 slot)</option>
                                                                        <option value="2">Medium (2 slots)</option>
                                                                        <option value="3">Large (3 slots)</option>
                                                                        <option value="6">X-Large (6 slots)</option>
                                                                        <option value="9">XX-Large (9 slots)</option>
                                                                        <option value="12">XXX-Large (12 slots)</option>
                                                                        <option value="15">XXXX-Large (15 slots)</option>
                                                                        <option value="18">XXXXX-Large (18 slots)</option>
                                                                    </select>
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_itemslotsfixed" value="1">
                                                                        <span>Fixed (Ignore quantity)</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group sheet-item-columns-2">
                                                                    <div class="sheet-form-group">
                                                                        <label>Notches:</label>
                                                                        <input type="text" name="attr_itemnotches" value="0">
                                                                    </div>
                                                                    <div class="sheet-form-group">
                                                                        <label>Quality:</label>
                                                                        <select name="attr_itemquality">
                                                                            <option value="" selected="selected"></option>
                                                                            <option value="pristine">Pristine</option>
                                                                            <option value="worn">Worn</option>
                                                                            <option value="wellworn">Well-worn</option>
                                                                            <option value="scarred">Scarred</option>
                                                                            <option value="broken">Broken</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Properties:</label>
                                                                    <input type="text" name="attr_itemproperties">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Modifiers:</label>
                                                                    <input type="text" name="attr_itemmodifiers">
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Description:</label>
                                                                    <textarea name="attr_itemcontent"></textarea>
                                                                </div>
                                                            </div>
                                                            <div class="sheet-toggle-checked">
                                                                <div class="sheet-item-columns-2">
                                                                    <div class="sheet-form-group">
                                                                        <label>Type:</label>
                                                                        <select name="attr_itemcontainer_type">
                                                                            <option value="bag" selected="selected">Bag</option>
                                                                            <option value="belt">Belt</option>
                                                                            <option value="pouch">Pouch</option>
                                                                            <option value="quiver">Quiver</option>
                                                                            <option value="sheath">Sheath</option>
                                                                            <option value="stash">Stash</option>
                                                                            <option value="property">Property</option>
                                                                            <option value="vehicle">Vehicle</option>
                                                                            <option value="worn">Worn</option>
                                                                        </select>
                                                                    </div>
                                                                    <div class="sheet-form-group">
                                                                        <label>Max. Capacity (Slots):</label>
                                                                        <input type="text" name="attr_itemcontainer_slots" value="3">
                                                                    </div>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label>Inventory Slots Modifier:</label>
                                                                    <input type="text" name="attr_itemcontainer_slots_modifier">
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="sheet-item-options">
                                                            <div class="sheet-form-group">
                                                                <label class="sheet-form-checkbox">
                                                                    <input type="checkbox" name="attr_equipped" value="1" checked="checked">
                                                                    <span>Equipped</span>
                                                                </label>
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label class="sheet-form-checkbox">
                                                                    <input type="checkbox" name="attr_carried" value="1" checked="checked">
                                                                    <span>Carried</span>
                                                                </label>
                                                            </div>
                                                            <div class="sheet-form-group">
                                                                <label class="sheet-form-checkbox">
                                                                    <input type="checkbox" name="attr_itemcontainer" value="1">
                                                                    <span>Container</span>
                                                                </label>
                                                            </div>
                                                            <input type="checkbox" name="attr_itemcontainer" value="1" class="sheet-toggle" hidden>
                                                            <div class="sheet-toggle-unchecked">
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_useasresource" value="1">
                                                                        <span>Use as a Resource</span>
                                                                    </label>
                                                                </div>
                                                                <div class="sheet-form-group">
                                                                    <label class="sheet-form-checkbox">
                                                                        <input type="checkbox" name="attr_hasattack" value="1">
                                                                        <span>Has an Attack</span>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="sheet-toggle-unchecked">
                                                <input type="checkbox" name="attr_itemcontainer" value="1" class="sheet-toggle" hidden>
                                                <div class="sheet-toggle-unchecked">
                                                    <div class="sheet-pc-item">
                                                        <div class="sheet-pc-item-header">
                                                            <span>Item Name</span>
                                                            <span>Quantity</span>
                                                            <span>Weight</span>
                                                            <span>Slots</span>
                                                            <span>Notches</span>
                                                        </div>
                                                        <div class="sheet-pc-item-content">
                                                            <span class="sheet-pc-item-name">
                                                                <input type="hidden" name="attr_equipped" value="1" class="sheet-field-toggle">
                                                                <span class="sheet-pc-item-equipped"><strong>E</strong></span>
                                                                <input type="hidden" name="attr_carried" value="1" class="sheet-field-toggle">
                                                                <span class="sheet-pc-item-carried"><strong>C</strong></span>
                                                                <span name="attr_itemname"></span>
                                                            </span>
                                                            <span class="sheet-pc-item-quantity">
                                                                <input type="text" name="attr_itemcount">
                                                            </span>
                                                            <span class="sheet-pc-item-weight">
                                                                <input type="text" name="attr_itemweight">
                                                                <span name="attr_itemweight"></span>
                                                            </span>
                                                            <span class="sheet-pc-item-slots">
                                                                <input type="text" name="attr_itemsize">
                                                            </span>
                                                            <span class="sheet-pc-item-notches">
                                                                <input type="text" name="attr_itemnotches">
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="sheet-toggle-checked">
                                                    <div class="sheet-pc-inventory-container">
                                                        <input type="hidden" name="attr_equipped" value="1" class="sheet-field-toggle">
                                                        <span class="sheet-pc-item-equipped"><strong>E</strong></span>
                                                        <input type="hidden" name="attr_carried" value="1" class="sheet-field-toggle">
                                                        <span class="sheet-pc-item-carried"><strong>C</strong></span>
                                                        <span name="attr_itemname"></span>
                                                        <span class="sheet-pc-inventory-container-slots">
                                                            (
                                                            <span name="attr_itemcontainer_type"></span>
                                                            <input type="hidden" name="attr_itemcontainer_slots" class="sheet-field-toggle">
                                                            <span> capacity <span name="attr_itemcontainer_slots"></span></span>
                                                            <input type="hidden" name="attr_itemcontainer_slots_modifier" class="sheet-field-toggle">
                                                            <span> extra slots <span name="attr_itemcontainer_slots_modifier"></span></span>
                                                            )
                                                        </span>
                                                    </div>
                                                    <div class="sheet-pc-inventory-container-footer">
                                                        <span>Item Name</span>
                                                        <span>Quantity</span>
                                                        <span>Weight</span>
                                                        <span>Slots</span>
                                                        <span>Notches</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-tab sheet-tab-options">
                    <input type="radio" name="attr_tab" value="options">
                    <span class="sheet-tab-label">Options</span>
                    <div class="sheet-tab-content">

                    </div>
                </div>
            </div>
        </div>
        <div class="sheet-section-pc-footer">
            <p>Venator Ignis's JTTH Character Sheet</p>
        </div>
    </div>

    <div class="sheet-variables">
        <input type="hidden" name="attr_level" value="1">
        <input type="hidden" name="attr_hitdie_final" value="">
        <input type="hidden" name="attr_initiative_bonus" value="0">
        <input type="hidden" name="attr_npc_legendary_move_desc" value="">
        <input type="hidden" name="attr_global_damage_mod_roll" value="0">
        <input type="hidden" name="attr_global_damage_mod_type" value="">
        <input type="hidden" name="attr_global_attack_mod" value="">
        <input type="hidden" name="attr_global_check_mod" value="">
        <input type="hidden" name="attr_global_skill_mod" value="">
        <input type="hidden" name="attr_name_flag" value="0">
        <!-- ATTRIBUTES -->
        <input type="hidden" name="attr_power" value="0">
        <input type="hidden" name="attr_agility" value="0">
        <input type="hidden" name="attr_vitality" value="0">
        <input type="hidden" name="attr_cultivation" value="0">
        <input type="hidden" name="attr_qi_control" value="0">
        <input type="hidden" name="attr_mental_strength" value="0">
        <!-- ATTRIBUTE BONUS -->
        <input type="hidden" name="attr_power_bonus" value="0">
        <input type="hidden" name="attr_agility_bonus" value="0">
        <input type="hidden" name="attr_vitality_bonus" value="0">
        <input type="hidden" name="attr_cultivation_bonus" value="0">
        <input type="hidden" name="attr_qi_control_bonus" value="0">
        <input type="hidden" name="attr_mental_strength_bonus" value="0">
        <!-- NPC SKILL FULL -->
        <input type='hidden' name='attr_npc_acrobatics' value=''>
        <input type='hidden' name='attr_npc_athletics' value=''>
        <input type='hidden' name='attr_npc_charm' value=''>
        <input type='hidden' name='attr_npc_deceit' value=''>
        <input type='hidden' name='attr_npc_discretion' value=''>
        <input type='hidden' name='attr_npc_disguise' value=''>
        <input type='hidden' name='attr_npc_fine_arts' value=''>
        <input type='hidden' name='attr_npc_forgery' value=''>
        <input type='hidden' name='attr_npc_history' value=''>
        <input type='hidden' name='attr_npc_intuition' value=''>
        <input type='hidden' name='attr_npc_intimidate' value=''>
        <input type='hidden' name='attr_npc_investigate' value=''>
        <input type='hidden' name='attr_npc_medicine' value=''>
        <input type='hidden' name='attr_npc_navigation' value=''>
        <input type='hidden' name='attr_npc_perception' value=''>
        <input type='hidden' name='attr_npc_performance' value=''>
        <input type='hidden' name='attr_npc_persuade' value=''>
        <input type='hidden' name='attr_npc_stealth' value=''>
        <input type='hidden' name='attr_npc_survival' value=''>
        <!-- NPC SKILL ROLL -->
        <input type="hidden" name="attr_npc_acrobatics_roll" value="0">
        <input type="hidden" name="attr_npc_athletics_roll" value="0">
        <input type="hidden" name="attr_npc_charm_roll" value="0">
        <input type="hidden" name="attr_npc_deceit_roll" value="0">
        <input type="hidden" name="attr_npc_discretion" value="0">
        <input type="hidden" name="attr_npc_disguise_roll" value="0">
        <input type="hidden" name="attr_npc_fine_arts_roll" value="0">
        <input type="hidden" name="attr_npc_forgery_roll" value="0">
        <input type="hidden" name="attr_npc_history_roll" value="0">
        <input type="hidden" name="attr_npc_intuition_roll" value="0">
        <input type="hidden" name="attr_npc_intimidation_roll" value="0">
        <input type="hidden" name="attr_npc_investigation_roll" value="0">
        <input type="hidden" name="attr_npc_medicine_roll" value="0">
        <input type="hidden" name="attr_npc_navigation_roll" value="0">
        <input type="hidden" name="attr_npc_perception_roll" value="0">
        <input type="hidden" name="attr_npc_performance_roll" value="0">
        <input type="hidden" name="attr_npc_persuade_roll" value="0">
        <input type="hidden" name="attr_npc_stealth_roll" value="0">
        <input type="hidden" name="attr_npc_survival_roll" value="0">
        <!-- NPC SKILL BONUS -->
        <input type='hidden' name='attr_npc_acrobatics_bonus' value='0'>
        <input type='hidden' name='attr_npc_athletics_bonus' value='0'>
        <input type='hidden' name='attr_npc_charm_bonus' value='0'>
        <input type='hidden' name='attr_npc_deceit_bonus' value='0'>
        <input type='hidden' name='attr_npc_discretion_bonus' value='0'>
        <input type='hidden' name='attr_npc_disguise_bonus' value='0'>
        <input type='hidden' name='attr_npc_fine_arts_bonus' value='0'>
        <input type='hidden' name='attr_npc_forgery_bonus' value='0'>
        <input type='hidden' name='attr_npc_history_bonus' value='0'>
        <input type='hidden' name='attr_npc_intuition_bonus' value='0'>
        <input type='hidden' name='attr_npc_intimidate_bonus' value='0'>
        <input type='hidden' name='attr_npc_investigate_bonus' value='0'>
        <input type='hidden' name='attr_npc_medicine_bonus' value='0'>
        <input type='hidden' name='attr_npc_navigation_bonus' value='0'>
        <input type='hidden' name='attr_npc_perception_bonus' value='0'>
        <input type='hidden' name='attr_npc_performance_bonus' value='0'>
        <input type='hidden' name='attr_npc_persuade_bonus' value='0'>
        <input type='hidden' name='attr_npc_stealth_bonus' value='0'>
        <input type='hidden' name='attr_npc_survival_bonus' value='0'>
        <!-- PLAYER SKILL FULL -->
        <input type='hidden' name='attr_acrobatics' value='0'>
        <input type='hidden' name='attr_athletics' value='0'>
        <input type='hidden' name='attr_charm' value='0'>
        <input type='hidden' name='attr_deceit' value='0'>
        <input type='hidden' name='attr_discretion' value='0'>
        <input type='hidden' name='attr_disguise' value='0'>
        <input type='hidden' name='attr_fine_arts' value='0'>
        <input type='hidden' name='attr_forgery' value='0'>
        <input type='hidden' name='attr_history' value='0'>
        <input type='hidden' name='attr_intuition' value='0'>
        <input type='hidden' name='attr_intimidate' value='0'>
        <input type='hidden' name='attr_investigate' value='0'>
        <input type='hidden' name='attr_medicine' value='0'>
        <input type='hidden' name='attr_navigation' value='0'>
        <input type='hidden' name='attr_perception' value='0'>
        <input type='hidden' name='attr_performance' value='0'>
        <input type='hidden' name='attr_persuade' value='0'>
        <input type='hidden' name='attr_stealth' value='0'>
        <input type='hidden' name='attr_survival' value='0'>
        <!-- PLAYER SKILL ROLL -->
        <input type='hidden' name='attr_acrobatics_roll' value='0'>
        <input type='hidden' name='attr_athletics_roll' value='0'>
        <input type='hidden' name='attr_charm_roll' value='0'>
        <input type='hidden' name='attr_deceit_roll' value='0'>
        <input type='hidden' name='attr_discretion_roll' value='0'>
        <input type='hidden' name='attr_disguise_roll' value='0'>
        <input type='hidden' name='attr_fine_arts_roll' value='0'>
        <input type='hidden' name='attr_forgery_roll' value='0'>
        <input type='hidden' name='attr_history_roll' value='0'>
        <input type='hidden' name='attr_intuition_roll' value='0'>
        <input type='hidden' name='attr_intimidate_roll' value='0'>
        <input type='hidden' name='attr_investigate_roll' value='0'>
        <input type='hidden' name='attr_medicine_roll' value='0'>
        <input type='hidden' name='attr_navigation_roll' value='0'>
        <input type='hidden' name='attr_perception_roll' value='0'>
        <input type='hidden' name='attr_performance_roll' value='0'>
        <input type='hidden' name='attr_persuade_roll' value='0'>
        <input type='hidden' name='attr_stealth_roll' value='0'>
        <input type='hidden' name='attr_survival_roll' value='0'>
        <!-- PLAYER SKILL BONUS -->
        <input type='hidden' name='attr_acrobatics_bonus' value='0'>
        <input type='hidden' name='attr_athletics_bonus' value='0'>
        <input type='hidden' name='attr_charm_bonus' value='0'>
        <input type='hidden' name='attr_deceit_bonus' value='0'>
        <input type='hidden' name='attr_discretion_bonus' value='0'>
        <input type='hidden' name='attr_disguise_bonus' value='0'>
        <input type='hidden' name='attr_fine_arts_bonus' value='0'>
        <input type='hidden' name='attr_forgery_bonus' value='0'>
        <input type='hidden' name='attr_history_bonus' value='0'>
        <input type='hidden' name='attr_intuition_bonus' value='0'>
        <input type='hidden' name='attr_intimidate_bonus' value='0'>
        <input type='hidden' name='attr_investigate_bonus' value='0'>
        <input type='hidden' name='attr_medicine_bonus' value='0'>
        <input type='hidden' name='attr_navigation_bonus' value='0'>
        <input type='hidden' name='attr_perception_bonus' value='0'>
        <input type='hidden' name='attr_performance_bonus' value='0'>
        <input type='hidden' name='attr_persuade_bonus' value='0'>
        <input type='hidden' name='attr_stealth_bonus' value='0'>
        <input type='hidden' name='attr_survival_bonus' value='0'>
    </div>

    <div class="sheet-rolltemplate">
        <div class="sheet-rolltemplates">
            <rolltemplate class="sheet-rolltemplate-desc">
                <div class="desc info">
                    <span>
                        <span class="top"></span><span class="middle">{{description}}</span><span class="bottom"></span>
                    </span>
                </div>
            </rolltemplate>

            <rolltemplate class="sheet-rolltemplate-simple">
                <div class="row header">
                    <span>{{rname}}</span>
                </div>
                {{#name}}
                    <div class="row subheader">
                        <span class="italics">{{name}}</span>
                    </div>
                {{/name}}
                <div class="row">
                    <span class="italics">{{type}}: </span><span>{{r1}}</span>
                </div>
            </rolltemplate>

            <rolltemplate class="sheet-rolltemplate-move">
                <div class="container">
                    <div class="row header">
                        <span>{{rname}}</span>
                    </div>
                    {{#name}}
                        <div class="row subheader">
                            <span class="italics">{{name}}</span>
                        </div>
                    {{/name}}
                    {{#range}}
                        <div class="sublabel">
                            <span>{{range}}</span>
                        </div>
                    {{/range}}
                    {{#attack}}
                    <div class="row">
                        <span class="italics">Attack: </span><span>{{r1}}</span><span> | </span><span>{{r2}}</span>
                    </div>
                    {{/attack}}
                    {{#description}}
                    <div class="row">
                        <span class="desc">{{description}}</span>
                    </div>
                    {{/description}}
                </div>
                {{#damage}}
                    <div class="container dmgcontainer damagetemplate">
                        <span class="italics">Damage: </span>
                        <span>
                            {{#dmg1flag}}
                                {{dmg1}}{{dmg1type}}
                            {{/dmg1flag}}
                            {{#dmg1flag}}{{#dmg2flag}} + {{/dmg2flag}}{{/dmg1flag}}
                            {{#dmg2flag}}
                                {{dmg2}}{{dmg2type}}
                            {{/dmg2flag}}
                        </span>
                    </div>
                {{/damage}}
            </rolltemplate>

            <rolltemplate class="sheet-rolltemplate-atkdmg">
                {{#attack}}
                    <div class="container atk">
                        <div class="result">
                            <div class="adv">
                                <span>{{r1}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span>{{r2}}</span>
                            </div>
                        </div>
                        {{#range}}
                            <div class="sublabel">
                                <span>{{range}}</span>
                            </div>
                        {{/range}}
                        <div class="label">
                            <span>{{rname}}
                        </div>
                        {{#charname}}
                            <div class="charname">
                                <span>{{charname}}</span>
                            </div>
                        {{/charname}}
                    </div>
                {{/attack}}
                {{#desc}}
                    <div class="desc info">
                        <span>
                            <span class="top"></span><span class="middle">{{desc}}</span><span class="bottom"></span>
                        </span>
                    </div>
                {{/desc}}
                {{#damage}}
                    <div class="container damagetemplate">
                        <div class="result">
                            {{#dmg1flag}}
                                {{^dmg2flag}}
                                    <div class="solo">
                                        <span class="damage">
                                            {{dmg1}}
                                            {{#attack}}
                                                {{#rollTotal() r1 r2}}{{/rollTotal() r1 r2}}
                                            {{/attack}}
                                        </span>
                                        <span class="sublabel">{{dmg1type}}</span>
                                    </div>
                                {{/dmg2flag}}
                            {{/dmg1flag}}
                            {{#dmg2flag}}
                                {{^dmg1flag}}
                                    <div class="solo">
                                        <span class="damage">
                                            {{dmg2}}
                                            {{#attack}}
                                                {{#rollTotal() r1 r2}}{{/rollTotal() r1 r2}}
                                            {{/attack}}
                                        </span>
                                        <span class="sublabel">{{dmg2type}}</span>
                                    </div>
                                {{/dmg1flag}}
                            {{/dmg2flag}}
                            {{#dmg1flag}}
                                {{#dmg2flag}}
                                    <div class="adv">
                                        <span class="damage">
                                            {{dmg1}}
                                            {{#attack}}
                                                {{#rollTotal() r1 r2}}{{/rollTotal() r1 r2}}
                                            {{/attack}}
                                        </span>
                                        <span class="sublabel">{{dmg1type}}</span>
                                    </div>
                                    <div class="advspacer"></div>
                                    <div class="adv">
                                        <span>
                                            {{dmg2}}
                                            {{#attack}}
                                                {{#rollTotal() r1 r2}}{{/rollTotal() r1 r2}}
                                            {{/attack}}
                                        </span>
                                        <span class="sublabel">{{dmg2type}}</span>
                                    </div>
                                {{/dmg2flag}}
                            {{/dmg1flag}}
                        </div>
                        {{^attack}}
                            {{#range}}
                                <div class="sublabel">
                                    <span>{{range}}</span>
                                </div>
                            {{/range}}
                            <div class="label">
                                <span>{{rname}}</span>
                            </div>
                            {{#charname}}
                                <div class="charname">
                                    <span>{{charname}}</span>
                                </div>
                            {{/charname}}
                        {{/attack}}
                    </div>
                {{/damage}}
            </rolltemplate>

            <rolltemplate class="sheet-rolltemplate-atk">
                <div class="row header">
                    {{rname}}
                </div>
                {{#name}}
                    <div class="row subheader">
                        <span class="italics">{{name}}</span>
                    </div>
                {{/name}}
                {{#range}}
                    <div class="sublabel">
                        <span>{{range}}</span>
                    </div>
                {{/range}}
                <div class="row">
                    <span>{{r1}}</span><span> | </span><span>{{r2}}</span>
                </div>
                {{#description}}
                    <div class="row">
                        <span class="desc">{{description}}</span>
                    </div>
                {{/description}}
            </rolltemplate>

            <rolltemplate class="sheet-rolltemplate-dmg">
                <div class="container dmgcontainer damagetemplate">
                    <span class="italics">Damage: </span>
                    <span>
                        {{#dmg1flag}}
                            {{dmg1}}{{dmg1type}}
                        {{/dmg1flag}}
                        {{#dmg1flag}}{{#dmg2flag}} + {{/dmg2flag}}{{/dmg1flag}}
                        {{#dmg2flag}}
                            {{dmg2}}{{dmg2type}}
                        {{/dmg2flag}}
                    </span>
                </div>
            </rolltemplate>

            <rolltemplate class="sheet-rolltemplate-features">
                <div class="row header">
                    <span>{{name}}</span>
                </div>
                {{#source}}
                <div class="row subheader">
                    <span class="italics">{{#charname}}{{charname}} {{/charname}}{{source}}</span>
                </div>
                {{/source}}
                {{#description}}
                    <div class="row">
                        <span class="desc">{{description}}</span>
                    </div>
                {{/description}}
            </rolltemplate>
        </div>
    </div>

    <script type="text/worker">
        on("change:agility change:power change:vitality change:cultivation change:mental_strength change:appearance change:qi_control", function(eventinfo) {
            update_npc_skills();
            update_npc_moves();
            update_npc_legendary_moves();
            update_skills();
            update_moves();
            update_initiative();
            update_evasion();
            update_durability();
            update_reduction();
            console.log("Updating Everything");
        });
        
        on("change:acrobatics_bonus change:athletics_bonus change:charm_bonus change:deceit_bonus change:disguise_bonus change:fine_arts_bonus change:forgery_bonus change:history_bonus change:intuition_bonus change:intimidation_bonus change:investigation_bonus change:medicine_bonus change:navigation_bonus change:perception_bonus change:performance_bonus change:persuade_bonus change:discretion_bonus change:stealth_bonus change:survival_bonus", function(eventinfo) {
            update_skills();
            console.log("Updating PC Skills");
        });
        
        on("change:repeating_nmove:name change:repeating_move:attack_flag change:repeating_move:attack_type change:repeating_move:attack_range change:repeating_move:attack_tohit change:repeating_move:attack_bonus change:repeating_move:attack_damage change:repeating_move:attack_damage1attribute change:repeating_move:attack_damage1bonus change:repeating_move:attack_damagetype change:repeating_move:attack_damage2 change:repeating_move:attack_damage2attribute change:repeating_move:attack_damage2bonus change:repeating_move:attack_damagetype2 change:repeating_move:description", function(eventinfo) {
            update_moves();
            console.log("Updating PC Moves");
        });
        
        on("change:npc_acrobatics_bonus change:npc_athletics_bonus change:npc_charm_bonus change:npc_deceit_bonus change:npc_disguise_bonus change:npc_fine_arts_bonus change:npc_forgery_bonus change:npc_history_bonus change:npc_intuition_bonus change:npc_intimidation_bonus change:npc_investigation_bonus change:npc_medicine_bonus change:npc_navigation_bonus change:npc_perception_bonus change:npc_performance_bonus change:npc_persuade_bonus change:npc_discretion_bonus change:npc_stealth_bonus change:npc_survival_bonus", function(eventinfo) {
            update_npc_skills();
            console.log("Updating NPC Skills");
        });
        
        on("change:repeating_npcmove:name change:repeating_npcmove:attack_flag change:repeating_npcmove:attack_type change:repeating_npcmove:attack_range change:repeating_npcmove:attack_tohit change:repeating_npcmove:attack_bonus change:repeating_npcmove:attack_damage change:repeating_npcmove:attack_damage1attribute change:repeating_npcmove:attack_damage1bonus change:repeating_npcmove:attack_damagetype change:repeating_npcmove:attack_damage2 change:repeating_npcmove:attack_damage2attribute change:repeating_npcmove:attack_damage2bonus change:repeating_npcmove:attack_damagetype2 change:repeating_npcmove:description", function(eventinfo) {
            update_npc_moves();
            console.log("Updating NPC Moves");
        });
        
        on("change:repeating_npcmove-l:name change:repeating_npcmove-l:attack_flag change:repeating_npcmove-l:attack_type change:repeating_npcmove-l:attack_range change:repeating_npcmove-l:attack_tohit change:repeating_npcmove-l:attack_bonus change:repeating_npcmove-l:attack_damage change:repeating_npcmove-l:attack_damage1attribute change:repeating_npcmove-l:attack_damage1bonus change:repeating_npcmove-l:attack_damagetype change:repeating_npcmove-l:attack_damage2 change:repeating_npcmove-l:attack_damage2attribute change:repeating_npcmove-l:attack_damage2bonus change:repeating_npcmove-l:attack_damagetype2 change:repeating_npcmove-l:description", function(eventinfo) {
            update_npc_legendary_moves();
            console.log("Updating NPC Legendary Moves");
        });
        
        on("change:evasion-base change:evasion-limit change:evasion-bonus", function(eventinfo) {
            update_evasion();
            console.log("Updating PC Evasion");
        });
        
        on("change:durability-base change:durability-limit change:durability-bonus", function(eventinfo) {
            update_durability();
            console.log("Updating PC Durability");
        });
        
        on("change:reduction-base change:reduction-armour change:reduction-bonus", function(eventinfo) {
            update_reduction();
            console.log("Updating PC Damage Reduction");
        });
        
        on("change:dtype", function(eventinfo) {
            if (eventinfo.sourceType && eventinfo.sourceType === "sheetworker") {
                return;
            }
            update_npc_moves();
            update_moves();
            update_npc_legendary_moves();
            console.log("Updating DType");
        });
        
        var update_npc_skills = function() {
            getAttrs(["npc_acrobatics_bonus", "npc_athletics_bonus", "npc_charm_bonus", "npc_deceit_bonus", "npc_disguise_bonus", "npc_fine_arts_bonus", "npc_forgery_bonus", "npc_history_bonus", "npc_intuition_bonus", "npc_intimidation_bonus", "npc_investigation_bonus", "npc_medicine_bonus", "npc_navigation_bonus", "npc_perception_bonus", "npc_performance_bonus", "npc_persuade_bonus", "npc_discretion_bonus", "npc_stealth_bonus", "npc_survival_bonus", "agility", "power", "mental_strength", "appearance", "qi_control"], function(v) {
                var update = {};   
        
                // Calculate base values
                var agility = parseInt(v.agility) || 0;
                var power = parseInt(v.power) || 0;
                var mental_strength = parseInt(v.mental_strength) || 0;
                var appearance = parseInt(v.appearance) || 0;
                var qi_control = parseInt(v.qi_control) || 0;
        
                update["npc_acrobatics_roll"] = agility;
                update["npc_athletics_roll"] = power;
                update["npc_charm_roll"] = Math.round(mental_strength + appearance);
                update["npc_deceit_roll"] = Math.round(mental_strength + appearance);
                update["npc_discretion_roll"] = agility;
                update["npc_disguise_roll"] = Math.round(mental_strength + appearance);
                update["npc_fine_arts_roll"] = Math.round(agility / 2 + mental_strength / 2);
                update["npc_forgery_roll"] = Math.round(agility / 2 + mental_strength / 2);
                update["npc_history_roll"] = Math.round(qi_control / 2 + mental_strength / 2);
                update["npc_intuition_roll"] = mental_strength;
                update["npc_intimidation_roll"] = Math.round(power + appearance);
                update["npc_investigation_roll"] = mental_strength;
                update["npc_medicine_roll"] = Math.round(qi_control / 2 + mental_strength / 2);
                update["npc_navigation_roll"] = Math.round(agility / 2 + mental_strength / 2);
                update["npc_perception_roll"] = mental_strength;
                update["npc_performance_roll"] = Math.round(agility + appearance);
                update["npc_persuade_roll"] = Math.round(mental_strength + appearance);
                update["npc_stealth_roll"] = agility;
                update["npc_survival_roll"] = Math.round(power / 2 + mental_strength / 2);
        
                // Calculate full rolls
                update["npc_acrobatics"] = update["npc_acrobatics_roll"] + (parseInt(v.npc_acrobatics_bonus) ? `d6 + ${parseInt(v.npc_acrobatics_bonus)}` : 'd6');
                update["npc_athletics"] = update["npc_athletics_roll"] + (parseInt(v.npc_athletics_bonus) ? `d6 + ${parseInt(v.npc_athletics_bonus)}` : 'd6');
                update["npc_charm"] = update["npc_charm_roll"] + (parseInt(v.npc_charm_bonus) ? `d6 + ${parseInt(v.npc_charm_bonus)}` : 'd6');
                update["npc_deceit"] = update["npc_deceit_roll"] + (parseInt(v.npc_deceit_bonus) ? `d6 + ${parseInt(v.npc_deceit_bonus)}` : 'd6');
                update["npc_discretion"] = update["npc_discretion_roll"] + (parseInt(v.npc_discretion_bonus) ? `d6 + ${parseInt(v.npc_discretion_bonus)}` : 'd6');
                update["npc_disguise"] = update["npc_disguise_roll"] + (parseInt(v.npc_disguise_bonus) ? `d6 + ${parseInt(v.npc_disguise_bonus)}` : 'd6');
                update["npc_fine_arts"] = update["npc_fine_arts_roll"] + (parseInt(v.npc_fine_arts_bonus) ? `d6 + ${parseInt(v.npc_fine_arts_bonus)}` : 'd6');
                update["npc_forgery"] = update["npc_forgery_roll"] + (parseInt(v.npc_forgery_bonus) ? `d6 + ${parseInt(v.npc_forgery_bonus)}` : 'd6');
                update["npc_history"] = update["npc_history_roll"] + (parseInt(v.npc_history_bonus) ? `d6 + ${parseInt(v.npc_history_bonus)}` : 'd6');
                update["npc_intuition"] = update["npc_intuition_roll"] + (parseInt(v.npc_intuition_bonus) ? `d6 + ${parseInt(v.npc_intuition_bonus)}` : 'd6');
                update["npc_intimidation"] = update["npc_intimidation_roll"] + (parseInt(v.npc_intimidation_bonus) ? `d6 + ${parseInt(v.npc_intimidation_bonus)}` : 'd6');
                update["npc_investigation"] = update["npc_investigation_roll"] + (parseInt(v.npc_investigation_bonus) ? `d6 + ${parseInt(v.npc_investigation_bonus)}` : 'd6');
                update["npc_medicine"] = update["npc_medicine_roll"] + (parseInt(v.npc_medicine_bonus) ? `d6 + ${parseInt(v.npc_medicine_bonus)}` : 'd6');
                update["npc_navigation"] = update["npc_navigation_roll"] + (parseInt(v.npc_navigation_bonus) ? `d6 + ${parseInt(v.npc_navigation_bonus)}` : 'd6');
                update["npc_perception"] = update["npc_perception_roll"] + (parseInt(v.npc_perception_bonus) ? `d6 + ${parseInt(v.npc_perception_bonus)}` : 'd6');
                update["npc_performance"] = update["npc_performance_roll"] + (parseInt(v.npc_performance_bonus) ? `d6 + ${parseInt(v.npc_performance_bonus)}` : 'd6');
                update["npc_persuade"] = update["npc_persuade_roll"] + (parseInt(v.npc_persuade_bonus) ? `d6 + ${parseInt(v.npc_persuade_bonus)}` : 'd6');
                update["npc_stealth"] = update["npc_stealth_roll"] + (parseInt(v.npc_stealth_bonus) ? `d6 + ${parseInt(v.npc_stealth_bonus)}` : 'd6');
                update["npc_survival"] = update["npc_survival_roll"] + (parseInt(v.npc_survival_bonus) ? `d6 + ${parseInt(v.npc_survival_bonus)}` : 'd6');
        
                setAttrs(update, {
                    silent: true
                });
            });
        };
        
        var update_skills = function() {
            getAttrs(["acrobatics_bonus", "athletics_bonus", "charm_bonus", "deceit_bonus", "disguise_bonus", "fine_arts_bonus", "forgery_bonus", "history_bonus", "intuition_bonus", "intimidation_bonus", "investigation_bonus", "medicine_bonus", "navigation_bonus", "perception_bonus", "performance_bonus", "persuade_bonus", "discretion_bonus", "stealth_bonus", "survival_bonus", "agility", "power", "mental_strength", "appearance", "qi_control"], function(v) {
                var update = {};
        
                // Calculate base values
                var agility = parseInt(v.agility) || 0;
                var power = parseInt(v.power) || 0;
                var mental_strength = parseInt(v.mental_strength) || 0;
                var appearance = parseInt(v.appearance) || 0;
                var qi_control = parseInt(v.qi_control) || 0;
        
                update["acrobatics_roll"] = agility;
                update["athletics_roll"] = power;
                update["charm_roll"] = Math.round(mental_strength + appearance);
                update["deceit_roll"] = Math.round(mental_strength + appearance);
                update["discretion_roll"] = agility;
                update["disguise_roll"] = Math.round(mental_strength + appearance);
                update["fine_arts_roll"] = Math.round(agility / 2 + mental_strength / 2);
                update["forgery_roll"] = Math.round(agility / 2 + mental_strength / 2);
                update["history_roll"] = Math.round(qi_control / 2 + mental_strength / 2);
                update["intuition_roll"] = mental_strength;
                update["intimidation_roll"] = Math.round(power + appearance);
                update["investigation_roll"] = mental_strength;
                update["medicine_roll"] = Math.round(qi_control / 2 + mental_strength / 2);
                update["navigation_roll"] = Math.round(agility / 2 + mental_strength / 2);
                update["perception_roll"] = mental_strength;
                update["performance_roll"] = Math.round(agility + appearance);
                update["persuade_roll"] = Math.round(mental_strength + appearance);
                update["stealth_roll"] = agility;
                update["survival_roll"] = Math.round(power / 2 + mental_strength / 2);
        
                // Calculate full rolls
                update["acrobatics"] = update["acrobatics_roll"] + (parseInt(v.acrobatics_bonus) ? `d6 + ${parseInt(v.acrobatics_bonus)}` : 'd6');
                update["athletics"] = update["athletics_roll"] + (parseInt(v.athletics_bonus) ? `d6 + ${parseInt(v.athletics_bonus)}` : 'd6');
                update["charm"] = update["charm_roll"] + (parseInt(v.charm_bonus) ? `d6 + ${parseInt(v.charm_bonus)}` : 'd6');
                update["deceit"] = update["deceit_roll"] + (parseInt(v.deceit_bonus) ? `d6 + ${parseInt(v.deceit_bonus)}` : 'd6');
                update["disguise"] = update["disguise_roll"] + (parseInt(v.disguise_bonus) ? `d6 + ${parseInt(v.disguise_bonus)}` : 'd6');
                update["fine_arts"] = update["fine_arts_roll"] + (parseInt(v.fine_arts_bonus) ? `d6 + ${parseInt(v.fine_arts_bonus)}` : 'd6');
                update["forgery"] = update["forgery_roll"] + (parseInt(v.forgery_bonus) ? `d6 + ${parseInt(v.forgery_bonus)}` : 'd6');
                update["history"] = update["history_roll"] + (parseInt(v.history_bonus) ? `d6 + ${parseInt(v.history_bonus)}` : 'd6');
                update["intuition"] = update["intuition_roll"] + (parseInt(v.intuition_bonus) ? `d6 + ${parseInt(v.intuition_bonus)}` : 'd6');
                update["intimidation"] = update["intimidation_roll"] + (parseInt(v.intimidation_bonus) ? `d6 + ${parseInt(v.intimidation_bonus)}` : 'd6');
                update["investigation"] = update["investigation_roll"] + (parseInt(v.investigation_bonus) ? `d6 + ${parseInt(v.investigation_bonus)}` : 'd6');
                update["medicine"] = update["medicine_roll"] + (parseInt(v.medicine_bonus) ? `d6 + ${parseInt(v.medicine_bonus)}` : 'd6');
                update["navigation"] = update["navigation_roll"] + (parseInt(v.navigation_bonus) ? `d6 + ${parseInt(v.navigation_bonus)}` : 'd6');
                update["perception"] = update["perception_roll"] + (parseInt(v.perception_bonus) ? `d6 + ${parseInt(v.perception_bonus)}` : 'd6');
                update["performance"] = update["performance_roll"] + (parseInt(v.performance_bonus) ? `d6 + ${parseInt(v.performance_bonus)}` : 'd6');
                update["persuade"] = update["persuade_roll"] + (parseInt(v.persuade_bonus) ? `d6 + ${parseInt(v.persuade_bonus)}` : 'd6');
                update["discretion"] = update["discretion_roll"] + (parseInt(v.discretion_bonus) ? `d6 + ${parseInt(v.discretion_bonus)}` : 'd6');
                update["stealth"] = update["stealth_roll"] + (parseInt(v.stealth_bonus) ? `d6 + ${parseInt(v.stealth_bonus)}` : 'd6');
                update["survival"] = update["survival_roll"] + (parseInt(v.survival_bonus) ? `d6 + ${parseInt(v.survival_bonus)}` : 'd6');
        
                setAttrs(update, {
                    silent: true
                });
            });
        };
        
        var update_moves = function() {
            getSectionIDs("repeating_move", function(idarray) {
                _.each(idarray, function(id) {
                    getAttrs([
                        `repeating_move_${id}_name`,
                        `repeating_move_${id}_attack_flag`,
                        `repeating_move_${id}_attack_range`,
                        `repeating_move_${id}_attack_tohit`,
                        `repeating_move_${id}_attack_bonus`,
                        `repeating_move_${id}_attack_damage`,
                        `repeating_move_${id}_attack_damage1attribute`,
                        `repeating_move_${id}_attack_damage1bonus`,
                        `repeating_move_${id}_attack_damagetype`,
                        `repeating_move_${id}_attack_damage2`,
                        `repeating_move_${id}_attack_damage2attribute`,
                        `repeating_move_${id}_attack_damage2bonus`,
                        `repeating_move_${id}_attack_damagetype2`,
                        `repeating_move_${id}_description`,
                        "power", "agility", "vitality", "cultivation", "qi_control", "mental_strength", "dtype"
                    ], function(v) {
                        var update = {};
        
                        var attackFlag = v[`repeating_move_${id}_attack_flag`] === "on" ? 1 : 0;
                        var atkFlag = (attackFlag === 1) ? "{{attack=1}}" : "";
        
                        var attackRange = v[`repeating_move_${id}_attack_range`];
                        var attackToHit = v[`repeating_move_${id}_attack_tohit`].replace("@{", "").replace("}", "");
                        var attackBonus = parseInt(v[`repeating_move_${id}_attack_bonus`]) || 0;
        
                        var damage1 = v[`repeating_move_${id}_attack_damage`];
                        var damage1Attribute = v[`repeating_move_${id}_attack_damage1attribute`];
                        var damage1Bonus = parseInt(v[`repeating_move_${id}_attack_damage1bonus`]) || 0;
                        var damage1Type = v[`repeating_move_${id}_attack_damagetype`];
        
                        var damage2 = v[`repeating_move_${id}_attack_damage2`];
                        var damage2Attribute = v[`repeating_move_${id}_attack_damage2attribute`];
                        var damage2Bonus = parseInt(v[`repeating_move_${id}_attack_damage2bonus`]) || 0;
                        var damage2Type = v[`repeating_move_${id}_attack_damagetype2`];
        
                        var damage_flag = "";
                        if (damage1 != "" || damage2 != "") {
                            damage_flag = damage_flag + "{{damage=1}} ";
                        }
                        if (damage1 != "") {
                            damage_flag = damage_flag + "{{dmg1flag=1}} ";
                        }
                        if (damage2 != "") {
                            damage_flag = damage_flag + "{{dmg2flag=1}} ";
                        }
        
                        var description = v[`repeating_move_${id}_description`];
        
                        var toHitValue = parseInt(v[attackToHit.replace("@{", "").replace("}", "")]) || 0;
                        var toHitString = attackBonus !== 0 ? `${toHitValue} + ${attackBonus}` : `${toHitValue}`;
        
                        var damage1AttrValue = damage1Attribute !== "none" ? (parseInt(v[damage1Attribute.replace("@{", "").replace("}", "")]) || 0) : 0;
                        var damage1String = `${damage1} + ${damage1AttrValue} + ${damage1Bonus}`;
        
                        var damage2AttrValue = damage2Attribute !== "none" ? (parseInt(v[damage2Attribute.replace("@{", "").replace("}", "")]) || 0) : 0;
                        var damage2String = `${damage2} + ${damage2AttrValue} + ${damage2Bonus}`;
        
                        var details = `${toHitString}, Reach: ${attackRange}\n`;
                        details += `Damage: (${damage1String}) ${damage1Type}`;
                        if (damage2) {
                            details += ` + (${damage2String}) ${damage2Type}`;
                        }
                        details += `\nDescription: ${description}`;
        
                        var rollbase = "";
                        if (v.dtype === "full") {
                            rollbase = `@{wtype}&{template:move} {{range=${attackRange}}} {{rname=@{name}}} ${atkFlag} ${damage_flag} {{r1=[[@{${attackToHit}}+${attackBonus}]]}} `;
                            if (damage1) {
                                rollbase += `{{dmg1=[[@{attack_damage} + [[${damage1AttrValue}]] + [[${damage1Bonus}]] ]]}} {{dmg1type=${damage1Type}}} `;
                            }
                            if (damage2) {
                                rollbase += `{{dmg2=[[@{attack_damage2} + [[${damage2AttrValue}]] + [[${damage2Bonus}]] ]]}} {{dmg2type=${damage2Type}}} `;
                            }
                        } else if (attackFlag) {
                            rollbase = `@{wtype}&{template:atk} ${atkFlag} ${damage_flag} {{range=${attackRange}}} {{rname=[@{name}](~repeating_move_dmg)}} {{type=[Attack](~repeating_move_dmg)}} {{r1=[[@{${attackToHit}}+${attackBonus}]]}} {{description=${description}}}`;
                        } else if (damage1 || damage2) {
                            rollbase = `@{wtype}&{template:dmg} ${damage_flag} `;
                            if (damage1) {
                                rollbase += `{{dmg1=[[@{attack_damage} + ${damage1AttrValue} + ${damage1Bonus}]]}} {{dmg1type=${damage1Type}}} `;
                            }
                            if (damage2) {
                                rollbase += `{{dmg2=[[@{attack_damage2} + ${damage2AttrValue} + ${damage2Bonus}]]}} {{dmg2type=${damage2Type}}} `;
                            }
                        } else {
                            rollbase = `@{wtype}&{template:move} {{rname=@{name}}} {{description=${description}}}`;
                        }
        
                        var full_damage = `@{wtype}&{template:dmg} ${damage_flag} `;
                        if (damage1) {
                            full_damage += `{{dmg1=[[@{attack_damage} + ${damage1AttrValue} + ${damage1Bonus}]]}} {{dmg1type=${damage1Type}}} `;
                        }
                        if (damage2) {
                            full_damage += `{{dmg2=[[@{attack_damage2} + ${damage2AttrValue} + ${damage2Bonus}]]}} {{dmg2type=${damage2Type}}} `;
                        }
        
                        update[`repeating_move_${id}_attack_details`] = details;
                        update[`repeating_move_${id}_attack_hitdamage`] = `Hit: ${toHitString}, (${attackRange}), Damage: (${damage1String}) ${damage1Type}`;
                        if (damage2) {
                            update[`repeating_move_${id}_attack_hitdamage`] += ` + (${damage2String}) ${damage2Type}`;
                        }
                        update[`repeating_move_${id}_attack_description`] = description;
                        update[`repeating_move_${id}_rollbase`] = rollbase;
                        update[`repeating_move_${id}_damage_flag`] = damage_flag;
                        update[`repeating_move_${id}_full_damage`] = full_damage;
        
                        setAttrs(update, { silent: true });
                    });
                });
            });
        };
        
        var update_npc_moves = function() {
            getSectionIDs("repeating_npcmove", function(idarray) {
                _.each(idarray, function(id) {
                    getAttrs([
                        `repeating_npcmove_${id}_name`,
                        `repeating_npcmove_${id}_attack_flag`,
                        `repeating_npcmove_${id}_attack_type`,
                        `repeating_npcmove_${id}_attack_range`,
                        `repeating_npcmove_${id}_attack_tohit`,
                        `repeating_npcmove_${id}_attack_bonus`,
                        `repeating_npcmove_${id}_attack_damage`,
                        `repeating_npcmove_${id}_attack_damage1attribute`,
                        `repeating_npcmove_${id}_attack_damage1bonus`,
                        `repeating_npcmove_${id}_attack_damagetype`,
                        `repeating_npcmove_${id}_attack_damage2`,
                        `repeating_npcmove_${id}_attack_damage2attribute`,
                        `repeating_npcmove_${id}_attack_damage2bonus`,
                        `repeating_npcmove_${id}_attack_damagetype2`,
                        `repeating_npcmove_${id}_description`,
                        "power", "agility", "vitality", "cultivation", "qi_control", "mental_strength", "dtype"
                    ], function(v) {
                        var update = {};
        
                        var attackFlag = v[`repeating_npcmove_${id}_attack_flag`] === "on" ? 1 : 0;
                        var atkFlag = (attackFlag === 1) ? "{{attack=1}}" : "";
        
                        var attackType = v[`repeating_npcmove_${id}_attack_type`];
                        var attackRange = v[`repeating_npcmove_${id}_attack_range`];
                        var attackToHit = v[`repeating_npcmove_${id}_attack_tohit`].replace("@{", "").replace("}", "");
                        var attackBonus = parseInt(v[`repeating_npcmove_${id}_attack_bonus`]) || 0;
        
                        var damage1 = v[`repeating_npcmove_${id}_attack_damage`];
                        var damage1Attribute = v[`repeating_npcmove_${id}_attack_damage1attribute`];
                        var damage1Bonus = parseInt(v[`repeating_npcmove_${id}_attack_damage1bonus`]) || 0;
                        var damage1Type = v[`repeating_npcmove_${id}_attack_damagetype`];
        
                        var damage2 = v[`repeating_npcmove_${id}_attack_damage2`];
                        var damage2Attribute = v[`repeating_npcmove_${id}_attack_damage2attribute`];
                        var damage2Bonus = parseInt(v[`repeating_npcmove_${id}_attack_damage2bonus`]) || 0;
                        var damage2Type = v[`repeating_npcmove_${id}_attack_damagetype2`];
        
                        var damage_flag = "";
                        if (damage1 != "" || damage2 != "") {
                            damage_flag = damage_flag + "{{damage=1}} ";
                        }
                        if (damage1 != "") {
                            damage_flag = damage_flag + "{{dmg1flag=1}} ";
                        }
                        if (damage2 != "") {
                            damage_flag = damage_flag + "{{dmg2flag=1}} ";
                        }
        
                        var description = v[`repeating_npcmove_${id}_description`];
        
                        var toHitValue = parseInt(v[attackToHit.replace("@{", "").replace("}", "")]) || 0;
                        var toHitString = attackBonus !== 0 ? `${toHitValue} + ${attackBonus}` : `${toHitValue}`;
        
                        var damage1AttrValue = damage1Attribute !== "none" ? (parseInt(v[damage1Attribute.replace("@{", "").replace("}", "")]) || 0) : 0;
                        var damage1String = `${damage1} + ${damage1AttrValue} + ${damage1Bonus}`;
                        var avgDamage1 = calculateAverageDamage(damage1) + damage1AttrValue + damage1Bonus;
        
                        var damage2AttrValue = damage2Attribute !== "none" ? (parseInt(v[damage2Attribute.replace("@{", "").replace("}", "")]) || 0) : 0;
                        var damage2String = `${damage2} + ${damage2AttrValue} + ${damage2Bonus}`;
                        var avgDamage2 = calculateAverageDamage(damage2) + damage2AttrValue + damage2Bonus;
        
                        var details = `${attackType} Weapon Attack: ${toHitString}, Reach: ${attackRange}\n`;
                        details += `Damage: ${avgDamage1} (${damage1String}) ${damage1Type}`;
                        if (damage2) {
                            details += ` + ${avgDamage2} (${damage2String}) ${damage2Type}`;
                        }
                        details += `\nDescription: ${description}`;
        
                        var rollbase = "";
                        if (v.dtype === "full") {
                            rollbase = `@{wtype}&{template:move} {{range=${attackRange}}} {{rname=@{name}}} ${atkFlag} ${damage_flag} {{r1=[[@{${attackToHit}}+${attackBonus}]]}} `;
                            if (damage1) {
                                rollbase += `{{dmg1=[[@{attack_damage} + [[${damage1AttrValue}]] + [[${damage1Bonus}]] ]]}} {{dmg1type=${damage1Type}}} `;
                            }
                            if (damage2) {
                                rollbase += `{{dmg2=[[@{attack_damage2} + [[${damage2AttrValue}]] + [[${damage2Bonus}]] ]]}} {{dmg2type=${damage2Type}}} `;
                            }
                        } else if (attackFlag) {
                            rollbase = `@{wtype}&{template:atk} ${atkFlag} ${damage_flag} {{range=${attackRange}}} {{rname=[@{name}](~repeating_npcmove_npc_dmg)}} {{type=[Attack](~repeating_npcmove_npc_dmg)}} {{r1=[[@{${attackToHit}}+${attackBonus}]]}} {{description=${description}}}`;
                        } else if (damage1 || damage2) {
                            rollbase = `@{wtype}&{template:dmg} ${damage_flag} `;
                            if (damage1) {
                                rollbase += `{{dmg1=[[@{attack_damage} + ${damage1AttrValue} + ${damage1Bonus}]]}} {{dmg1type=${damage1Type}}} `;
                            }
                            if (damage2) {
                                rollbase += `{{dmg2=[[@{attack_damage2} + ${damage2AttrValue} + ${damage2Bonus}]]}} {{dmg2type=${damage2Type}}} `;
                            }
                        } else {
                            rollbase = `@{wtype}&{template:move} {{rname=@{name}}} {{description=${description}}}`;
                        }
        
                        var full_damage = `@{wtype}&{template:dmg} ${damage_flag} `;
                        if (damage1) {
                            full_damage += `{{dmg1=[[@{attack_damage} + ${damage1AttrValue} + ${damage1Bonus}]]}} {{dmg1type=${damage1Type}}} `;
                        }
                        if (damage2) {
                            full_damage += `{{dmg2=[[@{attack_damage2} + ${damage2AttrValue} + ${damage2Bonus}]]}} {{dmg2type=${damage2Type}}} `;
                        }
        
                        update[`repeating_npcmove_${id}_attack_details`] = details;
                        update[`repeating_npcmove_${id}_attack_tohitrange`] = `To Hit: ${toHitString}, Range: ${attackRange}`;
                        update[`repeating_npcmove_${id}_attack_onhit`] = `Damage: ${avgDamage1} (${damage1String}) ${damage1Type}`;
                        if (damage2) {
                            update[`repeating_npcmove_${id}_attack_onhit`] += ` + ${avgDamage2} (${damage2String}) ${damage2Type}`;
                        }
                        update[`repeating_npcmove_${id}_attack_description`] = description;
                        update[`repeating_npcmove_${id}_rollbase`] = rollbase;
                        update[`repeating_npcmove_${id}_damage_flag`] = damage_flag;
                        update[`repeating_npcmove_${id}_full_damage`] = full_damage;
        
                        setAttrs(update, { silent: true });
                    });
                });
            });
        };
        
        var update_npc_legendary_moves = function() {
            getSectionIDs("repeating_npcmove-l", function(idarray) {
                _.each(idarray, function(id) {
                    getAttrs([
                        `repeating_npcmove-l_${id}_name`,
                        `repeating_npcmove-l_${id}_attack_flag`,
                        `repeating_npcmove-l_${id}_attack_type`,
                        `repeating_npcmove-l_${id}_attack_range`,
                        `repeating_npcmove-l_${id}_attack_tohit`,
                        `repeating_npcmove-l_${id}_attack_bonus`,
                        `repeating_npcmove-l_${id}_attack_damage`,
                        `repeating_npcmove-l_${id}_attack_damage1attribute`,
                        `repeating_npcmove-l_${id}_attack_damage1bonus`,
                        `repeating_npcmove-l_${id}_attack_damagetype`,
                        `repeating_npcmove-l_${id}_attack_damage2`,
                        `repeating_npcmove-l_${id}_attack_damage2attribute`,
                        `repeating_npcmove-l_${id}_attack_damage2bonus`,
                        `repeating_npcmove-l_${id}_attack_damagetype2`,
                        `repeating_npcmove-l_${id}_description`,
                        "power", "agility", "vitality", "cultivation", "qi_control", "mental_strength", "dtype"
                    ], function(v) {
                        var update = {};
        
                        var attackFlag = v[`repeating_npcmove-l_${id}_attack_flag`] === "on" ? 1 : 0;
                        var atkFlag = (attackFlag === 1) ? "{{attack=1}}" : "";
        
                        var attackType = v[`repeating_npcmove-l_${id}_attack_type`];
                        var attackRange = v[`repeating_npcmove-l_${id}_attack_range`];
                        var attackToHit = v[`repeating_npcmove-l_${id}_attack_tohit`].replace("@{", "").replace("}", "");
                        var attackBonus = parseInt(v[`repeating_npcmove-l_${id}_attack_bonus`]) || 0;
        
                        var damage1 = v[`repeating_npcmove-l_${id}_attack_damage`];
                        var damage1Attribute = v[`repeating_npcmove-l_${id}_attack_damage1attribute`];
                        var damage1Bonus = parseInt(v[`repeating_npcmove-l_${id}_attack_damage1bonus`]) || 0;
                        var damage1Type = v[`repeating_npcmove-l_${id}_attack_damagetype`];
        
                        var damage2 = v[`repeating_npcmove-l_${id}_attack_damage2`];
                        var damage2Attribute = v[`repeating_npcmove-l_${id}_attack_damage2attribute`];
                        var damage2Bonus = parseInt(v[`repeating_npcmove-l_${id}_attack_damage2bonus`]) || 0;
                        var damage2Type = v[`repeating_npcmove-l_${id}_attack_damagetype2`];
        
                        var damage_flag = "";
                        if (damage1 != "" || damage2 != "") {
                            damage_flag = damage_flag + "{{damage=1}} ";
                        }
                        if (damage1 != "") {
                            damage_flag = damage_flag + "{{dmg1flag=1}} ";
                        }
                        if (damage2 != "") {
                            damage_flag = damage_flag + "{{dmg2flag=1}} ";
                        }
        
                        var description = v[`repeating_npcmove-l_${id}_description`];
        
                        var toHitValue = parseInt(v[attackToHit.replace("@{", "").replace("}", "")]) || 0;
                        var toHitString = attackBonus !== 0 ? `${toHitValue} + ${attackBonus}` : `${toHitValue}`;
        
                        var damage1AttrValue = damage1Attribute !== "none" ? (parseInt(v[damage1Attribute.replace("@{", "").replace("}", "")]) || 0) : 0;
                        var damage1String = `${damage1} + ${damage1AttrValue} + ${damage1Bonus}`;
                        var avgDamage1 = calculateAverageDamage(damage1) + damage1AttrValue + damage1Bonus;
        
                        var damage2AttrValue = damage2Attribute !== "none" ? (parseInt(v[damage2Attribute.replace("@{", "").replace("}", "")]) || 0) : 0;
                        var damage2String = `${damage2} + ${damage2AttrValue} + ${damage2Bonus}`;
                        var avgDamage2 = calculateAverageDamage(damage2) + damage2AttrValue + damage2Bonus;
        
                        var details = `${attackType} Weapon Attack: ${toHitString}, Reach: ${attackRange}\n`;
                        details += `Damage: ${avgDamage1} (${damage1String}) ${damage1Type}`;
                        if (damage2) {
                            details += ` + ${avgDamage2} (${damage2String}) ${damage2Type}`;
                        }
                        details += `\nDescription: ${description}`;
        
                        var rollbase = "";
                        if (v.dtype === "full") {
                            rollbase = `@{wtype}&{template:move} {{range=${attackRange}}} {{rname=@{name}}} ${atkFlag} ${damage_flag} {{r1=[[@{${attackToHit}}+${attackBonus}]]}} `;
                            if (damage1) {
                                rollbase += `{{dmg1=[[@{attack_damage} + [[${damage1AttrValue}]] + [[${damage1Bonus}]] ]]}} {{dmg1type=${damage1Type}}} `;
                            }
                            if (damage2) {
                                rollbase += `{{dmg2=[[@{attack_damage2} + [[${damage2AttrValue}]] + [[${damage2Bonus}]] ]]}} {{dmg2type=${damage2Type}}} `;
                            }
                        } else if (attackFlag) {
                            rollbase = `@{wtype}&{template:atk} ${atkFlag} ${damage_flag} {{range=${attackRange}}} {{rname=[@{name}](~repeating_npcmove-l_npc_dmg)}} {{type=[Attack](~repeating_npcmove-l_npc_dmg)}} {{r1=[[@{${attackToHit}}+${attackBonus}]]}} {{description=${description}}}`;
                        } else if (damage1 || damage2) {
                            rollbase = `@{wtype}&{template:dmg} ${damage_flag} `;
                            if (damage1) {
                                rollbase += `{{dmg1=[[@{attack_damage} + ${damage1AttrValue} + ${damage1Bonus}]]}} {{dmg1type=${damage1Type}}} `;
                            }
                            if (damage2) {
                                rollbase += `{{dmg2=[[@{attack_damage2} + ${damage2AttrValue} + ${damage2Bonus}]]}} {{dmg2type=${damage2Type}}} `;
                            }
                        } else {
                            rollbase = `@{wtype}&{template:move} {{rname=@{name}}} {{description=${description}}}`;
                        }
        
                        var full_damage = `@{wtype}&{template:dmg} ${damage_flag} `;
                        if (damage1) {
                            full_damage += `{{dmg1=[[@{attack_damage} + ${damage1AttrValue} + ${damage1Bonus}]]}} {{dmg1type=${damage1Type}}} `;
                        }
                        if (damage2) {
                            full_damage += `{{dmg2=[[@{attack_damage2} + ${damage2AttrValue} + ${damage2Bonus}]]}} {{dmg2type=${damage2Type}}} `;
                        }
        
                        update[`repeating_npcmove-l_${id}_attack_details`] = details;
                        update[`repeating_npcmove-l_${id}_attack_tohitrange`] = `To Hit: ${toHitString}, Range: ${attackRange}`;
                        update[`repeating_npcmove-l_${id}_attack_onhit`] = `Damage: ${avgDamage1} (${damage1String}) ${damage1Type}`;
                        if (damage2) {
                            update[`repeating_npcmove-l_${id}_attack_onhit`] += ` + ${avgDamage2} (${damage2String}) ${damage2Type}`;
                        }
                        update[`repeating_npcmove-l_${id}_attack_description`] = description;
                        update[`repeating_npcmove-l_${id}_rollbase`] = rollbase;
                        update[`repeating_npcmove-l_${id}_damage_flag`] = damage_flag;
                        update[`repeating_npcmove-l_${id}_full_damage`] = full_damage;
        
                        setAttrs(update, { silent: true });
                    });
                });
            });
        };
        
        var update_initiative = function(){
            getAttrs(["agility","initiative_bonus"], function(v){
                var update = {};
        
                var agility = parseInt(v.agility) || 0;
        
                update["initiative"] = agility + (parseInt(v.agility) ? `d6 + ${parseInt(v.initiative_bonus)}` : 'd6');
        
                setAttrs(update, {
                    silent: true
                });
            });
        };
        
        var update_evasion = function() {
            getAttrs(["evasion-base", "evasion-limit", "evasion-bonus", "agility"], function(v) {
                var update = {};
        
                var agility = parseInt(v.agility) || 0;
                var base = parseInt(v["evasion-base"]) || 0;
                var limit = parseInt(v["evasion-limit"]) || 0;
                var bonus = parseInt(v["evasion-bonus"]) || 0;
        
                if (agility < limit) {
                    update["evasion-full"] = base + agility + bonus;
                } else {
                    update["evasion-full"] = base + limit + Math.floor((agility - limit) / 2) + bonus;
                }
        
                setAttrs(update, {
                    silent: true
                });
            });
        };
        
        var update_durability = function(){
            getAttrs(["durability-base", "durability-limit", "durability-bonus", "power", "vitality", "mental_strength", "qi_control"], function(v) {
                var update = {};
        
                var base = parseInt(v["durability-base"]) || 0;
                var limit = parseInt(v["durability-limit"]) || 0;
                var bonus = parseInt(v["durability-bonus"]) || 0;
        
                update["durability-full"] = base + bonus;
        
                setAttrs(update, {
                    silent: true
                });
            });
        };
        
        var update_reduction = function(){
            getAttrs(["reduction-base", "reduction-armour", "reduction-bonus"], function(v) {
                var update = {};
        
                var base = parseInt(v["reduction-base"]) || 0;
                var armour = parseInt(v["reduction-armour"]) || 0;
                var bonus = parseInt(v["reduction-bonus"]) || 0;
        
                update["reduction-full"] = base + armour + bonus;
        
                setAttrs(update, {
                    silent: true
                });
            });
        };
        
        var calculateAverageDamage = function(damageString) {
            var dicePattern = /(\d+)d(\d+)/;
            var match = damageString.match(dicePattern);
            if (match) {
                var numberOfDice = parseInt(match[1]);
                var sidesOfDice = parseInt(match[2]);
                return numberOfDice * ((sidesOfDice / 2) + 0.5);
            }
            return 0;
        };
    </script>
</div>